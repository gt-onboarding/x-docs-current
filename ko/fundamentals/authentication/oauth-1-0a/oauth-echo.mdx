---
title: OAuth 에코
sidebarTitle: OAuth 에코
keywords: ["OAuth 에코", "OAuth 에코 테스트", "OAuth 검증", "에코 테스트", "OAuth 1.0a 에코", "OAuth 검증"]
---

import { Button } from "/snippets/ko/button.mdx";


<div id="oauth-echo">
  ### OAuth Echo
</div>

OAuth Echo는 API와 상호작용하는 동안 제3자에게 OAuth 인가를 안전하게 위임하는 방법입니다.

이 상호작용에는 네 가지 주체가 참여합니다:

* **User(사용자)** — 특정 인가된 X 애플리케이션을 통해 X를 사용하고 있는 사람
* **Consumer(소비자)** — 제3자 미디어 제공자(예: 사진 공유 사이트)와 상호작용을 시도하는 X 애플리케이션
* **Delegator(위임자)** — 제3자 미디어 제공자
* **Service Provider(서비스 제공자)** — 즉, X 자체
     

요약하면, 애플리케이션과 사용자를 대신하여 Delegator가 X API에 전송할 요청을 준비하는 과정입니다. 원래라면 서명된 OAuth 요청이 되었을 내용을 HTTP 헤더에 넣고, Delegator에게 중간 작업을 완료한 뒤 그 요청을 X로 전송해 달라고 요청하는 방식입니다.

예를 들어, User가 사진을 업로드하고 싶어 한다고 가정해 봅니다. Consumer는 POST 요청으로 Delegator의 업로드 API를 호출합니다. 이 POST에는 이미지를 포함해야 할 뿐만 아니라, HTTP 헤더로 다음 두 가지 추가 항목도 포함해야 합니다:

* `x-auth-service-provider` — 신원 위임을 보내야 할 대상 영역(realm)을 지정합니다. X의 경우에는 이를 https://api.x.com/1.1/account/verify_credentials.json 으로 설정합니다. iOS5 기반 X 연동은 이 URL에 추가 `application_id` 파라미터를 붙이며, 이 파라미터는 `x-verify-credentials-authorization` 에 사용되는 `oauth_signature` 를 계산할 때도 사용됩니다.
* `x-verify-credentials-authorization` — Consumer는 OAuth를 사용해 HTTP 헤더에서 https://api.x.com/1.1/account/verify_credentials.json 를 호출할 수 있도록 필요한 모든 OAuth 파라미터를 생성해야 합니다(예: `OAuth oauth_consumer_key="..."`, `oauth_token="..."`, `oauth_signature_method="..."`, `oauth_signature="..."`, `oauth_timestamp="..."`, `oauth_nonce="..."`, `oauth_version="..."` 와 같은 형태여야 합니다).
     

전체 처리 과정이 `oauth_timestamp` 가 여전히 유효한 시간 안에 모두 완료되어야 한다는 점을 유념하십시오.

또는, 이 두 파라미터를 헤더 대신 POST 본문에 `x_auth_service_provider` 및 `x_verify_credentials_authorization` 으로 보낼 수도 있습니다. 이 경우, 다른 요청에서 파라미터를 인코딩하는 것과 마찬가지로 이 파라미터들을 이스케이프하여 OAuth 서명 베이스 문자열(OAuth signature base string)에 포함해야 한다는 점을 기억하십시오. 가능한 한 작업을 분리하기 위해 HTTP 헤더를 사용하는 것이 가장 좋습니다.

이 시점에서 Delegator의 목표는, 미디어를 저장하기 전에 User가 주장하는 본인임을 검증하는 것입니다. Delegator가 업로드 메서드를 통해 위의 모든 데이터를 수신하면, 이미지를 임시로 저장한 후 `x-auth-service-provider` 헤더에 지정된 엔드포인트(이 예에서는 https://api.x.com/1.1/account/verify_credentials.json)를, Consumer가 `x-verify-credentials-authorization` 헤더에서 제공한 것과 동일한 OAuth 인증 헤더를 사용하여 호출하도록 구성해야 합니다.
 

<div id="oauth-echo-best-practices">
  #### OAuth Echo 모범 사례
</div>

조회 작업을 수행할 때는 하드코딩된 값이 아니라 `x-auth-service-provider`에서 제공한 URL을 사용해야 합니다. 예를 들어 Apple iOS는 모든 OAuth 요청에 추가 application_id 파라미터를 포함하며, OAuth Echo의 각 단계에서 이 값이 유지되어야 합니다.

OAuth 인가 단계에서는 `x-verify-credentials-authorization`에 있는 헤더 값을 가져와, 서비스 공급자에 대한 호출 시 별도의 Authorization 헤더에 그대로 넣습니다. 추가로, `x-auth-service-provider`에 있는 값이 기대한 값이 맞는지 확인합니다.

* Service Provider가 HTTP 200을 반환하면 정상 처리된 것입니다. Delegator는 이미지를 영구적으로 저장하고, URL을 생성한 뒤 이를 반환해야 합니다.
* Service Provider가 HTTP 200을 반환하지 않으면 이미지를 폐기한 뒤 Consumer에게 오류를 반환해야 합니다.