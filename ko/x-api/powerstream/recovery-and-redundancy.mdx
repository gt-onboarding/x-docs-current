---
title: 복구 및 이중화
sidebarTitle: 복구 및 이중화
keywords: ["powerstream recovery", "powerstream redundancy", "recovery features", "redundancy features", "fault tolerance", "error recovery"]
---

스트리밍 데이터를 수신할 때 연결 시간을 최대화하고 일치하는 모든 데이터를 받는 것은 가장 기본적인 목표입니다. 이를 위해서는 중복 연결을 활용하고, 연결 끊김을 자동으로 감지해 신속하게 재연결하며, 손실된 데이터를 복구하기 위한 계획을 마련하는 것이 중요합니다.

이 통합 가이드에서는 중복 연결, 백필(backfill), 복구 등 다양한 복구 및 이중화 기능에 대해 살펴봅니다.
 

<div id="redundant-connections">
  ## 이중 연결
</div>

이중 연결은 스트림에 동시에 둘 이상 연결할 수 있게 해 줍니다. 이를 통해 두 개의 개별 컨슈머가 동일한 스트림에 연결하여, 두 연결 모두를 통해 동일한 데이터를 수신함으로써 이중화를 제공합니다. 따라서 하나의 스트림 연결이 끊기거나 애플리케이션의 기본 서버에 장애가 발생하는 등의 다양한 상황에서 앱에서 핫 페일오버를 사용할 수 있습니다.

이중화된 스트림을 사용하려면 기본 연결에 사용한 것과 동일한 URL에 다시 연결하기만 하면 됩니다. 스트림 데이터는 두 연결 모두를 통해 전송됩니다.

<div id="backfill">
  ## 백필
</div>

연결 끊김을 감지한 후에는 시스템이 스트림에 자동으로 재연결할 수 있도록 설계되어야 합니다. 가능하다면, 적절한 복구 기능을 사용해 데이터를 백필(backfill)할 수 있도록 연결이 끊겨 있었던 시간이 얼마나 지속되었는지 기록해야 합니다. 

연결 끊김이 5분 이하였다고 확인되면 백필 파라미터 `backfillMinutes`를 사용할 수 있습니다. 이 파라미터를 `GET /powerstream` 요청에 함께 전달하면, 최근 1분에서 5분 사이에 규칙과 일치한 게시물을 전달받게 됩니다. 일반적으로는 새로 일치한 게시물보다 이러한 과거 게시물을 먼저 전달하며, 게시물에 대해 중복 제거도 수행하지 않습니다. 예를 들어 90초 동안만 연결이 끊겼는데 2분치 백필 데이터를 요청한 경우, 30초 분량의 중복 게시물을 전달받게 되며, 시스템은 이를 허용하도록 설계되어야 합니다. 다음은 백필 파라미터를 포함한 요청 예시입니다:

`curl 'https://api.x.com/2/powerstream?backfillMinutes=5' -H "Authorization: Bearer $ACCESS_TOKEN"`

연결이 끊긴 시간이 5분보다 길다고 확인되면, [recent search endpoint](/ko/x-api/posts/search/introduction)나 복구 기능을 사용해 누락된 데이터를 요청할 수 있습니다. 

<div id="recovery">
  ## Recovery
</div>

5분 백필(backfill) 윈도우 내에 다시 연결하지 못한 경우, Recovery 기능을 사용해 최근 24시간 이내에 누락된 데이터를 복구할 수 있습니다.

스트리밍 Recovery 기능을 사용하면 백필 윈도우를 24시간까지 확장해 사용할 수 있습니다. Recovery를 통해 누락된 데이터가 발생한 기간을 ‘재생(replay)’할 수 있습니다. `startTime` 및 `endTime` 요청 파라미터를 사용하여 연결 요청을 보내면 Recovery 스트림이 시작됩니다. 연결되면 Recovery가 지정된 시간 구간의 데이터를 다시 스트리밍한 뒤 연결을 종료합니다.  

|     |     |     |
| :--- | :--- | :--- |
| **Name** | **Type** | **Description** |
| `startTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339).<br /><br />복구를 시작할 시점을 나타내는 UTC 기준 날짜/시간입니다. |
| `endTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339).<br /><br />복구를 종료할 시점을 나타내는 UTC 기준 날짜/시간입니다. |

예시 요청 URL: `https://api.x.com/2/powerstream?startTime=2022-07-12T15:10:00Z&endTime=2022-07-12T15:20:00Z`