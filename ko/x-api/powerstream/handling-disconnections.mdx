---
title: 연결 끊김 처리
sidebarTitle: 연결 끊김 처리
keywords: ["PowerStream 연결 끊김", "연결 끊김 처리", "PowerStream 재연결", "스트림 연결 끊김", "PowerStream 오류"]
---

<div id="what-is-a-disconnection">
  ## 연결 끊김이란 무엇인가요?
</div>

스트리밍 API에 연결한다는 것은, 매우 장시간 지속되는 HTTPS 요청을 보내고 응답을 순차적으로 파싱하는 것을 의미합니다. `powerstream` 엔드포인트에 연결할 때는 HTTPS 요청을 생성하고, 가능하면 최대한 오래 해당 스트림을 수신·처리해야 합니다. 서버는 서버 측 오류, 과도한 클라이언트 지연, 네트워크 문제, 정기적인 서버 유지보수, 또는 중복 로그인과 같은 상황을 제외하면 연결을 사실상 무기한 유지합니다. 스트리밍 엔드포인트에 대한 연결에서는 연결이 끊어지는 일이 자주 발생할 수 있으며, 이는 예상해야 하는 정상적인 동작이므로 재연결 로직을 구현해 두어야 합니다.

<div id="why-a-streaming-connection-might-be-disconnected">
  ## 스트리밍 연결이 끊길 수 있는 이유
</div>

스트림이 여러 가지 이유로 끊길 수 있습니다. 실패 원인을 이해하려면 스트림에서 반환된 오류 메시지를 확인하십시오. 연결이 끊길 수 있는 가능한 이유는 다음과 같습니다.

* 잘못된 토큰이나 잘못된 인증 방식 사용 등 인증 오류가 발생한 경우
* X 측에서 스트리밍 서버가 재시작된 경우. 이는 보통 코드 배포와 관련이 있으며, 일반적으로 발생할 수 있는 상황으로 이를 고려해 설계해야 합니다.
* 클라이언트가 스트림에서 전달되는 게시물 양을 따라가지 못하거나 데이터를 너무 느리게 읽는 경우. 모든 스트리밍 연결 뒤에는 클라이언트로 전송할 메시지 큐가 있습니다. 이 큐가 시간이 지나면서 지나치게 커지면 연결이 종료됩니다.
* 계정이 일별/월별 게시물 할당량을 초과한 경우
* 활성 중복 연결이 너무 많은 경우
* 클라이언트가 데이터를 갑자기 읽지 않는 경우. 스트림에서 읽어 가는 게시물 속도가 갑자기 떨어지면 연결이 종료됩니다.
* 서버와 클라이언트 간 네트워크 문제가 발생한 경우
* 일시적인 서버 측 문제, 예정된 유지 관리 및 업데이트가 진행 중인 경우 ([status page](/ko/status)를 확인하십시오)

<div id="anticipating-disconnects-and-reconnecting">
  ## 연결 끊김을 예상하고 재연결하기
</div>

게시물을 스트리밍할 때에는, 연결이 끊어질 수 있다는 점을 인지하면서 가능한 한 오래 연결 상태를 유지하는 것이 목표입니다. 이 엔드포인트는 20초마다 keep-alive 하트비트 신호를 제공합니다(새 줄 문자처럼 보입니다). 이 신호를 사용해 연결이 끊겼는지 감지하십시오.

1. 코드에서는 새 콘텐츠와 하트비트가 도착하지 않게 되는 시점을 감지해야 합니다.
2. 그런 일이 발생하면, 코드에서 재연결 로직을 실행해야 합니다. 일부 클라이언트와 언어에서는 읽기(read) 타임아웃을 지정할 수 있으며, 이를 20초로 설정할 수 있습니다.
3. 서비스는 이러한 연결 끊김을 감지하고 가능한 한 빨리 다시 연결해야 합니다.

연결이 한 번 성립된 후 끊어지면, 즉시 재연결을 시도하십시오. 재연결에 실패하면, 발생한 오류 유형에 따라 재연결 시도를 점진적으로 늦추십시오:

* TCP/IP 수준 네트워크 오류의 경우 선형적으로 대기 시간을 늘리십시오. 이러한 문제는 일반적으로 일시적이며 빠르게 해소되는 경향이 있습니다. 재연결 시도마다 지연 시간을 250ms씩 늘려 최대 16초까지 증가시키십시오.
* 재연결이 적절한 HTTP 오류의 경우 지수적으로 대기 시간을 늘리십시오. 처음에는 5초를 기다렸다가 시도할 때마다 두 배로 늘려, 최대 320초까지 증가시키십시오.
* HTTP 429 오류(레이트 리밋 초과)의 경우에도 지수적으로 대기 시간을 늘리십시오. 처음에는 1분을 기다렸다가 시도할 때마다 두 배로 늘리십시오. 각 HTTP 429 응답은 계정에 대한 레이트 리밋이 더 이상 적용되지 않을 때까지 기다려야 하는 시간이 증가한다는 점에 유의하십시오.
   

<div id="recovering-lost-data">
  ## 손실된 데이터 복구
</div>

연결이 끊어지는 일이 발생하더라도, 놓쳤을 수 있는 모든 데이터를 확보하기 위해 활용할 수 있는 여러 가지 전략이 있습니다. [데이터 복구](/ko/x-api/powerstream/recovery-and-redundancy)에 관한 통합 가이드에서 누락된 데이터를 복구하기 위해 취할 수 있는 주요 단계를 정리해 두었습니다. 
 

<div id="rate-limits-and-usage">
  ## 요청 한도와 사용량
</div>

연결 한도를 확인하려면 응답에 세 개의 헤더가 포함됩니다. 이를 통해 규칙 엔드포인트를 얼마나 자주 사용할 수 있는지, 그리고 스트리밍 엔드포인트에 대해 얼마나 많은 재연결 시도가 허용되는지 알 수 있습니다.

* x-rate-limit-limit 은 15분 시간 구간 동안 클라이언트가 보낼 수 있도록 할당된 최대 요청 수를 나타냅니다.

* x-rate-limit-remaining 은 현재 15분 시간 구간에서 아직 보낼 수 있는 남은 요청 수를 나타냅니다.

* x-rate-limit-reset 은 15분 시간 구간이 다시 시작되는 시점을 나타내는 UNIX 타임스탬프로, 이 시점에 x-rate-limit-remaining 값이 0으로 초기화됩니다.

filter stream 엔드포인트는 현재 사용량 데이터를 보고하지 않습니다. 얼마나 많은 게시물이 전송되었는지 확인하려면, 코드에서 계량(metering) 로직을 구현하여 필요 시 소비량을 측정하고 일시 중지할 수 있도록 해야 합니다. 

스트림의 클라이언트 측 코드는 단순히 들어오는 게시물을 선입선출(FIFO) 큐 또는 유사한 메모리 구조에 삽입하고, 별도의 프로세스/스레드가 그 큐에서 게시물을 가져와 파싱하고 저장을 위해 준비해야 합니다. 이와 같은 설계를 사용하면, 들어오는 게시물의 양이 급격하게 변하는 경우에도 효율적으로 확장 가능한 서비스를 구현할 수 있습니다. 개념적으로는 HTTP를 통해 무한히 긴 파일을 다운로드하는 것으로 생각할 수 있습니다.

<div id="reconnection-best-practices">
  ## 재연결 모범 사례
</div>

<div id="test-backoff-strategies">
  ### 백오프 전략 테스트
</div>

백오프 구현을 테스트하는 한 가지 좋은 방법은 잘못된 인증 자격 증명을 사용하고 재연결 시도를 관찰하는 것입니다. 제대로 구현되었다면 429 응답을 전혀 받지 않아야 합니다.

<div id="issue-alerts-for-multiple-reconnects">
  ### 여러 차례 재연결 시 문제 알림
</div>

Client의 재연결 간격이 설정한 상한 임계값에 도달하면, 연결에 영향을 주는 문제를 파악하고 조치할 수 있도록 사용자에게 알림을 보내도록 해야 합니다.

<div id="handle-dns-changes">
  ### DNS 변경 처리
</div>

클라이언트 프로세스가 DNS TTL(Time To Live)을 준수하는지 테스트하세요. 일부 스택은 프로세스가 실행되는 동안 해석된 주소를 캐시해 두고, 지정된 TTL이 지나기 전에는 DNS 변경 사항을 반영하지 않을 수 있습니다. 이처럼 지나치게 공격적인 캐싱은 X가 IP 주소 간에 부하를 분산할 때 클라이언트 측 서비스 중단으로 이어질 수 있습니다.

<div id="user-agent">
  ### User Agent
</div>

user-agent HTTP 헤더에 클라이언트 버전을 포함해야 합니다. 이는 X에서 문제를 진단하는 데 매우 중요합니다. 사용 중인 환경에서 user-agent 필드를 설정할 수 없다면, 대신 x-user-agent 헤더를 설정하십시오.