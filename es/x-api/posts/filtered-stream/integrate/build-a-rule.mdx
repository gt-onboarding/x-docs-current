---
title: Crear una regla
sidebarTitle: Crear una regla
keywords: ["crear una regla", "reglas de filtrado", "reglas de flujo", "generador de reglas", "reglas de flujo filtrado", "crear regla", "guía de reglas"]
---

<div id="building-rules-for-filtered-stream">
  ## Creación de reglas para el flujo filtrado
</div>

Los endpoints de flujo filtrado te entregan Publicaciones filtradas que coinciden con un conjunto de reglas que se aplican al flujo. Las reglas se componen de operadores que se usan para hacer coincidir una variedad de atributos de las Publicaciones.

Se pueden aplicar múltiples reglas a un flujo usando el endpoint [POST /tweets/search/stream/rules](/es/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules). Una vez que hayas agregado reglas y te conectes a tu flujo usando el endpoint [GET /tweets/search/stream](/es/x-api/posts/filtered-stream#get-2-tweets-search-stream), solo aquellas Publicaciones que coincidan con tus reglas se entregarán a través de una conexión de streaming persistente. No necesitas desconectarte del flujo para agregar o eliminar reglas. 

<div id="table-of-contents">
  ### Tabla de contenidos
</div>

* [Creación de una regla](#building-a-rule)
  * [Limitaciones de las reglas](#rule-limitations)
  * [Disponibilidad de operadores](#operator-availability)
  * [Tipos de operadores: independientes y que requieren conjunción](#operator-types-standalone-and-conjunction-required)
  * [Operadores booleanos y agrupación](#boolean-operators-and-grouping)
  * [Orden de operaciones](#order-of-operations)
  * [Puntuación, diacríticos y sensibilidad a mayúsculas y minúsculas](#punctuation-diacritics-and-case-sensitivity)
  * [Especificidad y eficiencia](#specificity-and-efficiency)
  * [Creación iterativa de una regla](#iteratively-building-a-rule)
  * [Agregar y eliminar reglas](#adding-and-removing-rules)
  * [Ejemplos de reglas](#rule-examples)

<div id="building-a-rule">
  ### Creación de una regla
</div>

<div id="rule-limitations">
  #### Limitaciones de las reglas
</div>

Los límites en la cantidad de reglas dependerán del [nivel de acceso](/es/x-api/getting-started/about-x-api) que se aplique a tu [Proyecto](/es/resources/fundamentals/projects).

Puedes ver cómo se aplican estos límites en la página de [introducción al flujo filtrado](/es/x-api/posts/filtered-stream).

<div id="operator-types-standalone-and-conjunction-required">
  #### Tipos de operadores: independientes y que requieren conjunción
</div>

Los **operadores independientes** se pueden usar solos o junto con cualquier otro operador (incluidos aquellos que requieren conjunción).

Por ejemplo, la siguiente regla funcionará porque usa el operador `#hashtag`, que es independiente:

`#xapiv2`

Los operadores que **requieren conjunción** no se pueden usar por sí solos en una regla; solo se pueden usar cuando al menos un operador independiente está presente en la regla. Esto se debe a que usar estos operadores solos sería demasiado general y devolvería un volumen extremadamente alto de Publicaciones.

Por ejemplo, las siguientes reglas no están permitidas, ya que contienen únicamente operadores que requieren conjunción:

`has:media`

`has:links OR is:retweet`

Si añadimos un operador independiente, como la frase `"X data"`, la regla entonces funcionaría correctamente. 

`"X data" has:mentions (has:media OR has:links)`

<div id="boolean-operators-and-grouping">
  #### Operadores booleanos y agrupación
</div>

Si quieres encadenar varios operadores en una sola regla, tienes las siguientes herramientas a tu disposición:

|     |     |
| :--- | :--- |
| **Lógica AND** | Los operadores sucesivos **con un espacio entre ellos** darán como resultado una lógica booleana &quot;AND&quot;, lo que significa que las Publicaciones coincidirán solo si se cumplen ambas condiciones. Por ejemplo, `snow day #NoSchool` coincidirá con Publicaciones que contengan los términos snow y day y el hashtag #NoSchool. |
| **Lógica OR** | Los operadores sucesivos con OR entre ellos darán como resultado una lógica OR, lo que significa que las Publicaciones coincidirán si se cumple cualquiera de las condiciones. Por ejemplo, al especificar `grumpy OR cat OR #meme` se hará coincidir cualquier Publicación que contenga al menos los términos grumpy o cat, o el hashtag #meme. |
| **Lógica NOT, negación** | Agrega un guion (-) delante de una palabra clave (o de cualquier operador) para negarla (NOT). Por ejemplo, `cat #meme -grumpy` coincidirá con Publicaciones que contengan el hashtag #meme y el término cat, pero solo si no contienen el término grumpy. Una cláusula de regla común es `-is:retweet`, que no coincidirá con Retweets y, por lo tanto, solo coincidirá con Publicaciones originales, Quote Tweets y respuestas. Todos los operadores se pueden negar, pero los operadores negados no se pueden usar solos. |
| **Agrupación** | Puedes usar paréntesis para agrupar operadores. Por ejemplo, `(grumpy cat) OR (#meme has:images)` devolverá Publicaciones que contengan los términos grumpy y cat, o Publicaciones con imágenes que contengan el hashtag #meme. Ten en cuenta que primero se aplican los AND y luego se aplican los OR. |

<Note>
  **Una nota sobre las negaciones**

  Todos los operadores se pueden negar excepto `sample:`, y `-is:nullcast` siempre debe estar negado. Los operadores negados no se pueden usar solos.

  No niegues un conjunto de operadores agrupados dentro de un conjunto de paréntesis. En su lugar, niega cada operador individual.

  Por ejemplo, en lugar de usar `skiing -(snow OR day OR noschool)`, sugerimos que uses `skiing -snow -day -noschool`. 
</Note>

<div id="order-of-operations">
  #### Orden de las operaciones
</div>

Al combinar la funcionalidad AND y OR, el siguiente orden de operaciones determinará cómo se evalúa tu regla.

1. Primero se combinan los operadores conectados mediante lógica AND
2. Luego se aplican los operadores conectados mediante lógica OR

Por ejemplo:

* `apple OR iphone ipad` se evaluaría como `apple OR (iphone ipad)`
* `ipad iphone OR android` se evaluaría como `(iphone ipad) OR android`

Para eliminar la incertidumbre y asegurarte de que tu regla se evalúe como deseas, agrupa los términos con paréntesis cuando sea apropiado. 

Por ejemplo:

* `(apple OR iphone) ipad`
* `iphone (ipad OR android)`

<div id="punctuation-diacritics-and-case-sensitivity">
  #### Puntuación, signos diacríticos y sensibilidad a mayúsculas
</div>

Si especificas una palabra clave o una regla de hashtag con acentos o signos diacríticos, coincidirá con las Publicaciones que contengan exactamente esa palabra con los acentos o signos diacríticos correctos, pero no con aquellas que tengan las mismas letras sin el acento o el signo diacrítico. 

Por ejemplo, las reglas con la palabra clave `diacrítica` o el hashtag `#cumpleaños` coincidirán con las Publicaciones que contengan *diacrítica* o *#cumpleaños* porque incluyen el acento o el signo diacrítico. Sin embargo, estas reglas no coincidirán con las Publicaciones que contengan *Diacritica* o *#cumpleanos* sin la tilde en la í ni la eñe.

Los caracteres con acentos o signos diacríticos se tratan igual que los caracteres normales y no se consideran límites de palabra. Por ejemplo, una regla con la palabra clave *cumpleaños* solo coincidiría con las Publicaciones que contengan la palabra *cumpleaños* y no coincidiría con Publicaciones que contengan *cumplea*, *cumplean* u *os*.

Todos los operadores se evalúan sin distinción entre mayúsculas y minúsculas. Por ejemplo, la regla cat coincidirá con todos los siguientes casos: *cat*, *CAT*, *Cat*.

<Note>
  El comportamiento de coincidencia de [Search Posts](/es/x-api/posts/search/introduction) funciona de forma diferente al de filtered stream. Al [crear una consulta de Search Posts](/es/x-api/posts/search/integrate/build-a-query), ten en cuenta que las palabras clave y los hashtags que incluyen acentos o signos diacríticos coincidirán tanto con el término con acentos y signos diacríticos como con el mismo término usando caracteres normales. 

  Por ejemplo, las consultas de Search Posts que incluyan una palabra clave `Diacrítica` o el hashtag `#cumpleaños` coincidirán tanto con *Diacrítica* y *#cumpleaños* como con *Diacritica* o *#cumpleanos* sin la tilde en la í ni la eñe.
</Note>

<div id="specificity-and-efficiency">
  #### Especificidad y eficiencia
</div>

Cuando comiences a crear tu regla, es importante tener en cuenta algunos aspectos.

* Usar operadores amplios e independientes para tu regla, como una sola palabra clave o un hashtag, por lo general no se recomienda, ya que probablemente coincidirá con un volumen masivo de Publicaciones. Crear una regla más sólida dará como resultado un conjunto más específico de Publicaciones que coincidan con ella y, con suerte, reducirá la cantidad de ruido en la carga útil que tendrás que filtrar para encontrar información valiosa. 
  * Por ejemplo, si tu regla fuera solo la palabra clave `happy`, probablemente obtendrías entre 200.000 y 300.000 Publicaciones por día.
  * Agregar más operadores condicionales reduce el alcance de tus resultados de búsqueda, por ejemplo `(happy OR happiness) place_country:GB -birthday -is:retweet`
* Escribir reglas eficientes también es beneficioso para mantenerte dentro del límite de longitud de caracteres de la regla. El recuento de caracteres incluye toda la cadena de la regla, incluidos espacios y operadores.
  * Por ejemplo, la siguiente regla tiene 59 caracteres de longitud: `(happy OR happiness) place_country:GB -birthday -is:retweet`

<div id="quote-tweet-matching-behavior">
  #### Comportamiento de coincidencia de las Publicaciones citadas
</div>

Cuando utilices los endpoints del flujo filtrado, los operadores coincidirán tanto con el contenido de la Publicación original que fue citada como con el contenido incluido en la Publicación citada.

Sin embargo, ten en cuenta que los endpoints de [Search Posts](/es/x-api/posts/search/introduction) no coincidirán con el contenido de la Publicación original que fue citada, pero sí con el contenido de la Publicación citada.

<div id="iteratively-building-a-rule">
  #### Crear una regla de manera iterativa
</div>

<div id="test-your-rule-early-and-often">
  ##### Prueba tu regla temprano y con frecuencia
</div>

Que una regla devuelva los resultados &quot;correctos&quot; a la primera es poco común. Hay tanto contenido en X que puede no ser evidente al principio, y la sintaxis de reglas descrita arriba puede resultar difícil de ajustar a la búsqueda que quieres hacer. A medida que defines una regla, es importante que la pruebes periódicamente con el endpoint de streaming para ver qué datos devuelve. También puedes hacer pruebas con uno de los endpoints de [búsqueda de Publicaciones](/es/x-api/posts/search/introduction), siempre que los operadores que estés usando también estén disponibles en ese endpoint. 

Para esta sección, vamos a empezar con la siguiente regla y a ajustarla en función de los resultados que obtengamos durante nuestra prueba: 

`happy OR happiness`

<div id="use-results-to-narrow-the-rule">
  ##### Usa los resultados para acotar la regla
</div>

A medida que pruebes la regla, debes revisar las Publicaciones devueltas para ver si incluyen los datos que esperas y deseas recibir. Comenzar con una regla amplia y un superconjunto de Publicaciones coincidentes te permite revisar el resultado y acotar la regla para filtrar los resultados no deseados.  

Cuando probamos la regla de ejemplo, notamos que estábamos recibiendo Publicaciones en una variedad de idiomas. En esta situación, queremos recibir solo Publicaciones que estén en inglés, así que vamos a agregar el operador `lang:`:

`(happy OR happiness) lang:en`

La prueba devolvió varias Publicaciones felicitando a personas por su cumpleaños, así que vamos a agregar `-birthday` como operador de palabra clave negado. También queremos recibir solo Publicaciones originales, por lo que hemos agregado el operador negado `-is:retweet`:

`(happy OR happiness) lang:en -birthday -is:retweet`

<div id="adjust-for-inclusion-where-needed">
  ##### Ajustar para inclusión cuando sea necesario
</div>

Si observas que no estás recibiendo los datos que esperas y sabes que existen Publicaciones que deberían aparecer en los resultados, es posible que necesites ampliar tu regla eliminando operadores que puedan estar filtrando los datos deseados. 

En nuestro ejemplo, observamos que había otras Publicaciones en nuestra cronología personal que expresaban la emoción que estamos buscando y que no se incluyeron en los resultados de prueba. Para asegurarnos de tener una mayor cobertura, vamos a añadir las palabras clave `excited` y `elated`.

`(happy OR happiness OR excited OR elated) lang:en -birthday -is:retweet`

<div id="adjust-for-popular-trendsbursts-over-the-time-period">
  ##### Ajustar según tendencias populares/picos durante el período de tiempo
</div>

Las tendencias van y vienen rápidamente en X. Mantener tu regla debe ser un proceso activo. Si planeas usar una sola regla durante un tiempo, te sugerimos que revises periódicamente los datos que estás recibiendo para ver si necesitas hacer algún ajuste.

En nuestro ejemplo, notamos que empezamos a recibir algunas Publicaciones en las que las personas desean “felices fiestas”. Como no queremos que estas Publicaciones se incluyan en nuestros resultados, vamos a agregar una palabra clave negada `-holidays`.

`(happy OR happiness OR excited OR elated) lang:en -birthday -is:retweet -holidays`

<div id="adding-and-removing-rules">
  #### Agregar y eliminar reglas
</div>

Utilizarás el endpoint [POST /2/tweets/search/stream/rules](/es/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules) tanto para agregar como para eliminar reglas de tu stream.

Para agregar una o más reglas a tu stream, envía un cuerpo JSON `add` con un array que contenga el parámetro `value`, incluyendo la regla, y el parámetro opcional `tag`, que incluya texto libre que puedes usar para [identificar qué Publicaciones devueltas coinciden con esta regla](/es/x-api/posts/filtered-stream#matching-returned-posts-to-their-associated-rule). 

Por ejemplo, si intentaras agregar un conjunto de reglas a tu stream, tu comando cURL podría verse así:

```bash
curl -X POST 'https://api.x.com/2/tweets/search/stream/rules' \
-H "Content-type: application/json" \
-H "Authorization: Bearer $ACCESS_TOKEN" -d \
'{
  "add": [
    {"value": "cat has:media", "tag": "cats with media"},
    {"value": "cat has:media -grumpy", "tag": "gatos felices con contenido multimedia"},
    {"value": "meme", "tag": "funny things"},
    {"value": "meme has:images"}
  ]
}'
```

De manera similar, para eliminar una o más reglas de tu stream, envía un cuerpo JSON `delete` con el arreglo que contenga el parámetro `id` de las reglas que quieras eliminar.

Por ejemplo, si quisieras eliminar un conjunto de reglas de tu stream, tu comando cURL podría verse así:

```bash
curl -X POST 'https://api.x.com/2/tweets/search/stream/rules' \
  -H "Content-type: application/json" \
  -H "Authorization: Bearer $ACCESS_TOKEN" -d \
  '{
    "delete": {
      "ids": [
        "1165037377523306498",
        "1165037377523306499"
      ]
    }
  }'
```

Tenemos código de ejemplo en varios lenguajes disponible en nuestro [GitHub](https://github.com/xdevplatform/Twitter-API-v2-sample-code/tree/master/Filtered-Stream).

<div id="rule-examples">
  #### Ejemplos de reglas
</div>

<div id="tracking-a-natural-disaster">
  ##### Seguimiento de un desastre natural
</div>

La siguiente regla se aplicó a Publicaciones procedentes de agencias meteorológicas y estaciones de medición que hablan sobre el huracán Harvey, que azotó Houston en 2017. Ten en cuenta el uso de la etiqueta [matching rules](/es/x-api/posts/filtered-stream#matching-returned-posts-to-their-associated-rule) y el formato JSON que deberás usar al enviar la regla al [endpoint POST /2/tweets/search/stream/rules](/es/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules).

```json
{
    "value": "-is:retweet has:geo (from:NWSNHC OR from:NHC_Atlantic OR from:NWSHouston OR from:NWSSanAntonio OR from:USGS_TexasRain OR from:USGS_TexasFlood OR from:JeffLindner1)",
    "tag": "theme:info has:geo original from weather agencies and gauges"
}
```

<div id="reviewing-the-sentiment-of-a-conversation">
  ##### Analizar el sentimiento de una conversación
</div>

La siguiente regla puede utilizarse para comprender mejor el sentimiento de la conversación que se desarrolla en torno al hashtag *#nowplaying*, pero solo a partir de Publicaciones procedentes de América del Norte.

```json
{
    "value": "#nowplaying (happy OR exciting OR excited OR favorite OR fav OR amazing OR lovely OR incredible) (place_country:US OR place_country:MX OR place_country:CA) -horrible -worst -sucks -bad -disappointing",
    "tag": "#nowplaying positive"
},
{
    "value": "#nowplaying (horrible OR worst OR sucks OR bad OR disappointing) (place_country:US OR place_country:MX OR place_country:CA) -happy -exciting -excited -favorite -fav -amazing -lovely -incredible",
    "tag": "#nowplaying negative"
}
```

<div id="find-posts-that-relate-to-a-specific-post-annotation">
  ##### Encontrar Publicaciones relacionadas con una anotación de Publicación específica
</div>

Esta regla se creó para buscar Publicaciones originales que incluyan una imagen de una mascota que no sea un gato y en las que el idioma identificado en la Publicación sea japonés. Para hacerlo, usamos el operador `context:` para aprovechar la funcionalidad de [Post annotation](/es/x-api/fundamentals/post-annotations). Primero usamos el endpoint [Post lookup](/es/x-api/posts/lookup/introduction) y el parámetro de campos `tweet.fields=context_annotations` para identificar qué ID de domain.entity necesitamos usar en nuestra consulta:

* Las Publicaciones relacionadas con gatos devuelven `domain` 66 (categoría Interests and Hobbies) con `entity` 852262932607926273 (Cats). 
* Las Publicaciones relacionadas con mascotas devuelven `domain` 65 (Interests and Hobbies Vertical) con `entity` 852262932607926273 (Pets). 
   

Así se vería la regla:

```json
{
    "value": "context:65.852262932607926273 -context:66.852262932607926273 -is:retweet has:images lang:ja",
    "tag": "Japanese pets with images - no cats"
}
```
