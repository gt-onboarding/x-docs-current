---
title: Gestión de desconexiones
sidebarTitle: Gestión de desconexiones
keywords: ["desconexiones de PowerStream", "gestionar desconexiones", "reconectar PowerStream", "desconexiones del stream", "errores de PowerStream"]
---

<div id="what-is-a-disconnection">
  ## ¿Qué es una desconexión?
</div>

Establecer una conexión con las APIs de streaming implica realizar una solicitud HTTPS de larga duración y procesar la respuesta de forma incremental. Al conectarte al endpoint de powerstream, debes realizar una solicitud HTTPS y consumir el flujo resultante durante el mayor tiempo posible. Nuestros servidores mantendrán la conexión abierta indefinidamente, salvo que se produzca un error del lado del servidor, un retraso excesivo del lado del cliente, problemas de red, mantenimiento rutinario del servidor o inicios de sesión duplicados. Con las conexiones a endpoints de streaming, es probable —y debes darlo por hecho— que se produzcan desconexiones, por lo que es necesario implementar lógica de reconexión.

<div id="why-a-streaming-connection-might-be-disconnected">
  ## Por qué una conexión de streaming puede desconectarse
</div>

Tu stream puede desconectarse por varios motivos. Revisa el mensaje de error que devuelve el stream para entender el motivo del fallo. Las posibles razones de desconexión son las siguientes:

* Un error de autenticación (como usar un token incorrecto o un método de autenticación incorrecto).
* Se reinicia un servidor de streaming en el lado de X. Esto suele estar relacionado con un despliegue de código y, en general, se debe prever y contemplar en el diseño.
* Tu cliente no consigue mantener el ritmo del volumen de Publicaciones que el stream entrega o está leyendo los datos demasiado lentamente. Cada conexión de streaming está respaldada por una cola de mensajes que se enviarán al cliente. Si esta cola crece demasiado con el tiempo, se cerrará la conexión.
* Tu cuenta superó tu cuota diaria o mensual de Publicaciones.
* Tienes demasiadas conexiones redundantes activas.
* Un cliente deja de leer datos de forma repentina. Si la tasa de Publicaciones que se leen del stream cae repentinamente, se cerrará la conexión.
* Posibles problemas de red entre el servidor y el cliente.
* Un problema temporal en el lado del servidor, o tareas de mantenimiento y actualizaciones programadas. (Consulta la [página de estado](/es/status))

<div id="anticipating-disconnects-and-reconnecting">
  ## Anticipar desconexiones y reconectar
</div>

Al hacer streaming de Publicaciones, el objetivo es permanecer conectado el mayor tiempo posible, reconociendo que pueden ocurrir desconexiones. El endpoint proporciona una señal de keep-alive cada 20 segundos (aparecerá como un carácter de nueva línea). Usa esta señal para detectar si te estás desconectando.

1. Tu código debe detectar cuándo dejan de llegar tanto el contenido nuevo como la señal de keep-alive.
2. Si eso sucede, tu código debe activar una lógica de reconexión. Algunos clientes e idiomas de programación te permiten especificar un tiempo de espera de lectura (read timeout), que puedes establecer en 20 segundos.
3. Tu servicio debe detectar estas desconexiones y reconectarse lo antes posible.

Una vez que se interrumpe una conexión establecida, intenta reconectar de inmediato. Si la reconexión falla, reduce la frecuencia de tus intentos de reconexión según el tipo de error experimentado:

* Aumenta el intervalo de forma lineal para errores de red a nivel TCP/IP. Estos problemas suelen ser temporales y tienden a resolverse rápidamente. Incrementa la demora entre reconexiones en 250 ms en cada intento, hasta 16 segundos.
* Aumenta el intervalo de forma exponencial para errores HTTP en los que sea apropiado reconectar. Comienza con una espera de 5 segundos, duplicándola en cada intento, hasta 320 segundos.
* Aumenta el intervalo de forma exponencial para errores HTTP 429 (Rate limit exceeded). Comienza con una espera de 1 minuto y duplícala en cada intento. Ten en cuenta que cada HTTP 429 recibido aumenta el tiempo que debes esperar hasta que el límite de frecuencia deje de aplicarse a tu cuenta.
   

<div id="recovering-lost-data">
  ## Recuperar datos perdidos
</div>

Si experimentas una desconexión, hay distintas estrategias que puedes usar para asegurarte de recibir todos los datos que podrías haberte perdido. Hemos documentado algunos pasos clave que puedes seguir para recuperar datos perdidos en nuestra guía de integración sobre [recuperación de datos](/es/x-api/powerstream/recovery-and-redundancy). 
 

<div id="rate-limits-and-usage">
  ## Límites de frecuencia y uso
</div>

Para consultar los límites de conexión, la respuesta incluirá tres encabezados. Esto es útil para entender cuántas veces puedes usar el endpoint de reglas y cuántos intentos de reconexión están permitidos para el endpoint de streaming.

* x-rate-limit-limit indica el número de solicitudes asignadas que tu cliente puede realizar durante la ventana de 15 minutos.

* x-rate-limit-remaining indica el número de solicitudes realizadas hasta el momento en la ventana de 15 minutos.

* x-rate-limit-reset es una marca de tiempo UNIX que indica cuándo se reiniciará la ventana de 15 minutos, restableciendo x-rate-limit-remaining a 0.

El endpoint de filtro de streaming actualmente no informa datos de uso. Para comprobar cuántas Publicaciones se han entregado, tu código puede implementar una lógica de medición, de modo que el consumo pueda medirse y pausarse si es necesario. 

El código que aloja el lado de cliente del stream simplemente inserta las Publicaciones entrantes en una cola FIFO (first in, first out) o una estructura de memoria similar; un proceso/hilo independiente debe consumir Publicaciones de esa cola para analizar y preparar el contenido para su almacenamiento. Con este diseño, puedes implementar un servicio que pueda escalar de forma eficiente en caso de que los volúmenes de Publicaciones entrantes cambien drásticamente. Conceptualmente, puedes imaginarlo como descargar un archivo infinitamente largo a través de HTTP.

<div id="reconnection-best-practices">
  ## Mejores prácticas de reconexión
</div>

<div id="test-backoff-strategies">
  ### Probar estrategias de backoff
</div>

Una buena forma de probar una implementación de backoff es usar credenciales de autorización no válidas y examinar los intentos de reconexión. Una buena implementación no debería obtener ninguna respuesta 429.

<div id="issue-alerts-for-multiple-reconnects">
  ### Alertas de incidencias por múltiples reconexiones
</div>

Si un cliente alcanza el umbral máximo de tiempo entre reconexiones, debería enviarte notificaciones para que puedas evaluar y priorizar los problemas que afectan a tu conexión.

<div id="handle-dns-changes">
  ### Gestión de cambios de DNS
</div>

Verifica que el proceso de tu cliente respete el valor de Time To Live (TTL) de DNS. Algunas pilas almacenan en caché una dirección resuelta durante toda la vida del proceso y no reflejan los cambios de DNS dentro del TTL prescrito. Este almacenamiento en caché tan agresivo provocará interrupciones del servicio en tu cliente cuando X desplace la carga entre direcciones IP.

<div id="user-agent">
  ### User Agent
</div>

Asegúrate de que el encabezado HTTP user-agent incluya la versión de tu cliente. Esto será fundamental para diagnosticar problemas por parte de X. Si tu entorno no permite establecer el campo user-agent, entonces establece un encabezado x-user-agent.