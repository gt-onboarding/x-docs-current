---
title: Gestión de desconexiones
sidebarTitle: Gestión de desconexiones
keywords: ["desconexiones de PowerStream", "gestionar desconexiones", "reconectar PowerStream", "desconexiones de stream", "errores de PowerStream"]
---

<div id="what-is-a-disconnection">
  ## ¿Qué es una desconexión?
</div>

Establecer una conexión con las APIs de streaming implica realizar una solicitud HTTPS de muy larga duración y procesar la respuesta de forma incremental. Al conectarte al endpoint de powerstream, debes realizar una solicitud HTTPS y consumir el flujo resultante durante el mayor tiempo posible. Nuestros servidores mantendrán la conexión abierta indefinidamente, salvo que se produzca un error del lado del servidor, un retraso excesivo del lado del cliente, problemas de red, tareas rutinarias de mantenimiento del servidor o inicios de sesión duplicados. Con las conexiones a endpoints de streaming, es probable —y debe esperarse— que se produzcan desconexiones, por lo que se debe implementar lógica de reconexión.

<div id="why-a-streaming-connection-might-be-disconnected">
  ## Por qué una conexión de streaming puede desconectarse
</div>

Tu stream puede desconectarse por varios motivos. Revisa el mensaje de error que devuelve el stream para comprender la causa del fallo. Las posibles razones de desconexión son las siguientes:

* Un error de autenticación (como usar un token incorrecto o un método de autenticación equivocado).
* Se reinicia un servidor de streaming en el lado de X. Esto suele estar relacionado con un despliegue de código y, en general, deberías esperarlo y diseñar tu integración teniéndolo en cuenta.
* Tu cliente no logra seguir el ritmo del volumen de Publicaciones que el stream está entregando o está leyendo los datos demasiado lentamente. Cada conexión de streaming está respaldada por una cola de mensajes que se enviarán al cliente. Si esta cola crece demasiado con el tiempo, se cerrará la conexión.
* Tu cuenta superó tu cuota diaria/mensual de Publicaciones.
* Tienes demasiadas conexiones redundantes activas.
* Un cliente deja de leer datos de repente. Si la tasa de Publicaciones que se leen del stream cae repentinamente, se cerrará la conexión.
* Problemas de red entre el servidor y el cliente.
* Un problema temporal del lado del servidor, mantenimiento programado o actualizaciones. (Consulta la [página de estado](/es/status))

<div id="anticipating-disconnects-and-reconnecting">
  ## Anticipar desconexiones y reconectar
</div>

Al transmitir Publicaciones en streaming, el objetivo es permanecer conectado el mayor tiempo posible, teniendo en cuenta que pueden producirse desconexiones. El endpoint proporciona una señal de keep-alive cada 20 segundos (aparecerá como un carácter de nueva línea). Usa esta señal para detectar si te estás desconectando.

1. Tu código debe detectar cuándo dejan de llegar contenido nuevo y la señal de keep-alive.
2. Si eso sucede, tu código debe activar una lógica de reconexión. Algunos clientes y lenguajes permiten especificar un tiempo de espera de lectura (read timeout), que puedes establecer en 20 segundos.
3. Tu servicio debe detectar estas desconexiones y reconectar tan pronto como sea posible.

Una vez que una conexión establecida se interrumpe, intenta reconectar inmediatamente. Si la reconexión falla, reduce la frecuencia de tus intentos de reconexión según el tipo de error experimentado:

* Aplica un retroceso (backoff) lineal para errores de red a nivel TCP/IP. Estos problemas suelen ser temporales y tienden a resolverse rápidamente. Aumenta el retraso entre reconexiones en 250 ms en cada intento, hasta 16 segundos.
* Aplica un retroceso exponencial para errores HTTP para los cuales sea apropiado reconectar. Comienza con una espera de 5 segundos, duplicándola en cada intento, hasta 320 segundos.
* Aplica un retroceso exponencial para errores HTTP 429 (Rate limit exceeded). Comienza con una espera de 1 minuto y duplícala en cada intento. Ten en cuenta que cada HTTP 429 recibido aumenta el tiempo que debes esperar hasta que el límite de frecuencia (rate limit) deje de estar en efecto para tu cuenta.
   

<div id="recovering-lost-data">
  ## Recuperar datos perdidos
</div>

Si experimentas una desconexión, hay varias estrategias que puedes usar para asegurarte de recibir todos los datos que podrías haberte perdido. Hemos documentado algunos pasos clave que puedes seguir para recuperar datos perdidos en nuestra guía de integración sobre [recuperación de datos](/es/x-api/powerstream/recovery-and-redundancy). 
 

<div id="rate-limits-and-usage">
  ## Límites de frecuencia y uso
</div>

Para comprobar los límites de conexión, la respuesta devolverá tres encabezados. Esto es útil para entender cuántas veces puedes usar el endpoint de reglas y cuántos intentos de reconexión están permitidos para el endpoint de streaming.

* x-rate-limit-limit indica la cantidad de solicitudes asignadas que tu cliente puede realizar durante la ventana de 15 minutos.

* x-rate-limit-remaining indica la cantidad de solicitudes realizadas hasta ahora en la ventana de 15 minutos.

* x-rate-limit-reset es una marca de tiempo UNIX que indica cuándo se reiniciará la ventana de 15 minutos, restableciendo x-rate-limit-remaining a 0.

Actualmente, el endpoint de filtro de stream no informa datos de uso. Para comprobar cuántas Publicaciones se han entregado, tu código puede implementar una lógica de medición, de modo que el consumo pueda medirse y pausarse si es necesario. 

El código que aloja el lado cliente del stream simplemente inserta las Publicaciones entrantes en una cola FIFO (first in, first out), o en una estructura de memoria similar; un proceso o hilo separado debe consumir Publicaciones de esa cola para analizar y preparar el contenido para su almacenamiento. Con este diseño, puedes implementar un servicio que escale de manera eficiente en caso de que el volumen de Publicaciones entrantes cambie drásticamente. Conceptualmente, puedes pensar en ello como descargar un archivo infinitamente largo a través de HTTP.

<div id="reconnection-best-practices">
  ## Mejores prácticas de reconexión
</div>

<div id="test-backoff-strategies">
  ### Probar estrategias de backoff
</div>

Una buena forma de probar una implementación de backoff es utilizar credenciales de autorización inválidas y analizar los intentos de reconexión. Una buena implementación no debería recibir ninguna respuesta 429.

<div id="issue-alerts-for-multiple-reconnects">
  ### Alertas de incidencias por múltiples reconexiones
</div>

Si un cliente alcanza su umbral máximo de tiempo entre reconexiones, debería enviarte notificaciones para que puedas identificar y priorizar los problemas que afectan a tu conexión.

<div id="handle-dns-changes">
  ### Gestionar cambios de DNS
</div>

Verifica que el proceso de tu cliente respete el tiempo de vida (TTL) de DNS. Algunas implementaciones almacenan en caché una dirección resuelta durante toda la vida del proceso y no detectan cambios de DNS dentro del TTL establecido. Un almacenamiento en caché tan agresivo provocará interrupciones en el servicio de tu cliente a medida que X redistribuya la carga entre direcciones IP.

<div id="user-agent">
  ### Agente de usuario
</div>

Asegúrate de que el encabezado HTTP `user-agent` incluya la versión del cliente. Esto será fundamental para diagnosticar problemas en X. Si tu entorno impide establecer el campo `user-agent`, entonces establece un encabezado `x-user-agent`.