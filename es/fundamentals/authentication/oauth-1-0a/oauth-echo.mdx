---
title: OAuth Echo
sidebarTitle: OAuth Echo
keywords: ["OAuth Echo", "prueba de OAuth Echo", "verificación de OAuth", "prueba de eco", "OAuth Echo 1.0a", "verificar OAuth"]
---

import { Button } from "/snippets/es/button.mdx";


<div id="oauth-echo">
  ### OAuth Echo
</div>

OAuth Echo es un medio para delegar de forma segura la autorización OAuth con un tercero mientras se interactúa con una API.

Hay cuatro partes involucradas en esta interacción:

* **el Usuario**, que está usando X a través de una aplicación de X concreta y autorizada
* **el Consumidor**, o la aplicación de X que intenta interactuar con el proveedor de contenido multimedia de terceros (por ejemplo, el sitio para compartir fotos)
* **el Delegador**, o el proveedor de contenido multimedia de terceros
* **el Proveedor del Servicio**, también conocido como X en sí mismo
     

En esencia, debes preparar una solicitud para que el Delegador la envíe a la X API en nombre de una aplicación y un usuario. Añade lo que de otro modo sería una solicitud OAuth firmada en un encabezado HTTP y pide al Delegador que envíe esa solicitud a X después de completar la operación intermedia.

Aquí hay un ejemplo: el Usuario quiere subir una foto. El Consumidor va a llamar al método de carga (upload) en el Delegador con un POST. El POST debe contener la imagen, pero también debe contener dos elementos adicionales como encabezados HTTP:

* `x-auth-service-provider` — en la práctica, este es el ámbito (realm) al que debe enviarse la delegación de identidad; en el caso de X, establécelo en https://api.x.com/1.1/account/verify_credentials.json. Las integraciones de X basadas en iOS5 agregarán un parámetro adicional application_id a esta URL, que también se utilizará para calcular el oauth_signature usado en x-verify-credentials-authorization.
* `x-verify-credentials-authorization` — el Consumidor debe crear todos los parámetros OAuth necesarios para poder llamar a https://api.x.com/1.1/account/verify_credentials.json usando OAuth en el encabezado HTTP (por ejemplo, debe verse como OAuth oauth\_consumer\_key="...", oauth\_token="...", oauth\_signature\_method="...", oauth\_signature="...", oauth\_timestamp="...", oauth\_nonce="...", oauth_version="..." ).
     

Ten en cuenta que todo el período de la transacción debe ocurrir dentro de un intervalo de tiempo en el que `oauth_timestamp` siga siendo válido.

Como alternativa, en lugar de enviar estos dos parámetros en el encabezado, se podrían enviar en el POST como x\_auth\_service_provider y x\_verify\_credentials_authorization; en este caso, recuerda escapar e incluir los parámetros en la cadena base de la firma OAuth, de forma similar a como se codifican los parámetros en cualquier solicitud. Es mejor usar encabezados HTTP para mantener las operaciones lo más separadas posible.

El objetivo del Delegador, en este punto, es verificar que el Usuario es quien dice ser antes de guardar el contenido multimedia. Una vez que el Delegador recibe todos los datos anteriores a través de su método de carga (upload), debe almacenar temporalmente la imagen y luego construir una llamada al endpoint especificado en el encabezado x-auth-service-provider; en este caso, https://api.x.com/1.1/account/verify_credentials.json, utilizando el mismo encabezado de autenticación OAuth proporcionado por el Consumidor en el encabezado x-verify-credentials-authorization.
 

<div id="oauth-echo-best-practices">
  #### Mejores prácticas de OAuth Echo
</div>

Utiliza la URL proporcionada por `x-auth-service-provider` para realizar la consulta, _no_ un valor codificado de forma fija. Apple iOS, por ejemplo, agrega un parámetro adicional `application_id` a todas las solicitudes OAuth, y su existencia debe mantenerse en cada etapa de OAuth Echo.

Para la parte de autorización OAuth, toma el valor del encabezado en `x-verify-credentials-authorization` y colócalo en su propio encabezado `Authorization` para la llamada al proveedor de servicios. Para mayor seguridad, confirma que el valor en `x-auth-service-provider` es el esperado.

* Si el proveedor de servicios devuelve un HTTP 200, entonces correcto. El Delegator debe almacenar permanentemente la imagen, generar una URL y devolverla.
* Si el proveedor de servicios no devuelve un HTTP 200, entonces desecha la imagen y devuelve un error al Consumer.