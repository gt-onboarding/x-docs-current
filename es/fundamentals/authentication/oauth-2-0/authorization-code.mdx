---
title: Flujo de código de autorización de OAuth 2.0 con PKCE
sidebarTitle: Flujo de código de autorización de OAuth 2.0 con PKCE
keywords: ["OAuth 2.0 PKCE", "flujo de código de autorización", "PKCE", "flujo de OAuth 2.0", "flujo de PKCE", "autorización de OAuth 2.0", "desafío de código"]
---

<div id="oauth-20-authorization-code-flow-with-pkce">
  ### Flujo de código de autorización de OAuth 2.0 con PKCE
</div>

<div id="introduction">
  #### Introducción
</div>

OAuth 2.0 es un protocolo de autorización estándar de la industria que permite un mayor control sobre el alcance de una aplicación y los flujos de autorización en múltiples dispositivos. OAuth 2.0 te permite elegir scopes específicos y granulares que te otorgan permisos concretos en nombre de un usuario. 

Para habilitar OAuth 2.0 en tu aplicación, debes activarlo en la configuración de autenticación de tu aplicación, ubicada en la sección de configuración de la aplicación en el portal para desarrolladores.

<div id="how-long-will-my-credentials-stay-valid">
  #### ¿Durante cuánto tiempo serán válidas mis credenciales?
</div>

De forma predeterminada, el token de acceso que crees mediante el flujo de código de autorización con PKCE solo será válido durante dos horas, a menos que hayas utilizado el scope `offline.access`.

<div id="refresh-tokens">
  #### Tokens de actualización
</div>

Los tokens de actualización permiten que una aplicación obtenga un nuevo token de acceso sin necesidad de solicitar nuevamente autorización al usuario, mediante el flujo de actualización de token.

Si se aplica el scope `offline.access`, se emitirá un token de actualización de OAuth 2.0. Con este token de actualización, se obtiene un token de acceso. Si este scope no se envía, no generaremos un token de actualización.

Un ejemplo de la solicitud que se realizaría para usar un token de actualización y obtener un nuevo token de acceso es el siguiente:

```bash
POST 'https://api.x.com/2/oauth2/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'refresh_token=bWRWa3gzdnk3WHRGU1o0bmRRcTJ5VUxWX1lZTDdJSUtmaWcxbTVxdEFXcW5tOjE2MjIxNDc3NDM5MTQ6MToxOnJ0OjE' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'client_id=rG9n6402A3dbUJKzXTNX4oWHJ
```

<div id="app-settings">
  #### Configuración de la aplicación
</div>

Puedes configurar la autenticación de tu aplicación como OAuth 1.0a u OAuth 2.0. También puedes habilitar que una aplicación use tanto OAuth 1.0a como OAuth 2.0.

OAuth 2.0 solo se puede usar con la X API v2. Si has seleccionado OAuth 2.0, podrás ver un Client ID en la sección de claves y tokens de tu aplicación. 

<div id="confidential-clients">
  #### Clientes confidenciales
</div>

[Los clientes confidenciales](https://datatracker.ietf.org/doc/html/rfc6749#section-2.1) pueden almacenar credenciales de forma segura sin exponerlas a terceros no autorizados y autenticarse de manera segura con el servidor de autorización, manteniendo tu client secret a salvo. Los clientes públicos, como suelen ejecutarse en un navegador o en un dispositivo móvil, no pueden usar tus client secrets. Si seleccionas un tipo de Aplicación que sea un cliente confidencial, se te proporcionará un client secret. 

Si seleccionaste en el portal para desarrolladores un tipo de cliente que es un cliente confidencial, también podrás ver un Client Secret. Tus opciones son Native App, Single page App, Web App, Automated App o bot. Native App y Single page Apps son clientes públicos y Web App y Automated App o bots son clientes confidenciales.

No necesitas client id para clientes confidenciales cuando utilizas un encabezado de autorización (Authorization Header) válido. Aun estás obligado a incluir Client Id en el cuerpo de las solicitudes con un cliente público. 

<div id="scopes">
  #### Alcances
</div>

Los alcances te permiten establecer un acceso granular para tu aplicación, de modo que solo tenga los permisos que necesita. Para obtener más información sobre qué alcances se asignan a qué endpoints, consulta nuestra [guía de asignación de autenticación](/es/resources/fundamentals/authentication/guides/v2-authentication-mapping).

|     |     |
| :--- | :--- |
| **Scope** | **Descripción** |
| tweet.read | Todas las publicaciones que puedes ver, incluidas las publicaciones de cuentas protegidas. |
| tweet.write | Publicar y hacer Retweet en tu nombre. |
| tweet.moderate.write | Ocultar y volver a mostrar respuestas a tus publicaciones. |
| users.email | Dirección de correo electrónico de un usuario autenticado. |
| users.read | Cualquier cuenta que puedas ver, incluidas las cuentas protegidas. |
| follows.read | Personas que te siguen y personas a las que sigues. |
| follows.write | Seguir y dejar de seguir personas en tu nombre. |
| offline.access | Permanecer conectado a tu cuenta hasta que revoques el acceso. |
| space.read | Todos los Spaces que puedes ver. |
| mute.read | Cuentas que has silenciado. |
| mute.write | Silenciar y dejar de silenciar cuentas en tu nombre. |
| like.read | Publicaciones a las que has dado “Me gusta” y “Me gusta” que puedes ver. |
| like.write | Dar y quitar “Me gusta” en publicaciones en tu nombre. |
| list.read | Listas, miembros de listas y seguidores de listas que has creado o de las que eres miembro, incluidas las listas privadas. |
| list.write | Crear y administrar listas en tu nombre. |
| block.read | Cuentas que has bloqueado. |
| block.write | Bloquear y desbloquear cuentas en tu nombre. |
| bookmark.read | Obtener las publicaciones añadidas a Marcadores por un usuario autenticado. |
| bookmark.write | Añadir publicaciones a Marcadores y quitar Marcadores de publicaciones. |
| media.write | Subir contenido multimedia. |

<div id="rate-limits">
  #### Límites de frecuencia
</div>

En la mayoría de los casos, los límites de frecuencia son los mismos que al autenticarse con OAuth 1.0a, con la excepción de la búsqueda de Publicaciones y de Usuarios. Estamos aumentando el límite por aplicación de 300 a 900 solicitudes por 15 minutos cuando se usa OAuth 2.0 para la búsqueda de Publicaciones y de usuarios. Para obtener más información, asegúrate de consultar nuestra [documentación sobre límites de frecuencia](/es/resources/fundamentals/rate-limits).

<div id="grant-types">
  #### Tipos de concesión
</div>

Solo ofrecemos el [authorization code](https://oauth.net/2/grant-types/authorization-code/) con [PKCE](https://oauth.net/2/pkce/) y el [refresh token](https://oauth.net/2/grant-types/refresh-token/) como [tipos de concesión](https://oauth.net/2/grant-types/) admitidos para este lanzamiento inicial. Es posible que proporcionemos más tipos de concesión en el futuro.

<div id="oauth-20-flow">
  #### Flujo de OAuth 2.0
</div>

OAuth 2.0 utiliza un flujo similar al que usamos actualmente para OAuth 1.0a. Puedes consultar un diagrama y una explicación detallada en nuestra [documentación al respecto](/es/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens). 

<div id="glossary">
  #### Glosario
</div>

|     |     |
| :--- | :--- |
| **Término** | **Descripción** |
| Grant types | El framework OAuth especifica varios tipos de concesión para distintos casos de uso y un marco para crear nuevos tipos de concesión. Algunos ejemplos incluyen authorization code, client credentials, device code y refresh token. |
| Confidential client | Un confidential client es una aplicación que puede autenticarse de forma segura con el servidor de autorización, por ejemplo, manteniendo su client secret registrado a salvo. |
| Public client | Un public client es una aplicación que no puede usar client secrets registrados, como las aplicaciones que se ejecutan en un navegador o dispositivo móvil. |
| Authorization code flow | Se utiliza tanto por confidential clients como por public clients para intercambiar un authorization code por un token de acceso. |
| PKCE | Una extensión del authorization code flow para evitar varios ataques y poder realizar de forma segura el intercambio OAuth desde public clients. |
| Client ID | Se puede encontrar en la sección de claves y tokens del portal para desarrolladores bajo el encabezado &quot;Client ID&quot;. Si no ves esto, ponte en contacto directamente con nuestro equipo. El Client ID será necesario para generar la URL de autorización (authorize URL). |
| Redirect URI | Tu URL de callback (redirección). Necesitarás tener [validación de coincidencia exacta](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6). |
| Authorization code | Esto permite que una aplicación llame a las API en nombre de los usuarios. Se conoce como auth&#95;code. El auth&#95;code tiene un límite de tiempo de 30 segundos una vez que el propietario de la App recibe un auth&#95;code aprobado del usuario. Tendrás que intercambiarlo por un token de acceso dentro de esos 30 segundos o el auth&#95;code expirará. |
| Access token | Los access tokens son los tokens que las aplicaciones usan para hacer solicitudes a la API en nombre de un usuario. |
| Refresh token | Permite que una aplicación obtenga un nuevo token de acceso sin solicitarlo al usuario mediante el flujo de refresh token. |
| Client Secret | Si has seleccionado un tipo de App que es un confidential client, se te proporcionará un &quot;Client Secret&quot; debajo de &quot;Client ID&quot; en la sección de claves y tokens de tu App. |

<div id="parameters">
  #### Parámetros
</div>

Para construir una URL de autorización de OAuth 2.0, debes asegurarte de incluir los siguientes parámetros en la URL de autorización. 

|     |     |
| :--- | :--- |
| **Parámetro** | **Descripción** |
| response&#95;type | Debes especificar que se trata de un código usando la palabra `code`. |
| client&#95;id | Se puede encontrar en el portal para desarrolladores con el encabezado &quot;Client ID&quot;. |
| redirect&#95;uri | Tu URL de retorno (callback URL). Este valor debe coincidir exactamente con una de las Callback URLs definidas en la configuración de tu Aplicación. Para OAuth 2.0, debes tener [validación de coincidencia exacta](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6) para tu callback URL. |
| state | Una cadena aleatoria que proporcionas para verificarla frente a [ataques CSRF](https://auth0.com/docs/protocols/state-parameters). La longitud de esta cadena puede ser de hasta 500 caracteres. |
| code&#95;challenge | Un parámetro [PKCE](https://www.oauth.com/oauth2-servers/pkce/authorization-request/), un secreto aleatorio para cada solicitud que realices. |
| code&#95;challenge&#95;method | Especifica el método que estás usando para hacer una solicitud (S256 o plain). |

<div id="authorize-url">
  #### URL de autorización
</div>

Con OAuth 2.0, generas una URL de autorización que puedes usar para permitir que un usuario se autentique mediante un flujo de autenticación, similar a “Iniciar sesión” con X. 

Un ejemplo de la URL que estás generando es el siguiente:

```
https://x.com/i/oauth2/authorize?response_type=code&client_id=M1M5R3BMVy13QmpScXkzTUt5OE46MTpjaQ&redirect_uri=https://www.example.com&scope=tweet.read%20users.read%20account.follows.read%20account.follows.write&state=state&code_challenge=challenge&code_challenge_method=plain
```

Debes usar la codificación adecuada para que esta URL funcione; asegúrate de consultar nuestra documentación sobre la [codificación por porcentaje](/es/resources/fundamentals/authentication/oauth-1-0a/percent-encoding-parameters).
