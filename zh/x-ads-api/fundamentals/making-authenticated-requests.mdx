---
title: 发起已认证请求
keywords: ["Ads API 身份验证", "已认证请求", "Ads API 身份验证", "OAuth Ads API", "Ads API 请求", "身份验证"]
---

访问 X Ads API 端点时，你的应用需要通过 TLS 安全地向 https://ads-api.x.com 发送经过身份验证的 Web 请求。

以下各节将概述如何发起已认证的 API 请求、如何设置 [Twurl](https://github.com/twitter/twurl#getting-started) 与 API 进行交互，以及如何扩展你的应用以支持 OAuth 1.0a 并向你的 Ads 账户发起请求。

<div id="requirements">
  ## 要求
</div>

在向 X Ads API 发送已认证请求之前，你需要：

* 一个[已获批准的开发者账号](/zh/resources/fundamentals/developer-portal)
* 一个已[获批 Ads API](/zh/x-ads-api/introduction) 访问权限的应用
* 通过 [app management UI](/zh/resources/fundamentals/developer-apps) 获取的 API key 和 secret，以及
* 一个属于具有 X Ads 账号访问权限用户的[访问令牌](/zh/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)

<div id="using-the-api">
  ## 使用 API
</div>

Advertising API 的访问地址为 https://ads-api.x.com。[标准 REST API](https://developer.x.com/en/docs/x-api/v1/tweets/post-and-engage/overview) 和 Advertising API 可以在同一个客户端应用中配合使用。Advertising API 强制使用 HTTPS，因此尝试通过 HTTP 访问任何端点都会返回错误消息。

Ads API 返回 JSON 格式的数据。所有标识符都是字符串，且所有字符串均为 UTF-8 编码。Advertising API 采用[版本控制](/zh/x-ads-api/fundamentals/versioning)，版本作为任意资源 URL 路径中的第一个元素进行指定。

`https://ads-api.x.com/<version>/accounts`

<div id="http-verbs-typical-response-codes">
  ## HTTP 动词和典型响应代码
</div>

Ads API 使用四种 HTTP 动词：

* **GET** 用于获取数据 
* **POST** 用于创建新数据，例如广告活动
* **PUT** 用于更新现有数据，例如广告单元（line items）
* **DELETE** 用于删除数据。

虽然删除是永久性的，但在使用大多数基于 GET 的方法请求资源时，如果显式包含 `with_deleted=true` 参数，仍然可以查看已删除的数据。否则，请求已删除记录会返回 HTTP 404 状态码。

成功的请求会返回 2xx 系列的 HTTP 状态码，并在创建、删除或更新资源时，附带表示该对象的 JSON 响应。

使用 HTTP PUT 更新数据时，只会更新指定的字段。你可以通过将参数设置为空字符串来取消设置一个可选值。比如，下面这一组参数会取消任何已设置的 `end_time`：`&end_time=&paused=false`。

有关错误响应的更多详细信息，请参阅 [Error Codes &amp; Responses](/zh/x-ads-api/fundamentals/error-codes-and-responses)。

<div id="in-line-parameters">
  ## 内联参数
</div>

大多数资源 URL 都包含一个或多个内联参数。许多 URL 还会在查询字符串中显式传递参数，或者对于 POST 或 PUT 请求，在请求体中传递参数。

内联参数在每个资源的 **Resource Path** 部分使用前置冒号（“:”）来表示。举例来说，如果你正在处理的账户被标识为 `"abc1"`，并且你在[检索与该账户关联的广告活动](/zh/x-ads-api/campaign-management#campaigns)，就会通过 URL `https://ads-api.x.com/6/accounts/abc1/campaigns` 访问该列表。通过在资源 URL（`https://ads-api.x.com/6/accounts/:account_id/campaigns`）中指定内联的 `account_id` 参数，你就将该请求限定为仅返回与该账户关联的对象。

<div id="using-access-tokens">
  ## 使用访问令牌
</div>

X Ads API 使用签名的 HTTPS 请求来验证应用的身份，并获取应用代表终端用户发起 API 请求时，该终端用户授予的权限，这些权限由用户的访问令牌来表示。所有对 Ads API 的 HTTP 调用都必须在 HTTPS 协议下包含一个 Authorization 请求头（使用 OAuth 1.0a）。

要集成 X Ads API，您需要在应用中添加生成 OAuth 1.0a Authorization 请求头的支持。不过，由于生成签名请求的过程较为复杂，我们强烈建议合作伙伴使用现有库，这些库要么已经支持 X API，要么已经实现了 OAuth 1.0a 请求处理——这里提供了一份[推荐的 OAuth 库](/zh/resources/fundamentals/authentication#oauth-1-0a-2)和[身份验证代码示例](/zh/resources/fundamentals/authentication#oauth-1-0a-2)列表。

请注意，如果合作伙伴在使用已知库时遇到身份验证错误，我们可以提供协助，但无法为自定义的 OAuth 实现提供支持。

<div id="http-oauth">
  ## HTTP 与 OAuth
</div>

与 X REST API v1.1 一样，广告 API 需要同时使用 [OAuth 1.0A](/zh/resources/fundamentals/authentication) 和 HTTPS。API 密钥可以通过[应用管理控制台](/zh/resources/fundamentals/developer-apps) 获取。还必须使用访问令牌来表示“当前用户”。当前用户是具有投放广告能力的 X 账号。

强烈建议合作伙伴使用 OAuth 库，而不是自行实现 OAuth。使用已知库时我们可以协助调试，但如果你自行实现 OAuth，我们将无法提供支持。请参阅你可以使用的[库](/zh/resources/fundamentals/authentication#oauth-1-0a-2)。

该 API 对 HTTP 1.1 和 OAuth 的要求非常严格。请确保在准备 OAuth 签名基字符串之前，已在 URL 和 POST 请求正文中正确[编码保留字符](https://tools.ietf.org/html/rfc3986#section-2.2)。广告 API 尤其在指定时间时使用 “:” 字符，在提供选项集合时使用 “,” 字符。这两个字符都属于此保留字符集的一部分：

| Symbol | URL Encoded |
| :--- | :--- |
| !   | %21 |
| #   | %23 |
| $   | %24 |
| &amp;   | %26 |
| &#39;   | %27 |
| (   | %28 |
| )   | %29 |
| *   | %2A |
| +   | %2B |
| ,   | %2C |
| /   | %2F |
| :   | %3A |
| ;   | %3B |
| =   | %3D |
| ?   | %3F |
| @   | %40 |
| [   | %5B |
| ]   | %5D |

<div id="making-your-first-api-request-with-twurl">
  ## 使用 Twurl 发起你的第一个 API 请求
</div>

X 维护着一个命令行工具 [Twurl](https://developer.x.com/en/docs/tutorials/using-twurl)，它支持 OAuth 1.0a 授权标头，可作为 [cURL](https://en.wikipedia.org/wiki/CURL) 的替代方案。Twurl 提供了一种简单方式，用于发起已授权的 API 请求，并在将认证集成到你的应用之前探索 Ads API。

在 [安装并授权 Twurl](https://github.com/twitter/twurl#getting-started) 之后，你可以快速生成访问令牌，并向 Ads API 发起已授权请求。

```bash
twurl -H "ads-api.x.com" "/5/accounts/"
```

请花些时间，通过这个讲解如何使用 API 创建广告系列的[分步](/zh/x-ads-api/campaign-management#creating-a-campaign-step-by-step)教程来熟悉 Twurl 和该 API。

<div id="testing-with-postman">
  ## 使用 Postman 进行测试
</div>

对于不熟悉命令行工具的开发者，我们还为 X Ads API 的各个端点提供了一个 Postman 集合。

[Postman](https://www.getpostman.com/products) 是目前业界最流行的 API 开发工具之一。它是一个 HTTP 客户端，拥有出色的图形界面，可以让你更轻松地发起复杂的 API 请求并提升工作效率。

要安装 Postman 并开始使用 Ads API 的 Postman 集合，请参阅我们的[设置指南](https://github.com/xdevplatform/postman-twitter-ads-api#installation)。

<Button href="https://app.getpostman.com/run-collection/369a02c0adc626ff6a06#?env%5BTwitter%20Ads%20API%5D=W3sia2V5IjoiYWNjb3VudF9pZCIsInZhbHVlIjoieW91cl9hZHNfYWNjb3VudF9pZCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidmVyc2lvbiIsInZhbHVlIjoiNiIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfa2V5IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX2tleSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfc2VjcmV0IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX3NlY3JldCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiYWNjZXNzX3Rva2VuIiwidmFsdWUiOiJ5b3VyX2FjY2Vzc190b2tlbiIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidG9rZW5fc2VjcmV0IiwidmFsdWUiOiJ5b3VyX3Rva2VuX3NlY3JldCIsImVuYWJsZWQiOnRydWV9XQ==">
  在 Postman 中运行
</Button>

<div id="extending-your-application-to-make-authenticated-requests">
  ### 扩展你的应用以发起带身份验证的请求
</div>

在使用 Twurl 调用 Ads API 并熟悉其请求方式之后，就可以开始为你的应用添加生成 OAuth 1.0a 身份验证请求头的功能。

[OAuth 1.0a](/zh/resources/fundamentals/authentication) 身份验证请求头包含的信息可以同时验证应用和用户的身份，并防止请求被篡改。你的应用需要为每一个 API 请求创建一个新的 `Authorization` 请求头。许多语言都有开源库可以帮助你创建这个身份验证请求头，从而向 X 发起 API 请求。

下面是一些使用 C#、PHP、Ruby 和 Python 的示例——[代码示例](/zh/resources/fundamentals/authentication#oauth-1-0a-2)。

<div id="custom-implementation">
  ## 自定义实现
</div>

在某些场景下，你可能需要在没有开源库支持的情况下自行实现 OAuth 1.0a 认证。[Authorizing a request](/zh/resources/fundamentals/authentication#authorizing-a-request) 提供了关于如何实现并创建 Authorization header 的详细说明。我们仍然强烈建议使用由社区维护的库。

总体步骤概览：

1. 为 header 收集 7 组以 oauth&#95; 开头的键值对
2. 使用这些键值对生成一个 [OAuth 1.0a HMAC-SHA1 signature](/zh/resources/fundamentals/authentication#creating-a-signature)
3. 使用上述值构建 [Authorization header](/zh/resources/fundamentals/authentication#authorizing-a-request)