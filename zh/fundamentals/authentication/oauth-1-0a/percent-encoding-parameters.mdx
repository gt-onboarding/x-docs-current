---
title: 百分号编码参数
sidebarTitle: 百分号编码参数
keywords: ["百分号编码", "URL 编码", "OAuth 编码", "参数编码", "URL 编码", "OAuth 1.0a 编码"]
---

import { Button } from "/snippets/zh/button.mdx";


<div id="percent-encoding-parameters">
  ### 百分号编码参数
</div>

X API 的部分功能，尤其是与 OAuth 签名相关的部分，要求字符串按照 [RFC 3986，第 2.1 节](http://tools.ietf.org/html/rfc3986#section-2.1) 进行编码。由于许多 URL 编码算法的实现与 RFC 3986 不完全兼容，不正确的编码是导致许多 OAuth 签名错误的原因。因此，本页对应当使用的精确签名算法进行了说明。

本页介绍了 [RFC 3986，第 2.1 节](http://tools.ietf.org/html/rfc3986#section-2.1) 中描述的 URL 编码过程。如本文件与该规范存在任何歧义或不一致之处，我们建议你以该规范为准。
 

<div id="encoding-a-string">
  #### 对字符串进行编码
</div>

以下算法假设你通过逐字节复制的方式，将字符串 SRC 的值复制到字符串 DST 中来对 SRC 进行编码。

**步骤 1：当 SRC 仍包含未读取的字节时，从 SRC 读取下一个字节（8 位）。** 通常，这被视为一个字符，但在某些编码（例如 UTF-8）中，一个字符可能由多个字节组成，此时只需读取第一个字节。

**步骤 2：检查读取的字节是否是下面任一 ASCII 字符。** 下表为了便于阅读被拆分为多行，但你只需要判断读取的字节是否存在于整个表中，而不需要关心具体是哪一行。

| 名称 | ASCII 字符 | 对应字节值 |
| :--- | :--- | :--- |
| 数字 | ‘0’, ‘1’, ‘2’, ‘3’, ‘4’, ‘5’, ‘6’, ‘7’, ‘8’, ‘9’ | 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39 |
| 大写字母 | ‘A’, ‘B’, ‘C’, ‘D’, ‘E’, ‘F’, ‘G’, ‘H’, ‘I’, ‘J’, ‘K’, ‘L’, ‘M’, ‘N’, ‘O’, ‘P’, ‘Q’, ‘R’, ‘S’, ‘T’, ‘U’, ‘V’, ‘W’, ‘X’, ‘Y’, ‘Z’ | 0x41, 0x42, 0x43, 0x44, 0x45,0x46, 0x47, 0x48, 0x49, 0x4A, 0x4B,0x4C, 0x4D, 0x4E, 0x4F, 0x50, 0x51,0x52, 0x53, 0x54, 0x55, 0x56, 0x57,0x58, 0x59, 0x5A |
| 小写字母 | ‘a’, ‘b’, ‘c’, ‘d’, ‘e’, ‘f’, ‘g’, ‘h’, ‘i’, ‘j’, ‘k’, ‘l’, ‘m’, ‘n’, ‘o’, ‘p’, ‘q’, ‘r’, ‘s’, ‘t’, ‘u’, ‘v’, ‘w’, ‘x’, ‘y’, ‘z’ | 0x61, 0x62, 0x63, 0x64, 0x65,0x66, 0x67, 0x68, 0x69, 0x6A, 0x6B,0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71,0x72, 0x73, 0x74, 0x75, 0x76, 0x77,0x78, 0x79, 0x7A |
| 保留字符 | ‘-‘, ‘.’, ‘_’, ‘~’ | 0x2D, 0x2E, 0x5F, 0x7E |

**步骤 2b：如果该字节未出现在上述表格中，则继续。** 任何其他值都必须进行编码。 **步骤 2a：如果该字节出现在上述表格中，则将其复制到 DST，并返回步骤 1。** 上述表中的字符不需要转义，因此你只需直接复制该字节。

**步骤 3：向 DST 写入字符 ‘%’。** 百分号字符 ‘%’（十六进制为 0x25，二进制为 00100101）表示接下来的两个字节将表示一个已编码的字节。

**步骤 4：向 DST 写入两个字符，这两个字符表示当前字节的十六进制值（使用大写 ASCII 字符）。** 这有点容易让人困惑，下面是一个示例。假设当前字节是 0xE6（二进制为 11100110）。这对应于字符 ‘æ’ 的 UTF-8 编码值。为了对这个值进行编码，先向 DST 写入字符 ‘E’（0x45，来自上表），然后写入字符 ‘6’（0x36）。最后写入的三个字符应为 “%E6”。请注意，如果你写入的是 A、B、C、D、E 或 F 这样的字母，必须使用大写形式。

**步骤 5：返回步骤 1。** 持续执行，直到 SRC 的内容全部复制到 DST 为止。
 

<div id="examples">
  #### 示例
</div>

下面的示例可帮助你与自己代码的输出进行比较。你应将任何差异视为错误。将空格编码为“+”字符就是一种错误的编码方式。

| 原始字符串 | 编码后字符串 |
| :--- | :--- |
| Ladies + Gentlemen | Ladies%20%2B%20Gentlemen |
| An encoded string! | An%20encoded%20string%21 |
| Dogs, Cats & Mice | Dogs%2C%20Cats%20%26%20Mice |
| ☃   | %E2%98%83 |