---
title: 构建查询
sidebarTitle: 构建查询
keywords: ["构建查询", "搜索查询", "查询构建器", "搜索运算符", "查询语法", "构建搜索查询", "查询指南"]
---

<div id="building-queries-for-search-posts">
  ## 为搜索帖子构建查询
</div>

搜索端点通过 GET 请求接收单个查询，并返回一组与该查询匹配的历史帖子。查询由一组运算符组成，这些运算符用于匹配多种帖子属性。 

<div id="table-of-contents">
  ### 目录
</div>

* [构建查询](#build)
* [查询限制](#limits)
* [运算符适用范围](#availability)
* [运算符类型：可独立使用与需使用逻辑连词](#types)
* [布尔运算符和分组](#boolean)
* [运算顺序](#order-of-operations)
* [标点符号、变音符号与大小写敏感性](#punctuation)
* [精确度与效率](#specificity)
* [引用帖子匹配行为](#quote-tweets)
* [迭代构建查询](#iterative)
* [在请求中添加查询](#adding-a-query)
* [查询示例](#examples)
* [运算符列表](#list)

<div id="building-a-query">
  ### 构建查询语句
</div>

<div id="query-limitations">
  #### 查询限制
</div>

你的查询会根据你所使用的[访问级别](/zh/x-api/getting-started/about-x-api)而受到限制。 

如果你具有 Basic 或 Pro 访问权限，你在最近搜索端点上的查询最长可以为 512 个字符。 

如果你具有 Pro 访问权限，你在全量归档搜索端点上的查询最长可以为 1,024 个字符。 

<div id="operator-availability">
  #### 运算符可用性
</div>

虽然大多数运算符对所有开发者都可用，但有一些仅保留给特定访问级别。我们在 [运算符列表](/zh/x-api/posts/search/integrate/operators) 表格中使用以下标签来标明每个运算符在对应访问级别下的可用情况：

* **核心运算符：** 使用任意 [Project](/zh/resources/fundamentals/projects) 时可用。
* **高级运算符：** 使用具有特定访问级别的 Project 时可用。

<div id="operator-types-standalone-and-conjunction-required">
  #### 运算符类型：独立运算符与需搭配使用的运算符
</div>

**独立运算符（Standalone operators）** 可以单独使用，也可以与任何其他运算符（包括那些需要搭配使用的运算符）一起使用。

例如，下面的查询可以正常工作，因为它使用了 `#hashtag` 运算符，而该运算符是独立运算符：

`#xapiv2`

**需搭配使用的运算符（Conjunction-required operators）** 不能在查询中单独使用；只有在查询中至少还包含一个独立运算符时才能使用。原因是，如果单独使用这些运算符，查询条件会过于宽泛，并且会匹配到数量极其庞大的帖子。

例如，下面的查询不受支持，因为它们只包含需搭配使用的运算符：

`has:media`

`has:links OR is:retweet`

如果我们加入一个独立运算符，例如短语 `"X data"`，那么查询就可以正常执行。

`"X data" has:mentions (has:media OR has:links)`

<div id="boolean-operators-and-grouping">
  #### 布尔运算符和分组
</div>

如果你想在一个查询中组合多个运算符，可以使用以下方式：

|     |     |
| :--- | :--- |
| **AND 逻辑** | 连续的运算符之间用空格分隔时，将采用布尔 AND 逻辑，这意味着只有在两个条件都满足时才会匹配帖子。例如，`snow day #NoSchool` 会匹配同时包含词语 snow 和 day 以及话题标签 #NoSchool 的帖子。 |
| **OR 逻辑** | 连续的运算符之间使用 OR 分隔时，将采用 OR 逻辑，这意味着只要任一条件满足就会匹配帖子。例如，指定 `grumpy OR cat OR #meme` 会匹配包含 grumpy 或 cat 这两个词语之一，或包含话题标签 #meme 的任意帖子。 |
| **NOT 逻辑，取反** | 在关键词（或任何运算符）前加上减号 (-) 即可对其取反（NOT）。例如，`cat #meme -grumpy` 会匹配包含话题标签 #meme 和词语 cat、但不包含词语 grumpy 的帖子。一个常见的查询子句是 `-is:retweet`，它不会匹配转帖（Retweets），因此只会匹配原始帖子、引用帖子（Quote Tweets）和回复。所有运算符都可以被取反，但取反的运算符不能单独作为条件使用。 |
| **分组** | 你可以使用括号将运算符分组。例如，`(grumpy cat) OR (#meme has:images)` 将返回包含词语 grumpy 和 cat 的帖子，或者带有图片且包含话题标签 #meme 的帖子。请注意，会先应用 AND，然后再应用 OR。 |

**关于取反的说明**

运算符 `-is:nullcast` 必须始终以取反形式使用。

取反的运算符不能单独使用。

不要对一组用括号括起来的运算符整体取反，请改为对每个单独的运算符取反。例如，请不要使用 `skiing -(snow OR day OR noschool)`，而建议你使用 `skiing -snow -day -noschool`。 

<div id="order-of-operations">
  #### 运算顺序
</div>

在组合 AND 和 OR 逻辑时，下面的运算顺序将决定查询是如何被解析和评估的。

1. 通过 AND 逻辑连接的运算符会首先组合
2. 然后，再应用通过 OR 逻辑连接的运算符

例如：

* `apple OR iphone ipad` 将被解析为 `apple OR (iphone ipad)`
* `ipad iphone OR android` 将被解析为 `(iphone ipad) OR android`

为消除不确定性并确保查询按你的预期进行评估，请在合适的地方使用括号将词项分组。 

例如：

* `(apple OR iphone) ipad`
* `iphone (ipad OR android)`

<div id="punctuation-diacritics-and-case-sensitivity">
  #### 标点符号、变音符号和大小写敏感性
</div>

如果你在关键词或标签查询中使用带有重音或变音符号的字符，它会匹配帖子文本中既包含带重音和变音符号的词，也包含使用普通字符的对应词。例如，包含关键词 `Diacrítica` 或标签 `#cumpleaños` 的查询，将匹配 *Diacrítica* 或 *#cumpleaños*，也会匹配不带重音 í 或 ñ 的 *Diacritica* 或 *#cumpleanos*。

带重音或变音符号的字符会被视为与普通字符相同，并且不会被视为词边界。例如，使用关键词 `cumpleaños` 的查询，只会匹配包含单词 *cumpleaños* 的结果，而不会匹配包含 *cumplea*、*cumplean* 或 *os* 的结果。

所有运算符的评估都不区分大小写。例如，查询 `cat` 会匹配包含以下任意形式的帖子：*cat*、*CAT*、*Cat*。

[filtered stream](/zh/x-api/posts/filtered-stream) 的匹配行为与 Search Posts 不同。当[构建 filtered stream 规则](/zh/x-api/posts/filtered-stream#building-rules-for-filtered-stream)时，请注意，包含重音和变音符号的关键词和标签只会匹配同样包含该重音和变音符号的词，而不会匹配使用普通字符的词。

例如，包含关键词 `Diacrítica` 或标签 `#cumpleaños` 的 filtered stream 规则只会匹配词 *Diacrítica* 和 *#cumpleaños*，而不会匹配不带重音 í 或 ñ 的 *Diacritica* 或 *#cumpleanos*。

<div id="specificity-and-efficiency">
  #### 精确性和效率
</div>

在开始构建查询时，需要牢记以下几点。

* 通常不建议在查询中只使用宽泛、独立的运算符，例如单个关键词或 #hashtag，因为这很可能会匹配到海量帖子。构建更健壮的查询可以得到更精确的一组匹配帖子，并有望减少响应数据中的噪音，避免你在筛选有价值洞察时需要处理过多无关内容。 
  * 例如，如果你的查询只是关键词 `happy`，你每天可能会获得 200,000 - 300,000 条帖子。
  * 添加更多条件运算符会缩小搜索结果范围，例如 `(happy OR happiness) place_country:GB -birthday -is:retweet`
* 编写高效的查询还有助于符合查询字符串长度限制。字符数包括整个查询字符串中的所有字符，包括空格和运算符。
  * 例如，下面的查询长度为 59 个字符：`(happy OR happiness) place_country:GB -birthday -is:retweet`

<div id="quote-tweet-matching-behavior">
  #### 引用帖子匹配行为
</div>

在使用 Search Posts 端点时，运算符不会匹配被引用的原始帖子内容，而只会匹配引用帖子中包含的内容。

但是，请注意，[filtered stream](/zh/x-api/posts/filtered-stream) 会同时匹配被引用的原始帖子内容以及引用帖子的内容。

<div id="iteratively-building-a-query">
  #### 迭代式构建查询
</div>

<div id="test-your-query-early-and-often">
  ##### 尽早并经常测试你的查询
</div>

让查询第一次就返回“正确”的结果是很少见的。X 上的内容非常多，其中很多一开始可能并不显而易见，而且上文描述的查询语法也可能很难精确匹配你想要的搜索。随着你构建查询，定期对其进行测试非常重要。

在本节中，我们将从以下查询开始，并根据测试过程中得到的结果对其进行调整： 

`happy OR happiness`

<div id="use-results-to-narrow-the-query">
  ##### 使用结果来缩小查询范围
</div>

在测试查询时，你应该浏览返回的帖子，查看其中是否包含你期望和希望获取的数据。先从范围较宽的查询和一个包含更多匹配帖子的超集开始，可以先查看结果，再逐步收窄查询，从而过滤掉不需要的结果。  

当我们测试示例查询时，我们注意到返回了多种不同语言的帖子。在这种情况下，我们只想接收英文帖子，因此要添加 `lang:` 运算符：

`(happy OR happiness) lang:en`

测试结果中有大量帖子是在祝别人生日快乐，因此我们要添加 `-birthday` 作为一个否定关键词运算符。我们还只希望接收原创帖子，所以又添加了否定的 `-is:retweet` 运算符：

`(happy OR happiness) lang:en -birthday -is:retweet`

<div id="adjust-for-inclusion-where-needed">
  ##### 在需要时调整以包括更多结果
</div>

如果你发现没有收到预期的数据，并且确定存在本应被返回的帖子，那么你可能需要通过移除某些可能过滤掉目标数据的运算符来放宽查询范围。 

在我们的示例中，我们注意到在个人时间线上还有其他表达我们所寻找情绪的帖子，但没有包含在测试结果中。为确保有更广的覆盖范围，我们打算添加关键词 `excited` 和 `elated`。

`(happy OR happiness OR excited OR elated) lang:en -birthday -is:retweet`

<div id="adjust-for-popular-trendsbursts-over-the-time-period">
  ##### 根据该时间段内的热门趋势/突发热度进行调整
</div>

X 上的趋势更迭非常迅速。维护查询应该是一个持续的过程。如果你计划在一段时间内使用某个查询，我们建议你定期检查自己收到的数据，以评估是否需要做出任何调整。

在我们的示例中，我们注意到开始收到一些祝人们“节日快乐”的帖子。因为我们不希望这些帖子被包含在结果中，所以我们要添加一个否定的 `-holidays` 关键词。

`(happy OR happiness OR excited OR elated) lang:en -birthday -is:retweet -holidays`

<div id="adding-a-query-to-your-request">
  ### 将查询添加到请求中
</div>

要将查询添加到请求中，必须使用 `query` 参数。与任何查询参数一样，你必须确保对编写的查询进行 HTTP 编码处理。

下面是一个使用 cURL 命令的示例，其中额外包含了 `tweet.fields` 和 `max_results` 参数。如果你想使用此命令，请务必将 `$BEARER_TOKEN` 替换为你自己的 [Bearer Token](/zh/resources/fundamentals/authentication#oauth-2-0)：

```bash
curl https://api.x.com/2/tweets/search/recent?query=cat%20has%3Amedia%20-grumpy&tweet.fields=created_at&max_results=100 -H "Authorization: Bearer $BEARER_TOKEN"
```

<div id="query-examples">
  ### 查询示例
</div>

<div id="tracking-a-natural-disaster">
  #### 跟踪自然灾害
</div>

下面的查询会匹配来自气象机构和监测站、讨论 2017 年袭击休斯顿的飓风 Harvey 的原始帖子。

下面是不带 HTTP 编码的查询示例：

`has:geo (from:NWSNHC OR from:NHC\_Atlantic OR from:NWSHouston OR from:NWSSanAntonio OR from:USGS\_TexasRain OR from:USGS_TexasFlood OR from:JeffLindner1) -is:retweet`

下面是带有 HTTP 编码、查询参数以及 recent 搜索 URI 的查询示例：

`https://api.x.com/2/tweets/search/recent?query=-is%3Aretweet%20has%3Ageo%20(from%3ANWSNHC%20OR%20from%3ANHC\_Atlantic%20OR%20from%3ANWSHouston%20OR%20from%3ANWSSanAntonio%20OR%20from%3AUSGS\_TexasRain%20OR%20from%3AUSGS_TexasFlood%20OR%20from%3AJeffLindner1)`

<div id="reviewing-the-sentiment-of-a-conversation">
  #### 分析对话的情绪倾向
</div>

下一个规则可用于更好地理解围绕话题标签 *#nowplaying* 展开的对话情绪，但范围仅限于发布自北美地区的帖子。

下面是不带 HTTP 编码的两个不同查询，一个用于正向情绪，一个用于负向情绪：

`#nowplaying (happy OR exciting OR excited OR favorite OR fav OR amazing OR lovely OR incredible) (place\_country:US OR place\_country:MX OR place_country:CA) -horrible -worst -sucks -bad -disappointing`

`#nowplaying (horrible OR worst OR sucks OR bad OR disappointing) (place\_country:US OR place\_country:MX OR place_country:CA) -happy -exciting -excited -favorite -fav -amazing -lovely -incredible`

下面是带有 HTTP 编码、查询参数以及 recent search URI 的查询形式：

`https://api.x.com/2/tweets/search/recent?query=%23nowplaying%20(happy%20OR%20exciting%20OR%20excited%20OR%20favorite%20OR%20fav%20OR%20amazing%20OR%20lovely%20OR%20incredible)%20(place\_country%3AUS%20OR%20place\_country%3AMX%20OR%20place_country%3ACA)%20-horrible%20-worst%20-sucks%20-bad%20-disappointing`

`https://api.x.com/2/tweets/search/recent?query=%23nowplaying%20(horrible%20OR%20worst%20OR%20sucks%20OR%20bad%20OR%20disappointing)%20(place\_country%3AUS%20OR%20place\_country%3AMX%20OR%20place_country%3ACA)%20-happy%20-exciting%20-excited%20-favorite%20-fav%20-amazing%20-lovely%20-incredible`

<div id="find-posts-that-relate-to-a-specific-post-annotation">
  #### 查找与特定 Post 标注相关的帖子
</div>

此规则用于搜索包含宠物（但不是猫）图片的原创帖子，并且该帖子识别出的语言为日语。为此，我们使用了 `context:` 运算符，来利用 [Post 标注](/zh/x-api/fundamentals/post-annotations) 功能。我们首先使用 [Post 查找](/zh/x-api/posts/lookup/introduction) 端点和 `tweet.fields=context_annotations` 字段参数，以确定在查询中需要使用哪些 domain.entity ID：

* 与猫相关的帖子会返回 `domain` 66（兴趣与爱好类别），其中 entity 为 852262932607926273（Cats）。
* 与宠物相关的帖子会返回 `domain` 65（兴趣与爱好垂直领域），其中 entity 为 852262932607926273（Pets）。

下面是不带 HTTP 编码的查询示例：

`context:65.852262932607926273 -context:66.852262932607926273 -is:retweet has:images lang:ja`

下面是带有 HTTP 编码、query 参数以及 recent search URI 的查询示例：

`https://api.x.com/2/tweets/search/recent?query=context%3A65.852262932607926273%20-context%3A66.852262932607926273%20-is%3Aretweet%20has%3Aimages%20lang%3Aja`

你也可以试用 [query builder 工具](https://developer.x.com/apitools/query?query=) 获取更多帮助。