---
title: 全量归档搜索
sidebarTitle: 全量归档搜索
keywords: ["全量归档搜索", "归档搜索快速入门", "历史搜索", "全量归档教程", "归档搜索指南"]
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-full-archive-search-endpoint">
  ## 开始使用完整存档搜索端点
</div>

本快速入门指南将帮助你使用 Postman，向完整存档搜索端点发送第一个请求，并指定一组字段。

如果你想查看不同语言的示例代码，请访问我们在 GitHub 上的 [X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) 代码仓库。 

<Note>
  ### 先决条件

  完整存档搜索端点目前仅对 Pro 和 Enterprise 访问级别开放。要使用此端点，你必须升级到 Pro 访问级别，或 [申请 Enterprise 访问级别](https://docs.google.com/forms/d/e/1FAIpQLScO3bczKWO2jFHyVZJUSEGfdyfFaqt2MvmOfl_aJp0KxMqtDA/viewform)。

  除了获得访问批准之外，你还需要一组用于对请求进行身份验证的[密钥和令牌](/zh/resources/fundamentals/authentication)。你可以通过以下步骤生成这些密钥和令牌：

  * 在开发者门户中，前往具有 Enterprise 或 Pro 访问级别的[项目](/zh/resources/fundamentals/projects)，并确保该项目下关联了一个[开发者应用](/zh/resources/fundamentals/developer-apps)。

  * 前往你的应用的 “Keys and tokens（密钥和令牌）” 页面以生成所需的凭证。请务必将所有凭证保存在安全的位置。
</Note>

<div id="steps-to-build-a-full-archive-search-request">
  ### 构建全档案搜索请求的步骤
</div>

**步骤一：从工具或库开始**

有多种不同的工具、代码示例和库可用于向此 endpoint 发起请求，但在这里我们将使用 Postman 工具来简化流程。

要将 X API v2 Postman collection 加载到你的环境中，请点击以下按钮：

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  将 X API v2 添加到 Postman
</Button>

在你将 X API v2 collection 加载到 Postman 后，导航到 Search Posts &gt; Full-archive search request。

**步骤二：为你的请求进行身份验证**

要正确地向 X API 发起请求，你需要验证自己是否拥有权限。对于此 endpoint，你必须使用 [OAuth 2.0 App-Only](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token) 认证方式对你的请求进行身份验证。

你必须将你的密钥和令牌（特别是 [App Access Token](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)（也称为 App-only Bearer Token））添加到 Postman。你可以通过在 Postman 右上角选择名为 “X API v2” 的环境，并将你的密钥和令牌添加到 &quot;initial value&quot; 和 &quot;current value&quot; 字段中（点击环境下拉菜单旁边的眼睛图标）来完成此操作。

如果你正确完成此操作，该变量将会自动被填充到请求的 Authorization 选项卡中。
 

**步骤三：创建搜索查询**

每个全档案搜索请求都需要一个搜索查询。在此示例中，我们将使用一个匹配 @XDevelopers 账号所发布帖子的查询。对于该查询，我们使用 from 运算符，并将其设置为 XDevelopers（不区分大小写）：

`from:XDevelopers`

在 Postman 中，导航到 &quot;Params&quot; 选项卡，并将此 ID，或由多个 Post ID 组成、以逗号分隔的字符串，填入 `ids` 参数的 &quot;Value&quot; 列中。
 

| Key | Value | Description |
| :--- | :--- | :--- |
| `query` | `from:XDevelopers` | 提交到全档案搜索 endpoint 的搜索查询 |

**步骤四：确定并指定你希望检索的字段**

如果你在步骤三之后点击 &quot;Send&quot; 按钮，你将在响应中收到默认的 [Post 对象](/zh/x-api/fundamentals/data-dictionary#tweet) 字段：`id`、`text` 和 `edit_history_tweet_ids`。请注意，如果你收到的是编辑功能推出之前的帖子，则不会返回 `edit_history_tweet_ids` 字段。我们不会为该字段回填历史数据。 

如果你希望接收这些默认字段之外的其他字段，你需要在请求中通过 [field](/zh/x-api/fundamentals/fields) 和/或 [expansion](/zh/x-api/fundamentals/expansions) 参数来指定这些字段。

在本练习中，我们将从不同对象中请求四组不同的字段：

1. 默认的 Post 对象字段
2. 主对象中的附加 tweet.created&#95;at 字段
3. 返回帖子所关联作者的 [user 对象](/zh/x-api/fundamentals/data-dictionary#user) 默认字段
4. 关联用户对象中的附加 user.description 字段
    

在 Postman 中，导航到 &quot;Params&quot; 选项卡，并在 &quot;Query Params&quot; 表中添加以下 key:value 对：

| Key | Value | Returned fields |
| :--- | :--- | :--- |
| `tweet.fields` | `created_at` | `tweets.created_at` |
| `expansions` | `author_id` | includes.users.id, includes.users.name, includes.users.username |
| `user.fields` | `description` | includes.users.description |

你现在应该会在 &quot;Send&quot; 按钮旁看到如下 URL：

`https://api.x.com/2/tweets/search/all?query=from:XDevelopers&tweet.fields=created_at&expansions=author_id&user.fields=created_at`

<Note>
  **请注意**

  默认情况下，只会返回最近的 10 条帖子。如果你希望每个请求返回超过 10 条帖子，可以使用 max&#95;results 参数，并将其设置为每个请求最多 500 条帖子。同样地，默认情况下只会返回最近 30 天内的帖子。如果你想获取早于 30 天的帖子，可以在 API 调用中使用 start&#95;time 和 end&#95;time 参数。
</Note>

**步骤五：发送请求并查看响应**

在完成所有设置后，点击“Send”按钮，即可收到类似于下面的响应：

```
{
   "data": [
       {
           "author_id": "2244994945",
           "created_at": "2020-06-11T16:05:06.000Z",
           "id": "1271111223220809728",
           "text": "今晚收看 @jessicagarson 带我们了解如何在 R 中运行您最喜欢的 Python 包。🍿\n\n学习如何将两种强大的编程语言结合用于数据科学，并查看使用 Twitter 开发者实验室最新搜索端点的实时示例。https://t.co/v178oUZNuj"
       },
       {
           "author_id": "2244994945",
           "created_at": "2020-06-10T19:25:24.000Z",
           "id": "1270799243071062016",
           "text": "在我们致力于构建新的 Twitter API 的过程中，我们延长了几个 Labs v1 端点的弃用时间表。了解更多 📖 https://t.co/rRWaJYJgKk"
       },
       {
           "author_id": "2244994945",
           "created_at": "2020-06-09T18:08:47.000Z",
           "id": "1270417572001976322",
           "text": "注释帮助您更多地了解推文——它们甚至可以帮助您找到感兴趣的话题。🔬\n\n在本教程中，@suhemparack 向我们展示如何使用注释 + 过滤流端点查找与 COVID-19 相关的推文。\n\n了解您也可以如何做到。⤵️\nhttps://t.co/qwVOgw0zSV"
       }
   ],
   "includes": {
       "users": [
           {
               "description": "Twitter #DevRel 团队的声音，也是您获取 Twitter API 更新、新闻和活动的官方来源。\n\n#BlackLivesMatter",
               "id": "2244994945",
               "name": "Twitter 开发者",
               "username": "TwitterDev"
           }
       ]
   },
   "meta": {
       "newest_id": "1271111223220809728",
       "oldest_id": "1270417572001976322",
       "result_count": 3
   }
}
```

在本示例中，我们使用了一个非常简单的查询。如果你想查看更详细的指南，请访问下面列出的资源。 

**后续步骤**

[使用 API 参考文档自定义你的请求](/zh/x-api/posts/full-archive-search)

[查看查询运算符的完整列表](/zh/x-api/posts/search/integrate/build-a-query "查看查询运算符的完整列表")

[使用这些端点的示例代码](https://github.com/xdevplatform/Twitter-API-v2-sample-code "使用这些端点的示例代码")
