---
title: v1 到 v2
sidebarTitle: v1 到 v2
keywords: ["v1.1 到 v2 迁移", "过滤流迁移", "迁移过滤流", "standard 到 v2 过滤流", "v1 到 v2 过滤流", "迁移指南"]
---

<div id="standard-v11-compared-to-x-api-v2">
  ### 标准 v1.1 与 X API v2 的比较
</div>

如果你之前一直在使用 v1.1 的 [statuses/filter](https://developer.x.com/en/docs/x-api/v1/tweets/filter-realtime/api-reference/post-statuses-filter) 端点，那么本指南可以帮助你了解标准端点与 X API v2 过滤流端点之间的相似之处和差异。

* **相似之处**
  * 请求参数和运算符
  * 对帖子编辑历史和元数据的支持
* **差异**
  * 端点 URL
  * 应用和项目要求
  * 身份验证方式
  * 规则数量和持久化流
  * 响应数据格式
  * 请求参数
  * 恢复和冗余功能的可用性
  * 查询运算符

<div id="similarities">
  #### 相似之处
</div>

**请求参数和运算符**

标准 v1.1 `statuses/filter` 端点提供了一些参数，可以随请求一起传入以过滤流。使用 v2 过滤流时，你需要改用一组[运算符](/zh/x-api/posts/filtered-stream#building-rules-for-filtered-stream)，并通过布尔逻辑将它们组合起来，以筛选出所需的帖子。可用的运算符中有一些是对现有标准 v1.1 参数的直接替代。 

以下标准 v1.1 请求参数在 X API v2 中具有等效运算符：
 

| **Standard** | **X API v2** |
| :--- | :--- |
| follow - 以逗号分隔的用户 ID 列表，表示应在流中投递其帖子的用户。 | 许多可帮助你查找与特定用户相关帖子的运算符：<br /><br />* @<br />* from:<br />* to:<br />* 等等 |
| track - 以逗号分隔的短语列表，用于确定哪些帖子会在流中被投递。 | 许多可帮助你查找与特定关键词相关帖子的运算符：<br /><br />* keyword<br />* “exact phrase match”（完全短语匹配）<br />* #<br />* 等等 |

**对帖子编辑历史和元数据的支持**

这两个版本都提供描述任何编辑历史的元数据。请参阅 [过滤流 API 参考](/zh/x-api/posts/filtered-stream#api-reference-index)和[帖子编辑基础知识页面](/zh/x-api/fundamentals/edit-posts)了解更多信息。 

<div id="differences">
  #### 差异
</div>

**Endpoint URL**

* 标准 v1.1 endpoint：
  * https://stream.x.com/1.1/statuses/filter.json
* X API v2 endpoint：
  * https://api.x.com/2/tweets/search/stream
  * https://api.x.com/2/tweets/search/stream/rule

**应用和项目要求**

在对请求进行认证时，X API v2 endpoint 要求你使用与某个[开发者应用](/zh/resources/fundamentals/developer-apps)关联的[项目](/zh/resources/fundamentals/projects)中的凭证。所有 X API v1.1 endpoint 都可以使用独立应用或与项目关联的应用中的凭证。

**认证方法**

标准 endpoint 支持 [OAuth 1.0a 用户上下文](/zh/resources/fundamentals/authentication)，而 X API v2 过滤流 endpoint 支持 [OAuth 2.0 应用仅模式](/zh/resources/fundamentals/authentication#oauth-2-0)（也称为仅应用认证）。要向 X API v2 版本发起请求，你必须使用 App Access Token（应用访问令牌）来为请求进行认证。

如果你不再拥有在开发者门户中创建项目和应用时提供给你的 App Access Token，你可以前往开发者门户中应用的 “Keys and tokens” 页面生成一个新的令牌。如果你希望以编程方式生成 App Access Token，请参阅此 [OAuth 2.0 应用仅模式指南](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token)。 

**规则数量和持久流**

标准 v1.1 endpoint 只支持一个规则来过滤流式连接。要更改规则，你必须断开该流，然后使用更新后的过滤规则作为参数提交新的请求。 

X API v2 过滤流 endpoint 允许你对单个流应用多个规则，并且在保持流连接的同时向流中添加或移除规则。 

**响应数据格式**

标准 v1.1 与 X API v2 endpoint 版本之间最大的差异之一，是你如何选择在负载中返回哪些字段。

对于标准 endpoint，你默认会接收到许多响应字段，然后可以选择使用参数来指定应在负载中返回哪些字段或字段集合。

X API v2 版本默认只返回帖子 id 和 text 字段。要请求任何额外的字段或对象，你需要使用 [fields](/zh/x-api/fundamentals/fields) 和 [expansions](/zh/x-api/fundamentals/expansions) 参数。从这些 endpoint 请求的任何 Post 字段都会返回在主 Post 对象中。任何扩展的用户、媒体、投票或地点对象及其字段，则会返回在响应中的 includes 对象内。然后，你可以通过匹配帖子和扩展对象中出现的 ID，将任何扩展对象与 Post 对象关联起来。 

我们鼓励你在各自的指南中进一步了解这些新参数，或者阅读我们的[如何使用 fields 和 expansions](/zh/x-api/fundamentals/data-dictionary#how-to-use-fields-and-expansions) 指南。 

我们还整理了一个[数据格式迁移指南](/zh/x-api/migrate/data-format-migration#migrating-from-standard-v1-1s-data-format-to-v2)，帮助你将标准 v1.1 字段映射到较新的 v2 字段。该指南还会为你提供在 v2 请求中需要传递的具体 expansion 和 field 参数，以便返回特定字段。 
 

除了你请求某些字段的方式发生变化之外，X API v2 也为 API 返回的对象引入了新的 JSON 设计，包括 Post 和 [user](/zh/x-api/fundamentals/data-dictionary#user) 对象。

* 在 JSON 根级别，标准 endpoint 在 statuses 数组中返回 Post 对象，而 X API v2 在 data 数组中返回。 
* X API v2 JSON 不再使用 Retweeted 和 Quoted “statuses” 的说法，而是使用 Retweeted 和 Quoted Tweets。许多传统和已弃用字段（例如 contributors 和 user.translator&#95;type）正在被移除。 
* X API v2 不再同时使用 favorites（Post 对象中的字段）和 favourites（user 对象中的字段），而是统一使用术语 like。 
* X 采用了一种约定：没有值的 JSON 值（例如 null）不会写入负载。Post 和 user 属性仅在其值非 null 时才会被包含。 
   

我们还在 [Post 对象](/zh/x-api/fundamentals/data-dictionary#tweet) 中引入了一组新字段，包括以下内容：

* 一个 [conversation&#95;id](/zh/x-api/fundamentals/conversation-id) 字段
* 两个新的 [annotations](/zh/x-api/fundamentals/post-annotations) 字段，包括 context 和 entities
* 若干新的 [metrics](/zh/x-api/fundamentals/metrics) 字段
* 一个新的 reply&#95;setting 字段，用于显示谁可以回复特定的帖子

**请求参数**

还有一组标准的过滤流请求参数在 X API v2 中**不**受支持：

| Standard v1.1 parameter | Details |
| :--- | :--- |
| locations - 由逗号分隔的经度、纬度对列表，用于指定一组边界框以按地理位置过滤帖子。 | 我们尚未为 X API v2 发布基于位置的运算符。 |
| Delimited | 在 v1.1 端点中，将其设置为字符串长度表示应在流中对状态进行分隔，这样客户端就知道在状态消息结束前需要读取多少字节。<br /><br />在 X API v2 中不提供此功能。 |
| Stall&#95;warnings | 在 v1.1 端点中，将此参数设置为 true 会在客户端有断开连接风险时周期性发送消息。<br /><br />在 X API v2 中，会默认发送停滞预警，并且会不时发送换行符。 |

**恢复和冗余功能的可用性**

X API v2 版本的过滤流引入了恢复和冗余功能，可帮助你最大化流式传输的在线时间，并在断连持续时间不超过五分钟的情况下恢复可能错过的帖子。

冗余连接允许你针对同一个流最多建立两个连接，这有助于确保你始终保持与流的连接，即使其中一个连接发生故障。

backfill&#95;minutes 参数可用于恢复最多五分钟的遗漏数据。

这两项功能都只能通过 [Academic Research access](/zh/x-api/getting-started/about-x-api) 使用。你可以在我们的 [recovery and redundancy features](/zh/x-api/posts/filtered-stream#filtered-stream-recovery-and-redundancy-features) 集成指南中进一步了解这些功能。

**新的查询运算符**

X API v2 为支持两项新功能引入了新的运算符：

* **[Conversation IDs](/zh/x-api/fundamentals/conversation-id)** - 随着会话在 X 上展开，会话 ID 将用于标记属于该会话的帖子。会话中的所有帖子其 conversation&#95;id 都会被设置为发起该会话的帖子 ID。
  * conversation&#95;id:
* **[X Annotations](/zh/x-api/fundamentals/post-annotations)** 为帖子提供上下文信息，包括实体（entity）和上下文（context）注释。Entities 由人物、地点、产品和组织组成。Contexts 是域或主题，被识别出来的实体属于这些域或主题。例如，帖子中提到的人物可能会有一个 context，指示他们是运动员、演员还是政治人物。
  * context: - 匹配带有感兴趣上下文标注的帖子。
  * entity: - 匹配带有感兴趣实体标注的帖子。 