---
title: v1 到 v2
sidebarTitle: v1 到 v2
keywords: ["v1.1 到 v2 的迁移", "filtered stream 迁移", "迁移 filtered stream", "standard 到 v2 filtered stream", "v1 到 v2 filtered stream", "迁移指南"]
---

<div id="standard-v11-compared-to-x-api-v2">
  ### 标准版 v1.1 与 X API v2 的比较
</div>

如果你一直在使用 v1.1 的 [statuses/filter](https://developer.x.com/en/docs/x-api/v1/tweets/filter-realtime/api-reference/post-statuses-filter) 端点，本指南可以帮助你了解标准版端点与 X API v2 过滤流端点之间的相似点和差异。

* **相似点**
  * 请求参数和运算符
  * 对帖子编辑历史和元数据的支持
* **差异**
  * 端点 URL
  * 对应用和项目的要求
  * 身份验证方式
  * 规则数量和持久化流
  * 响应数据格式
  * 请求参数
  * 恢复和冗余功能的可用性
  * 查询运算符

<div id="similarities">
  #### 相似之处
</div>

**请求参数和运算符**

标准 v1.1 `statuses/filter` 端点提供了一些参数，可以随请求一起传入以过滤流。在 v2 过滤流中，则需要使用一组[运算符](/zh/x-api/posts/filtered-stream#building-rules-for-filtered-stream)，并通过布尔逻辑将它们组合起来，以筛选出所需的帖子。可用的运算符中有一些是对现有标准 v1.1 参数的直接替代。 

以下标准 v1.1 请求参数在 X API v2 中具有等效的运算符：
 

| **Standard** | **X API v2** |
| :--- | :--- |
| follow - 以逗号分隔的用户 ID 列表，表示其帖子应在流中被投递的用户。 | 有多个运算符可以帮助你查找与特定用户相关的帖子：<br /><br />* @<br />* from:<br />* to:<br />* 等等 |
| track - 以逗号分隔的短语列表，用于确定哪些帖子会被投递到流中。 | 有多个运算符可以帮助你查找与特定关键词相关的帖子：<br /><br />* keyword<br />* &quot;精确短语匹配&quot;<br />* #<br />* 等等 |

**对帖子编辑历史和元数据的支持**

两个版本都提供了用于描述编辑历史的元数据。请参阅[过滤流 API 参考](/zh/x-api/posts/filtered-stream#api-reference-index)和[帖子编辑基础页面](/zh/x-api/fundamentals/edit-posts)以了解更多详情。 

<div id="differences">
  #### 差异
</div>

**Endpoint URL**

* 标准 v1.1 endpoint：
  * https://stream.x.com/1.1/statuses/filter.json
* X API v2 endpoint：
  * https://api.x.com/2/tweets/search/stream
  * https://api.x.com/2/tweets/search/stream/rule

**应用和项目要求**

在对请求进行认证时，X API v2 endpoint 要求你使用与某个 [developer App](/zh/resources/fundamentals/developer-apps) 关联、并隶属于某个 [Project](/zh/resources/fundamentals/projects) 的凭证。所有 X API v1.1 endpoint 都可以使用独立应用或与 Project 关联的应用的凭证。

**认证方式**

标准 endpoint 支持 [OAuth 1.0a User Context](/zh/resources/fundamentals/authentication)，而 X API v2 过滤流 endpoint 支持 [OAuth 2.0 App-Only](/zh/resources/fundamentals/authentication#oauth-2-0)（也称为 Application-only authentication）。要向 X API v2 版本发起请求，你必须使用 App Access Token 对请求进行认证。

如果你不再持有在开发者门户中创建 Project 和应用时提供给你的 App Access Token，可以通过前往开发者门户中应用的 “Keys and tokens” 页面生成一个新的。如果你希望以编程方式生成 App Access Token，请参阅此 [OAuth 2.0 App-Only 指南](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token)。 

**规则数量和持久流**

标准 v1.1 endpoint 仅支持使用单一规则来过滤流式连接。若要更改规则，你必须先断开该流，然后使用更新后的过滤规则作为参数提交新的请求。 

X API v2 过滤流 endpoint 允许你在单个流上应用多个规则，并在保持流连接的同时为你的流添加和移除规则。 

**响应数据格式**

标准 v1.1 与 X API v2 endpoint 版本之间最大的差异之一，是如何选择在负载中返回哪些字段。

对于标准 endpoint，你默认会收到许多响应字段，然后可以选择使用参数来指定应在负载中返回哪些字段或字段集合。

X API v2 版本默认仅返回帖子 id 和 text 字段。要请求任何额外字段或对象，你需要使用 [fields](/zh/x-api/fundamentals/fields) 和 [expansions](/zh/x-api/fundamentals/expansions) 参数。从这些 endpoint 请求的任何帖子字段都会返回在主 Post 对象中。任何扩展的用户、媒体、投票或地点对象及其字段会返回在响应中的 includes 对象里。随后，你可以通过匹配帖子和扩展对象中出现的 ID，将任何扩展对象匹配回 Post 对象。 

我们鼓励你在各自的指南中进一步了解这些新参数，或阅读我们关于 [如何使用 fields 和 expansions](/zh/x-api/fundamentals/data-dictionary#how-to-use-fields-and-expansions) 的指南。 

我们还整理了一个 [数据格式迁移指南](/zh/x-api/migrate/data-format-migration#migrating-from-standard-v1-1s-data-format-to-v2)，帮助你将标准 v1.1 字段映射到新的 v2 字段。该指南还会为你提供在 v2 请求中需要携带哪些 expansions 参数和 fields 参数，以返回特定字段。 
 

除了请求某些字段的方式发生变化之外，X API v2 还为 API 返回的对象引入了新的 JSON 设计，包括 Post 和 [user](/zh/x-api/fundamentals/data-dictionary#user) 对象。

* 在 JSON 根级别，标准 endpoint 在 statuses 数组中返回 Post 对象，而 X API v2 在 data 数组中返回 Post 对象。 
* X API v2 JSON 不再使用 Retweeted 和 Quoted “statuses” 的说法，而是改为使用 Retweeted 和 Quoted Tweets。许多旧版和已弃用字段（例如 contributors 和 user.translator&#95;type）正在被移除。 
* X API v2 不再同时使用 favorites（在 Post 对象中）和 favourites（在 user 对象中），而统一使用 like 这一术语。 
* X 采用的约定是，不会在负载中写入没有值的 JSON 值（例如 null）。仅当 Post 和 user 属性具有非 null 值时才会被包含。 
   

我们还为 [Post 对象](/zh/x-api/fundamentals/data-dictionary#tweet) 引入了一组新的字段，其中包括以下内容：

* 一个 [conversation&#95;id](/zh/x-api/fundamentals/conversation-id) 字段
* 两个新的 [annotations](/zh/x-api/fundamentals/post-annotations) 字段，包括 context 和 entities
* 若干新的 [metrics](/zh/x-api/fundamentals/metrics) 字段
* 一个新的 reply&#95;setting 字段，用于显示谁可以回复指定的帖子

**请求参数**

还有一组标准的过滤流请求参数在 X API v2 中**不**受支持：

| Standard v1.1 parameter | 详情 |
| :--- | :--- |
| locations - 以逗号分隔的 longitude,latitude 对列表，指定一组边界框，用于按地理范围过滤帖子。 | 我们尚未在 X API v2 中发布基于位置的运算符。 |
| Delimited | 在 v1.1 端点中，将其设置为字符串长度表示应在流中对状态消息进行分隔，以便客户端知道在状态消息结束前需要读取多少字节。<br /><br />此功能在 X API v2 中不可用。 |
| Stall&#95;warnings | 在 v1.1 端点中，将此参数设置为 true 会在客户端存在断开连接风险时定期发送消息。<br /><br />在 X API v2 中，停滞警告默认发送，并会定期通过换行符的方式发出。 |

**恢复和冗余功能的可用性**

X API v2 版本的过滤流引入了恢复和冗余功能，可帮助你最大化流式连接的正常运行时间，并在断开连接持续五分钟或更短时间的情况下恢复可能遗漏的帖子。

冗余连接允许你对给定的流建立最多两条连接，这可以帮助确保你始终至少保持一条与该流的连接，即便其中一条连接出现故障。

可以使用 backfill&#95;minutes 参数来恢复最多五分钟内遗漏的数据。

这些功能仅可通过 [Academic Research access](/zh/x-api/getting-started/about-x-api) 使用。你可以通过我们的 [recovery and redundancy features](/zh/x-api/posts/filtered-stream#filtered-stream-recovery-and-redundancy-features) 集成指南了解更多相关功能。

**新的查询运算符**

X API v2 引入了新的运算符，以支持两个新功能：

* **[Conversation IDs](/zh/x-api/fundamentals/conversation-id)** - 随着对话在 X 上展开，会提供一个 Conversation ID 来标记属于该对话的帖子。对话中的所有帖子的 conversation&#95;id 都会被设置为发起该对话的帖子的 id。
  * conversation&#95;id:
* **[X Annotations](/zh/x-api/fundamentals/post-annotations)** 为帖子提供上下文信息，包括 entity 和 context 注解。Entities 由人物、地点、产品和组织构成。Contexts 是领域或主题，即已识别实体所属的范畴。例如，帖子中提到的人可能具有一个 context，用于指示其是运动员、演员还是政治人物。
  * context: - 匹配已用某个感兴趣的 context 进行注解的帖子。
  * entity: - 匹配已用某个感兴趣的 entity 进行注解的帖子。 