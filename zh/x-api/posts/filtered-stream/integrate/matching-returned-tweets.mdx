---
title: 将帖子与规则进行匹配
sidebarTitle: 将帖子与规则进行匹配
keywords: ["匹配规则", "过滤规则", "规则匹配", "流规则", "过滤流规则", "规则标签"]
---

<div id="matching-returned-posts-to-their-associated-rule">
  ### 将返回的帖子与其关联的规则进行匹配
</div>

`filtered stream` 端点允许你在单个连接中使用多条规则。在开始通过流接收帖子之前，你需要先创建一条规则，用于指定你感兴趣的帖子类型。 

当你通过多种属性（包括用户属性、地理位置、语言等）来定义匹配帖子的规则时，你可以为该规则附加一个标签，以便在更高层级上对规则进行区分。标签是为规则提供上下文信息的一种好方式，尤其是在你设置了多条规则的情况下。过滤规则决定了哪些与帖子相关的活动会通过该连接发送给你。

如果你需要添加一条新的过滤规则来捕获不同类型的帖子，或者删除一条现有规则，你的应用可以向 [POST tweets/search/stream/rules](/zh/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules) 端点发送请求来完成操作。发送该请求后，过滤规则会自动更新，更改会直接在数据流中生效，无需重新建立连接。大多数新添加的规则会在大约 20 秒或更短时间内生效。虽然可能性不大，但取决于外部因素（例如网络连接状况），在你开始接收匹配帖子之前，可能需要更长时间。如果你在 `list rule` 端点的结果中找不到某条规则，请先确认创建该规则的请求是否成功；你可以通过检查日志中是否有错误消息来确认这一点。

<div id="matching-rules">
  #### 匹配规则
</div>

当某个活动通过你的 filtered stream 连接被投递时，在 matching&#95;rules 数组中会包含与所投递帖子匹配的过滤器列表。

在帖子负载中还有额外的字符串元数据，其中包含导致特定帖子被投递的规则 id 和标签。如果多个规则匹配同一个帖子，则该活动只会被投递一次，但元数据中会包含所有匹配的规则。匹配规则为你提供了一种简单方式，将特定帖子与特定规则关联起来，这在你拥有大量不同规则时尤其有用。由于数据是通过单一流以这种方式投递的，因此确保你使用唯一的 id 和标签对于匹配来说至关重要。 

**下面是“matching&#95;rules”数组在帖子负载中的示例：**

```"matching_rules": [
    {
      "id": "1166916266197536768",
      "tag": "test-rule-tag-00000"
    },
    {
      "id": "1166916266197536769",
      "tag": "test-rule-tag-12345"
    }
  ]
```

<div id="rule-tags">
  #### 规则标签
</div>

在创建时，每条过滤规则都可以带有一个标签。规则标签本身没有特殊含义，只是作为与规则一同携带的不透明字符串。它们会包含在返回的活动中的 `matching_rules` 元数据里，目的是在更高层级上帮助你更容易地区分各条规则。 

标签提供了一种便捷的方法来对过滤规则进行逻辑分组。比如，你可以为某条特定规则生成一个唯一 ID 作为其标签，并让你的应用在处理活动时引用该 ID，将结果与特定客户、广告活动、类别或其他相关分组关联起来。

请注意，现有规则的标签无法更新，只能在创建规则时一并添加。如果要“更新”或“重命名”标签，你需要先删除该规则，然后使用所需标签重新添加。最佳做法是直接使用唯一标识符作为标签，由你的系统将该标识符与应用中各种其他数据点关联，而无需更改规则集中的任何内容。

<div id="filtered-stream-recovery-and-redundancy-features">
  ### Filtered stream - 恢复和冗余功能
</div>

<Note>
  注意：仅具有 Enterprise 访问权限的用户可以使用这些恢复和冗余功能。
</Note>