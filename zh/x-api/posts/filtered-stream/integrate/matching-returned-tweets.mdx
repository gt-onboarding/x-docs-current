---
title: 帖子与规则的匹配
sidebarTitle: 帖子与规则的匹配
keywords: ["匹配规则", "过滤规则", "规则匹配", "流规则", "过滤流规则", "规则标签"]
---

<div id="matching-returned-posts-to-their-associated-rule">
  ### 将返回的帖子与其关联的规则进行匹配
</div>

filtered stream 端点允许你通过单个连接同时使用多个规则。在你开始在流中接收帖子之前，需要先创建一条规则，用于指定你感兴趣的帖子类型。 

当你基于多种属性（包括用户属性、地理位置、语言等）来指定用于匹配帖子的规则时，你可以为该规则附加一个标签（tag），以在更高层级区分这条规则。标签是为规则提供上下文的一个好方式，尤其是在你有大量规则时。过滤规则决定了哪些帖子相关活动会通过该连接发送。

如果你需要添加新的过滤规则来捕获不同类型的帖子，或移除现有规则，你的应用可以向 [POST tweets/search/stream/rules](/zh/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules) 端点发送请求来完成操作。当该请求发送后，过滤规则会自动更新，这些更改会直接在数据流中生效，而无需重新连接。大多数新增规则会在大约 20 秒或更短时间内生效。虽然这种情况不太常见，但受外部因素影响（例如网络连接），在你开始接收匹配帖子之前可能会花费更长时间。如果你在 list rule 端点中找不到某条规则，请确认规则创建请求是否已成功；你可以通过检查日志中的错误消息来进行核实。

<div id="matching-rules">
  #### 匹配规则
</div>

当某个活动通过你的 filtered stream 连接被投递时，在 matching&#95;rules 数组中会包含与已投递帖子匹配的过滤器列表。

在帖子有效负载（payload）中还有额外的字符串元数据，其中包括导致特定帖子被投递的规则 id 和标签。如果多个规则匹配同一个帖子，该活动只会被投递一次，但此元数据中会包含每条匹配的规则。匹配规则为将特定帖子与特定规则关联起来提供了一种简单的方法，这在你拥有许多不同规则时尤其有用。由于数据是通过单一流以这种方式投递的，因此确保 id 和标签具有唯一性对于匹配至关重要。

**下面是 “matching&#95;rules” 数组在帖子有效负载中出现方式的示例：**

```"matching_rules": [
    {
      "id": "1166916266197536768",
      "tag": "test-rule-tag-00000"
    },
    {
      "id": "1166916266197536769",
      "tag": "test-rule-tag-12345"
    }
  ]
```

<div id="rule-tags">
  #### 规则标签
</div>

在创建时，每条过滤规则都可以带有一个标签。规则标签本身没有特殊含义，它们只是作为不透明字符串与规则一起传递。它们会包含在返回活动数据中的 `matching_rules` 元数据里，目的是在更高层级上帮助你更容易地区分各条规则。 

标签为创建过滤规则的逻辑分组提供了一种简便方式。比如，你可以为某条特定规则生成一个唯一 ID 作为其标签，并让你的应用在处理活动时引用该 ID，以便将结果与特定客户、广告活动、类别或其他相关分组关联起来。

请注意，无法更新现有规则的标签，只能在创建规则时添加。若要“更新”或“重命名”标签，你需要先删除该规则，然后使用所需标签重新添加。最佳做法是直接使用一个唯一标识符作为标签，由你的系统将其与应用内部的各类其他数据点关联，这样就无需对规则集本身做任何修改。

<div id="filtered-stream-recovery-and-redundancy-features">
  ### 过滤流 - 恢复与冗余功能
</div>

<Note>
  注意：这些恢复和冗余功能仅向具备 Enterprise 访问权限的用户提供。
</Note>