---
title: 快速入门
sidebarTitle: 快速入门
keywords: ["过滤流快速入门", "流式传输快速入门", "过滤流教程", "流式传输指南", "流式传输示例"]
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-filtered-stream-endpoints">
  ## 开始使用过滤流端点
</div>

本快速入门指南将指导你使用 cURL 向过滤流端点组发出第一个请求。cURL 是一个命令行工具，可让你在几乎无需配置的情况下发出请求。

如果你想查看不同语言的示例代码，请访问我们的 [X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub 仓库。 

<Note>
  **前提条件**

  要完成本指南，你需要一组用于对请求进行身份验证的[密钥和令牌](/zh/resources/fundamentals/authentication)。你可以按照以下步骤生成这些密钥和令牌：

  * [注册开发者账号](https://developer.x.com/en/apply-for-access)并通过审核。
  * 在开发者门户中创建一个[项目](/zh/resources/fundamentals/projects)以及一个关联的[开发者应用](/zh/resources/fundamentals/developer-apps)。
  * 前往你的 App 的“Keys and tokens”页面以生成所需的凭证。请确保将所有凭证保存在安全的位置。
</Note>

<div id="steps-to-build-a-filtered-stream-request-using-curl">
  ### 使用 cURL 构建过滤流请求的步骤
</div>

**步骤一：创建规则**

规则由一个或多个不同的[运算符](/zh/x-api/posts/filtered-stream#building-rules-for-filtered-stream)组成，通过布尔逻辑和括号组合，用于定义哪些帖子会被发送到你的流中。在本指南中，我们将对流进行过滤，筛选出同时包含关键字“cat”和图片的帖子。我们的规则如下：

```cat has:images
```

**步骤二：为你的规则添加一个标签**

你可以为同一个流添加多条同时生效的规则。当你打开流式连接时，匹配到任一规则的帖子都会通过同一个流式连接传输。为确保你知道每条帖子分别匹配的是哪条规则，你可以在创建规则的请求中一并传入一个标签。每个匹配该规则的帖子随后都会在帖子负载中包含一个 `tag` 字段，用来标明它匹配到的规则。对于这条规则，我们将指定以下标签：

```cats with images
```

**步骤三：将规则添加到流中**

此端点要求你在请求中传入一个 `application/json` 类型的请求体，其中包含你的规则及其标签。你还会注意到，我们将规则的值和标签放在一个 `add` 对象中，因为我们要将这条规则添加到流中。这个 JSON 请求体如下所示：

```json
{
  "add": [
    {
      "value": "cat has:images",
      "tag": "带图片的猫"
    }
  ]
}
```

现在你已经完整配置好了这个 JSON 请求体，可以将其添加到一个 cURL 请求中，该请求如下所示。此请求目前还未准备就绪，请暂时不要提交，等到后续步骤再进行提交。

```json
curl -X POST 'https://api.x.com/2/tweets/search/stream/rules' \
-H "Content-type: application/json" \
-H "Authorization: Bearer $APP_ACCESS_TOKEN" -d \
'{
  "add": [
    {"value": "cat has:images", "tag": "cats with images"}
  ]
}'`
```

**步骤四：对请求进行身份验证**

由于 filtered stream 规则端点需要 [OAuth 2.0 应用仅模式身份验证](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token)，你需要将第三步 cURL 命令中的 $APP&#95;ACCESS&#95;TOKEN 替换为你在前提条件中生成的 [App Access Token](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)。 

**步骤五：将规则添加到流中**

下一步是执行你的 cURL 请求，这会把规则添加到你的流中。将该 cURL 命令复制并粘贴到命令行界面，然后按下 &quot;Enter&quot; 键。 

如果你的 cURL 请求成功，你将收到一个响应，其中包含关于你的 value、tag 和 id（作为你规则的唯一标识符）的数据。该响应看起来类似于下面这样：

```json
{
  "data": [
    {
      "value": "cat has:images",
      "tag": "带图片的猫咪",
      "id": "1273026480692322304"
    }
  ],
  "meta": {
    "sent": "2020-06-16T22:55:39.356Z",
    "summary": {
      "created": 1,
      "not_created": 0,
      "valid": 1,
      "invalid": 0
    }
  }
}
```

你可以通过向 rules 端点发送以下 GET 请求来确认你的规则是否已成功添加，并再次确保将 $APP&#95;ACCESS&#95;TOKEN 替换为你的令牌。该请求会返回已添加到你的流中的所有规则的完整列表。

```bash
curl -X GET 'https://api.x.com/2/tweets/search/stream/rules' \
-H "Authorization: Bearer $APP_ACCESS_TOKEN"
```

如果你的 cURL 请求成功，将会收到如下结果：

```json
{
	"data": [{
		"id": "1273028376882589696",
		"value": "cat has:images",
		"tag": "cats with images"
	}],
	"meta": {
		"sent": "2020-06-16T23:14:06.498Z"
	}
}
```

**第六步：确定并指定要检索的字段**

如果你在步骤五之后再连接到流，你将在响应中收到默认的 [Post 对象](/zh/x-api/fundamentals/data-dictionary#tweet)字段：id、text 和 edit&#95;history&#95;tweet&#95;ids。如果你希望接收这些之外的其他字段，则必须在请求中通过 [field](/zh/x-api/fundamentals/fields) 和/或 [expansion](/zh/x-api/fundamentals/expansions) 参数显式指定这些字段。

在本练习中，我们将从不同对象中请求三组字段：

1. 主 Post 对象中的额外 tweet.created&#95;at 字段。
2. 返回帖子对应作者的 [user 对象](/zh/x-api/fundamentals/data-dictionary#user) 的默认字段：id、name 和 username
3. 关联 user 对象中的额外 user.created&#95;at 字段。
    

要请求这些字段，你需要在请求中传入以下内容：

|              |                |                                                                 |
| :----------- | :------------- | :-------------------------------------------------------------- |
| 键            | 值              | 返回的字段                                                           |
| tweet.fields | created&#95;at | tweets.created&#95;at                                           |
| expansions   | author&#95;id  | includes.users.id, includes.users.name, includes.users.username |
| user.fields  | created&#95;at | includes.users.created&#95;at                                   |

现在你已经了解这些内容，可以把请求 URL 拼接出来以连接到流，请求看起来会像这样：

```bash
https://api.x.com/2/tweets/search/stream?tweet.fields=created_at&expansions=author_id&user.fields=created_at
```

**步骤七：连接到流并检查你的响应**

现在规则已经生效，而且你也指定了希望返回哪些字段，你就可以连接到流了。该流会返回与你提交的规则匹配的 Post 对象。将第六步中的 URL 加入到请求后，你的 cURL 命令将如下所示：

```bash
curl -X GET -H "Authorization: Bearer $APP_ACCESS_TOKEN" "https://api.x.com/2/tweets/search/stream?tweet.fields=created_at&expansions=author_id&user.fields=created_at"
```

同样，这个请求必须使用 OAuth 2.0 应用仅模式进行身份验证，因此在将其复制粘贴到命令行工具之前，请务必将 $APP&#95;ACCESS&#95;TOKEN 替换为你自己的凭证。

一旦你连接到 filtered stream，你就会开始按如下 JSON 格式接收符合你规则的帖子：

```json
{
  "data": [
    {
      "author_id": "2244994945",
      "created_at": "2022-09-14T19:00:55.000Z",
      "id": "1228393702244134912",
      "edit_history_tweet_ids": ["1228393702244134912"],
      "text": "开发者在情人节卡片上写了什么？\n  \nwhile(true) {\n    I = Love(You);  \n}"
    },
    {
      "author_id": "2244994945",
      "created_at": "2022-09-12T17:09:56.000Z",
      "id": "1227640996038684673",
       "edit_history_tweet_ids": ["1227640996038684673"],
      "text": "Doctors: Googling stuff online does not make you a doctor\n\nDevelopers: https://t.co/mrju5ypPkb"
    },
    {
      "author_id": "2244994945",
      "created_at": "2022-09-27T20:26:41.000Z",
      "id": "1199786642791452673",
      "edit_history_tweet_ids": ["1199786642791452673"],
      "text": "C#"
    }
  ],
  "includes": {
    "users": [
      {
        "created_at": "2013-12-14T04:35:55.000Z",
        "id": "2244994945",
        "name": "Twitter Dev",
        "username": "TwitterDev"
      }
    ]
  }
}
```

如果你想关闭连接，可以在 Mac 或 Windows 系统的命令行工具中按下 Control+C 来中断连接，或者直接关闭窗口。
