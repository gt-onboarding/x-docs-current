---
title: Decahose API
keywords: ["Decahose", "10% 流", "Decahose API", "Enterprise Decahose", "10% 抽样流", "Enterprise 流式传输"]
---

<Note>
  此端点已更新，现包含帖子编辑相关的元数据。您可以在[“编辑帖子”基础知识页面](/zh/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets)了解这些元数据的详细信息。
</Note>

<div id="decahose-stream">
  ### Decahose 流
</div>

[Enterprise](https://developer.x.com/en/products/x-api/enterprise)

*这是仅在我们托管访问级别内提供的 Enterprise API。要使用此 API，你必须先与我们的 Enterprise 销售团队联系并开通账号。[了解更多](https://developer.x.com/en/products/x-api/enterprise)*

Decahose 通过流式连接提供 X 实时 Firehose 中 10% 的随机样本。这是通过实时采样算法实现的，该算法对数据进行随机抽取，同时仍然能够在 X 通过 Firehose 发送数据时，以预期的低延迟方式传送数据。

以下是 Decahose 提供的一些功能：

* **扩展和增强的 URL：** - 完整展开短链接，并提供额外的元数据（页面标题和描述）
* **流分区** - 2 个分区，每个分区包含 Decahose 流量的 50%
* **增强的可靠性** - 后端系统具有地域多样性

注意：此数据以批量方式交付，不支持额外过滤（例如按关键词）。

`ENTERPRISE`

<div id="streaming-likes">
  ### 流式传输点赞
</div>

*这是仅在我们受管访问级别中提供的 Enterprise API。要使用此 API，你必须先通过我们的 Enterprise 销售团队开通账户。[了解更多](https://developer.x.com/en/products/x-api/enterprise)*

点赞可以帮助你了解是谁点赞了帖子，并提供精确的点赞计数。Gnip 的 Firehose 和 Decahose 可以传递与通过 Gnip 提供的帖子相关的公开点赞。这为某条帖子提供了与之相关的实时公开互动和受众指标。
 

**开始使用点赞**

在你准备使用点赞数据时，你需要了解以下内容：

* 点赞通过独立的单独数据流进行传递
* 点赞在过去被称为“Favorites（收藏）”。增强型原生格式负载保留了这一命名方式
* 数据流只包含公开的点赞
  * 公开意味着点赞用户、帖子创建者以及帖子本身在平台上都是公开的
* 点赞与转发非常相似，代表一种公开的互动信号
* 负载元素包括：
  * 原始帖子对象
  * 创建原始帖子的 Actor 对象
  * 执行点赞操作的 Actor 对象
* 只有原创内容可以被点赞
  * 转发不能被点赞。对转发的点赞会作用于原始帖子
  * 引用帖子（Quoted Tweets）&#95;可以&#95;被点赞
* 点赞活动包括适用的 Gnip Enrichments（在购买/应用的情况下）
* 支持的产品 / 功能
  * 点赞流支持 Backfill（在购买/应用的情况下）
  * 点赞流不支持 Replay
  * 点赞不支持搜索或历史功能
  * 目前暂无将点赞支持添加到 PowerTrack 的计划

**Decahose**

* 对于在 Decahose 中提供的 10% 抽样帖子，数据流会包含 100% 的适用公开点赞
* **分区：**2
* **URL 结构**
  * https://gnip-stream.x.com/stream/sample10-likes/accounts/&lt;accountName&gt;/publishers/twitter/&lt;streamLabel&gt;.json?partition=1

**原生富化格式负载**

```json
{
   "id":"43560406e0ad9f68374445f5f30c33fc",
   "created_at":"Thu Dec 01 22:27:39 +0000 2016",
   "timestamp_ms":1480631259353,
   "favorited_status":{
      "created_at":"Thu Dec 01 22:27:16 +0000 2016",
      "id":804451830033948672,
      "id_str":"804451830033948672",
      "text":"@kafammheppduman",
      "source":"\u003ca href=\"http:\/\/x.com\/download\/android\" rel=\"nofollow\"\u003eX Android 版\u003c\/a\u003e",
      "truncated":false,
      "in_reply_to_status_id":803694205163814912,
      "in_reply_to_status_id_str":"803694205163814912",
      "in_reply_to_user_id":2855759795,
      "in_reply_to_user_id_str":"2855759795",
      "in_reply_to_screen_name":"kafammheppduman",
      "user":{
         "id":2855759795,
         "id_str":"2855759795",
         "name":"delirdim kanka",
         "screen_name":"kafammheppduman",
         "location":"sanane",
         "url":"http:\/\/instagram.com\/kafammheppduman",
         "description":"Manit @GalatasaraySk \ud83d\udc9e",
         "translator_type":"none",
         "protected":false,
         "verified":false,
         "followers_count":3702,
         "friends_count":607,
         "listed_count":1,
         "favourites_count":113338,
         "statuses_count":389,
         "created_at":"Sat Nov 01 22:38:25 +0000 2014",
         "utc_offset":null,
         "time_zone":null,
         "geo_enabled":true,
         "lang":"tr",
         "contributors_enabled":false,
         "is_translator":false,
         "profile_background_color":"C0DEED",
         "profile_background_image_url":"",
         "profile_background_image_url_https":"",
         "profile_background_tile":false,
         "profile_link_color":"1DA1F2",
         "profile_sidebar_border_color":"C0DEED",
         "profile_sidebar_fill_color":"DDEEF6",
         "profile_text_color":"333333",
         "profile_use_background_image":true,
       "Profile_image_url": "http:\/\/pbs.twimg.com\/profile_images\/804421763945861121\/v3bp9pnq_normal.jpg",
         "Profile_image_url_https": "https:\/\/pbs.twimg.com\/profile_images\/804421763945861121\/v3bp9pnq_normal.jpg",
         "profile_banner_url":"https:\/\/pbs.twimg.com\/profile_banners\/2855759795\/1480630085",
         "default_profile":true,
         "default_profile_image":false,
         "following":null,
         "follow_request_sent":null,
         "notifications":null
      },
      "geo":null,
      "coordinates":null,
      "place":null,
      "contributors":null,
      "is_quote_status":false,
      "retweet_count":0,
      "favorite_count":0,
      "entities":{
         "hashtags":[],
         "urls":[],
         "user_mentions":[
            {
               "screen_name":"kafammheppduman",
               "name":"delirdim kanka",
               "id":2855759795,
               "id_str":"2855759795",
               "indices":[
                  0,
                  16
               ]
            }
         ],
         "symbols":[]
      },
      "favorited":false,
      "retweeted":false,
      "filter_level":"low",
      "lang":"und"
   },
   "user":{
      "id":774146932365070336,
      "id_str":"774146932365070336",
      "name":"Uyuyan Adam",
      "screen_name":"saykoMenn",
      "location":"Tarsus, T\u00fcrkiye",
      "url":"http:\/\/connected2.me\/pmc1i",
      "description":null,
      "translator_type":"none",
      "protected":false,
      "verified":false,
      "followers_count":414,
      "friends_count":393,
      "listed_count":0,
      "favourites_count":9868,
      "statuses_count":370,
      "created_at":"Fri Sep 09 07:26:26 +0000 2016",
      "utc_offset":null,
      "time_zone":null,
      "geo_enabled":false,
      "lang":"tr",
      "contributors_enabled":false,
      "is_translator":false,
      "profile_background_color":"F5F8FA",
      "profile_background_image_url":"",
      "profile_background_image_url_https":"",
      "profile_background_tile":false,
      "profile_link_color":"1DA1F2",
      "profile_sidebar_border_color":"C0DEED",
      "profile_sidebar_fill_color":"DDEEF6",
      "profile_text_color":"333333",
      "profile_use_background_image":true,
      "Profile_image_url": "http:\/\/pbs.twimg.com\/profile_images\/802992813424201728\/VMzcTL3x_normal.jpg",
      "Profile_image_url_https": "https:\/\/pbs.twimg.com\/profile_images\/802992813424201728\/VMzcTL3x_normal.jpg",
      "profile_banner_url":"https:\/\/pbs.twimg.com\/profile_banners\/774146932365070336\/1480283382",
      "default_profile":true,
      "default_profile_image":false,
      "following":null,
      "follow_request_sent":null,
      "notifications":null
   }
}
```

**取消点赞 / “Unlike” 请求负载**

```json
{
   "delete":{
      "favorite":{
         "tweet_id":696615514970279937,
         "tweet_id_str":"696615514970279937",
         "user_id":2510287578,
         "user_id_str":"2510287578"
      },
      "timestamp_ms":"1480437031205"
   }
}
```

<div id="guides">
  ## 指南
</div>

<div id="recovery-and-redundency">
  ### 恢复与冗余
</div>

**简介** 

在以流式方式传输大规模实时帖子时，会涉及一系列有助于同时提升数据可靠性和数据完整性、保真度的最佳实践。在消费实时数据时，尽可能延长连接时间是一个基本目标。当连接中断时，自动检测并重新连接非常重要。重新连接后，评估是否存在需要回填数据的时间段同样关键。管理这些细节并消费实时帖子的组件，只是整个系统中的一部分，该系统还要处理网络、数据存储、服务器和存储资源等方面的问题。鉴于这些系统的复杂性，另一个最佳实践是使用不同的流式环境，至少要为开发/测试和生产环境分别配置独立的流。

Decahose 提供了一组有助于实现这些目标的功能。

1. 为了支持多个环境，我们可以为你的账号部署[附加流](#AdditionalStreams)。这些流彼此独立，并使用不同的 `stream_label` 来帮助区分它们。
2. 为了帮助维持连接，每个 Decahose 流都支持[冗余连接](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#additional-streams)。最常见的架构是为一个流配置两个连接，在客户端则有两个相互独立的消费者——理想情况下位于不同的网络上。通过这种设计，可以在客户端网络、服务器和数据存储路径之间实现冗余。请注意，每个连接都会提供一份完整拷贝的数据，客户端必须能够容忍并管理重复数据。
3. 每 10 秒会提供一次“**心跳**”（heartbeat）；然而，对于 Decahose 流来说，数据量足够大，以至于即使是在很短的时间（例如几秒钟）内没有帖子，也可能表示存在连接问题。因此，“数据静默”（data silence）和缺少心跳这两种情况都可以用来检测断开。

由于断开连接在所难免，Decahose 流提供了专门的[恢复](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#overview)和[回填](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#backfill)功能，用于帮助恢复因断开连接及其他操作问题而错过的数据。

<div id="additional-streams">
  #### 附加流
</div>

配置额外的 Decahose 流是将可靠性构建到解决方案中的另一种方式。任何附加流彼此完全独立，并有其唯一的 endpoint。每个流都会分配自己的 stream&#95;label，该标签连同你的账户名称一起构成该流的 URL。请参见下面的示例：

https://gnip-stream.x.com/stream/sample10/accounts/:account&#95;name/publishers/twitter/:stream&#95;label.json

最常见的做法是：拥有一个专门供生产系统使用的实时流，以及一个可用于开发和测试的附加流。拥有一个测试/开发流可以让 Decahose 客户拥有一条专用流，用于测试客户端 consumer 的更新。虽然可以为流分配任何（唯一的）标签，但一种常见约定是对生产流使用 `prod`，对附加开发流使用 `dev` 或 `sandbox`。

流的数量及其唯一标签由你的账户代表进行配置。

**冗余连接**

冗余连接是指允许你与数据流建立多个同时连接。它通过允许你使用两个独立的 consumer 连接到同一个流，并通过两个连接接收相同的数据，从而提供冗余保障。因此，你的应用在各种情况下都具备热故障切换能力，例如其中一个流断开连接或你的应用主服务器发生故障。

任何特定流所允许的连接数量由你的账户代表进行配置。要使用冗余连接，只需连接到与你的主连接相同的 URL。你的流数据将通过这两个连接发送，并且两个流连接都会显示在流仪表板上。

请注意，出于计费目的，我们会对你通过多个连接收到的 activity 计数进行去重，这样你只会为每个唯一的 activity 支付一次费用。鉴于 Decahose 有两个分区，下面是连接计数如何工作的一个示例：

Connect to decahose partition=1\
Connect to decahose partition=1\
Connect to decahose partition=2

上述情况总共产生三个连接——两个连接到 partition=1，一个连接到 partition=2。通常，你会希望对每个分区有相同数量的连接，因此此示例突出的是一种情况：到 partition=2 的冗余连接已掉线，你需要进一步排查。

**恢复**

<div id="overview">
  #### 概览
</div>

Recovery 是一款数据恢复工具（不应用作主要数据采集方式），可提供对最近 5 天 X 历史数据的滚动窗口的流式访问。它应在以下场景下用于数据恢复：当你的消费端应用在实时流中遗漏数据时，无论是因为短时间断开连接，还是任何其他导致你在一段时间内无法摄取实时数据的情况。

<div id="using-recovery">
  #### 使用 Recovery
</div>

通过 Recovery 流，你的应用可以向其发出请求，其行为方式与对实时流的请求相同。不过，你的应用必须在 URL 中指定参数，用来表明你请求的时间窗口。换句话说，Recovery 请求是向 API 请求“从时间 A 到时间 B 的帖子”。这些帖子随后会通过你的流式连接传递，传递方式会模拟实时流，但速率会略慢于实时。参见下面的示例：

&quot;https://stream-data-api.x.com/stream/powertrack/accounts/someAccountName/publishers/twitter/powertrack.json?startTime=2023-07-05T17:09:12.070Z&quot;

帖子将从所指定时间段内的第一（最早）分钟开始投递，并按时间顺序持续投递，直到最后一分钟被投递完成。此时，一个 Recovery Request Completed 消息会通过连接发送，然后服务器会关闭该连接。如果你的请求从某个匹配结果很少甚至没有的时间点开始，那么在首次结果被投递之前，很可能会有一段时间没有数据——当 Recovery 在当时正在处理的归档数据中遇到匹配结果时，才会开始投递数据。当没有可投递的结果时，流会继续通过连接发送回车符（“心跳”），以防止你的连接超时。

Recovery 旨在作为一个用于轻松恢复因短暂断线而错过的数据的工具，而不是用于恢复像整天这样非常长时间段的数据。如果需要恢复较长时间段的数据，我们建议将较长请求拆分为更短的时间窗口（例如两小时），以减少由于网络不稳定或其他原因导致在请求中途断开连接的可能性，并为长请求的进度提供更好的可见性。

<div id="data-availability">
  #### 数据可用性
</div>

如果你无法在 5 分钟的回填窗口内重新建立连接，可以使用 Recovery 功能在过去 24 小时内恢复遗漏的数据。

流式恢复功能允许你将回填窗口延长至 24 小时。Recovery 使你能够“恢复”遗漏数据的这段时间区间。当你在连接请求中使用 `start_time` 和 `end_time` 请求参数时，会启动一个恢复流。连接建立后，Recovery 会重新推送指定时间段内的数据，然后断开连接。  

你可以同时向 Recovery 发起 2 个并发请求，即“两个恢复任务”。Recovery 在技术上与回填的工作方式相同，只是需要定义开始时间和结束时间。每次恢复对应一个单独的时间范围。

<div id="backfill">
  #### 回填（Backfill）
</div>

要请求回填，你需要在连接请求中添加一个 `backfillMinutes=N` 参数，其中 N 是在建立连接时要回填的分钟数（1–5，只能是整数）。例如，如果你断开了 90 秒，你应当在连接请求中添加 `backfillMinutes=2`。由于该请求会提供 2 分钟的回填，包括你断开前 30 秒的时间段，*你的 consumer 应用必须能够容忍重复数据*。

一个示例 Decahose 连接请求 URL，请求对分区 1 进行 5 分钟回填，如下所示：

https://gnip-stream.x.com/stream/sample10/accounts/:account&#95;name/publishers/twitter/:stream&#95;label.json?partition=1&amp;backfillMinutes=5

**注意：**

* 你可以选择在每次连接时都使用 `backfillMinutes=5`，然后处理可能提供的任何重复数据。

* 如果你的断开时间超过五分钟，你可以使用 Recovery 来恢复数据。

**从断开连接中恢复**

重新启动并从断开连接中恢复涉及多个步骤：

* 确定断开时间段的长度。
  * 5 分钟或更短？
    * 如果你已为流启用 Backfill，为连接请求准备合适的 `backfillMinutes` 参数。
  * 超过 5 分钟？
    * 如果你有 Recovery 流，为断开时间段发起 Recovery 请求（理想情况下使用你当前的实时规则集，必要时通过 Rules API 配置）。

* 请求一个新的连接。

当你遇到断开或停机时，可以使用以下策略来缓解并在这种场景下恢复：

1. **实施回填（Backfill）**\
   Backfill 允许你从断开之前的某个时间点重新连接到流，并覆盖最长 5 分钟的断开。通过在连接请求中包含一个参数来实现。

2. **从另一个位置消费冗余流**\
   如果可以将冗余流流式传输到同一个实时环境，并对数据进行去重，那么除非正常流和冗余流同时出现停机或断开，否则你将不再需要进行恢复。如果冗余流无法实时流入生产环境，则可以将其写入单独的“应急”数据存储。然后，在主流连接出现断开或停机时，你的系统将拥有可用的数据，用于填补主数据库在数据缺失时间段内的空白。

3. **实施 Recovery**\
   当断开或停机同时影响主流和冗余流时，使用 Decahose Recovery 恢复任何遗漏的数据。该 API 提供一个覆盖 5 天归档的滚动窗口，最理想的使用方式是在任一时刻请求不多于该窗口中的一小时数据，并将其流式导入。这是与实时流并行完成的。请注意，我们没有方案可以恢复 Recovery 所提供的 5 天窗口之外的 Decahose 数据，因此对于你而言，利用冗余流非常重要，以确保在你这边发生重大停机时，你这边仍然拥有完整的数据副本。

当你检测到存储数据量异常时——\
在没有发生任何断开或停机的情况下，可能检测缺失数据的方法包括……

1. 统计入站帖子（Posts）的数量\
   你的系统应当在数据摄取应用最开始的位置统计你接收到的原始帖子数量，然后提供一种方式，将这些数字与最终数据存储中到达的帖子数量进行比较。可以监控任何差异，并提醒你的团队注意导致数据在接收后被丢弃的问题。

2. 分析异常的存储量\
   你可能还希望分析最终数据库中存储数据的数量，以查找异常下降的情况。这同样可以表明存在问题，尽管在某些情况下，数量下降属于正常现象（例如，如果 X 平台不可用，在一段时间内人们无法创建帖子）。

<div id="api-reference">
  ## API 参考
</div>

<div id="decahose-stream">
  ### Decahose 流
</div>

跳转到本页章节

[方法](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#methods)

[身份验证](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#authentication)

[GET /&#123;stream-type&#125;/:stream](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#get-stream-type-stream)

[重放 API](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#replay-api)

<div id="methods">
  #### 方法
</div>

| 方法 | 描述 |
| :--- | :--- |
| [GET /&#123;stream-type&#125;/:stream](#Stream) | 连接到数据流 |

<div id="authentication">
  #### 身份验证[](#authentication- "Permalink to this headline")
</div>

对 Volume Stream API 的所有请求都必须使用 HTTP 基本身份验证，该验证由用于登录 console.gnip.com 账户的有效电子邮件地址和密码组合构成。凭据必须作为每个请求的 Authorization 请求头传递。因此，请确认你的客户端为所有 API 请求添加了 `"Authentication: Basic"` HTTP 请求头（通过 HTTPS 传输编码后的凭据）。

#### GET {stream-type}:stream

建立到 Firehose 流的持久连接，实时数据将通过该连接传输。

<div id="request-specifications">
  #### 请求规范
</div>

|     |     |
| :--- | :--- |
| **请求方法** | HTTP GET |
| **连接类型** | Keep-Alive  <br />  <br />应在请求头中进行指定。 |
| **URL** | 可在你的仪表板中该流的 API 帮助页面上找到，使用以下结构：  <br />  <br />Decahose:<br /><br />[https://gnip-stream.x.com/stream/sample10/accounts/:account&#95;name/publishers/twitter/:stream&#95;label.json?partition=1](https://gnip-stream.x.com/stream/sample10/accounts/:account_name/publishers/twitter/:stream_label.json?partition=1) |
| **分区（必填）** | `partition=\{#}` - 现在必须使用分区才能消费完整的数据流。你需要在连接到流时指定 partition 参数。下面是每个流的分区数量：<br /><br />* Decahose：2 个分区 |
| **压缩** | Gzip。要使用 Gzip 压缩连接到流，只需在连接请求中添加 Accept-Encoding 头。该头应如下所示：  <br />  <br />Accept-Encoding: gzip |
| **字符编码** | UTF-8 |
| **响应格式** | JSON。你的请求头应指定响应为 JSON 格式。 |
| **速率限制** | 每 60 秒 10 个请求。 |
| **回补参数** | 如果你购买的是启用回补（Backfill）的流，则需要在 GET 请求中添加 &quot;backfillMinutes&quot; 参数来启用它。 |
| **读取超时** | 在你的客户端上设置读取超时，并确保其值大于 30 秒。 |
| **对帖子编辑的支持** | 所有帖子对象都将包含描述其编辑历史的帖子编辑元数据。更多详情请参阅 [&quot;Edit Tweets&quot; 基础知识页面](/zh/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets)。 |

<div id="responses">
  #### 响应
</div>

对于这些请求，API 可能返回以下响应。大多数错误代码会在响应体中附带一个包含更多详细信息的字符串。对于非 200 响应，客户端应尝试重新连接。

| Status | Text | Description |
| :--- | :--- | :--- |
| 200 | Success | 连接已成功建立，新的活动会在到达时通过该连接发送。 |
| 401 | Unauthorized | 由于凭证无效导致 HTTP 身份验证失败。请使用你的凭证登录 console.gnip.com，以确保在请求中正确使用这些凭证。 |
| 406 | Not Acceptable | 通常发生在你的客户端未正确包含用于从流中接收 gzip 编码的请求头时，但在其他情况下也可能发生。  <br />  <br />响应体将包含类似于“此连接需要压缩。若要启用压缩，请在请求中添加一个 ‘Accept-Encoding: gzip’ 头，并在客户端读取流时准备好对其进行解压。”的 JSON 消息。 |
| 429 | Rate Limited | 你的应用已超出连接请求的限制。 |
| 503 | Service Unavailable | Twitter 服务器问题。请使用指数退避模式重新连接。如果在 [X API Status Page](https://api.twitterstat.us/) 上没有关于此问题的公告，并且在 10 分钟后仍无法连接，请联系支持团队或紧急支持渠道。 |

<div id="example-curl-request">
  #### 示例 curl 请求
</div>

以下示例请求是通过命令行使用 curl 发出的。不过请注意，这些请求也可以使用你选择的编程语言来发送：

```
curl --compressed -v -uexample@customer.com "https://gnip-stream.x.com/stream/firehose/accounts/:account\_name/publishers/twitter/:stream\_label.json?partition={#}"
```

<div id="replay-api">
  #### 回放 API
</div>

回放 API 是对实时 Volume 流的重要补充。回放是一种用于数据恢复的工具，可提供对最近一段时间 X 历史数据滚动窗口的流式访问。