---
title: 互动 API
keywords: ["互动 API", "Enterprise 互动 API", "互动指标", "互动数据", "Enterprise 互动", "GNIP 互动"]
---

<div id="overview">
  ## 概览
</div>

[`Enterprise`](https://developer.x.com/en/products/x-api/enterprise)

*这是仅在我们的托管访问级别中提供的 Enterprise 级别 API。要使用此 API，您必须先与我们的 Enterprise 销售团队开通账户。 [了解更多](/zh/x-api/enterprise-gnip-2.0/enterprise-gnip)*

Engagement API 提供对帖子曝光量和互动指标的访问。尽管大多数指标和端点要求您使用 [OAuth 1.0a 用户上下文](/zh/resources/fundamentals/authentication) 进行认证，但您也可以使用 [OAuth 2.0 Bearer Token](/zh/resources/fundamentals/authentication#oauth-2-0) 和 /totals 端点来访问公开的点赞（Favorite）、转发（Retweet）、回复（Reply）和视频播放量（Video Views）指标。  

**注意：**您可能会发现某些 X Web 仪表板上报告的数据显示，与 Engagement API 报告的数据存在差异。出现这些差异的原因在于，Web 仪表板通常只展示在所选时间范围内发生的互动和/或曝光。例如，Web 仪表板可能会展示在某个公历月内对帖子产生的互动，而 Engagement API 可能会展示超出该月范围但仍在所请求时间区间内的互动。在这类情况下，应以 Engagement API 作为权威的数据来源。
 

<div id="request-endpoints">
  ### 请求端点
</div>

Engagement API 有三个端点：

<div id="current-totals-totals">
  #### 当前总计：[/totals]
</div>

* 请求会返回目标帖子展示次数和互动次数的总计指标
* 仅支持以下指标：Impressions、Engagements、Favorites、Replies、Retweets、Quote Tweets 和 Video Views
* 支持使用 OAuth 1.0a 用户上下文，检索在**过去 90 天内**创建的帖子对应的 **Impressions** 和 **Engagements** 指标
* 支持使用 OAuth 2.0 Bearer Token，检索**任意帖子**对应的 **Favorites、Retweets、Quote Tweets、Replies** 和 **Video Views** 指标
* 结果基于发起请求时的展示次数和互动次数当前总计
* 非常适合用于构建仪表板报告，并用于计算多个 @handle 的互动率
* 每次请求最多可为 250 条帖子获取指标
   

<div id="last-28-hours-28hr">
  #### 最近 28 小时：[/28hr]
</div>

* 请求可以返回曝光次数的总量指标、互动次数的总量指标，以及最近 28 小时内各类单项互动指标的明细
* 数据可以按 Post ID 分组，也可以按时间序列进行汇总（按天或按小时）
* 非常适合跟踪最近创建内容的表现
* 支持所有可用指标
* 支持在单次请求中为最多 25 条帖子请求指标
   

<div id="historical-historical">
  #### 历史数据：[/historical]
</div>

* 请求可以返回最近一年的展示次数、互动量以及各单项互动指标的明细，这些均基于互动发生时间（而非帖子创建时间）。
* 请求支持开始日期和结束日期参数，可灵活缩小到最长为 4 周的特定时间段。
* 帖子互动数据仅能追溯到过去 365 天。
* 数据可以按帖子 ID 分组，也可以按时间序列聚合，按天或按小时分组。
* 非常适合将近期表现与历史基准进行评估，或构建某个 @账号 表现的历史画像。
* 支持所有可用指标。
* 每个请求最多可为 25 条帖子请求指标。

<div id="available-metrics">
  ### 可用指标
</div>

下表说明了可以通过 Engagement API 访问的指标类型。

请查看我们的[解读指标页面](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#interpreting-the-metrics)，以进一步了解以下这些指标。

| 指标                                                                                                                                                  | 适用端点              | 是否需要用户上下文信息                                            | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| :-------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------- | :----------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 展示次数                                                                                                                                                | 全部                | 需要                                                     | 帖子被查看的总次数。该指标仅适用于过去 90 天内发布的帖子。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 互动量                                                                                                                                                 | 全部                | 是                                                      | 用户与该帖子交互次数的计数。该指标仅适用于过去 90 天内发布的帖子。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 点赞次数                                                                                                                                                | 所有端点              | 是 - /28hrs 和 /Historical<br /><br />否 - /totals        | 帖子被点赞的次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 转发数                                                                                                                                                 | 全部端点              | 需要 - /28hrs &amp; /Historical<br /><br />不需要 - /totals | 帖子被转发的总次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| quote&#95;tweets                                                                                                                                    | /totals           | 否 - /totals                                            | 帖子被带评论转发（也称为「引用」）的次数计数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 回复数                                                                                                                                                 | 全部                | 是 - /28hrs &amp; /Historical<br /><br />否 - /totals    | 帖子被回复次数的计数值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| video&#95;views                                                                                                                                     | 全部                | 是 - /28hrs 和 /historical<br /><br />否 - /totals        | 统计给定帖子中某个视频在至少两秒时间内有 50% 画面处于可见状态的次数。<br /><br />视频观看次数指标仅适用于发布时间在 1800 天以内的帖子。如果你尝试为超过 1800 天的帖子请求视频观看次数，你将在响应中收到以下对象，同时还会有一个单独的对象包含你请求的其他指标：<br /><br />&quot;unsupported&#95;for&#95;video&#95;views&#95;tweet&#95;ids&quot;: [&quot;TWEET&#95;ID&quot;]<br /><br />**请注意：** 你在 X 自有并运营的平台（移动应用和网站）中看到的视频观看次数指标，可能会与你通过 /28hr 和 /historical 端点获得的数值不一致。<br /><br />*   X 用户界面以及 /totals 端点中显示的视频观看次数，是在所有发布了该视频的帖子中汇总后的总观看次数。这意味着，界面中显示的该指标包含了该视频在任何被转发或在不同帖子中再次发布的所有实例的合并观看次数。此指标不包括 GIF 动图的视频观看次数。<br />*   /28hr 和 /historical 端点提供的视频观看次数，仅包含由你拉取指标的那个特定帖子所产生的观看次数。此指标同样不包括 GIF 动图的视频观看次数。 |
| media&#95;views                                                                                                                                     | /28hr /historical | 是                                                      | 统计在视频、GIF 和图片中，您的媒体通过自动播放和点击产生的所有观看次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| media&#95;engagements<br /><br />([之前名为 Media Clicks](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#recent-changes-to-the-engagement-api)) | /28hr /historical | 是                                                      | 帖子中图片或视频等媒体被点击的总次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| url&#95;clicks                                                                                                                                      | /28hr /historical | 是                                                      | 帖子中的 URL 被点击的总次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| hashtag&#95;clicks                                                                                                                                  | /28hr /historical | 是                                                      | 统计帖子中话题标签被点击的次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| detail&#95;expands                                                                                                                                  | /28hr /historical | 是                                                      | 帖子为查看更多详情而被点击的次数计数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| permalink&#95;clicks                                                                                                                                | /28hr /historical | 是                                                      | 指向该帖子永久链接（专用于该帖子的独立网页）被点击的次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| app&#95;install&#95;attempts                                                                                                                        | /28hr /historical | 是                                                      | 从该帖子触发的应用安装事件次数                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| app&#95;opens                                                                                                                                       | /28hr /historical | 是                                                      | 统计由该帖子触发的 App 打开事件发生的次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| email&#95;tweet                                                                                                                                     | /28hr /historical | 需要                                                     | 统计帖子通过电子邮件被分享的次数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| user&#95;follows                                                                                                                                    | /28hr /historical | 需要                                                     | 从此帖子引发的对该用户（帖子作者）的关注次数计数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| user&#95;profile&#95;clicks                                                                                                                         | /28hr /historical | 是                                                      | 从此帖子发起的用户（帖子作者）个人资料被点击次数的计数。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

<div id="engagement-groupings">
  ### 互动分组
</div>

分组可以让你自定义组织返回的互动指标。每个请求最多可以包含 3 个分组。你可以按以下一个或多个值对指标进行分组：

*所有三个端点都支持：*

* tweet.id
* engagement.type
   

*`/28hr` 和 `/historical` 端点可以提供时间序列指标，因此支持：*

* engagement.day
* engagement.hour

若要进一步了解分组，请访问指南部分中的 [Engagement API Grouping](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#engagement-api-groupings) 页面。

<div id="guides">
  ## 指南
</div>

<div id="developer-getting-started-guide">
  ### 开发者快速入门指南
</div>

<div id="introduction">
  #### 简介
</div>

本指南旨在向开发者介绍如何集成 Engagement API。我们将先讨论为何要进行集成，然后再深入探讨技术层面的具体实现方式。

<div id="what-does-the-engagement-api-provide">
  ##### **Engagement API 提供了什么功能？**
</div>

* Engagement API 为任意 X 账号在过去 90 天内发布的自有帖子提供展示次数和互动数据，前提是该账号已授权你的应用，允许其使用 [3-legged OAuth](/zh/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) 代表该账号请求指标。这个功能强大且易于实现的解决方案，可立即获取展示次数以及更深层的互动数据，例如 URL 点击、#hashtag 点击等。
* Engagement API 为任意帖子提供点赞（favorites）、转发（Retweets）、引用帖子（Quote Tweets）、回复（replies）以及视频播放量（video views）等汇总总指标。这可以作为获取任意单条帖子或一组帖子基础互动数据的有力方式。
* Engagement API 通过允许客户利用 15+ 项性能指标有效衡量内容表现，从而评估其在 X 上的投资回报率（ROI），为社交聆听、营销和内容发布平台创造了新的价值。
* Engagement API 是一种请求/响应式 API，允许应用开发者发送包含 Post id、所需指标以及时间范围的请求，API 会立即返回相应数据。
   

<div id="why-integrate-example-use-cases">
  ##### **为什么要集成？示例用例**
</div>

* 了解你的内容的总体触达情况，看看有多少人查看。了解有多少人观看视频、点击链接、点击话题标签，或安装你的应用。
* 生成总量和时间序列两类参与度指标。
* 了解任何公开帖子的基础参与度指标（点赞、转发、引用帖子、回复）。
* 使用这些指标来判断哪些类型的帖子效果更好，从而可以更频繁地发布此类帖子，为你的内容带来更多曝光和参与。
* 将营销行为自动化（例如，每当你的某条帖子获得 100 个点赞或达到其他阈值时，自动转发来自另一个自有账号的内容）。
* 为不同活动建立基准并进行对比，用作 A/B 测试工具。
* 分析哪些类型的内容能更好地支持客服部门，以确定应如何以及何时进行回复。
* 展示从你的平台发布的内容的分析数据。
   

[Engagement API 于 2016 年推出](https://blog.x.com/official/en_us/a/2016/gnip-s-engagement-api-is-now-generally-available.html)，是首个在大规模上提供此类深度参与度指标的 X API。Engagement API 易于使用，并能够让客户实现流程自动化。下面是一篇案例研究，介绍了一个示例集成：

* [使用红十字会衡量活动成效](https://blog.x.com/developer/en_us/topics/spotlight/2016/measuring-campaign-success-with-the-red-cross.html)[](https://simplymeasured.com/blog/true-twitter-impressions-and-url-clicks-new-from-simply-measured/#sm.0007werel134td8zqf02m2mduumr6)

既然我们已经探讨了 Engagement API 的使用价值，下面开始深入了解其技术细节。

<div id="integrating-the-engagement-api">
  #### 集成参与度 API
</div>

<div id="introduction-to-api">
  ##### **API 简介**
</div>

Engagement API 是一个简单的 RESTful API，用于接收以 JSON 编码的请求，并返回以 JSON 编码的互动指标。请求由三个主要部分组成（参见链接获取更多文档）：

* ***Post IDs*** 数组。
* 指定感兴趣[指标类型](https://developer.x.com/en/docs/x-api/v1/metrics/get-tweet-engagement/overview#EngagementTypes)的数组。类型包括 “impressions”、“retweets”、“hashtag&#95;clicks” 和 “user&#95;follows” 等。
* [Engagement groupings](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#engagement-api-groupings)，这是一个 JSON 结构，用于指示你希望在 API 响应中如何组织互动数据。

在许多情况下，Engagement Types 和 Groupings 在不同请求之间会保持相对不变，只有 Post IDs 会被更新。

Engagement API 提供了[三个端点](https://developer.x.com/en/docs/x-api/v1/metrics/get-tweet-engagement/overview#RequestEndpoints)：

* **Totals** - 为帖子提供总体互动总数。一些指标适用于所有帖子，而另一些仅适用于过去 90 天内的帖子。
* **28 hour** - 提供最近 28 小时的时间序列互动指标。
* **Historical** - 为 2014 年 9 月 1 日之后发布的帖子提供最长连续四周的时间序列互动指标。

**/totals** 端点支持在一次请求中为最多 **250 个帖子** 请求指标。**/28hour** 和 **/historical** 端点支持每次请求最多 **25 个帖子**。

在介绍如何获取 Engagement API 的访问权限之后，我们将演示如何发起 API 请求，提供 OAuth 概览，并给出指向其他技术资源的链接。

<div id="getting-api-access">
  ##### **获取 API 访问权限**
</div>

如果你正在阅读本文档，很可能已经获得了 Engagement API 的访问权限。如果还没有，请联系你的 Enterprise 客户经理，或在[此处](/zh/x-api/enterprise-gnip-2.0/enterprise-gnip)申请 Enterprise 访问权限。

第一步是通过[开发者门户](/zh/resources/fundamentals/developer-portal)，使用已获批准的开发者账号创建一个 [X app](/zh/resources/fundamentals/developer-apps)。你的客户经理需要此应用关联的数值型 App ID 才能为你开通访问权限。如果你需要申请开发者账号，可以在[此处](/zh/resources/fundamentals/developer-apps)进行申请。

<div id="making-a-request">
  ##### **发起请求**
</div>

好消息是，向 Engagement API 发起请求非常简单。对于本次请求，我们将获取以下两条 [@XDevelopers](https://x.com/XDevelopers) 帖子的转发、引用转发、点赞和回复总数：

> 1/ 今天我们分享对 X API 平台未来的愿景！[https://t.co/XweGngmxlP](https://t.co/XweGngmxlP)
>
> — Twitter Dev (@TwitterDev) [2017 年 4 月 6 日](https://x.com/TwitterDev/status/850006245121695744)

> 不要错过那些关于你帖子的帖子。
>
> 现在在 iOS 上，你可以在一个地方看到所有带评论的转发。[pic.x.com/oanjZfzC6y](https://t.co/oanjZfzC6y)
>
> — X (@X) [2020 年 5 月 12 日](https://x.com/status/1260294888811347969?ref_src=twsrc%5Etfw)

![示例图片](https://t.co/oanjZfzC6y)

第一步是以 JSON 形式构造 API 请求，其中包括：包含这两个帖子 ID 的数组、一个包含你感兴趣的互动类型的数组，以及一个名为 &quot;groupings&quot; 的自定义 JSON 对象，用于指明我们希望在响应中如何排列这些指标。我们的请求如下所示：

```json
{
  "tweet_ids": [
    1260294888811347969, 850006245121695744
  ],
  "engagement_types": [
    "retweets", "quote_tweets", "favorites", "replies"
  ],
  "groupings": {
    "engagement-types-by-id": {
      "group_by": [
        "Tweet.id", "engagement.type"
      ]
    }
  }
}
```

要获取这些汇总指标，我们向 [https://data-api.x.com/insights/engagement/totals](https://data-api.x.com/insights/engagement/totals) 端点发送一个 JSON POST 请求。

我们将设置以下请求头，用于表明请求体是 JSON 编码的，并且经过 Gzip 压缩（因为请求体可能会很大）：

* Content-Type: application/json
* Accept-Encoding: gzip
   

发起请求时，我们使用 OAuth 进行认证，这部分内容将在下一节中进一步讨论。

API 会返回如下响应载荷：

```json
{
  "grouping name": {
    "1260294888811347969": {
      "favorites": "17111",
      "quote_tweets": "3254",
      "replies": "1828",
      "retweets": "5218"
    },
    "850006245121695744": {
      "favorites": "492",
      "quote_tweets": "66",
      "replies": "42",
      "retweets": "324"
    }
  }
}
```

请注意，响应中包含我们请求的指标，其结构符合“分组”定义：最外层先按帖子 ID 列出指标，下一层再按互动类型进行划分。

这很简单。如果你刚开始使用 OAuth 进行身份验证，请查看下一节内容。

<div id="authenticating-with-oauth">
  #### 使用 OAuth 进行认证
</div>

OAuth 是技术领域中广泛使用的一种认证标准。 如果你已经在使用 OAuth（例如与其他 X API 一起使用），那么很可能已经在使用某种特定语言的 OAuth 包，它会帮你屏蔽所有复杂细节。 如果你是 OAuth 新手，请访问我们的 [使用 X API 的 OAuth](/zh/resources/fundamentals/authentication) 页面，或者直接前往 [https://oauth.net](https://oauth.net/) 了解更多信息。 然后我们建议你为自己使用的集成编程语言找到一个合适的 OAuth 包，并从那里入手。 使用这些包进行认证的典型流程通常是：配置你的密钥和令牌，创建某种 HTTP 对象，然后使用该对象发起请求。

例如，在 Ruby 生态中，下面的伪代码展示了一个使用 Ruby gem &#39;oauth&#39; 构建支持 OAuth 的应用并发起 POST 请求的示例：

```js
require 'oauth'

#组装 JSON 请求(如上所示)。
request = make_json_request()

#使用我的应用消费者密钥和密钥构建应用消费者对象。
consumer = OAuth::Consumer.new(keys['consumer_key'], keys['consumer_secret'], {:site => ‘https://data-api.x.com’})
#使用授权账户提供的令牌构建用户令牌。如果发起仅限应用的请求(使用 /totals 端点检查无需权限的帖子),可以跳过此步骤。
token = {:oauth_token => keys['access_token'], :oauth_token_secret => keys['access_token_secret']}

#创建启用 OAuth 的应用对象。
app = OAuth::AccessToken.from_hash(consumer, token)
#发起 POST 请求。
result = app.post(“/insights/engagement/totals", request, {"content-type" => "application/json", "Accept-Encoding" => "gzip"})
```

Engagement API 支持仅应用（application-only）和用户上下文（user-context）两种身份验证方式。如果你使用 /totals 端点为非自有的公开帖子收集互动指标，则不需要用户授权，可以使用仅应用身份验证。在这种情况下，你只需使用应用的 key 和 secret 进行认证。

OAuth 也允许应用使用与用户关联的令牌，“代表其他用户”发起 API 请求。如果你要为自有帖子生成 Engagement 指标，即由你持有其用户令牌的用户所发布的帖子，那么你将以用户上下文发起请求，这意味着需要同时使用应用密钥和用户特定的访问令牌进行认证。这些用户访问令牌通常通过 “[Sign-in with X](/zh/resources/fundamentals/authentication#log-in-with-x)” 流程提供，或直接从用户处获取（请注意，如果你是直接从用户处获取令牌，则必须使用 [twurl](https://github.com/xdevplatform/xurl)）。一旦用户提供了他们的令牌，这些令牌不会过期，并且只要用户没有重置令牌或更改密码，你就可以使用 Engagement API 代表他们发起请求；如果用户重置了令牌或修改了密码，则需要他们再次向你提供新令牌。

你可以通过[此表格](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#engagement-api-groupings)查看每种指标所需的身份验证方式。

<div id="selecting-an-engagement-api-endpoint">
  ### 选择 Engagement API 端点
</div>

Engagement API 提供三个不同的端点：

* **[Totals](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement)** - 提供来自“自有（owned）”或“非自有（unowned）”帖子的一组选定指标的总体汇总值（grand totals）。部分指标对所有帖子都可用，而另一些仅对过去 90 天内发布的帖子可用。每个请求最多支持 250 条帖子。
* **[28 hour](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement)** - 为过去 28 小时内的“自有（owned）”帖子提供时间序列形式的 Engagement 指标。每个请求最多支持 25 条帖子。
* **[Historical](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement-historical)** - 为自 2014 年 9 月 1 日以来发布的“自有（owned）”帖子提供最长连续四周的时间序列 Engagement 指标。每个请求最多支持 25 条帖子。
   

每个端点都有其独特特性。无论你计划同时使用这三个端点，还是在尝试决定哪个最符合你的用例，理解它们之间的差异都非常重要。

下面我们将介绍一些关键概念，进一步探讨这三个端点，然后给出示例用例，这些用例大体对应于某一个特定端点。我们希望这些信息能帮助你更高效地集成这三个端点，或帮助你决定哪一个单一端点最契合你的目标。
 

<div id="key-concepts">
  #### 核心概念
</div>

有几个核心概念，有助于帮助你理解三个 Engagement API 端点各自的特性以及它们所提供的数据。
 

<div id="impressions-and-engagement-metrics">
  ##### 展现和互动指标
</div>

展现数表示某条帖子在 X 平台上以自然（非付费）场景下被查看的次数。在推广或付费场景中看到帖子所产生的展现数不包含在内。在 Engagement API 出现之前，帖子的展现数仅代表潜在浏览机会的一个度量。它是基于作者账号的关注者数量以及转发该内容的任何账号的关注者数量来计数的，而没有考虑到某个用户实际上可能并未看到该帖子的这一常见情况。

由 Engagement API 生成的展现指标是真实反映帖子被渲染并实际展示在用户屏幕上的次数。如果某个关注你账号的用户错过了你的帖子，则不会计为一次展现。

Engagement API 提供了 14 种不同的互动[指标类型](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#available-metrics)，每一种都代表用户在看到帖子时可以执行的一种不同操作。这些操作包括转发、点赞、回复、点击 #hashtags、链接和媒体等实体、关注作者以及查看作者的个人资料。所有这些单独的操作最终会汇总为一个 Engagements（互动）指标。

<div id="owned-and-unowned-x-content">
  ##### 自有和非自有 X 内容
</div>

Engagement 明确区分自有和非自有帖子。自有帖子是指由你的账号发布的帖子，或你已获得权限、可以请求其 Engagement 数据的帖子。与其他 X API 一样，你通过让其他 X 用户/账号授权你使用他们的访问令牌来获得权限，从而代表他们发起 API 请求。获取这些令牌的一种常见方式是使用 [“使用 X 登录”流程](/zh/resources/fundamentals/authentication#log-in-with-x)。

`/totals` 端点为自有和非自有帖子都提供互动数据。对于非自有帖子，你可以请求在帖子展示中公开可见的互动指标：Favorite、Retweet 和 Reply。对于这些指标，Engagement API 提供的价值在于，能够以自动化方式、大规模地获取这些指标。对于自有帖子，`/totals` 端点还会提供 Impression 和总体 Engagement 指标。

`/28hr` 和 `/historical` 端点只为自有帖子提供指标，这意味着你在向这些端点发起请求时必须传递用户上下文。

<div id="total-and-time-series-engagement-data">
  ##### 总量数据和时间序列互动数据
</div>

如其名称所示，`/totals` 端点仅提供各类互动的总量。其数值表示自帖子发布以来截至当前的累计总数。如果某个帖子刚刚发布，而你反复请求其指标，这些总量通常会在每次请求时发生变化。

`/28hr` 和 `/historical` 端点既可以提供总量数据，也可以提供时间序列数据。在请求时间序列数据时，互动指标可以聚合为按天或按小时的数据。  

有关如何使用 `/28hr` 和 `/historical` 端点请求时间序列数据的说明，请参阅我们关于[互动分组](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#engagement-api-groupings)的文档。

<div id="endpoints-and-example-use-cases">
  #### 端点和示例用例
</div>

考虑到前文讨论的各项特性和差异，每个独立端点通常对应不同类型的用例。为帮助你确定哪个端点最适合你的具体用例，下面列出了一些用户示例陈述，以及最能满足这些陈述的端点。

<div id="totals">
  ##### **/totals**
</div>

* 我只需要访问某些指标类型（Impressions、Engagements、Favorites、Retweets、Quote Tweets、Replies 和 Video Views）。
* 我需要获取任意帖子（不只是我拥有的帖子）的基础互动数据。
* 我想将表现与竞争对手进行对比。
* 我想跟踪某个话题标签（hashtag）或活动的基础互动统计数据，其中包含我不拥有的帖子。
* 我不需要按天或按小时拆分的数据，只需要在发起请求时获取当前总量。
* 我需要一个单一指标用于在报告或仪表盘中展示，并且不打算存储任何数据。
* 我想在页面加载时就展示数据，只需要发起一次请求并获得响应。
* 我需要每天获取数十万甚至数百万条帖子的相关数据。
   

<div id="28hr">
  ##### **/28hr**
</div>

* 我需要访问全部 17 种指标类型。
* 我想展示最近 28 小时内发布的帖子的数据。
* 我有一个每天运行一次的任务来获取我关心的数据，只需要获取最近一天的数据。
* 我需要按天或按小时细分的指标。
* 我想在仪表板中显示按小时划分的时间序列活动明细。
* 我每天需要对数十万条帖子进行高频访问。
* 我具备存储能力，可以每天刷新一次数据并持续累积统计。
   

<div id="historical">
  ##### **/historical**
</div>

* 我需要访问全部 17 种指标类型。
* 我需要获取最早可追溯到 2014 年 9 月创建的帖子历史数据。
* 我希望呈现对不同广告活动进行对比的详细历史分析。
* 我需要按天或按小时细分的指标。
* 我不需要对 Engagement API 的高访问级别，每天只需要为几百到几千条帖子获取数据。

<div id="engagement-api-key-characteristics">
  ### Engagement API 的关键特性
</div>

* **RESTful API**，提供 JSON 数据，支持带 JSON 请求体的 POST 请求。
* **请求类型：** 客户端应用可以发起以下类型的请求：
  * **总互动数（Total engagements）** -- 向 /totals endpoint 发起 HTTP POST 请求
  * **最近 28 小时互动数（Last 28-hour engagements）** -- 向 /28hr endpoint 发起 HTTP POST 请求
  * **历史互动数（Historical engagements）** -- 向 /historical endpoint 发起 HTTP POST 请求
* **OAuth 认证：**
  * [OAuth 1.0 用户上下文](/zh/resources/fundamentals/authentication)：对于已通过 [三方（3-legged）OAuth](https://developer.x.com/resources/fundamentals/authentication/obtaining-user-access-tokens) 授权你应用的用户所拥有的帖子，所有可用指标都可访问。在发起请求时，必须使用该用户的访问令牌。[](/zh/resources/fundamentals/authentication)
  * [OAuth 2.0 Bearer Token](/zh/resources/fundamentals/authentication#oauth-2-0)：特定指标（转发、引用转发、回复、点赞和视频播放量）对任意公开帖子均可用。 
* **请求元数据和结构：** 请求数据是一个 JSON 对象，由帖子 ID 数组、互动类型数组以及互动分组结构组成。
* **每个请求的帖子数量：**
  * /totals endpoint：250 个帖子 ID
  * /28hr endpoint：25 个帖子 ID
  * /historical endpoint：25 个帖子 ID
* **互动指标可用性：**
  * **/totals** -- 自帖子发布以来的指标总计。对于过去 90 天内发布的帖子，展示次数和互动次数可用；对于所有帖子，转发、引用转发、回复、点赞和视频播放量都可用。
  * **/28hr** -- 自请求时间起最近 28 小时的数据。
  * **/historical** -- 从 2014 年 9 月 1 日开始的任意 28 天时间段。
* **指标类型：** 每个请求都包含一个 [Metric Types](http://support.gnip.com/apis/engagement_api/overview.html#EngagementTypes) 数组。其可用性取决于所使用的 endpoint；如果是从 /totals endpoint 发起请求，还取决于帖子是否经过用户授权。
  * /totals endpoint：
    * 所有帖子：点赞、转发、引用转发、回复和视频播放量
    * 需要 OAuth 1.0a 用户上下文：展示次数、互动次数、点赞、回复和转发
  * /28hr 和 /historical endpoints（需要带帖子所有者访问令牌的 OAuth 1.0a 用户上下文）：展示次数、互动次数、点赞、回复、转发、链接点击、话题标签点击、详情点击、永久链接点击、媒体点击、应用安装尝试、应用打开、通过邮件分享帖子、视频播放量和媒体观看次数
* **互动分组：** 每个请求都包含一个 [Engagement Groupings](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#engagement-api-groupings) 数组。通过这些分组，你可以自定义返回指标的组织方式。每个请求最多可包含三个分组。指标可以按以下值进行组织：
  * 所有 endpoints：帖子 ID、互动类型
  * /28hr 和 /historical endpoints：如果指定以下附加分组，这些 endpoint 将提供时间序列数据：互动日期、互动小时
* **集成预期：** 你的团队将负责以下事项：
  * 创建并维护一个客户端应用，用于向 Engagement API 发送 HTTP 请求，并返回对请求中包含的帖子 ID 的互动指标。
* **限制**
* 视频播放量仅适用于距离当前时间不超过 1800 天的帖子。

<div id="authenticating-with-the-engagement-api">
  ### 使用 Engagement API 进行认证
</div>

> **请注意**： 
>
> 在你开始使用 API 之前，X 需要为你的开发者应用启用 Engagement API 访问权限。为此，请务必将你打算用于认证的应用 ID 提供给你的客户经理或技术支持团队。

Engagement API 支持两种认证方式：[OAuth 1.0a](/zh/resources/fundamentals/authentication#oauth-1-0a-2) 和 [OAuth 2.0 Bearer Token](/zh/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)。 

**OAuth 2.0 Bearer Token**（也称为“仅应用（application-only）”）允许你访问公开可用的互动指标。使用这种认证方式调用 [/totals 端点](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement-totals) 时，可以获取任何公开可见帖子中的收藏（又称点赞）、转发、引用帖子、回复以及视频观看次数的总计数。 

**OAuth 1.0a**（也称为“用户上下文”）允许你代表某个用户发起请求，并访问该用户的私有互动指标。 

以下场景需要使用这种认证方式：

* 所有发往 [/28hr 端点](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement-28hr) 和 [/historical 端点](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement-historical) 的请求
* 访问以下任一私有指标：展示次数（Impressions）、互动次数（Engagements）、媒体浏览量（Media Views）、媒体互动次数（Media Engagements）、URL 点击量、话题标签点击量、详情展开次数、固定链接点击量、应用安装尝试次数、应用打开次数、通过邮件分享帖子（Email Post）、用户关注、用户主页点击量

当使用 OAuth 1.0a 发送请求时，你需要包含拥有相关帖子或受保护资源的用户的访问令牌（Access Token 和 Secret）。如果在请求受保护的用户数据时未提供正确的用户访问令牌，Engagement API 将返回 `403 Forbidden` 错误。

即使你代表拥有这些帖子的用户进行认证，Engagement API 也不允许你获取[受保护的帖子](https://help.x.com/en/safety-and-security/public-and-protected-tweets)的互动数据。尝试这样做将返回 `400 Bad Request` 错误，并带有 `"Tweet ID(s) are unavailable"` 消息。

如果你是代表自己的 X 账号发送请求（换句话说，即拥有该开发者应用的账号），可以直接在 [开发者门户](https://developer.x.com/en/portal/projects-and-apps)中，在该开发者应用的“Keys and tokens（密钥和令牌）”选项卡下生成所需的访问令牌。

如果你是代表其他任何用户发起请求，则需要使用三方 OAuth 流程来获取所需的访问令牌。你可以在以下文档中找到关于如何执行此操作的更多信息：[OAuth 1.0a: how to obtain a user’s access tokens](/zh/resources/fundamentals/authentication#oauth-1-0a-2)。

如需更多示例，包括如何使用 OAuth 1.0a 进行认证，请参阅 [X Developers 提供的 Engagement API Python 示例代码](https://github.com/xdevplatform/enterprise-scripts-python/tree/master/Engagement-API)。

<div id="recent-changes-to-the-engagement-api">
  ### Engagement API 的最新变更
</div>

Engagement API 提供了非常有价值的曝光和互动指标，帮助你监测自己在 X 上活动的表现。为了持续支持基于我们数据做出营销决策，我们很高兴地分享 Engagement API 的近期更新，这些更新让整个 X 平台上的指标更加一致。  

我们最近对 Engagement API 进行了更新，使其采用与 X 分析仪表板（analytics.x.com）相同的指标聚合方法。在推出这些新指标时，我们尽量谨慎地减少会破坏现有集成的 API 变更，并于 2017 年 10 月 9 日部署了第一批更新。这些变更提升了你或你的客户在 X 上通过各个途径监测表现时的一致性。请参阅下方变更的详细说明：

|     |     |
| :--- | :--- |
| **Metric** | **Change** |
| engagements | 我们更新了汇总为整体 engagements 的各项指标，使其与 Post 分析仪表板保持一致。Engagements 衡量“人们与此 Post 互动的次数”。<br /><br />对于包含视频或 GIF 等媒体的帖子，engagements 指标将不再包含媒体观看次数。媒体观看次数现在可通过一个新的指标 *media&#95;views* 获取。 |
| media&#95;clicks* | 此指标已由一个名为“*media&#95;engagements*”的新指标取代。 |
| video&#95;views | 自 2018 年 7 月 6 日起，此指标可通过 [/totals](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement) 端点用于“非自有（unowned）”帖子。这意味着你可以使用仅应用身份验证来获取**所有**帖子的 video&#95;views。 <br /><br />你只能请求 1800 天以内的 video&#95;views。如果尝试请求超过 1800 天之前的帖子的视频观看次数，你会收到如下返回：<br /><br />&quot;unsupported&#95;for&#95;video&#95;views&#95;tweet&#95;ids&quot;: [&quot;TWEET&#95;ID&quot;]<br /><br />**请注意**，它与 media&#95;views 不同，因为 video&#95;views 依赖 MRC 标准，即至少有 50% 的视频在屏幕内、且观看时间至少为两秒。  <br /><br />**另外，**请注意，你在 X 自有平台（移动应用和网站）中看到的 video&#95;views 指标，可能与通过 /28hr 和 /historical 端点获取的数值不完全一致。<br /><br />* X 用户界面中显示并通过 /totals 端点提供的 video&#95;views，是在所有包含该视频的帖子中聚合后得到的总观看次数。这意味着 UI 中显示的指标包含了该视频在被转发或在不同帖子中再次发布时产生的所有观看次数。<br />* 通过 /28hr 和 /historical 端点提供的 video&#95;views 仅包含你获取指标时所针对的那个特定帖子所产生的观看次数。 |
| media&#95;views | 这包括你所有媒体的观看次数（自动播放和点击播放），涵盖视频、Vine、GIF 和图片。<br /><br />**请注意**，带有图片的帖子在分析仪表板中不会显示 media&#95;views 指标，但在 Engagement API 中仍会返回该指标。 |
| media&#95;engagements* | 这包括你的媒体在视频、Vine、GIF 和图片上的点击次数。此指标用于替代 *media&#95;clicks*。 |
| quote&#95;tweets | 自 2020 年 7 月 7 日起，此指标可通过 /totals 端点用于“非自有（unowned）”帖子。这意味着你可以使用仅应用身份验证来获取所有帖子的引用帖子数量。 |

<div id="interpreting-the-metrics">
  ### 解读指标
</div>

**注意：** 您可能会发现某些 X 网页仪表板上报告的数据与 Engagement API 中报告的数据之间存在差异。出现这些差异的原因在于，网页仪表板通常只展示在所选时间范围内发生的互动和/或展示次数（impressions）。例如，一个网页仪表板可能只展示某个日历月内针对帖子产生的互动，而 Engagement API 可能会展示超出该月份范围、但仍在您请求的时间区间内发生的互动。在这些情况下，应将 Engagement API 视为权威的数据来源。
 

<div id="impressions-and-engagement-data">
  #### 展示次数和互动数据
</div>

Engagement API 提供**自然**展示次数和互动数据。

展示次数表示在自然场景下，某条给定帖子在 X 平台上被查看的总次数。由在推广或付费场景中看到的帖子所产生的展示次数**不**包括在内。

互动表示在**自然**和**推广**场景下，某条给定帖子被观看者产生互动的总次数。互动包括但不限于转发、点赞、回复、URL 点击、话题标签（Hashtag）点击、提及点击以及媒体浏览。要查看所包含互动行为的完整列表，请参阅“互动数据”部分。 

要计算基准互动率，请在你所分析的时间范围内，将某条给定帖子的总互动次数除以其总展示次数。

展示次数和互动数据只能针对你自己拥有的 @handle 所发布的帖子，或已授权你的应用查看其帖子详细信息的 @handle 所发布的帖子进行获取。 在内部，Engagement API 会跟踪已根据合同约定的 @handle 配额发起请求的唯一 @handle 数量。 建议你也在客户端在整个月内跟踪 @handle 请求的使用情况。  

<div id="video-metrics">
  #### 视频指标
</div>

在 X 中，有几种不同的指标用于表示媒体的曝光。第一种是我们的视频观看量指标，它依赖 MRC 标准：至少有 50% 的视频画面在可视区域内，并持续两秒以上。第二种是 Media Views，它包括你的媒体在视频、Vine、GIF 动图和图片中的所有观看（自动播放和点击）的总和。

视频观看量指标可通过 /28hour 和 /historical 端点获取自有帖子（owned Posts）的数据，也可通过 /totals 端点获取所有非自有帖子（unowned Posts）的数据。 

尽管 X 用户界面中的视频观看量指标使用的是同一 MRC 标准，但请注意，你在 X 自有平台（移动应用和网站）上看到的视频观看量，与通过不同 Engagement API 端点获得的数值之间，可能会存在差异。

* /totals 端点提供的视频观看量以及 X 用户界面展示的视频观看量，会将给定视频在所有帖子中被发布的情况进行汇总展示。也就是说，通过 /totals 提供并在 X UI 中显示的该指标，包含任意实例中该视频被转发或在其他单独帖子中再次发布所产生的合并观看次数。
* /28hour 和 /historical Engagement API 端点提供的视频观看量，仅包含由你用于拉取指标的那个特定帖子所产生的观看。 
   

请注意，我们不会提供超过 1800 天之前的帖子的视频观看量。取而代之的是，我们会返回一个对象，其中列出超过 1800 天的帖子。你仍然会在另一个单独的对象中收到为你所请求帖子提供的所有其他指标。以下是一个响应示例：

```json
{
  "unsupported_for_video_views_tweet_ids": [
    "479311209565413376",
    "477139122520219648"
  ],
  "grouping name": {
    "479311209565413376": {
      "favorites": "69",
      "impressions": "1692",
      "retweets": "142",
      "video_views": "0"
    },
    "477139122520219648": {
      "favorites": "10",
      "impressions": "1023",
      "retweets": "6",
      "video_views": "0"
    },
    "1397568983931392004": {
      "favorites": "268",
      "impressions": "26803",
      "retweets": "56",
      "video_views": "17902"
    }
  }
}
```

Media Views 指标仅适用于通过 /28hour 和 /historical 端点查询的自有帖子。

<div id="engagement-api-groupings">
  ### Engagement API 分组
</div>

分组可以对返回的互动指标进行自定义归类。每个请求最多可包含 3 个分组。你可以根据以下一个或多个值对指标进行分组：

*所有三个端点均支持：*

* tweet.id
* engagement.type
   

*`/28hr` 和 `/historical` 端点可以提供时间序列指标，因此支持：*

* engagement.day
* engagement.hour

分组会按顺序依次应用，因此你可以通过调整 `group_by` 值的顺序来更改所需的结果格式。包含四个 `group_by` 值的分组仅支持以下两种格式之一：

```bash
"group_by": [
    "tweet.id",
    "engagement.type",
    "engagement.day",
    "engagement.hour"
  ]
```

或

```bash
"group_by": [
    "engagement.type",
    "tweet.id",
    "engagement.day",
    "engagement.hour"
]
```

例如，如果你想生成各类指标的汇总总计，请在请求中加入如下所示的 “groupings” 规范（关于如何构造请求的更多信息，请参阅 [API Reference](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#post-insights-engagement) 页面）：

```json
{
  "engagement_types": [
    "favorites",
    "replies",
    "retweets"
  ],
  "groupings": {
    "Grand Totals": {
      "group_by": [
        "engagement.type"
      ]
    }
  }
}
```

使用这种分组方式时，Engagement API 的 JSON 响应会包含一个根级 `"Grand Totals"` 属性，其中按指标类型给出总体汇总：

```json
{
  "Grand Totals": {
    "favorites": "12",
    "replies": "2",
    "retweets": "2"
  }
}
```

要为单个帖子生成按 Post id 分组的 4 小时时间序列指标，请求中应包含以下 Grouping 规范：

```json
{
  "start": "2016-02-10T17:00:00Z",
  "end": "2016-02-10T21:00:00Z",
  "tweet_ids": [
    "697506383516729344"
  ],
  "engagement_types": [
    "impressions",
    "engagements"
  ],
  "groupings": {
    "Tweets_MetricType_TimeSeries": {
      "group_by": [
        "tweet.id",
        "engagement.type",
        "engagement.hour"
      ]
    }
  }
}
```

使用此分组方式时，Engagement API 的 JSON 响应将在根级包含一个 `"Tweets_MetricType_TimeSeries"` 属性，其中包含按帖子 ID、再按指标类型细分的指标，以及对应的逐小时时间序列：

```json
{
  "Tweets_MetricType_TimeSeries": {
    "697506383516729344": {
      "impressions": {
        "2016-02-10": {
          "17": "551",
          "18": "412",
          "19": "371",
          "20": "280"
        }
      },
      "engagements": {
        "2016-02-10": {
          "17": "8",
          "18": "6",
          "19": "3",
          "20": "0"
        }
      }
    }
  }
}
```

<div id="frequently-asked-questions">
  ## 常见问题
</div>

`Enterprise`

<div id="engagement-api">
  ### Engagement API
</div>

<AccordionGroup>
  <Accordion title="如何访问 Engagement API？">
    对 Engagement API 的访问是通过 Enterprise 订阅提供的。请填写[此表单](/zh/x-api/enterprise-gnip-2.0/enterprise-gnip)以便与我们的销售团队取得联系。
  </Accordion>

  <Accordion title="我的使用情况是如何按“@handle”进行跟踪的？">
    如果你的合同对可与 Engagement API 搭配使用的唯一 handle 数量设有限制，内部的 X 系统会统计使用 Engagement API 查询的帖子所对应的、拥有这些帖子的已认证用户数量。客户也应在客户端自行跟踪这一唯一 @handle 数量。目前，没有可用于查看 Engagement API 的 @handle 用量的用量 API 或 UI。如果请求的 @handle 数量超过合同约定，系统不会阻止超额使用。在计费月末，查询到的唯一 @handle 数量会与合同约定的数量进行比较，超出部分将根据合同条款收取超额费用。
  </Accordion>

  <Accordion title="我可以查看 Engagement API 的 @handle 使用情况吗？">
    目前，没有可用于查看 Engagement API 的 @handle 用量的用量 API 或 UI。如果请求的 @handle 数量超过合同约定，系统不会阻止超额使用。在计费月末，查询到的唯一 @handle 数量会与合同约定的数量进行比较，超出部分将根据合同条款收取超额费用。

    **返回负载中的 `engagements` 元数据字段不等于各种互动指标总数之和。为什么会这样？**

    这是预期行为。`engagements` 元数据字段可能并不总是与 API 返回的各个互动指标之和一一对应。这是因为 `engagements` 元数据字段可能包含一些在负载中没有以特定指标单独列出的额外互动。换句话说，将所有各种互动指标总数相加，可能不会等于负载中返回给你的 `engagements` 指标字段中的数值。

    你可以将 `engagements` 元数据字段理解为对该帖子进行的任何点击或交互。
     

    **当帖子实际上没有 URL 时，负载响应中的 `url_clicks` 字段仍返回了一个数字。这怎么可能？**

    这可能是因为帖子中包含类似主题标签（hashtag）之类的内容（会创建到其他页面的链接），当用户点击这些内容时，会被计为一次 URL 点击。
     
  </Accordion>

  <Accordion title="为什么我无法获取某条特定帖子的互动数据？">
    你可能无法获取某条特定帖子的互动数据，原因包括但不限于：

    * 你请求的帖子 ID 在你使用的认证 token 下不可用，该 token 是用于代表第三方检索数据的。
    * 你在 /totals endpoint 上请求的帖子 ID 不在 90 天以内，因此无法返回展示量或互动指标。
    * 你请求的帖子 ID 不再可用，通常表示这些帖子已被删除，或因其他原因不再公开可见。

    请查看在上述任一情况下你可能会收到的不同[错误消息](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#error-messages)。
  </Accordion>

  <Accordion title="如何在使用 Engagement API 时处理速率限制？">
    你可以在向 Engagement API 发起请求时，使用响应头中返回的 `x-per-minute-limit` 和 `x-per-minute-remaining` 信息来监控你的使用量。

    `x-per-minute-limit` 告诉你允许的配额，而 `x-per-minute-remaining` 告诉你剩余的调用次数。
  </Accordion>
</AccordionGroup>

<div id="error-troubleshooting-guide">
  ### 错误排查指南
</div>

<AccordionGroup>
  <Accordion title="我在进行身份验证时遇到问题">
    请务必查看我们关于 Engagement API 身份验证的[指南](/zh/x-api/enterprise-gnip-2.0/fundamentals/engagement-api#authentication)。
  </Accordion>

  <Accordion title="我已经传入了正确的 consumer key 和 secret，以及 access token 和 access token secret，但仍然返回如下错误。我该怎么办？">
    ```bash
    [
        Your account could not be authenticated. Reason: Unknown Authorization Type;
    ]
    ```

    请确保在尝试与 /totals 端点进行身份验证时不要使用任何访问令牌或 secret。因为如果你确实包含了这些令牌，但尝试拉取与这些令牌无关联的帖子内容，就很可能会收到类似如下的错误：

    ```bash
    [
        Forbidden to access tweets: 1054424731825229824;
    ]
    ```
  </Accordion>
</AccordionGroup>

<div id="still-cant-find-what-youre-looking-for">
  ### 还是没找到你需要的内容？
</div>

<AccordionGroup>
  <Accordion title="我有一个尚未得到解答的问题">
    请联系技术支持团队，我们会尽快回复你。
  </Accordion>
</AccordionGroup>

<div id="api-reference">
  ## API 参考
</div>

<div id="post-insightsengagement">
  ### **POST insights/engagement**
</div>

<div id="methods">
  #### **方法**
</div>

| 方法 | 说明 |
| :--- | :--- |
| [POST /insights/engagement/totals](#Totals) | 获取一组帖子对应的总曝光量和互动量。 |
| [POST /insights/engagement/historical](#Historical) | 获取一组帖子在最长 4 周时间范围内（可回溯至 2014 年 9 月 1 日）的曝光量和互动量。 |
| [POST /insights/engagement/28hr](#api-28hr) | 获取一组帖子在过去 28 小时内的曝光量和互动量。 |

<div id="authentication">
  #### **认证**
</div>

Engagement API 要求使用 HTTPS，并同时支持 User Context 和 Application-Only OAuth。对 Engagement API 的大多数请求都需要使用 3-Legged OAuth（User Context 的一种特定形式），这意味着你需要使用已由你的 Twitter 客户经理注册并批准用于访问 Engagement API 的应用的 consumer key 和 consumer secret，以及帖子所有者的 access token 和 access token secret 来调用该端点。以下请求需要这种类型的 OAuth：

* 对 /totals 的任何请求，以获取 Impressions 和 Engagements 指标类型（这些指标仅限于已拥有的帖子）
* 对 /28hr 的任何请求
* 对 /historical 的任何请求

对 Engagement API 的某些请求可以使用 Application-Only OAuth，这意味着你只需要提供 consumer key 和 consumer secret，或一个 Bearer Token。以下请求可以使用这种类型的 OAuth 执行：

* 对 /totals 的任何请求，以获取 Favorites、Replies、Retweets 或 Video Views 指标类型，这些指标可以针对任何帖子获取

对于任何请求，你都需要在 [developer.x.com](https://developer.x.com/en/portal/dashboard) 上通过应用管理控制台创建一个 Twitter 应用以及相应的 API key。

请注意——如果你已在 developer.x.com 上登录你的 Twitter 账号，你可以通过 [Twitter 应用控制面板](https://developer.x.com/en/apps) 查看和编辑现有的 [Twitter 应用](/zh/resources/fundamentals/developer-apps)。

完成应用设置后，你的应用 ID 需要由你的客户代表批准，你的应用才能向 Engagement API 发起请求。访问令牌必须用于表示“当前用户”，代表其他用户发起的请求必须使用有效的令牌进行签名。请确保在构建 OAuth 签名基础字符串之前，在 URL 和 POST 请求体中适当[对保留字符进行编码](https://tools.ietf.org/html/rfc3986)。

有关如何开始使用 OAuth 的更多信息，请访问以下链接：

* [OAuth 概览](/zh/resources/fundamentals/authentication)
* [使用 3-Legged OAuth（也称为 User Context）](/zh/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)
* [使用 Application-Only OAuth](/zh/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)

<div id="post-insightsengagementtotals">
  #### **POST /insights/engagement/totals**
</div>

`totals` 端点可用于一次性获取最多 250 条帖子集合当前的总展示次数和互动量。

|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| :-------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **请求方法**        | HTTP POST                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **URL**         | `https://data-api.x.com/insights/engagement/totals`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **内容类型**        | `application/json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **压缩方式**        | Gzip。要使用 Gzip 压缩发起请求，请在连接请求中包含 Accept-Encoding 请求头。  <br />该请求头应如下所示：  <br />  <br />`Accept-Encoding: gzip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **POST 请求格式**   | 你可以通过 POST 请求发送数据，请求体为一个 JSON 对象，其中包含一组帖子 ID 和所需的分组方式。该 POST 请求的格式为一个数组，其中包含 `tweets`、`engagements` 和 `groupings` 对象。每个请求最多可以包含 250 个帖子 ID。  <br />  <br />一个示例 POST 请求体如下：  <br />  <br /><br />  &#123;<br />    &quot;tweet&#95;ids&quot;: [<br />        &quot;Tweet ID 1&quot;,<br />        &quot;Tweet ID 2&quot;,<br />        &quot;Tweet ID 3&quot;<br />    ],<br />      &quot;engagement&#95;types&quot;: [<br />        &quot;impressions&quot;,<br />        &quot;engagements&quot;,<br />        &quot;favorites&quot;,<br />        &quot;quote&#95;tweets&quot;<br />    ],<br />    &quot;groupings&quot;: &#123;<br />      &quot;grouping name&quot;: &#123;<br />        &quot;group&#95;by&quot;: [<br />          &quot;tweet.id&quot;,<br />          &quot;engagement.type&quot;<br />        ]<br />      &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **帖子 ID**       | 一个数组，其中包含要查询互动数据的帖子的 Tweet ID。请注意，您只能请求由用于身份验证的 @handle 创建的帖子的相关数据。每个请求最多可包含 250 条帖子，并且 Tweet ID 必须以字符串形式表示。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **互动指标类型**      | 一个数组，其中包含要查询的互动指标类型。Totals 端点仅支持以下互动类型：`impressions`、`engagements`、`favorites`、`retweets`、`quote_tweets`、`replies`、`video_views`。  <br />`/totals` 端点支持获取在过去 90 天内创建的帖子对应的 `impressions` 和 `engagements`，以及任意帖子对应的 `favorites`、`retweets`、`quote_tweets`、`replies` 和 `video_views`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **分组方式**        | 可以根据你的需求，将 Engagement API 的结果按不同的分组方式返回。每个请求最多可包含 3 个分组。  <br />  <br />对于每个分组，你可以自定义一个分组名称，以便在你的应用中更容易引用这一分组类型。  <br />  <br />定义好分组名称后，你可以选择按 `tweet.id` 和/或 `engagement.type` 进行分组。  <br />  <br />分组会按顺序依次生效，因此你可以通过更改 group&#95;by 值的顺序来改变返回结果的格式。下面是一个示例分组，会将指标按帖子 ID 和指标类型分别展示：  <br />  <br /><br />  &quot;groupings&quot;: &#123;<br />      &quot;my grouping name&quot;: &#123;<br />        &quot;group&#95;by&quot;: [<br />          &quot;tweet.id&quot;,<br />          &quot;engagement.type&quot;<br />        ]<br />      &#125;<br />    &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **POST 请求规模限制** | 每次请求最多可提交 250 个帖子 ID。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **响应格式**        | JSON。您应在请求头中将响应格式指定为 JSON。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **速率限制**        | 系统将按分钟对您的请求进行限流，具体额度将根据您的访问级别，以合同中的约定为准。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **示例请求（公开指标）**  | curl --request POST <br />  --url [https://data-api.x.com/insights/engagement/totals](https://data-api.x.com/insights/engagement/totals) <br />  --header &#39;accept-encoding: gzip&#39; <br />  --header &#39;authorization: Bearer &#39; <br />  --header &#39;content-type: application/json&#39; <br />  --data &#39;&#123;<br />                &quot;tweet&#95;ids&quot;: [<br />                    &quot;1070059276213702656&quot;,&quot;1021817816134156288&quot;,&quot;1067094924124872705&quot;<br />                ],<br />                &quot;engagement&#95;types&quot;: [<br />                    &quot;favorites&quot;,&quot;retweets&quot;,&quot;replies&quot;,&quot;quote&#95;tweets&quot;,&quot;video&#95;views&quot;<br />                ],<br />                &quot;groupings&quot;: &#123;<br />                    &quot;perTweetMetricsUnowned&quot;: &#123;<br />                        &quot;group&#95;by&quot;: [<br />                            &quot;tweet.id&quot;,<br />                            &quot;engagement.type&quot;<br />                        ]<br />                    &#125;<br />                &#125;<br />            &#125; <br />  --verbose <br />  --compressed                                                                                                                                                                                                                                                                                                                                                       |
| **示例请求**        | curl --request POST <br />  --url [https://data-api.x.com/insights/engagement/totals](https://data-api.x.com/insights/engagement/totals) <br />  --header &#39;accept-encoding: gzip&#39; <br />  --header &#39;authorization: OAuth oauth&#95;consumer&#95;key=&quot;consumer-key-for-app&quot;,oauth&#95;nonce=&quot;generated-nonce&quot;,oauth&#95;signature=&quot;generated-signature&quot;,oauth&#95;signature&#95;method=&quot;HMAC-SHA1&quot;, oauth&#95;timestamp=&quot;generated-timestamp&quot;,oauth&#95;token=&quot;access-token-for-authed-user&quot;, oauth&#95;version=&quot;1.0&quot;&#39; <br />  --header &#39;content-type: application/json&#39; <br />  --data &#39;&#123;<br />                &quot;tweet&#95;ids&quot;: [<br />                    &quot;1060976163948904448&quot;,&quot;1045709644067471360&quot;<br />                ],<br />                &quot;engagement&#95;types&quot;: [<br />                    &quot;favorites&quot;,&quot;replies&quot;,&quot;retweets&quot;,&quot;video&#95;views&quot;,&quot;impressions&quot;,&quot;engagements&quot;<br />                ],<br />                &quot;groupings&quot;: &#123;<br />                    &quot;perTweetMetricsOwned&quot;: &#123;<br />                        &quot;group&#95;by&quot;: [<br />                            &quot;tweet.id&quot;,<br />                            &quot;engagement.type&quot;<br />                        ]<br />                    &#125;<br />                &#125;<br />            &#125;&#39; <br />  --verbose <br />  --compressed |
| **示例响应（公开指标）**  | &#123;<br />  &quot;perTweetMetricsUnowned&quot;: &#123;<br />    &quot;1021817816134156288&quot;: &#123;<br />      &quot;favorites&quot;: &quot;530&quot;,<br />      &quot;quote&#95;tweets&quot;: &quot;79&quot;,<br />      &quot;replies&quot;: &quot;147&quot;,<br />      &quot;retweets&quot;: &quot;323&quot;,<br />      &quot;video&#95;views&quot;: &quot;0&quot;<br />    &#125;,<br />    &quot;1067094924124872705&quot;: &#123;<br />      &quot;favorites&quot;: &quot;1360&quot;,<br />      &quot;quote&#95;tweets&quot;: &quot;29&quot;,<br />      &quot;replies&quot;: &quot;56&quot;,<br />      &quot;retweets&quot;: &quot;178&quot;,<br />      &quot;video&#95;views&quot;: &quot;5754512&quot;<br />    &#125;,<br />    &quot;1070059276213702656&quot;: &#123;<br />      &quot;favorites&quot;: &quot;69&quot;,<br />      &quot;quote&#95;tweets&quot;: &quot;5&quot;,<br />      &quot;replies&quot;: &quot;7&quot;,<br />      &quot;retweets&quot;: &quot;26&quot;,<br />      &quot;video&#95;views&quot;: &quot;0&quot;<br />    &#125;<br />  &#125;<br />&#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **示例响应**        | &#123;<br />  &quot;perTweetMetricsOwned&quot;: &#123;<br />    &quot;1045709644067471360&quot;: &#123;<br />      &quot;engagements&quot;: &quot;2&quot;,<br />      &quot;favorites&quot;: &quot;0&quot;,<br />      &quot;impressions&quot;: &quot;47&quot;,<br />      &quot;replies&quot;: &quot;0&quot;,<br />      &quot;retweets&quot;: &quot;8&quot;,<br />      &quot;quote&#95;tweets&quot;: &quot;5&quot;,<br />      &quot;video&#95;views&quot;: &quot;0&quot;<br />    &#125;,<br />    &quot;1060976163948904448&quot;: &#123;<br />      &quot;engagements&quot;: &quot;4&quot;,<br />      &quot;favorites&quot;: &quot;0&quot;,<br />      &quot;impressions&quot;: &quot;148&quot;,<br />      &quot;replies&quot;: &quot;1&quot;,<br />      &quot;retweets&quot;: &quot;9&quot;,<br />      &quot;quote&#95;tweets&quot;: &quot;2&quot;,<br />      &quot;video&#95;views&quot;: &quot;0&quot;<br />    &#125;<br />  &#125;<br />&#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **不可用的帖子 ID**   | 对于包含已变为不可用（例如已被删除）的帖子 ID 的查询，所有可用的帖子 ID 都会返回相应的数据，而不可用的帖子 ID 会在名为 `unavailable_tweet_ids` 的数组中列出。示例：  <br /><br />  &#123;<br />    &quot;start&quot;: &quot;2015-11-17T22:00:00Z&quot;,<br />    &quot;end&quot;: &quot;2015-11-19T02:00:00Z&quot;,<br />    &quot;unavailable&#95;tweet&#95;ids&quot;: [<br />        &quot;323456789&quot;<br />    ],<br />    &quot;group1&quot;: &#123;<br />     &quot;423456789&quot;: &#123;<br />      &quot;favorites&quot;: &quot;67&quot;,<br />      &quot;replies&quot;: &quot;8&quot;,<br />      &quot;retweets&quot;: &quot;26&quot;,<br />      &quot;quote&#95;tweets&quot;: &quot;2&quot;<br />     &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

<div id="post-insightsengagement28hr">
  #### **POST /insights/engagement/28hr**
</div>

这个 28 小时端点可用于在过去 28 小时内，获取最多 25 条帖子集合的展示次数和互动数据。该端点还支持为所有受支持的单项指标请求数据。有关受支持指标的完整列表，请参阅 [Metric Availability](https://developer.x.com/en/docs/x-api/v1/metrics/get-tweet-engagement/overview#EngagementTypes)。

|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :-------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **请求方法**        | HTTP POST                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **URL**         | `https://data-api.x.com/insights/engagement/28hr`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **内容类型**        | `application/json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **压缩方式**        | Gzip。要使用 Gzip 压缩发起请求，请在该请求中发送 Accept-Encoding 头部。  <br />该头部应如下所示：  <br />  <br />`Accept-Encoding: gzip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **POST 请求格式**   | 请求可以作为 POST 请求发送，请求体为一个 JSON 对象，包含一组帖子 ID 和所需的分组方式。POST 请求按数组格式组成，由 `tweets`、`engagements` 和 `groupings` 对象构成。每个请求最多可包含 25 个帖子 ID。  <br />  <br />示例 POST 请求体如下：  <br />  <br /><br />  &#123;<br />    &quot;tweet&#95;ids&quot;: [<br />       &quot;Tweet ID 1&quot;,<br />       &quot;Tweet ID 2&quot;,<br />       &quot;Tweet ID 3&quot;<br />    ],<br />      &quot;engagement&#95;types&quot;: [<br />        &quot;impressions&quot;,<br />        &quot;engagements&quot;,<br />        &quot;url&#95;clicks&quot;,<br />        &quot;detail&#95;expands&quot;<br />    ],<br />    &quot;groupings&quot;: &#123;<br />      &quot;grouping name&quot;: &#123;<br />        &quot;group&#95;by&quot;: [<br />          &quot;tweet.id&quot;,<br />          &quot;engagement.type&quot;,<br />          &quot;engagement.hour&quot;<br />        ]<br />      &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **帖子 ID**       | 一个数组，其中包含要查询互动数据的帖子 ID。请注意，您只能请求由当前进行身份验证的 @handle 发布的帖子的数据。28 小时端点每个请求最多支持 25 条帖子，并且帖子 ID 必须以字符串形式表示。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **互动类型**        | 一个数组，包含要查询的互动指标类型。  <br />  <br />在 28 小时端点中，`impressions`、`engagements` 以及所有具体的互动类型都是受支持的指标。有关受支持互动指标的完整列表，请参阅 [Engagement Data](https://developer.x.com/en/docs/x-api/v1/metrics/get-tweet-engagement/overview#AvailableData)。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **分组方式**        | 通过 Engagement API 返回的结果可以按不同的分组方式返回，以更好地满足你的需求。每个请求最多可以包含 3 个分组。  <br />  <br />对于每个分组，你可以自定义一个分组名称，以便在你的应用中更容易引用此分组类型。定义分组名称后，你可以选择按以下一个或多个值进行分组：  <br />`tweet.id`  <br />`engagement.type`  <br />`engagement.day`  <br />`engagement.hour`  <br />分组会按顺序依次应用，因此你可以通过更改 group&#95;by 值的顺序来改变期望的结果格式。下面是一个示例分组，它会按帖子 ID、互动类型和日期分隔显示指标，示例如下：<br /><br />  &quot;groupings&quot;: &#123;<br />    &quot;my grouping name&quot;: &#123;<br />      &quot;group&#95;by&quot;: [<br />        &quot;tweet.id&quot;,<br />        &quot;engagement.type&quot;,<br />        &quot;engagement.day&quot;<br />      ]<br />    &#125;<br />  &#125;<br /><br />  <br />包含 4 个 `group_by` 项的分组，仅在使用以下两种顺序之一时才是有效的。在同一个分组中包含 4 个 `group_by` 项但不符合以下任一顺序的请求将返回错误。此外，每个请求中只允许包含一个带有 4 个 `group_by` 项的分组。  <br /><br />&quot;group&#95;by&quot;: [<br />    &quot;tweet.id&quot;,<br />    &quot;engagement.type&quot;,<br />    &quot;engagement.day&quot;,<br />    &quot;engagement.hour&quot;<br />  ]<br /><br />&quot;group&#95;by&quot;: [<br />    &quot;engagement.type&quot;,<br />    &quot;tweet.id&quot;,<br />    &quot;engagement.day&quot;,<br />    &quot;engagement.hour&quot;<br />  ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **POST 请求大小上限** | 每次请求最多可包含 25 个帖子 ID。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **响应格式**        | JSON。你需要在请求头中将响应格式指定为 JSON。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **速率限制**        | 系统将以分钟为粒度施加速率限制，具体配额以合同中根据你的访问级别所载明者为准。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **请求示例**        | curl -X POST &quot;[https://data-api.x.com/insights/engagement/28hr](https://data-api.x.com/insights/engagement/28hr)&quot; <br />  -H &#39;Accept-Encoding: gzip&#39; <br />  -H &#39;Authorization OAuth oauth&#95;consumer&#95;key=&quot;consumer-key-for-app&quot;,oauth&#95;nonce=&quot;generated-nonce&quot;,oauth&#95;signature=&quot;generated-signature&quot;,oauth&#95;signature&#95;method=&quot;HMAC-SHA1&quot;, oauth&#95;timestamp=&quot;generated-timestamp&quot;,oauth&#95;token=&quot;access-token-for-authed-user&quot;, oauth&#95;version=&quot;1.0&quot;&#39; <br />  -d &#39;&#123;<br />    &quot;tweet&#95;ids&quot;: [<br />       &quot;123456789&quot;<br />    ],<br />      &quot;engagement&#95;types&quot;: [<br />        &quot;impressions&quot;,<br />        &quot;engagements&quot;<br />    ],<br />    &quot;groupings&quot;: &#123;<br />      &quot;hourly-time-series&quot;: &#123;<br />        &quot;group&#95;by&quot;: [<br />          &quot;tweet.id&quot;,<br />          &quot;engagement.type&quot;,<br />          &quot;engagement.day&quot;,<br />          &quot;engagement.hour&quot;<br />        ]<br />      &#125;<br />    &#125;<br />  &#125;&#39;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **示例响应**        | &#123;<br />&quot;start&quot;:&quot;2015-09-14T17:00:00Z&quot;,<br />&quot;end&quot;:&quot;2015-09-15T22:00:00Z&quot;,<br />&quot;hourly-time-series&quot;:&#123;<br />&quot;123456789&quot;:&#123;<br />&quot;曝光量&quot;:&#123;<br />&quot;2015-09-14&quot;:&#123;<br />&quot;17&quot;:&quot;551&quot;,<br />&quot;18&quot;:&quot;412&quot;,<br />&quot;19&quot;:&quot;371&quot;,<br />&quot;20&quot;:&quot;280&quot;,<br />&quot;21&quot;:&quot;100&quot;,<br />&quot;22&quot;:&quot;19&quot;,<br />&quot;23&quot;:&quot;6&quot;<br />&#125;,<br />&quot;2015-09-15&quot;:&#123;<br />&quot;00&quot;:&quot;5&quot;,<br />&quot;01&quot;:&quot;2&quot;,<br />&quot;02&quot;:&quot;7&quot;,<br />&quot;03&quot;:&quot;3&quot;,<br />&quot;04&quot;:&quot;1&quot;,<br />&quot;05&quot;:&quot;0&quot;,<br />&quot;06&quot;:&quot;0&quot;,<br />&quot;07&quot;:&quot;0&quot;,<br />&quot;08&quot;:&quot;0&quot;,<br />&quot;09&quot;:&quot;0&quot;,<br />&quot;10&quot;:&quot;0&quot;,<br />&quot;11&quot;:&quot;0&quot;,<br />&quot;12&quot;:&quot;0&quot;,<br />&quot;13&quot;:&quot;0&quot;,<br />&quot;14&quot;:&quot;0&quot;,<br />&quot;15&quot;:&quot;0&quot;,<br />&quot;16&quot;:&quot;0&quot;,<br />&quot;17&quot;:&quot;0&quot;,<br />&quot;18&quot;:&quot;0&quot;,<br />&quot;19&quot;:&quot;0&quot;,<br />&quot;20&quot;:&quot;0&quot;,<br />&quot;21&quot;:&quot;0&quot;<br />&#125;<br />&#125;,<br />&quot;engagements&quot;:&#123;<br />&quot;2015-09-14&quot;:&#123;<br />&quot;17&quot;:&quot;0&quot;,<br />&quot;18&quot;:&quot;0&quot;,<br />&quot;19&quot;:&quot;0&quot;,<br />&quot;20&quot;:&quot;0&quot;,<br />&quot;21&quot;:&quot;0&quot;,<br />&quot;22&quot;:&quot;0&quot;,<br />&quot;23&quot;:&quot;0&quot;<br />&#125;,<br />&quot;2015-09-15&quot;:&#123;<br />&quot;00&quot;:&quot;0&quot;,<br />&quot;01&quot;:&quot;0&quot;,<br />&quot;02&quot;:&quot;0&quot;,<br />&quot;03&quot;:&quot;0&quot;,<br />&quot;04&quot;:&quot;0&quot;,<br />&quot;05&quot;:&quot;0&quot;,<br />&quot;06&quot;:&quot;0&quot;,<br />&quot;07&quot;:&quot;0&quot;,<br />&quot;08&quot;:&quot;0&quot;,<br />&quot;09&quot;:&quot;0&quot;,<br />&quot;10&quot;:&quot;0&quot;,<br />&quot;11&quot;:&quot;0&quot;,<br />&quot;12&quot;:&quot;0&quot;,<br />&quot;13&quot;:&quot;0&quot;,<br />&quot;14&quot;:&quot;0&quot;,<br />&quot;15&quot;:&quot;0&quot;,<br />&quot;16&quot;:&quot;0&quot;,<br />&quot;17&quot;:&quot;0&quot;,<br />&quot;18&quot;:&quot;0&quot;,<br />&quot;19&quot;:&quot;0&quot;,<br />&quot;20&quot;:&quot;0&quot;,<br />&quot;21&quot;:&quot;0&quot;<br />&#125;<br />&#125;<br />&#125;<br />&#125;<br />&#125; |
| **不可用的帖子 ID**   | 对于包含已不可用帖子 ID（例如已被删除）的查询，系统会为所有可用的帖子 ID 返回相应的数据，而不可用的帖子 ID 将会在名为 `unavailable_tweet_ids` 的数组中列出。例如：  <br /><br />  &#123;<br />    &quot;start&quot;: &quot;2015-11-17T22:00:00Z&quot;,<br />    &quot;end&quot;: &quot;2015-11-19T02:00:00Z&quot;,<br />    &quot;unavailable&#95;tweet&#95;ids&quot;: [<br />        &quot;323456789&quot;<br />    ],<br />    &quot;group1&quot;: &#123;<br />     &quot;423456789&quot;: &#123;<br />      &quot;favorites&quot;: &quot;67&quot;,<br />      &quot;replies&quot;: &quot;8&quot;,<br />      &quot;retweets&quot;: 26<br />     &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

<div id="post-insightsengagementhistorical">
  #### **POST /insights/engagement/historical**
</div>

历史端点可以在任意最长为 4 周的时间段内，为最多 25 条帖子组成的集合获取展示次数和互动数据。目前，无法通过 API 请求早于 2014 年 9 月 1 日的数据。历史端点还支持为所有受支持的各项指标请求指标数据。有关受支持指标的完整列表，请参阅 [Metric Availability](https://developer.x.com/en/docs/x-api/v1/metrics/get-tweet-engagement/overview#EngagementTypes)。

|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :-------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **请求方式**        | HTTP POST                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **URL**         | `https://data-api.x.com/insights/engagement/historical`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **内容类型**        | `application/json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **压缩方式**        | Gzip。要使用 Gzip 压缩发出请求，请在连接请求中发送 `Accept-Encoding` 请求头。  <br />该请求头应如下所示：  <br />  <br />`Accept-Encoding: gzip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **POST 请求格式**   | 请求可以通过 POST 请求发送，其中请求体为一个 JSON 对象，包含一组帖子 ID 以及所需的分组方式。POST 请求的格式为一个数组，其中包含 `tweets`、`engagements` 和 `groupings` 对象。每个请求最多可以包含 25 个帖子 ID。每个请求都可以指定自定义的开始和结束日期，最长为四周。  <br />  <br /><br />  &#123;<br />    &quot;tweet&#95;ids&quot;: [<br />       &quot;Tweet ID 1&quot;,<br />       &quot;Tweet ID 2&quot;,<br />       &quot;Tweet ID 3&quot;<br />    ],<br />      &quot;engagement&#95;types&quot;: [<br />        &quot;impressions&quot;,<br />        &quot;engagements&quot;,<br />        &quot;url&#95;clicks&quot;,<br />        &quot;detail&#95;expands&quot;<br />    ],<br />    &quot;groupings&quot;: &#123;<br />      &quot;grouping name&quot;: &#123;<br />        &quot;group&#95;by&quot;: [<br />          &quot;tweet.id&quot;,<br />          &quot;engagement.type&quot;,<br />          &quot;engagement.hour&quot;<br />        ]<br />      &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **起始和结束日期**     | 您可以在请求中使用 `start` 和 `end` 字段来指定自定义的开始日期和结束日期。您必须指定一个时长不超过 4 周的开始和结束日期区间。目前支持的最早开始日期为 2014 年 9 月 1 日。不支持将结束日期设置为将来时间。如果未提供开始和结束日期，API 将默认使用紧邻当前时间之前的 4 周数据。  <br />  <br />Engagement API 返回数据的最小粒度为按小时。对于任何使用 start 或 end 值、但不精确落在整点边界上的请求，系统会自动将其调整到最近且包含在区间内的整点时间。例如，请求中使用 &quot;start&quot;:&quot;2015-07-01T12:24:00Z&quot; 和 &quot;end&quot;:&quot;2015-07-10T08:37:00Z&quot; 时，将会被调整为 &quot;start&quot;:&quot;2015-07-01T12:00:00Z&quot;,&quot;end&quot;:&quot;2015-07-10T09:00:00Z&quot;。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **帖子 ID**       | 一个数组，其中包含要查询互动数据的帖子 ID。请注意，你只能请求由进行身份验证的 @handle 创建的帖子的相关数据。4 周历史端点每个请求最多支持 25 条帖子，并且帖子 ID 必须表示为字符串。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **互动指标类型**      | 一个数组，其中包含要查询的互动指标类型。  <br />  <br />对于 4 周历史端点，`impressions`、`engagements` 以及所有单独的互动类型都是受支持的指标。有关受支持的互动指标的完整列表，请参见 [Engagement Data](https://developer.x.com/en/docs/x-api/v1/metrics/get-tweet-engagement/overview#AvailableData)。  <br />  <br />**注意：** 目前，对于 2015 年 9 月 15 日之前的查询，有三个指标将显示为 0：`favorites`、`replies` 和 `retweets`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **分组**          | 可以根据你的需求，将 Engagement API 的结果按不同的分组方式返回。每个请求最多可以包含 3 个分组。  <br />  <br />对于每个分组，你可以自定义一个分组名称，以便在你的应用中更容易引用这种分组类型。一旦你定义了分组名称，就可以选择按以下一个或多个值进行分组：  <br />`tweet.id`  <br />`engagement.type`  <br />`engagement.day`  <br />`engagement.hour`  <br />分组是按顺序依次生效的，因此你可以通过改变 `group&#95;by` 值的顺序来改变期望的结果格式。下面是一个示例分组，它会按帖子 ID、指标类型和日期维度分别显示指标，看起来如下所示：<br /><br />  &quot;groupings&quot;: &#123;<br />    &quot;my grouping name&quot;: &#123;<br />      &quot;group&#95;by&quot;: [<br />        &quot;tweet.id&quot;,<br />        &quot;engagement.type&quot;,<br />        &quot;engagement.day&quot;<br />      ]<br />    &#125;<br />  &#125;<br /><br />  <br />包含 4 个 `group_by` 项的分组只有在使用以下两种顺序之一时才有效。在单个分组中包含 4 个 `group_by` 项但不符合以下任一顺序的请求将会返回错误。此外，每个请求中只允许有一个包含 4 个 `group_by` 项的分组。  <br /><br />&quot;group&#95;by&quot;: [<br />    &quot;tweet.id&quot;,<br />    &quot;engagement.type&quot;,<br />    &quot;engagement.day&quot;,<br />    &quot;engagement.hour&quot;<br />  ]<br /><br />&quot;group&#95;by&quot;: [<br />    &quot;engagement.type&quot;,<br />    &quot;tweet.id&quot;,<br />    &quot;engagement.day&quot;,<br />    &quot;engagement.hour&quot;<br />  ]                                                                                                                                                                                                     |
| **POST 请求大小限制** | 一次请求最多可包含 25 个帖子 id。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **响应格式**        | JSON。应在请求头中将响应格式指定为 JSON。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **速率限制**        | 系统将按分钟对请求施加速率限制，具体额度根据您的访问级别，以合同约定为准。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **请求示例**        | curl -XPOST &quot;[https://data-api.x.com/insights/engagement/historical](https://data-api.x.com/insights/engagement/historical)&quot; <br />  -H &#39;Accept-Encoding: gzip&#39; <br />  -H &#39;Authorization OAuth oauth&#95;consumer&#95;key=&quot;consumer-key-for-app&quot;,oauth&#95;nonce=&quot;generated-nonce&quot;,oauth&#95;signature=&quot;generated-signature&quot;,oauth&#95;signature&#95;method=&quot;HMAC-SHA1&quot;, oauth&#95;timestamp=&quot;generated-timestamp&quot;,oauth&#95;token=&quot;access-token-for-authed-user&quot;, oauth&#95;version=&quot;1.0&quot;&#39; <br />  -d &#39;&#123;<br />    &quot;start&quot;: &quot;2015-08-01&quot;,<br />    &quot;end&quot;: &quot;2015-08-15&quot;,<br />    &quot;tweet&#95;ids&quot;: [<br />       &quot;123456789&quot;,<br />       &quot;223456789&quot;,<br />       &quot;323456789&quot;<br />    ],<br />      &quot;engagement&#95;types&quot;: [<br />        &quot;impressions&quot;,<br />        &quot;engagements&quot;,<br />        &quot;url&#95;clicks&quot;,<br />        &quot;detail&#95;expands&quot;<br />    ],<br />    &quot;groupings&quot;: &#123;<br />      &quot;types-by-tweet-id&quot;: &#123;<br />        &quot;group&#95;by&quot;: [<br />          &quot;tweet.id&quot;,<br />          &quot;engagement.type&quot;<br />        ]<br />      &#125;<br />    &#125;<br />  &#125;&#39; |
| **示例响应**        | &#123;<br />    &quot;start&quot;: &quot;2015-08-01T00:00:00Z&quot;,<br />    &quot;end&quot;: &quot;2015-08-15T00:00:00Z&quot;,<br />    &quot;types-by-tweet-id&quot;: &#123;<br />      &quot;123456789&quot;: &#123;<br />        &quot;impressions&quot;: &quot;0&quot;,<br />        &quot;engagements&quot;: &quot;0&quot;,<br />        &quot;url&#95;clicks&quot;: &quot;0&quot;,<br />        &quot;detail&#95;expands&quot;: &quot;0&quot;<br />      &#125;,<br />      &quot;223456789&quot;: &#123;<br />        &quot;impressions&quot;: &quot;788&quot;,<br />        &quot;engagements&quot;: &quot;134&quot;,<br />        &quot;url&#95;clicks&quot;: &quot;30&quot;,<br />        &quot;detail&#95;expands&quot;: &quot;1323&quot;<br />      &#125;,<br />      &quot;323456789&quot;: &#123;<br />        &quot;impressions&quot;: &quot;4&quot;,<br />        &quot;engagements&quot;: &quot;0&quot;,<br />        &quot;url&#95;clicks&quot;: &quot;2&quot;,<br />        &quot;detail&#95;expands&quot;: &quot;0&quot;<br />      &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                      |
| **不可用的帖子 ID**   | 对于包含已不可用的帖子 ID（例如已被删除）的查询，系统会为所有仍可用的帖子 ID 返回相应的数据，而不可用的帖子 ID 将会在名为 `unavailable_tweet_ids` 的数组中列出。例如：<br /><br />&#123;<br />    &quot;start&quot;: &quot;2015-11-17T22:00:00Z&quot;,<br />    &quot;end&quot;: &quot;2015-11-19T02:27:50Z&quot;,<br />    &quot;unavailable&#95;tweet&#95;ids&quot;: [<br />        &quot;323456789&quot;<br />    ],<br />    &quot;group1&quot;: &#123;<br />     &quot;423456789&quot;: &#123;<br />      &quot;favorites&quot;: &quot;67&quot;,<br />      &quot;replies&quot;: &quot;8&quot;,<br />      &quot;retweets&quot;: 26<br />     &#125;<br />    &#125;<br />  &#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

<div id="response-codes">
  #### **响应状态码**
</div>

| Status | Text | Description |
| :--- | :--- | :--- |
| 200 | OK  | 请求成功。 |
| 400 | Bad Request | 通常是由于请求中包含无效的 JSON，或请求未发送任何 JSON 负载而返回此响应。 |
| 401 | Unauthorized | 由于凭证无效导致 HTTP 身份验证失败。请检查你的 OAuth 密钥和令牌。 |
| 404 | Not Found | 在接收请求的 URL 上未找到资源，通常是因为使用了错误的 URL。 |
| 429 | Too Many Requests | 你的应用已超出 API 请求次数限制。 |
| 500 | Internal Server Error | Gnip 端发生错误。请使用指数退避策略重试请求。 |
| 502 | Proxy Error | Gnip 端发生错误。请使用指数退避策略重试请求。 |
| 503 | Service Unavailable | Gnip 端发生错误。请使用指数退避策略重试请求。 |

<div id="error-messages">
  #### **错误消息**
</div>

在各种场景下，Engagement API 会返回与特定情境相关的错误消息，你的应用需要具备处理这些错误的能力。下表列出了这些错误消息的一些常见示例，以及你应如何理解它们。请注意，在许多情况下，Engagement API 会在返回可用数据的部分结果时，附带特定错误消息，并作为 `200 OK` 响应的一部分提供更多说明。

| Error Message | 描述 |
| :--- | :--- |
| `"errors":["Your account could not be authenticated. Reason: Access token not found"]` | 请求中的身份验证部分出现错误。“Reason” 字段会提供有助于排查错误的信息。如果你无法自行解决，请将完整错误信息（包括 “Reason”）发送给我们的支持团队。 |
| `"errors":["1 Tweet ID(s) are unavailable"],"unavailable_tweet_ids": ["TWEET_IDS"]` | 你请求的一个或多个帖子 ID 已不再可用，通常表示这些帖子已被删除，或因其他原因不再公开可见。 |
| `"errors":["Impressions & engagements for tweets older than 90 days (*TIME_PERIOD*) are not supported"],"unsupported_for_impressions_engagements_tweet_ids":[*TWEET_IDS*]` | 你针对 `/totals` 端点请求的帖子 ID 不在最近 90 天内，因此无法返回其曝光或互动指标。 |
| `"errors":["Forbidden to access tweets: *TWEET_IDS*"]` | 基于你当前用于代表第三方检索数据的身份验证令牌，你请求的帖子 ID 无法访问。 |