---
title: 用量 API
description: "Usage API 是免费的 REST API，可为你的 Enterprise 账户提供跨产品活动用量的程序化访问能力和可见性。"
sidebarTitle: 用量 API
keywords: ["用量 API", "Enterprise 用量 API", "用量跟踪", "消耗跟踪", "Enterprise 用量", "Enterprise API 用量"]
---

<div id="usage-api-twitter-api">
  ## 使用量 API | Twitter API
</div>

<div id="overview">
  ### 概览
</div>

`Enterprise`

这是在你的账户下，用于帮助监控和管理不同 API 使用情况的最重要、也是&#95;最佳&#95;的工具。

**重要免责声明：**

由于试用以及其他计费调整，Usage API 返回的使用计数可能与账单上的数据不一致。所有数值均基于在特定日期（UTC）内所消耗的去重后活动计算。

<div id="features">
  #### 功能
</div>

* 以编程方式获取 console.gnip.com UI 中可用的使用数据
* 流级别使用数据 —— 除了产品级别之外，还在流级别（例如 dev 和 prod）提供使用数据
* 粒度细致且描述清晰的数据 —— 搜索“requests”会按 Full-Archive 和 30-Day Search 产品分别统计
* 历史 PowerTrack “days”和“jobs” 

<div id="supported-apis">
  ### 支持的 API
</div>

Usage API 当前支持的 API 如下：

* PowerTrack API `enterprise`
* 30-Day Search API `enterprise`
* Full-Archive Search API `enterprise`
* Historical PowerTrack `enterprise`

<div id="limitations">
  ### 限制
</div>

* Usage API 允许你访问自 2018 年 5 月 1 日以来的使用数据。从 2019 年 7 月 1 日起，Usage API 允许你访问**最近 13 个日历月**的使用数据。

* 你可以通过使用 fromDate 和 toDate，以**每三个月为一个区间**访问使用数据。

请参见下面的请求和响应示例：

```bash
curl -u<username>:<password> \
"https://gnip-api.x.com/metrics/usage/accounts/<account-name>.json?bucket=month"
```

```json
{
  "account": {
    "name": "accountnamehere"
  },
  "publishers": [
    {
      "type": "twitter",
      "used": [
        {
          "timePeriod": "201805010000",
          "activities": 1235,
          "searchRequests30Day": 3,
          "searchRequestsFullArchive": 19,
          "historicalPowertrackDays": 0,
          "historicalPowertrackJobs": 0
        },
        {
          "timePeriod": "201806010000",
          "activities": 23467,
          "searchRequests30Day": 0,
          "searchRequestsFullArchive": 66,
          "historicalPowertrackDays": 0,
          "historicalPowertrackJobs": 0
        },
        {
          "timePeriod": "201807010000",
          "activities": 431,
          "searchRequests30Day": 11,
          "searchRequestsFullArchive": 4,
          "historicalPowertrackDays": 0,
          "historicalPowertrackJobs": 0
        }
      ],
      "projected": {
        "timePeriod": "201807010000",
        "activities": 803,
        "searchRequests30Day": 20,
        "searchRequestsFullArchive": 7,
        "historicalPowertrackDays": 0,
        "historicalPowertrackJobs": 0
      },
      "products": [
        {
          "type": "Historical PowerTrack 订阅",
          "used": [
            {
              "timePeriod": "201805010000",
              "activities": 0,
              "days": 0,
              "jobs": 0
            },
            {
              "timePeriod": "201806010000",
              "activities": 0,
              "days": 0,
              "jobs": 0
            },
            {
              "timePeriod": "201807010000",
              "activities": 0,
              "days": 0,
              "jobs": 0
            }
          ],
          "projected": {
            "timePeriod": "201807010000",
            "activities": 0,
            "days": 0,
            "jobs": 0
          }
        },
        {
          "type": "PowerTrack",
          "used": [
            {
              "timePeriod": "201805010000",
              "activities": 267
            },
            {
              "timePeriod": "201806010000",
              "activities": 3
            },
            {
              "timePeriod": "201807010000",
              "activities": 32
            }
          ],
          "projected": {
            "timePeriod": "201807010000",
            "activities": 59
          },
          "endpoints": [
            {
              "type": "PowerTrack 2.0",
              "label": "actformat",
              "used": [
                {
                  "timePeriod": "201805010000",
                  "activities": 0
                },
                {
                  "timePeriod": "201806010000",
                  "activities": 0
                },
                {
                  "timePeriod": "201807010000",
                  "activities": 0
                }
              ],
              "projected": {
                "timePeriod": "201807010000",
                "activities": 0
              }
            },
              {
              "type": "PowerTrack Replay 2.0",
              "label": "ogformat",
              "used": [
                {
                  "timePeriod": "201805010000",
                  "activities": 0
                },
                {
                  "timePeriod": "201806010000",
                  "activities": 0
                },
                {
                  "timePeriod": "201807010000",
                  "activities": 0
                }
              ],
              "projected": {
                "timePeriod": "201807010000",
                "activities": 0
              }
            }
          ]
        },
        {
          "type": "Search API（30 天）2.0",
          "used": [
            {
              "timePeriod": "201805010000",
              "activities": 10,
              "searchRequests30Day": 3
            },
            {
              "timePeriod": "201806010000",
              "activities": 0,
              "searchRequests30Day": 0
            },
            {
              "timePeriod": "201807010000",
              "activities": 23,
              "searchRequests30Day": 11
            }
          ],
          "projected": {
            "timePeriod": "201807010000",
            "activities": 42,
            "searchRequests30Day": 20
          },
          "endpoints": [
            {
              "type": "Search API（30 天）2.0",
              "label": "ogformat",
              "used": [
                {
                  "timePeriod": "201805010000",
                  "activities": 10,
                  "searchRequests30Day": 3
                },
                {
                  "timePeriod": "201806010000",
                  "activities": 0,
                  "searchRequests30Day": 0
                },
                {
                  "timePeriod": "201807010000",
                  "activities": 21,
                  "searchRequests30Day": 10
                }
              ],
              "projected": {
                "timePeriod": "201807010000",
                "activities": 39,
                "searchRequests30Day": 18
              }
            }
          ]
        },
        {
          "type": "Search API（全量归档）",
          "used": [
            {
              "timePeriod": "201805010000",
              "activities": 961,
              "searchRequestsFullArchive": 19
            },
            {
              "timePeriod": "201806010000",
              "activities": 23466,
              "searchRequestsFullArchive": 66
            },
            {
              "timePeriod": "201807010000",
              "activities": 379,
              "searchRequestsFullArchive": 4
            }
          ],
          "projected": {
            "timePeriod": "201807010000",
            "activities": 706,
            "searchRequestsFullArchive": 7
          },
          "endpoints": [
            {
              "type": "Search API（全量归档）",
              "label": "actformat",
              "used": [
                {
                  "timePeriod": "201805010000",
                  "activities": 1,
                  "searchRequestsFullArchive": 3
                },
                {
                  "timePeriod": "201806010000",
                  "activities": 0,
                  "searchRequestsFullArchive": 0
                },
                {
                  "timePeriod": "201807010000",
                  "activities": 2,
                  "searchRequestsFullArchive": 1
                }
              ],
              "projected": {
                "timePeriod": "201807010000",
                "activities": 3,
                "searchRequestsFullArchive": 1
              }
            },
            {
              "type": "Search API（全量归档）",
              "label": "ogformat",
              "used": [
                {
                  "timePeriod": "201805010000",
                  "activities": 961,
                  "searchRequestsFullArchive": 16
                },
                {
                  "timePeriod": "201806010000",
                  "activities": 23466,
                  "searchRequestsFullArchive": 66
                },
                {
                  "timePeriod": "201807010000",
                  "activities": 379,
                  "searchRequestsFullArchive": 3
                }
              ],
              "projected": {
                "timePeriod": "201807010000",
                "activities": 706,
                "searchRequestsFullArchive": 5
              }
            }
          ]
        }
      ]
    }
  ],
  "bucket": "month",
  "fromDate": "201805010000",
  "toDate": "201808010000"
}
```

<div id="sample-payload">
  ### 示例负载
</div>

下面是一个负载示例：

```bash
{
  "账户": {
    "名称": "gnip-username"
  },
  "时段": "month",
  "发布者": [
    {
      "类型": "automattic",
      "已使用": [
        {
          "活动": 0,
          "时间段": "201603010000"
        }
      ],
      "预计": {
        "活动": 0,
        "时间段": "201603010000"
      },
      "产品": [
        {
          "类型": "PowerTrack",
          "已使用": [
            {
              "时间段": "201603010000",
              "活动": 0
            }
          ],
          "预计": {
            "时间段": "201603010000",
            "活动": 0
          },
          "端点": [
            {
              "类型": "PowerTrack",
              "标签": "dev",
              "已使用": [
                {
                  "时间段": "201603010000",
                  "活动": 0
                }
              ],
              "预计": {
                "时间段": "201603010000",
                "活动": 0
              }
            }
          ]
        }
      ]
    },
    {
      "类型": "twitter",
      "已使用": [
        {
          "活动": 84,
          "30天搜索请求": 4,
          "全档案搜索请求": 0,
          "历史PowerTrack天数": 0,
          "历史PowerTrack作业": 0,
          "时间段": "201603010000"
        }
      ],
      "预计": {
        "活动": 0,
        "30天搜索请求": 0,
        "全档案搜索请求": 0,
        "历史PowerTrack天数": 0,
        "历史PowerTrack作业": 0,
        "时间段": "201601010000"
      },
      "产品": [
        {
          "类型": "Historical PowerTrack 2.0",
          "已使用": [
            {
              "时间段": "201511010000",
              "活动": 11884,
              "天数": 5,
              "作业": 5
            },
            {
              "时间段": "201512010000",
              "活动": 0,
              "天数": 0,
              "作业": 0
            },
            {
              "时间段": "201601010000",
              "活动": 0,
              "天数": 0,
              "作业": 0
            }
          ]
        },
        {
          "类型": "PowerTrack",
          "已使用": [
            {
              "时间段": "201511010000",
              "活动": 0
            },
            {
              "时间段": "201512010000",
              "活动": 27456
            },
            {
              "时间段": "201601010000",
              "活动": 0
            }
          ],
          "预计": {
            "时间段": "201601010000",
            "活动": 0
          },
          "端点": [
            {
              "类型": "PowerTrack",
              "标签": "devel",
              "已使用": [
                {
                  "时间段": "201511010000",
                  "活动": 0
                },
                {
                  "时间段": "201512010000",
                  "活动": 2930
                },
                {
                  "时间段": "201601010000",
                  "活动": 0
                }
              ],
              "预计": {
                "时间段": "201601010000",
                "活动": 0
              }
            },
            {
              "类型": "PowerTrack 2.0",
              "标签": "devel-v2",
              "已使用": [
                {
                  "时间段": "201511010000",
                  "活动": 0
                },
                {
                  "时间段": "201512010000",
                  "活动": 24542
                },
                {
                  "时间段": "201601010000",
                  "活动": 0
                }
              ],
              "预计": {
                "时间段": "201601010000",
                "活动": 0
              }
            },
            {
              "类型": "PowerTrack 2.0",
              "标签": "devel-v2-1",
              "已使用": [
                {
                  "时间段": "201511010000",
                  "活动": 0
                },
                {
                  "时间段": "201512010000",
                  "活动": 0
                },
                {
                  "时间段": "201601010000",
                  "活动": 0
                }
              ],
              "预计": {
                "时间段": "201601010000",
                "活动": 0
              }
            }
          ]
        },
        {
          "类型": "Search API",
          "已使用": [
            {
              "时间段": "201511010000",
              "活动": 0,
              "30天搜索请求": 0
            },
            {
              "时间段": "201512010000",
              "活动": 0,
              "30天搜索请求": 0
            },
            {
              "时间段": "201601010000",
              "活动": 0,
              "30天搜索请求": 0
            }
          ],
          "预计": {
            "时间段": "201601010000",
            "活动": 0,
            "30天搜索请求": 0
          },
          "端点": [
            {
              "类型": "Search API",
              "标签": "devel",
              "已使用": [
                {
                  "时间段": "201511010000",
                  "活动": 0,
                  "30天搜索请求": 0
                },
                {
                  "时间段": "201512010000",
                  "活动": 0,
                  "30天搜索请求": 0
                },
                {
                  "时间段": "201601010000",
                  "活动": 0,
                  "30天搜索请求": 0
                }
              ],
              "预计": {
                "时间段": "201601010000",
                "活动": 0,
                "30天搜索请求": 0
              }
            }
          ]
        },
        {
          "类型": "Search API (30-Day)",
          "已使用": [
            {
              "时间段": "201511010000",
              "活动": 0,
              "30天搜索请求": 0
            },
            {
              "时间段": "201512010000",
              "活动": 0,
              "30天搜索请求": 0
            },
            {
              "时间段": "201601010000",
              "活动": 0,
              "30天搜索请求": 0
            }
          ],
          "预计": {
            "时间段": "201601010000",
            "活动": 0,
            "30天搜索请求": 0
          },
          "端点": [
            {
              "类型": "Search API (30-Day)",
              "标签": "devel",
              "已使用": [
                {
                  "时间段": "201511010000",
                  "活动": 0,
                  "30天搜索请求": 0
                },
                {
                  "时间段": "201512010000",
                  "活动": 0,
                  "30天搜索请求": 0
                },
                {
                  "时间段": "201601010000",
                  "活动": 0,
                  "30天搜索请求": 0
                }
              ],
              "预计": {
                "时间段": "201601010000",
                "活动": 0,
                "30天搜索请求": 0
              }
            }
          ]
        },
        {
          "类型": "Search API (Full-Archive)",
          "已使用": [
            {
              "时间段": "201511010000",
              "活动": 0,
              "全档案搜索请求": 0
            },
            {
              "时间段": "201512010000",
              "活动": 0,
              "全档案搜索请求": 0
            },
            {
              "时间段": "201601010000",
              "活动": 0,
              "全档案搜索请求": 0
            }
          ],
          "预计": {
            "时间段": "201601010000",
            "活动": 0,
            "全档案搜索请求": 0
          },
          "端点": [
            {
              "类型": "Search API (Full-Archive)",
              "标签": "devel",
              "已使用": [
                {
                  "时间段": "201511010000",
                  "活动": 0,
                  "全档案搜索请求": 0
                },
                {
                  "时间段": "201512010000",
                  "活动": 0,
                  "全档案搜索请求": 0
                },
                {
                  "时间段": "201601010000",
                  "活动": 0,
                  "全档案搜索请求": 0
                }
              ],
              "预计": {
                "时间段": "201601010000",
                "活动": 0,
                "全档案搜索请求": 0
              }
            }
          ]
        }
      ]
    }
  ]
}
```

<div id="api-reference">
  ## API 参考
</div>

<div id="get-usage">
  ### get-usage
</div>

<div id="methods">
  #### **方法**
</div>

| 方法 | 说明 |
| :--- | :--- |
| [GET /metrics/usage/accounts/{ACCOUNT_NAME}.json](#GETData) | 获取用量数据 |

其中：

* :account&#95;name 是与您的账户关联的名称（区分大小写），应与 console.gnip.com 上显示的名称一致

<div id="authentication-and-rate-limit">
  #### **身份验证与速率限制**
</div>

<div id="authentication">
  ##### **身份验证**
</div>

对 Usage API 的所有请求都需要使用 HTTP 基本身份验证，你可以使用账户中任一已启用的电子邮件/密码凭据，用于登录你在 console.gnip.com 的账户或连接到任何 Gnip 流。

<div id="rate-limit">
  ##### **速率限制**
</div>

Usage API 的请求速率限制为每分钟最多两次请求。

<div id="best-practices-limitations">
  #### **最佳实践和限制**
</div>

<div id="data-availability">
  ##### **数据可用性**
</div>

使用数据基于已去重的活动，这些活动统计到最近一个已完成数据处理的完整时间周期（UTC）。数据通常会被处理并更新到分钟级别，除非 Gnip 正在进行系统部署。

* Usage API 允许你访问自 2018 年 5 月 1 日以来的使用数据。从 2019 年 7 月 1 日起，Usage API 允许你访问最近**连续 13 个日历月**的使用数据。 

* 你可以按由 fromDate 和 toDate 定义的**三个月时间区间**访问使用数据

<div id="requesting-and-receiving-data">
  #### **请求和接收数据**
</div>

Usage API 的工作方式是：通过向与你的账号对应的 API 端点发送一个带有 HTTP BASIC-AUTH 身份验证凭据的 HTTP GET 请求来实现的。

<div id="get-request">
  ##### GET 请求：
</div>

使用你的用户凭证和账户名称，对以下端点发起 GET 请求：

https://gnip-api.x.com/metrics/usage/accounts/:account&#95;name.json

**附加参数**

|     |     |
| :--- | :--- |
| bucket | 可选。提供用量数据的时间单位。用量数据可以按天或按月的粒度返回。  <br />  <br />未指定 bucket 的请求将返回按月粒度的数据。  <br />  <br />可选值：&#39;month&#39; 或 &#39;day&#39; |
| fromDate (YYYYMMDDHHMM) | 可选。用量数据仅从 2018 年 5 月 1 日开始可用。该参数表示返回用量数据时所使用的最早 UTC 时间戳。时间戳的粒度为天，并且是包含性的（即 201805010000 包含 05-01 这一天）。在小时和分钟粒度上，包含除 &#39;0000&#39; 之外其他值的请求将被重置为 &#39;0000&#39;。  <br />  <br />在未指定 fromDate 或 toDate 的情况下发起的请求，将按月粒度返回当前月份的用量数据，并包含前两个月的历史数据。  <br />  <br />**请注意：** 自 2019 年 6 月 1 日起，你可以访问过去 13 个日历月的用量数据。例如，如果当前日期是 10 月 10 日，你可以访问到上一年 9 月 1 日以来的用量数据。  <br />**示例：** 201810010000 将返回从 2018 年 10 月 1 日（含 10 月 1 日）开始的数据。 |
| toDate (YYYYMMDDHHMM) | 可选。该参数表示返回用量数据时所使用的最新 UTC 时间戳。时间戳的粒度为天，并且是不包含性的（即 201703020000 不包含 03-02 这一天的数据）。当为当前日或未来日期指定 toDate 时，用量数据将返回到最近一个完整的日期（UTC）。在小时和分钟粒度上，包含除 &#39;0000&#39; 之外其他值的请求将被重置为 &#39;0000&#39;。  <br />  <br />不带 toDate 的请求，将默认使用下一个时间 bucket（当 bucket=day 时为明天，当 bucket=month 时为下个月）。在未指定 fromDate 和 toDate 的情况下发起的请求，将默认 bucket=month，并显示当前月以及前两个完整月份的数据。  <br />  <br />**示例：** 201703050000 将返回截至 2017 年 3 月 5 日的数据，但不包含 3 月 5 日当天的任何数据。 |

**GET 请求示例**

此请求将以月为粒度返回从 2017 年 3 月 1 日至 2017 年 3 月 5 日的数据，但不包含 2017 年 3 月 5 日的任何数据。

curl -u &quot;https://gnip-api.x.com/metrics/usage/accounts/:account&#95;name.json?bucket=month&amp;fromdate=201403010000&amp;toDate=201403150000&quot;

<div id="data-format">
  #### **数据格式**
</div>

下表描述了 Usage API 返回的用量数据的根级数据结构。对于包含多级子字段的字段，请单击提供的链接以查看子字段的详细信息。

如果你想查看一个完整的 Usage API 负载示例，请访问[此页面](/zh/x-api/usage/introduction)。

|     |     |
| :--- | :--- |
| **account** | 表示请求用量数据的账号对象。 |
| **bucket** | 提供用量数据的时间单位，可以是“day”或“month”。 |
| **fromDate** | 你希望获取用量数据的最早 UTC 时间戳（包含该时间）。 |
| **toDate** | 你希望获取用量数据的最晚 UTC 时间戳（不包含该时间）。 |
| **publishers** | 包含三个主要对象：Used、Projected 和 Products。 |