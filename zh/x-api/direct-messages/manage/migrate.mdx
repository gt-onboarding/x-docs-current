---
title: 迁移指南
sidebarTitle: 迁移指南
keywords: ["管理私信迁移", "私信管理迁移", "从 v1.1 迁移到 v2 管理私信", "私信迁移指南", "迁移私信管理"]
---

import { Button } from '/snippets/zh/button.mdx';

<div id="comparing-v11-and-v2-manage-direct-message-endpoints">
  ## 比较 v1.1 和 v2 管理私信端点
</div>

Direct Messages 端点在 v1.1 和 v2 中都提供了创建私信的方法。本指南旨在帮助你理解两者之间的差异，并为迁移到 v2 提供参考。 

这两个版本之间的一个主要差异是，v1.1 仅支持一对一会话，而 v2 新增了对群组会话的支持。其中一个体现是，v1.1 只支持“消息已创建”事件，而 v2 还支持与参与者加入和离开会话相关的事件。实际上，v2 的一个基础性更新，就是将 dm&#95;conversations 建立为一个核心 API 对象。   

在 v1.1 中，有两个用于管理私信的端点：

* POST direct&#95;messages/events/new - 创建一条一对一私信。此 v1.1 端点只能创建一对一消息，不支持群组消息。  

* DELETE direct&#95;messages/events/destroy - 从认证用户的视图中删除一条一对一消息。 

在此 v2 版本中，有三个用于创建私信的 POST 方法： 

* **POST /2/dm&#95;conversations/with/:participant&#95;id/messages** - 创建一条一对一私信。此方法要么将消息添加到现有的一对一会话中，要么创建一个新会话。:participant&#95;id 路径参数是接收方账号的 User ID。 

* **POST /2/dm&#95;conversations** - 创建一个新的群组会话，并向其中添加一条私信。这些请求需要提供一个会话参与者列表。请注意，你可以使用相同的参与者列表创建多个会话。这类请求将始终返回一个新的会话 ID。 

* **POST /2/dm&#95;conversations/:dm&#95;conversation&#95;id/messages** - 创建一条私信并将其添加到现有会话中。:dm&#95;conversation&#95;id 路径参数是要将消息添加到其中的会话 ID。 

一个重要细节是，会话和事件 ID 在 X 平台的 v1.1 和 v2 版本之间是共享的。这意味着这两个版本可以一起使用。例如，Direct Messages v1.1 端点提供了返回单个事件和删除事件的方法，而这些方法在 v2 中尚不可用。由于 ID 在 v1.1 和 v2 之间是通用的，你可以基于 v2 提供的 ID 发起 v1.1 请求，或者引用 X 应用中会话 URL 显示的会话 ID。

下表比较了 v1.1 和 v2 管理私信端点的一些基本方面。此处介绍的 X API v2 特性，对所有私信查询端点都是通用的。

|     |     |     |
| :--- | :--- | :--- |
| **说明** | **标准版 v1.1** | **X API v2** |
| 主机域名 | https://api.x.com | https://api.x.com |
| 端点根路径 | [/1.1/direct&#95;messages](https://api.x.com/1.1/direct_messages) | [/2/dm&#95;conversations](https://api.x.com/2/users/:id/dm_conversations)<br /><br />Direct Messages 会话被引入为一个基础性的 API 对象。   <br /><br />这些端点会检索 MessageCreate、ParticipantsJoin 和 ParticipantLeave 事件。 |
| 支持的 HTTP 方法 | POST | POST |
| 是否支持群组私信 |     | ✔   |
| 支持的事件类型 | message&#95;create | MessageCreate, ParticipantsJoin, ParticipantsLeave |
| [Authentication](/zh/resources/fundamentals/authentication) | OAuth 1.0a User Context | OAuth 1.0a User Context<br /><br />OAuth 2 User Context（作用域：dm.read, dm.write） |
| 需要使用与 X API v2 [Project](/zh/resources/fundamentals/projects) 关联的 [developer App](/zh/resources/fundamentals/authentication) 的凭据 |     | ✔   |
| 默认请求[速率限制](/zh/x-api/fundamentals/rate-limits)*  <br />*所有请求都需要用户令牌 | 每位用户每 24 小时 1000 次请求  <br />每个应用每 24 小时 15000 次请求 | 每位用户每 15 分钟 200 次请求<br /><br />每位用户每 24 小时 1000 次请求<br /><br />每个应用每 24 小时 15000 次请求<br /><br />这些速率限制在所有 dm&#95;conversations POST 端点之间共享。 |

下表将 v2 的 POST 方法与 v1.1 版本进行了比较。请注意，这些 v2 方法通过支持群组会话扩展了可用功能。 

**创建一个新的“一对一”私信**

路径：POST /2/dm&#95;conversations/with/:participant&#95;id/messages

|     |     |     |
| :--- | :--- | :--- |
| **Description** | **Standard v1.1** | **X API v2** |
| Endpoint path | POST direct&#95;messages/events/new (message&#95;create) | POST /2/dm&#95;conversations/with/:participant&#95;id/messages |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits) | 每位用户每 24 小时 1000 次请求  <br />每个应用每 24 小时 15000 次请求 | 每位用户每 15 分钟 200 次请求<br /><br />每位用户每 24 小时 1000 次请求<br /><br />每个应用每 24 小时 15000 次请求<br /><br />这些速率限制适用于所有 dm&#95;conversations POST 端点。 |
| Supports group Direct Messages |     | ✔   |

**创建新的群组私信会话并向其中添加一条消息**

Path: POST /2/dm&#95;conversations

|     |     |     |
| :--- | :--- | :--- |
| **Description** | **Standard v1.1** | **X API v2** |
| Endpoint path | 不支持 | POST /2/dm&#95;conversations |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits) |     | 每位用户每 15 分钟 200 次请求<br /><br />每位用户每 24 小时 1000 次请求<br /><br />每个应用每 24 小时 15000 次请求<br /><br />这些速率限制适用于所有 dm&#95;conversations POST 端点。 |
| Supports group Direct Messages |     | ✔   |

**通过会话 ID 向现有私信会话添加一条消息**

Path: POST /2/dm&#95;conversations/:dm&#95;conversation&#95;id/messages

|     |     |     |
| :--- | :--- | :--- |
| **Description** | **Standard v1.1** | **X API v2** |
| Endpoint path | 不支持 | POST /2/dm&#95;conversations/:dm&#95;conversation&#95;id/messages |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits) |     | 每位用户每 15 分钟 200 次请求<br /><br />每位用户每 24 小时 1000 次请求<br /><br />每个应用每 24 小时 15000 次请求<br /><br />这些速率限制适用于所有 dm&#95;conversations POST 端点。 |
| Supports group Direct Messages |     | ✔   |