---
title: 快速入门
sidebarTitle: 快速入门
keywords: ["管理私信快速入门", "管理 DM 快速入门", "发送私信快速入门", "私信管理快速入门"]
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## 开始使用管理私信的端点
</div>

本快速入门指南将帮助你使用 Postman（一个用于管理和发送 HTTP 请求的工具），向用于管理私信的端点发出你的第一个请求。要了解有关我们 Postman 集合的更多信息，请访问我们的 [使用 Postman](/zh/tutorials/postman-getting-started) 指南。

如果你想查看基于 Python 的示例，请访问我们的 [X API v2 示例代码](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub 仓库。此外，官方的 [X Developer Platform 软件开发工具包 (SDK)](/zh/x-api/tools-and-libraries/sdks) 将会更新以支持这些私信端点。  

<Note>
  **先决条件**

  要完成本指南，你需要拥有一组用于对请求进行身份验证的 [密钥和令牌](/zh/resources/fundamentals/authentication)。你可以按照以下步骤生成这些密钥和令牌：

  * [注册开发者账号](https://developer.x.com/en/apply-for-access) 并通过审批。
  * 在开发者门户中创建一个 [项目](/zh/resources/fundamentals/projects) 以及一个关联的 [开发者应用](/zh/resources/fundamentals/developer-apps)。
  * 前往你的应用的 “Keys and tokens”（密钥和令牌）页面以生成所需凭证。请务必将所有凭证保存在安全的位置。
</Note>

<div id="steps-to-building-manage-direct-message-requests">
  ### 构建管理私信请求的步骤
</div>

在本示例中，我们会在一次请求中创建一个新的群组会话并向其中添加第一条消息，然后再向该会话添加第二条消息。

<div id="step-one-start-with-a-tool-or-library">
  #### 第一步：从工具或库开始
</div>

要开始使用管理私信端点，我们将使用 Postman 工具来简化流程。我们会使用由 XDev 团队编写的一组示例 X API v2 请求集合，来探索六个端点，这些端点用于创建新的私信以及列出私信会话事件。

尽管集合的大部分内容已预先配置好，但仍有一些细节需要你根据为这些 API 请求而创建的 X 应用来填写。首先，我们先加载/更新这个集合。

要将 X API v2 的 Postman 集合加载到你的环境中，请点击下方按钮：

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  将 X API v2 添加到 Postman
</Button>

在你将 X API v2 集合加载到 Postman 后，导航到 “Manage Direct Messages” 文件夹。该文件夹的 Authorization 选项卡在可能的情况下已预先填好，你可以更新部分设置来填入你的 X 应用的身份验证信息。此文件夹还包含三个用于创建新私信的端点。请注意，还有一个名为 &quot;Direct Message lookup&quot; 的文件夹，其中有三个可用端点，用于检索私信会话事件，包括发送和接收消息，以及会话参与者加入和离开时的事件。

由于创建群组会话是 X API v2 的一项重要新功能，本示例将重点展示这一点。我们将使用 &quot;New group DM and conversation&quot; 示例，并通过该请求来创建一个私信群组会话。

下一步是为该端点的请求进行身份验证。

**第二步：为你的请求进行身份验证**

要正确地向 X API 发送请求，你需要确认自己是否有权限这样做。为了成功调用此端点，我们将使用 [OAuth 2.0 Authorization Code Flow with PKCE](resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2)。你可以在 Postman 中生成访问令牌。 

使用 Postman 时，你可以在文件夹级别或请求级别设置身份验证方式。这里我们将在文件夹级别配置身份验证信息。

导航到 &quot;Manage Direct Messages&quot; 文件夹，选择 &quot;Authorization&quot; 选项卡，并确认 Type 设置为 “OAuth 2.0”，且 &quot;Add auth data to&quot; 设置为 &quot;Request Headers&quot;。在 &quot;Current Token&quot; 部分，确保 &quot;header Prefix&quot; 设置为 Bearer。  

要配置并生成新令牌：

1. 创建一个 Token Name，例如 &quot;Manage DMs&quot;。

2. 确认 **Grant Type** 设置为 Authorization Code (with PKCE)。

3. 设置你的 **Callback URL**。你需要将 Callback URL 更新为与在 [v2 Dev Portal](https://developer.x.com/en/portal/dashboard) 中与你的应用关联的 Callback URL 完全一致。在此示例中使用的 X 应用中，Callback URL 被设置为 - [*https://www.example.com*.](https://www.example.com/)（注意，由于必须完全匹配，[*https://example.com*](https://example.com) 将无法使用。） 

4. 确认 **Auth URL** 设置为 [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize)。

5. 确认 **Access Token URL** 设置为 [https://api.x.com/2/oauth2/token](https://api.x.com/2/oauth2/token)。\
   **Client ID** - 从开发者门户复制并粘贴 OAuth 2.0 client ID\
   **Client Secret** - 只有在你使用的是保密客户端类型的应用时才需要此项。如果是，请从开发者门户复制并粘贴 OAuth 2.0 Client Secret。 

6. 确认 **Scope** 设置为 dm.read、dm.write、tweet.read 和 users.read。

7. 确认 **State** 设置为 “state”。

8. 确认 **Client Authentication** 设置为 Send as Basic Auth header。

9. 点击 **Get New Access Token**，在 “Sign-in with X” 流程中点击 &quot;Authorize app&quot;。

10. 点击 &quot;Proceed&quot; 按钮，然后点击 &quot;Use Token&quot; 来生成令牌。 

11. 点击 &quot;Save&quot; 按钮以保存这些配置信息。

你可能会收到一条消息，提示你尚未登录 X。如果出现此错误，你需要在 Postman 中登录到你打算代表其发帖的 X 帐户。

现在已经在文件夹级别配置好了这些 OAuth 2.0 详情，前往每个示例的“Authorization”选项卡，并确认它们的 Type 已设置为“Inherit auth from parent”。

请注意，此令牌会很快过期，你需要通过点击“Get New Access Token”按钮来重新生成它。点击该按钮会触发“Sign-in with X”流程，并生成一个新的令牌用于发起请求。

<div id="step-three-specify-the-direct-message-conversation-participants-and-message-contents">
  #### 步骤三：指定 Direct Message 会话参与者和消息内容
</div>

导航到 “Body” 选项卡，并修改示例 JSON 对象。将 `participant_ids` 属性设置为你想发送 Direct Message 的账号。

`{
   "message": {"text": "Hello to just you two, this is a new group conversation."},
   "participant_ids": ["944480690","906948460078698496"],
   "conversation_type": "Group"
}`

<div id="step-four-make-your-request-and-review-the-response">
  #### 步骤四：发送请求并查看响应
</div>

在完成所有设置后，点击 “Send” 按钮，你会收到一个与下方示例响应类似的响应结果。提醒一下，如果你的访问令牌自创建后已经过期，你可以回到该文件夹的 Authorization 选项卡，点击 “Get New Access Token” 来创建一个新的访问令牌。

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582103724607971332"
   }
}
```

如果返回的响应 &quot;data&quot; 对象中包含 dm&#95;conversation&#95;id 和 dm&#95;event&#95;id，则说明你已成功创建了一个新的 Direct Message 会话。要开始查询与此会话相关的事件，请前往 Direct Message 查找快速入门指南。

<div id="step-five-add-another-message-to-that-group-conversation">
  #### 步骤五：向该群组会话再添加一条消息
</div>

现在选择 “Add DM to conversation” 示例，然后选择 “Params” 选项卡。在 “Path Variables” 下，将 dm&#95;conversation&#95;id 更新为你在上面创建的会话的 ID。

|                            |                     |
| :------------------------- | :------------------ |
| **Key**                    | **Value**           |
| dm&#95;conversation&#95;id | 1582103724607971328 |

使用该会话 ID，请求路径将变为：[https://api.x.com/2/dm&#95;conversations/1582103724607971328/messages](https://api.x.com/2/dm_conversations/1582103724607971328/messages)

同时，在 “Body” 选项卡中更新请求 JSON，使其包含你要发送的消息文本：

```
{
   "text": "Adding a new message to our group conversation..."
}
```

完成所有设置后，点击“Send”按钮，你将会收到类似于下面示例的响应：

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582106224379559940"
   }
}
```
