---
title: 迁移指南
sidebarTitle: 迁移指南
keywords: ["私信迁移", "DM 迁移", "v1.1 到 v2 DM 查询", "DM 迁移指南", "DM 查询迁移"]
---

import { Button } from '/snippets/zh/button.mdx';

<div id="comparing-v11-and-v2-direct-message-event-lookup-endpoints">
  ## 比较 v1.1 和 v2 私信事件查询端点
</div>

Direct Messages 端点在 v1.1 和 v2 两个版本中都提供了查询私信事件的方法。本指南旨在帮助你理解两者之间的差异，并为迁移到 v2 提供相关信息。 

两者之间的一个主要区别是：v1.1 只支持一对一会话，而 v2 引入了对群组会话的支持。这带来的一个直接结果是，v1.1 只支持“消息创建”事件，而 v2 还支持与参与者加入和离开会话相关的事件。事实上，v2 的一个根本性更新是将 dm&#95;conversations 建立为核心 API 对象。   

在 v1.1 中，有两个用于获取私信的端点（同样地，新消息是 v1.1 中唯一支持的事件类型）：

* GET direct&#95;messages/events/show - 根据 ID 获取单个事件。 

* GET direct&#95;messages/events/list - 获取由经过身份验证的用户发送和接收的一对一私信，时间范围最长为过去 30 天。请注意，此方法无法获取群组会话中的消息。 

在 v2 中，有三个用于获取私信会话事件的 GET 方法： 

* **GET /2/dm&#95;conversations/with/:participant&#95;id/dm&#95;events** - 获取与某个一对一会话关联的私信事件。:participant&#95;id 路径参数是与发起此请求的经过身份验证用户进行会话的账户的用户 ID。 

* **GET /2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events** - 获取与特定会话 ID 关联的私信事件，该会话 ID 由 :dm&#95;conversation&#95;id 路径参数指定。此方法同时支持一对一和群组会话。 

* **GET /2/dm&#95;events** - 获取与某个用户关联的私信事件，包括一对一和群组会话。最多可获取追溯 30 天内的事件。  

一个重要细节是，会话和事件 ID 在 X 平台的 v1.1 和 v2 版本之间是共享的。这意味着可以同时使用这两个版本。例如，Direct Messages v1.1 的端点提供了返回单个事件和删除事件的方法，而这些方法在 v2 中尚不可用。由于 ID 在 v1.1 和 v2 中是通用的，你可以基于 v2 提供的 ID 发起 v1.1 请求，或者引用 X 应用中会话 URL 显示的会话 ID。

下表比较了 v1.1 和 v2 私信事件查询端点的一些基本方面。这里列出的 X API v2 特性通用于所有私信查询端点。

|     |     |     |
| :--- | :--- | :--- |
| **Description** | **Standard v1.1** | **X API v2** |
| Host domain | https://api.x.com | https://api.x.com |
| Endpoint root path | [/1.1/direct&#95;messages](https://api.x.com/1.1/direct_messages) | [/2/dm&#95;conversations](https://api.x.com/2/users/:id/dm_conversations)<br /><br />Direct Messages 会话被引入为一个基础 API 对象。   <br /><br />这些端点会返回 MessageCreate、ParticipantsJoin 和 ParticipantLeave 事件。 |
| HTTP methods supported | GET | GET |
| Supports Group Direct Messages |     | ✔   |
| Event types supported | message&#95;create | MessageCreate, ParticipantsJoin, ParticipantsLeave |
| [Authentication](/zh/resources/fundamentals/authentication) | OAuth 1.0a 用户上下文 | OAuth 1.0a 用户上下文<br /><br />OAuth 2 用户上下文（scopes：dm.read、tweet.read、user.read） |
| Requires the use of credentials from a [developer App](/zh/resources/fundamentals/authentication) associated with a X API v2 [Project](/zh/resources/fundamentals/projects) |     | ✔   |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits)*  <br />*All requests require user tokens |     | GET 请求：每 15 分钟 300 次请求<br /><br />速率限制应用于三个端点的总和 |

下表将 v2 的 GET 方法与 v1.1 版本进行比较。请注意，这些 v2 能力通过支持群组会话扩展了可用功能。 

**获取特定一对一会话中的所有消息 **

***

Path: GET /2/dm&#95;conversations/with/:participant&#95;id/dm&#95;events

|     |     |     |
| :--- | :--- | :--- |
| **Description（描述）** | **Standard v1.1** | **X API v2** |
| Endpoint path（端点路径） | GET <br /><br />/1.1/direct&#95;messages/events/list | GET /2/dm&#95;conversations/with/:participant&#95;id/dm&#95;events |
| How much event history is available（可用事件历史范围） | 30 天 | 无限制 |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits)（默认请求速率限制） | 每 15 分钟 15 个请求 | 每 15 分钟 300 个请求  <br />速率限制在三个 GET 端点之间共享适用 |

**根据会话 ID 获取所有消息**

Path: GET /2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events

|     |     |     |
| :--- | :--- | :--- |
| **Description（描述）** | **Standard v1.1** | **X API v2** |
| Endpoint path（端点路径） | 不支持。V1.1 只能返回一对一会话中的消息，不支持按会话 ID 检索事件。 | GET /2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events |
| How much event history is available（可用事件历史范围） | 30 天 | 无限制 |
| Supports group conversations（支持群组会话） |     | ✔   |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits)（默认请求速率限制） | 每 15 分钟 15 个请求 | 每 15 分钟 300 个请求  <br />速率限制在三个 GET 端点之间共享适用 |

**获取经过身份验证用户在其所有一对一和群组会话中的所有事件**

Path: GET /2/dm&#95;events

|     |     |     |
| :--- | :--- | :--- |
| **Description（描述）** | **Standard v1.1** | **X API v2** |
| Endpoint path（端点路径） | GET /1.1/direct&#95;messages/events/list  <br />  <br />V1.1 只能返回一对一会话中的消息。 | GET /2/dm&#95;events |
| How much event history is available（可用事件历史范围） | 30 天 | 30 天 |
| Supports group conversations（支持群组会话） |     | ✔   |
| Default request [rate limits](/zh/x-api/fundamentals/rate-limits)（默认请求速率限制） | 每 15 分钟 15 个请求 | 每 15 分钟 300 个请求  <br />速率限制在三个 GET 端点之间共享适用 |