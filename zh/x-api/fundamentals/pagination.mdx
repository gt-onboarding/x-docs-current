---
title: 分页
keywords: ["分页", "分页令牌", "下一页令牌", "上一页令牌", "逐页浏览结果", "分页", "游标分页", "分页令牌"]
---

<div id="introduction">
  ## 简介
</div>

当返回的结果数量超过单个响应所能包含的上限时，X API v2 的端点会通过分页这一功能，将结果拆分为多个部分返回。此时，数据会以一系列“页面”的形式返回。分页指的是通过编程方式请求所有页面，以获取完整的结果数据集的方法。并非所有 API 端点都支持或需要分页，但在结果集较大时，通常会使用分页。

<div id="use-cases-for-pagination">
  ### 分页的使用场景
</div>

**检索某个请求的全部结果：** 应使用分页来获取与特定请求及其参数相关的所有数据。当匹配结果数量多于该请求的 `max_results` 上限时，必须使用分页。通过循环发送带有分页令牌的请求，可以检索全部结果。当返回的响应中不再包含 `next_token` 值时，可以认为所有结果都已经通过分页获取完毕。分页不应用于轮询。若要获得自上一次请求以来的最新结果，请参考使用 `since_id` 进行轮询。

**在请求结果中前后遍历：** 分页通过响应中的 `next_token` 和 `previous_token` 值，提供在请求结果中导航的方向选择。可以在后续请求中将这些令牌设置为 `pagination_token`，以跳转到下一页或上一页的结果。

<div id="pagination-token-definitions">
  ### 分页令牌定义
</div>

* `next_token` - 在支持分页的端点中，作为 meta 对象响应的一部分返回的不透明字符串。表示还有更多可用结果，可在下一次请求中将其作为 `pagination_token` 参数使用，以返回下一页结果。最后一页结果不会包含 `next_token`。
  * `previous_token` - 在支持分页的端点中，作为 meta 对象响应的一部分返回的不透明字符串。表示存在上一页结果可用，可在下一次请求中将其设置为 `pagination_token` 参数，以返回上一页结果。
  * `pagination_token` - 在分页请求中使用的参数。将其设置为 `next_token` 的值以获取下一页结果，将其设置为 `previous_token` 的值以获取上一页结果。

<div id="fundamentals-of-pagination">
  ### 分页基础知识
</div>

* 使用分页的端点会在初始请求时返回第一页结果，并在 JSON 响应的 meta 对象中提供一个 `next_token`，如果还有更多结果页可用。要获取全部结果，请重复这一流程，直到响应中不再包含 `next_token`。
  * 结果按时间倒序返回，这一点对单个页面以及跨多个页面都成立：
    * 第一个响应中的第一条帖子是最新的。
    * 最后一个响应中的最后一条帖子是最早的。
  * `max_results` 请求参数允许你配置每个响应页面返回的帖子数量。`max_results` 有默认值和最大值。
  * 任何分页实现都需要从响应负载中解析 token，并在后续请求中使用这些 token。
  * 在某些情况下，每页返回的结果可能少于 `max_results`。不要假定每页的结果数总是等于 `max_results` 参数值。
  * 要通过分页获取完整结果，最佳做法是在集成代码中使用循环逻辑，或者使用支持 X API v2 的[库](/zh/x-api/tools-and-libraries/overview)。

<div id="pagination-example">
  ### 分页示例
</div>

在本例中，由于将 `max_results` 设置为 `100`，且用户 ID `2244994945`（@XDevelopers）在 2019 年 1 月 1 日 17:00:00 UTC 至 12 月 12 日 00:00:00 UTC 期间大约创建了 295 条帖子，因此结果总共有三页。第一页上的第一条帖子（`1337498609819021312`）是最新的，第三页结果中的最后一条帖子（`1082718487011885056`）是最早的。

<div id="initial-request">
  #### 初始请求
</div>

```bash
      https://api.x.com/2/users/2244994945/tweets?tweet.fields=created_at&max_results=100&start_time=2019-01-01T17:00:00Z&end_time=2020-12-12T01:00:00Z
```

<div id="sequence-table">
  ### 顺序表
</div>

|                 | **首次请求**                                                                                                                                                                                                                                                                                                                                                                 | **第二页**                                                                                                                                                                                                                                                                                                                                                                                                                                                         | **第三页**                                                                                                                                                                                                                                                                                                                                                                                                                                                                | **第四页**                                                                                                                                                                    |
| :-------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **请求参数**        | * `max_results` = `100`  - `tweet.fields` = `created_at`  - `start_time` = `2019-01-01T17:00:00Z`  - `end_time` = `2020-12-12T01:00:00Z`                                                                                                                                                                                                                                 | - `max_results` = `100`  - `tweet.fields` = `created_at`  - `start_time` = `2019-01-01T17:00:00Z`  - `end_time` = `2020-12-12T01:00:00Z`  - `pagination_token` = `7140w`                                                                                                                                                                                                                                                                                        | * `max_results` = `100`  - `tweet.fields` = `created_at`  - `start_time` = `2019-01-01T17:00:00Z`  - `end_time` = `2020-12-12T01:00:00Z`  - `pagination_token` = `7140k9`                                                                                                                                                                                                                                                                                              | - `max_results` = `100`  - `tweet.fields` = `created_at`  - `start_time` = `2019-01-01T17:00:00Z`  - `end_time` = `2020-12-12T01:00:00Z`  - `pagination_token` = `71408hi` |
| **响应内容**        | `json { "data": [ { "created_at": "2020-12-11T20:44:52.000Z", "id": "1337498609819021312", "text": "感谢所有今天收看的朋友……" }, ... , { "created_at": "2020-05-06T17:24:31.000Z", "id": "1258085245091368960", "text": "现在更容易理解帖子带来的影响了……" } ], "meta": { "oldest_id": "1258085245091368960", "newest_id": "1337498609819021312", "result_count": 100, "next_token": "7140w" } } ` | `json { "data": [ { "created_at": "2020-04-29T17:01:44.000Z", "id": "1255542797765013504", "text": "Our developer community is full of inspiring ideas..." }, ... , { "created_at": "2019-11-21T16:17:23.000Z", "id": "1197549579035496449", "text": "Soon, we'll be releasing tools in..." } ], "meta": { "oldest_id": "1197549579035496449", "newest_id": "1255542797765013504", "result_count": 100, "next_token": "7140k9", "previous_token": "77qp8" } } ` | `json { "data": [ { "created_at": "2019-11-21T16:17:23.000Z", "id": "1197549578418941952", "text": "We know that some people who receive a large volume of replies may..." }, ... , { "created_at": "2019-01-08T19:19:37.000Z", "id": "1082718487011885056", "text": "Updates to Grid embeds..." } ], "meta": { "oldest_id": "1082718487011885056", "newest_id": "1197549578418941952", "result_count": 95, "next_token": "71408hi", "previous_token": "77qplte" } } ` | `json { "meta": { "result_count": 0, "previous_token": "77qpw8l" } } `                                                                                                     |
| **下一次请求需执行的操作** | 要获取下一页，请直接从响应中取出 `next_token` 值（`7140w`），并将其设置为下一次请求的 `pagination_token`。                                                                                                                                                                                                                                                                                                | 若要继续获取全部结果：从响应中直接取出 `next_token` 的值（`7140k9`），并在下一次请求调用中将其设置为 `pagination_token`。 若要回到上一页：从响应中直接取出 `previous_token` 的值（`77qp8`），并在下一次请求调用中将其设置为 `pagination_token`。                                                                                                                                                                                                                                                                                             | 若要继续获取所有结果：从响应中直接获取 `next_token` 值（`71408hi`），并将其设置为下一次请求的 `pagination_token`。若要跳转到上一页：从响应中直接获取 `previous_token` 值（`77qplte`），并将其设置为下一次请求的 `pagination_token`。                                                                                                                                                                                                                                                                                                         | 请注意，这里没有 `next_token`，这表示已获取到所有结果。要跳转到上一页：从响应中直接获取 `previous_token` 的值（`77qpw8l`），并将其设置为下一次请求调用的 `pagination_token`。                                                       |