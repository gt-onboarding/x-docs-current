---
title: 恢复与冗余
sidebarTitle: 恢复与冗余
keywords: ["powerstream recovery", "powerstream redundancy", "recovery features", "redundancy features", "fault tolerance", "error recovery"]
---

在消费流式数据时，最大化连接持续时间并接收所有匹配的数据是一个基本目标。这意味着务必要充分利用冗余连接、自动检测断线、快速重连，并制定恢复丢失数据的方案。

在本集成指南中，我们将介绍不同的恢复与冗余功能：冗余连接、回填以及恢复。
 

<div id="redundant-connections">
  ## 冗余连接
</div>

冗余连接是指允许你对同一条流建立多个同时存在的连接。通过让你使用两个独立的消费端连接到同一条流，并在这两条连接中接收相同的数据，从而提供冗余。这样，你的应用在多种情况下都可以进行热备切换，例如某个流断开连接，或者应用的主服务器发生故障时。

要使用冗余流，只需连接到与你的主连接相同的 URL。你的流数据会通过这两条连接同时发送。

<div id="backfill">
  ## 回填
</div>

在你检测到连接中断之后，你的系统应当足够智能，能够自动重新连接到流。如果可能，你的系统还应该记录中断持续的时间长度，以便你可以使用合适的恢复功能来回填数据。 

如果你确认中断持续时间为五分钟或更短，你可以使用回填参数 `backfillMinutes`。如果你在 `GET /powerstream` 请求中传入此参数，你将会收到过去一到五分钟内与你的规则匹配的帖子。我们通常会先发送这些较早的帖子，再发送任何新匹配到的帖子，并且不会对帖子进行去重。这意味着，如果你断开连接持续了 90 秒，但请求了两分钟的回填数据，你会收到 30 秒的重复帖子，你的系统应该能够容忍这些重复。下面是一个包含回填参数的请求示例：

`curl 'https://api.x.com/2/powerstream?backfillMinutes=5' -H "Authorization: Bearer $ACCESS_TOKEN"`

如果你确认中断持续时间超过五分钟，你可以使用[最近搜索端点](/zh/x-api/posts/search/introduction)或恢复功能来请求遗漏的数据。 

<div id="recovery">
  ## 恢复（Recovery）
</div>

如果你未能在 5 分钟的回补窗口内重新建立连接，可以使用 Recovery 功能在过去 24 小时内恢复遗漏的数据。

流式恢复功能允许你将回补窗口扩展到 24 小时。Recovery 使你能够“重放”错过的数据时间段。当你在连接请求中使用 `startTime` 和 `endTime` 请求参数时，会启动一个恢复流。连接建立后，Recovery 会重新推送指定时间段的数据，然后断开连接。  

|     |     |     |
| :--- | :--- | :--- |
| **名称** | **类型** | **描述** |
| `startTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339).<br /><br />以 UTC 表示的日期时间，指定恢复的起始时间。 |
| `endTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339).<br /><br />以 UTC 表示的日期时间，指定恢复的结束时间。 |

示例请求 URL：`https://api.x.com/2/powerstream?startTime=2022-07-12T15:10:00Z&endTime=2022-07-12T15:20:00Z`