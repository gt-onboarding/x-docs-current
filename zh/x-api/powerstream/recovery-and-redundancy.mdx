---
title: 恢复与冗余
sidebarTitle: 恢复与冗余
keywords: ["powerstream recovery", "powerstream redundancy", "恢复特性", "冗余特性", "容错能力", "错误恢复"]
---

在消费流式数据时，尽可能延长连接时间并接收所有匹配的数据是一个基本目标。这意味着，充分利用冗余连接、自动检测断连、快速重新连接，以及制定丢失数据的恢复方案都非常重要。

在本集成指南中，我们将讨论不同的恢复与冗余机制：冗余连接、数据回填（backfill）以及数据恢复。
 

<div id="redundant-connections">
  ## 冗余连接
</div>

冗余连接是指你可以对同一个流建立多个同时存在的连接。通过使用两个独立的消费者连接到同一个流，并在两个连接上接收相同的数据，你就获得了冗余能力。这样，你的应用在多种情况下就具备了热切换能力，例如当其中一个流连接断开，或者你的应用主服务器发生故障时。

要使用冗余流，只需连接到与你的主连接相同的 URL。你的流数据会同时通过这两个连接发送。

<div id="backfill">
  ## 回填
</div>

在检测到断开连接后，你的系统应足够智能，能够重新连接到流。如果可能，你的系统还应记录断开连接持续的时间，以便你可以使用合适的恢复功能来回填数据。 

如果你确认断开连接持续了五分钟或更短时间，你可以使用回填参数 `backfillMinutes`。如果在 `GET /powerstream` 请求中传递该参数，你将收到在过去一到五分钟内与你的规则匹配的帖子。我们通常会在任何新匹配的帖子之前优先发送这些较早的帖子，并且不会对帖子进行去重。这意味着，如果你断开连接了 90 秒，但请求了两分钟的回填数据，你将会收到 30 秒的重复帖子，你的系统应能够容忍这种情况。下面是一个带有回填参数的请求示例：

`curl 'https://api.x.com/2/powerstream?backfillMinutes=5' -H "Authorization: Bearer $ACCESS_TOKEN"`

如果你确认断开连接时间超过五分钟，你可以使用[最近搜索端点](/zh/x-api/posts/search/introduction)或恢复功能来获取遗漏的数据。 

<div id="recovery">
  ## 恢复
</div>

如果你无法在 5 分钟回填窗口内重新连接，可以使用 Recovery 功能在过去 24 小时内恢复遗漏的数据。

流式恢复功能允许你将回填窗口扩展到 24 小时。Recovery 让你可以“重放”遗漏数据所在的这段时间。当你使用 `startTime` 和 `endTime` 请求参数发起连接请求时，就会启动一个恢复流。连接成功后，Recovery 会在指定时间段内重新推送数据，然后断开连接。  

|     |     |     |
| :--- | :--- | :--- |
| **名称** | **类型** | **说明** |
| `startTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339)。<br /><br />UTC 时间，表示开始恢复的时间点。 |
| `endTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339)。<br /><br />UTC 时间，表示恢复到的结束时间点。 |

示例请求 URL：`https://api.x.com/2/powerstream?startTime=2022-07-12T15:10:00Z&endTime=2022-07-12T15:20:00Z`