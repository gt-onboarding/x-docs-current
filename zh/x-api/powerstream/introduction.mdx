---
title: 介绍
sidebarTitle: 介绍
keywords: ["powerstream", "powerstream API", "real-time streaming", "streaming rules", "filtered stream", "enterprise streaming", "GNIP powerstream"]
---

Powerstream 是我们用于访问 X 公共数据的速度最快的实时流式 API。它类似于传统的 GNIP Powetrack API，使用规则根据关键词、运算符和元数据来过滤帖子。一旦与 Powerstream 端点建立了持续的 HTTP 连接，就可以开始以近乎实时的方式接收匹配的帖子。

目前，Powerstream 支持最多 1,000 条规则，每条规则最长可以为 2,048 个字符。

<div id="key-features">
  ## 关键功能：
</div>

* **实时数据投递**：在接近实时的情况下获取与您的规则匹配的数据。
* **精确过滤**：使用带运算符的布尔查询，筛选出完全符合您需求的数据。
* **传输方式**：通过 HTTP/1.1 分块传输编码（chunked transfer encoding）返回 JSON 响应。
* **本地数据中心支持**：仅从本地数据中心获取帖子，以避免复制延迟，从而降低时延。

<Note>
  Powerstream API 是一项高级付费服务，仅在特定 Enterprise 计划下提供。

  如果您有兴趣使用 Powerstream 或进一步了解我们的 Enterprise 产品，请通过提交 [Enterprise 请求表单](/zh/forms/enterprise-api-interest) 联系我们的销售团队。
  我们很乐意与您讨论 Powerstream 如何支持您的业务需求。
</Note>

<div id="authentication">
  ## 身份验证
</div>

Powerstream API 端点使用 OAuth 2.0 Bearer Token。将其以 `Authorization: Bearer &lt;token&gt;` 的形式添加到请求头中后，即可开始使用这些端点。

<div id="quick-start">
  ## 快速开始
</div>

本节演示如何在 Python 中使用 `requests` 库快速开始调用 PowerStream 端点。通过 `pip install requests` 进行安装。所有示例都使用 OAuth 2.0 Bearer Token 认证。将 `YOUR_BEARER_TOKEN` 替换为你的实际令牌（请安全存储，例如通过 `os.getenv('BEARER_TOKEN')`）。

我们将通过代码片段介绍每个端点。假定你已经在文件开头添加了以下导入：

```python
import requests
import json
import time
import sys
import os  # 用于环境变量
```

<div id="setup">
  ### 设置
</div>

```python
bearer_token = os.getenv('BEARER_TOKEN') or "YOUR_BEARER_TOKEN"  # 使用环境变量以保证安全
base_url = "https://api.x.com/2/powerstream"
rules_url = f"{base_url}/rules"  # 用于规则管理
headers = {
   "Authorization": f"Bearer {bearer_token}",
   "Content-Type": "application/json"
}
```

<div id="1-create-rules-post-rules">
  ### 1. 创建规则 (POST /rules)
</div>

添加规则以过滤你的流数据。

```python
data = {
   "rules": [
       {
           "value": "(cat OR dog) lang:en -is:retweet",
           "tag": "pet-monitor"
       },
       # 根据需要添加更多规则(最多 100 个)
   ]
}

response = requests.post(rules_url, headers=headers, json=data)
if response.status_code == 201:
   rules_added = response.json().get("data", {}).get("rules", [])
   print("已添加规则:")
   for rule in rules_added:
       print(f"ID: {rule['id']}, Value: {rule['value']}, Tag: {rule.get('tag', 'N/A')}")
else:
   print(f"错误 {response.status_code}:{response.text}")
```

<div id="2-delete-rules-post-rules">
  ### 2. 删除规则 (POST /rules)
</div>

通过 ID（推荐）或 value 删除规则。

```python
data = {
   "rules": [
       {
           "value": "(cat OR dog) lang:en -is:retweet",
           "tag": "pet-monitor"
       },
       # 根据需要添加更多规则（最多 100 条）
   ]
}

response = requests.delete(rules_url, headers=headers, json=data)
if response.status_code == 200:
   deleted = response.json().get("data", {})
   print(f"Deleted count: {deleted.get('deleted', 'N/A')}")
   if 'not_deleted' in deleted:
       print("Not deleted:", deleted['not_deleted'])
else:
   print(f"Error {response.status_code}: {response.text}")
```

**提示**：要删除所有规则，先通过 GET 请求获取这些规则，提取其中的 id，再批量删除。

<div id="3-get-rules-get-rules">
  ### 3. 获取规则 (GET /rules)
</div>

获取所有当前启用的规则。

```python
response = requests.get(rules_url, headers=headers)
if response.status_code == 200:
   rules = response.json().get("data", {}).get("rules", [])
   if rules:
       print("Active rules:")
       for rule in rules:
           print(f"ID: {rule['id']}, Value: {rule['value']}, Tag: {rule.get('tag', 'N/A')}")
   else:
       print("No active rules.")
else:
   print(f"Error {response.status_code}: {response.text}")
```

<div id="4-powerstream-get-stream">
  ### 4. PowerStream（GET /stream）
</div>

连接到流以获取实时帖子数据。使用 `stream=True` 进行逐行读取。实现重连逻辑以提高可靠性。

```python
stream_url = base_url

def main():
   while True:
       response = requests.request("GET", stream_url, headers=headers, stream=True)
       print(response.status_code)
       for response_line in response.iter_lines():
           if response_line:
               json_response = json.loads(response_line)
               print(json.dumps(json_response, indent=4, sort_keys=True))
               if response.status_code != 200:
                   print(response.headers)
                   raise Exception(
                       "Request returned an error: {} {}".format(
                           response.status_code, response.text
                       )
                   )
```

<div id="local-datacenter-support">
  #### 本地数据中心支持
</div>

为了优化延迟，Powerstream 提供了一个选项，只获取在建立连接所在本地数据中心中发出或创建的帖子。这样可以避免复制滞后，相比来自其他数据中心的帖子实现更快速的投递。要启用此功能，请在流端点后追加查询参数 `?localDcOnly=true`（例如：`/2/powerstream?localDcOnly=true`）。你所连接的数据中心会在流的初始数据负载中以及响应的 HTTP 头部中标示。

在代码中使用方式如下：

```python
# 仅用于本地数据中心：
stream_url = "https://api.x.com/2/powerstream?localDcOnly=true"
```

如果启用了 `localDcOnly` 参数，当流首次建立连接时，响应头中会包含以下响应头，用于指示正在使用的本地数据中心：

```bash
'x-powerstream-datacenter': 'atla',
'x-powerstream-localdconly': 'true'
```

除此之外，它还会发送一个初始数据载荷，用于指定数据中心：

```bash
{
    "type": "connection_metadata",
    "datacenter": "atla",
    "timestamp": 1762557264155
}
```

<Note>
  **提示：** 为了优化延迟，请从不同的地理位置建立连接（例如，一个靠近美国东海岸的亚特兰大，另一个靠近美国西海岸的波特兰），并为每个连接启用 `localDcOnly=true`。这样可以更快速地访问各自数据中心中的帖子。请在你端将这些流进行聚合，以合并跨数据中心的数据。
</Note>

<div id="operators">
  ## 运算符
</div>

要设置过滤规则，可以使用关键字和运算符。请参阅下方可用运算符列表。

<div id="field-based-operators">
  ### 字段运算符
</div>

<div id="user-operators">
  #### 用户运算符
</div>

| 运算符 | 摘要 | 示例 |
|----------|---------|---------|
| `from:` | 匹配来自特定用户的帖子 | `from:xdevelopers` 或 `from:123456` |
| `to:` | 匹配发给特定用户的帖子 | `to:jvaleski` |
| `retweets_of:` | 匹配转发特定用户帖子 的帖子 | `retweets_of:xdevelopers` |

<div id="content-operators">
  #### 内容运算符
</div>

| 运算符 | 概要 | 示例 |
|----------|---------|---------|
| `contains:` | 匹配包含特定文本或关键词的帖子 | `contains:hello` 或 `contains:-2345.432` |
| `url_contains:` | 匹配其 URL 中包含特定文本的帖子 | `url_contains:"com/willplayforfood"` |
| `lang:` | 匹配使用特定语言的帖子 | `lang:en` |

<div id="entity-operators">
  #### 实体运算符
</div>

| 运算符 | 说明 | 示例 |
|----------|---------|---------|
| `has:` | 匹配包含特定实体的帖子（可选值：mentions、geo、links、media、lang、symbols、images、videos） | `has:images`, `has:geo`, `has:mentions` |
| `is:` | 匹配特定类型或具有特定属性的帖子（可选值：retweet、reply） | `is:retweet`, `is:reply` |

<div id="location-operators">
  #### 位置运算符
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `place:` | 匹配来自特定地点或位置的帖子 | `place:"Belmont Central"`, `place:02763fa2a7611cf3` |
| `bounding_box:` | 匹配位于地理边界框内的帖子 | `bounding_box:[-112.424083 42.355283 -112.409111 42.792311]` |
| `point_radius:` | 匹配位于某个点一定半径范围内的帖子 | `point_radius:[-111.464973 46.371179 25mi]`, `point_radius:[-111.464973 46.371179 15km]` |

<div id="advancedcontent-operators">
  #### 高级/内容运算符
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `bio:` | 匹配来自个人简介中包含特定内容的用户所发布的帖子（使用短语匹配） | N/A |
| `bio_name:` | 匹配来自个人简介中包含特定姓名的用户所发布的帖子（使用短语匹配） | N/A |

<div id="additional-operators">
  #### 其他运算符
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `retweets_of_status_id:` | 匹配针对特定帖子的转发 | `retweets_of_status_id:1234567890123456789` |
| `in_reply_to_status_id:` | 匹配针对特定帖子的回复 | `in_reply_to_status_id:1234567890123456789` |

<div id="non-field-operators">
  ### 非字段运算符
</div>

<div id="special-syntax-operators">
  #### 特殊语法运算符
</div>

| 运算符 | 说明 | 示例 |
|----------|---------|---------|
| `@` | 提及运算符 | `@username` |
| 短语匹配 | 匹配完全相同的短语 | `"exact phrase"` |

<div id="logical-operators">
  #### 逻辑运算符
</div>

| 运算符 | 说明 | 示例 |
|----------|---------|---------|
| `OR` | 表达式之间的逻辑“或” | `x OR facebook` |
| 空格/AND | 表达式之间的逻辑“与” | `x facebook`（两个词都必须出现） |
| `()` | 对复杂表达式进行分组 | `(x OR facebook) iphone` |
| `-` | 否定/排除 | `x -facebook`（包含 x 但不包含 facebook） |

<div id="responses">
  ## 响应
</div>

Powestream API 的有效负载格式与旧版 GNIP PowerTrack API 相同。示例 JSON 响应如下：

```json
[
   {
       "created_at": "Tue Mar 21 20:50:14 +0000 2006",
       "id": 20,
       "id_str": "20",
       "text": "just setting up my twttr",
       "truncated": false,
       "entities": {
           "hashtags": [],
           "symbols": [],
           "user_mentions": [],
           "urls": []
       },
       "source": "<a href=\"http://x.com\" rel=\"nofollow\">X Web Client</a>",
       "in_reply_to_status_id": null,
       "in_reply_to_status_id_str": null,
       "in_reply_to_user_id": null,
       "in_reply_to_user_id_str": null,
       "in_reply_to_screen_name": null,
       "user": {
           "id": 12,
           "id_str": "12",
           "name": "jack",
           "screen_name": "jack",
           "location": "",
           "description": "no state is the best state",
           "url": "https://t.co/ZEpOg6rn5L",
           "entities": {
               "url": {
                   "urls": [
                       {
                           "url": "https://t.co/ZEpOg6rn5L",
                           "expanded_url": "http://primal.net/jack",
                           "display_url": "primal.net/jack",
                           "indices": [
                               0,
                               23
                           ]
                       }
                   ]
               },
               "description": {
                   "urls": []
               }
           },
           "protected": false,
           "followers_count": 6427829,
           "friends_count": 3,
           "listed_count": 32968,
           "created_at": "Tue Mar 21 20:50:14 +0000 2006",
           "favourites_count": 36306,
           "utc_offset": null,
           "time_zone": null,
           "geo_enabled": true,
           "verified": false,
           "statuses_count": 30134,
           "lang": null,
           "contributors_enabled": false,
           "is_translator": false,
           "is_translation_enabled": false,
           "profile_background_color": "EBEBEB",
           "profile_background_image_url": "http://abs.twimg.com/images/themes/theme7/bg.gif",
           "profile_background_image_url_https": "https://abs.twimg.com/images/themes/theme7/bg.gif",
           "profile_background_tile": false,
           "profile_image_url": "http://pbs.twimg.com/profile_images/1661201415899951105/azNjKOSH_normal.jpg",
           "profile_image_url_https": "https://pbs.twimg.com/profile_images/1661201415899951105/azNjKOSH_normal.jpg",
           "profile_banner_url": "https://pbs.twimg.com/profile_banners/12/1742427520",
           "profile_link_color": "990000",
           "profile_sidebar_border_color": "DFDFDF",
           "profile_sidebar_fill_color": "F3F3F3",
           "profile_text_color": "333333",
           "profile_use_background_image": true,
           "has_extended_profile": true,
           "default_profile": false,
           "default_profile_image": false,
           "following": null,
           "follow_request_sent": null,
           "notifications": null,
           "translator_type": "regular",
           "withheld_in_countries": []
       },
       "geo": null,
       "coordinates": null,
       "place": null,
       "contributors": null,
       "is_quote_status": false,
       "retweet_count": 122086,
       "favorite_count": 263321,
       "favorited": false,
       "retweeted": false,
       "lang": "en"
   }
]
```

<div id="limits-best-practices">
  ## 限制与最佳实践
</div>

* 速率限制：规则管理为 50 次请求/24 小时；流没有限制（但受连接数限制）。
* 重新连接：在断开连接后使用指数退避重连策略。
* 监控：使用 `Connection: keep-alive` 请求头。