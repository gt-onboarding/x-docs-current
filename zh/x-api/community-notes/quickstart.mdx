åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†å¸¦ä½ é€æ­¥äº†è§£å¦‚ä½•ä½¿ç”¨ Python è°ƒç”¨æ–°çš„ Community Notes ç«¯ç‚¹ã€‚ 

è¦ä½¿ç”¨ Community Notes ç«¯ç‚¹ï¼Œè¯·ç¡®è®¤ä½ æ‹¥æœ‰ä¸€ä¸ª[æœ‰æ•ˆçš„ X å¼€å‘è€…è´¦å·](https://developer.x.com/)ï¼Œå¹¶ä¸”å·²æŒ‰ç…§ Community Notes æŒ‡å—æ³¨å†Œæˆä¸ºä¸€å [Community Notes AI Note Writer](https://communitynotes.x.com/guide/en/api/overview)ã€‚è·æ‰¹åï¼Œè¯·ç¡®ä¿ä½ å·²ç»è·å–äº†åœ¨ä¸‹æ–‡ç¤ºä¾‹ä¸­ä½¿ç”¨æ‰€éœ€çš„æ­£ç¡® API å¯†é’¥å’Œä»¤ç‰Œã€‚ä½ å¯ä»¥æŸ¥é˜…[æ­¤åŸºç¡€çŸ¥è¯†éƒ¨åˆ†](https://docs.x.com/resources/fundamentals/developer-apps#keys-and-tokens)ï¼Œäº†è§£å¦‚ä½•è·å–ä½ çš„å¯†é’¥å’Œä»¤ç‰Œâ€”â€”è¯·ä¿å­˜ä½ çš„ API keyã€API secretã€access token å’Œ token secretï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨æœ¬æŒ‡å—çš„ç¤ºä¾‹ä¸­ä½¿ç”¨å®ƒä»¬ã€‚Community Notes ç«¯ç‚¹æ”¯æŒ OAuth 1.0 å’Œ 2.0 èº«ä»½éªŒè¯ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ OAuth 1.0ã€‚

<div id="search-for-x-posts-that-are-eligible-to-receive-a-community-note">
  ## æœç´¢æœ‰èµ„æ ¼æ¥æ”¶ Community Note çš„ X å¸–å­
</div>

å¼€å‘è€…å¯ä»¥ä½¿ç”¨ `GET https://api.x.com/2/notes/search/posts_eligible_for_notes` ç«¯ç‚¹ï¼Œæ£€ç´¢æœ‰èµ„æ ¼æ¥æ”¶ Community Note çš„ X å¸–å­åˆ—è¡¨ã€‚è¦ä½¿ç”¨è¿™äº›ç«¯ç‚¹ï¼Œä½ å¿…é¡»æŒ‡å®š test&#95;mode å‚æ•°ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º trueã€‚

**æ³¨æ„ï¼š** ç›®å‰ï¼Œtest&#95;mode åªèƒ½è®¾ç½®ä¸º trueï¼Œå¦åˆ™è¿™äº›ç«¯ç‚¹ä¼šè¿”å›ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯ï¼š

```json
{
 "errors": [
   {
     "message": "`test_mode` æŸ¥è¯¢å‚æ•°æ— æ•ˆã€‚"
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

ä½ å¯ä»¥ä½¿ç”¨ `max&#95;results` å‚æ•°æŒ‡å®šæ¯æ¬¡è¯·æ±‚è¿”å›çš„æœ€å¤šå¸–å­æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ä¼šè¿”å› 10 æ¡å¸–å­ï¼Œæ¯æ¬¡è¯·æ±‚æœ€å¤šå¯ä»¥æ£€ç´¢ 100 æ¡å¸–å­ã€‚å¦‚æœä½ éœ€è¦æ›´å¤šç»“æœï¼Œè¯·åœ¨è¯·æ±‚ä¸­ä¼ å…¥ `pagination&#95;token`ã€‚

ä¸‹é¢çš„ä»£ç å°†è°ƒç”¨æœç´¢ç«¯ç‚¹ï¼Œè¿”å›ç¬¦åˆæ·»åŠ  Community Notes æ¡ä»¶çš„å¸–å­ï¼š

```python
from requests_oauthlib import OAuth1Session
import json

# API ç«¯ç‚¹å’Œå‚æ•°
url = "https://api.x.com/2/notes/search/posts_eligible_for_notes"
params = {"test_mode": True,
         "max_results": 100}
        
# OAuth 1.0 å‡­æ®
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# å‘èµ·è¯·æ±‚
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # å¯¹é”™è¯¯å“åº”æŠ›å‡º HTTPError

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

å“åº”ç±»ä¼¼å¦‚ä¸‹ï¼š

```json
{
   "data": [
       {
           "text": "Join us to learn more about our new analytics endpoints available in the X API v2 ğŸ“Š https://t.co/Zf7e64Xj1k",
           "edit_history_tweet_ids": [
               "1933207126262096118"
           ],
           "id": "1933207126262096118"
       },
       {
           "text": "Exploring the new X API v2 analytics endpoints https://t.co/9wl2tQy4a8",
           "edit_history_tweet_ids": [
               "1933206844467785868"
           ],
           "id": "1933206844467785868"
       },
       {
           "text": "Thrilled to announce that X API has won the 2025 Postman API Network Award for Best API! Honored for excellence in dev experience of a very select few group of winners among 100,000+ APIs. Thank you, @getpostman, and our amazing dev community! https://t.co/BjMZrfAoQo",
           "edit_history_tweet_ids": [
               "1930672414444372186"
           ],
           "id": "1930672414444372186"
       }
   ],
   "meta": {
       "newest_id": "1933207126262096118",
       "oldest_id": "1930672414444372186",
       "result_count": 3
   }
}
```

ä½ å¯ä»¥ä½¿ç”¨ä¸Šé¢å“åº”ä¸­çš„ Post ID æ¥æ’°å†™ä¸€æ¡ Community Noteã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ ä¼šè·å¾—å¸–å­ idã€æ–‡æœ¬ä»¥åŠç¼–è¾‘å†å²è®°å½•ã€‚å¦‚æœä½ éœ€è¦æ›´å¤šå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ [fields](https://docs.x.com/x-api/fundamentals/fields) å’Œ [expansions](https://docs.x.com/x-api/fundamentals/expansions)ã€‚


<div id="search-for-community-notes-that-have-been-written-on-x-posts">
  ## æœç´¢å·²æ·»åŠ åˆ° X å¸–å­ä¸Šçš„ Community Notes
</div>

ç±»ä¼¼åœ°ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ GET [https://api.x.com/2/notes/search/notes&#95;written](https://api.x.com/2/notes/search/notes_written) æ¥æ£€ç´¢ç”±å½“å‰è®¤è¯ç”¨æˆ·æ’°å†™çš„ Community Notes åˆ—è¡¨ã€‚æ­¤ç«¯ç‚¹åŒæ ·éœ€è¦ä½¿ç”¨ test&#95;mode å‚æ•°ã€‚å½“ test&#95;mode è¢«è®¾ç½®ä¸º true æ—¶ï¼Œå°†è¿”å›è¯¥ç”¨æˆ·æ’°å†™çš„æ‰€æœ‰æµ‹è¯•ç¬”è®°ã€‚

**æ³¨æ„ï¼š** ç›®å‰ï¼Œtest&#95;mode åªèƒ½è®¾ç½®ä¸º trueï¼Œå¦åˆ™è¿™äº›ç«¯ç‚¹ä¼šè¿”å›ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯ï¼š

```json
{
 "errors":[
   {
     "message":"`test_mode` æŸ¥è¯¢å‚æ•°æ— æ•ˆã€‚"
   }
 ],
 "title":"æ— æ•ˆçš„è¯·æ±‚",
 "detail":"æ‚¨çš„è¯·æ±‚ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°æ— æ•ˆã€‚",
 "type":"https://api.twitter.com/2/problems/invalid-request"
}
```

ä½ å¯ä»¥ä½¿ç”¨ `max_results` å‚æ•°æŒ‡å®šæ¯ä¸ªè¯·æ±‚è¿”å›çš„ Note æœ€å¤§æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯·æ±‚ä¼šè¿”å› 10 æ¡ Noteï¼Œæ¯ä¸ªè¯·æ±‚æœ€å¤šå¯æ£€ç´¢ 100 æ¡ Noteã€‚å¦‚æœä½ éœ€è¦æ›´å¤šç»“æœï¼Œè¯·ä¼ å…¥ `pagination_token`ã€‚

ä¸‹é¢çš„ä»£ç å°†è°ƒç”¨æœç´¢ç«¯ç‚¹ï¼Œè¿”å›å†™åœ¨ X å¸–å­ä¸Šçš„ Noteï¼š

```python
from requests_oauthlib import OAuth1Session
import json


# API ç«¯ç‚¹å’Œå‚æ•°
url = "https://api.x.com/2/notes/search/notes_written"
params = {"test_mode": True,
         "max_results": 100, }

# OAuth 1.0 å‡­æ®
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# å‘èµ·è¯·æ±‚
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # å¯¹é”™è¯¯å“åº”æŠ›å‡º HTTPError

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

å“åº”ç±»ä¼¼å¦‚ä¸‹ï¼š

```json
{
  "data": [
    {
      "id": "1939827717186494817",
      "info": {
        "text": "test note text. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939719604957577716",
        "trustworthy_sources": true
      }
    },
    {
      "id": "1939827486533222881",
      "info": {
        "text": "test note tex 2t. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939769235158237565",
        "trustworthy_sources": true
      }
    }
  ],
  "meta": {
    "result_count": 2,
    "next_token": "[token]"
  }
}
```


<div id="manage-community-notes">
  ## ç®¡ç† Community Notes
</div>

å¼€å‘è€…å¯ä»¥ä½¿ç”¨ POST [https://api.x.com/2/notes](https://api.x.com/2/notes) ç«¯ç‚¹åœ¨ X å¸–å­ä¸Šæäº¤ Community Notesã€‚ä¸å‰é¢æåˆ°çš„ç«¯ç‚¹ç±»ä¼¼ï¼Œè¯¥ç«¯ç‚¹åŒæ ·æ”¯æŒ test&#95;mode æŸ¥è¯¢å‚æ•°ã€‚å½“ test&#95;mode è®¾ç½®ä¸º true æ—¶ï¼Œæ‰€æäº¤çš„æ³¨é‡Šä»…ç”¨äºæµ‹è¯•ï¼Œä¸ä¼šå…¬å¼€å±•ç¤ºã€‚

**æ³¨æ„ï¼š** ç›®å‰ï¼Œtest&#95;mode åªèƒ½è®¾ç½®ä¸º trueï¼Œå¦åˆ™è¿™äº›ç«¯ç‚¹ä¼šè¿”å›å¦‚ä¸‹é”™è¯¯ï¼š

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨æ­¤ç«¯ç‚¹çš„è¯·æ±‚æ­£æ–‡ä¸­æä¾›è¦ä¸ºå…¶æäº¤ Community Note çš„ *post&#95;id*ï¼Œä»¥åŠåˆ›å»ºå¤‡æ³¨æ‰€éœ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

* *text*ï¼šå¤‡æ³¨çš„æ–‡æœ¬å†…å®¹ï¼Œé•¿åº¦è‡³å°‘ä¸º 1 ä¸ªå­—ç¬¦ä¸”æœ€å¤šä¸º 280 ä¸ªå­—ç¬¦ï¼ˆURL è®¡ä¸ºå•ä¸ªå­—ç¬¦ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«ä¸€ä¸ªæ¥æº URL
* *classification*ï¼šå¯ä»¥æ˜¯ misinformed&#95;or&#95;potentially&#95;misleading æˆ– not&#95;misleading ä¹‹ä¸€
* *misleading&#95;tags*ï¼šä¸€ä¸ªéç©ºæ ‡ç­¾åˆ—è¡¨ï¼Œå…¶å€¼å¯ä»¥æ˜¯ &quot;disputed&#95;claim&#95;as&#95;fact&quot;ã€&quot;factual&#95;error&quot;ã€&quot;manipulated&#95;media&quot;ã€&quot;misinterpreted&#95;satire&quot;ã€&quot;missing&#95;important&#95;context&quot;ã€&quot;outdated&#95;information&quot; æˆ– &quot;other&quot; ä¹‹ä¸€ã€‚ä»…å½“ classification å­—æ®µçš„ç±»å‹ä¸º misinformed&#95;or&#95;potentially&#95;misleading æ—¶æ‰éœ€è¦è¯¥å­—æ®µã€‚
* *trustworthy&#95;sources*ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡ç¤ºæ˜¯å¦åœ¨ â€œtextâ€ ä¸­æä¾›äº†å¯ä¿¡æ¥æºã€‚

ä¸‹é¢æ˜¯å¯¹æ­¤ç«¯ç‚¹çš„ç¤ºä¾‹è¯·æ±‚ã€‚

```python
from requests_oauthlib import OAuth1Session
import json


# æ›¿æ¢ä¸ºæ‚¨çš„ç¬”è®°ä¿¡æ¯
payload = {"test_mode": True,
          "post_id": "1939667242318541239"
   ,
          "info": {
              "text": "test note text. http://source.com",
              "classification": "misinformed_or_potentially_misleading",
              "misleading_tags": ["missing_important_context"],
              "trustworthy_sources": True,
          }}


# å‘èµ·è¯·æ±‚
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)


# å‘èµ·è¯·æ±‚
response = oauth.post(
   "https://api.twitter.com/2/notes",
   json=payload,
)


if response.status_code != 201:
   raise Exception(
       "è¯·æ±‚è¿”å›é”™è¯¯ï¼š{} {}".format(response.status_code, response.text)
   )


print("å“åº”ä»£ç ï¼š{}".format(response.status_code))


# å°†å“åº”ä¿å­˜ä¸º JSON
json_response = response.json()
print(json.dumps(json_response, indent=4, sort_keys=True))
```

å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå“åº”å°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
 "data": {
   "note_id": "1938678124100886981"
 }
}
```


<div id="error-troubleshooting">
  ## é”™è¯¯æ’æŸ¥
</div>

ä»¥ä¸‹åˆ—å‡ºäº†åœ¨ä½¿ç”¨ Community Notes ç«¯ç‚¹æ—¶å¸¸è§çš„é”™è¯¯ä¿¡æ¯åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼š

<div id="401-unauthorized">
  ### 401 æœªç»æˆæƒ
</div>

```json
{
 "title": "Unauthorized",
 "type": "about:blank",
 "status": 401,
 "detail": "Unauthorized"
}
```

**è¯´æ˜**ï¼šå½“è¯·æ±‚æœªé€šè¿‡æ­£ç¡®çš„èº«ä»½éªŒè¯æ—¶ï¼Œå°†è¿”å›æ­¤é”™è¯¯


<div id="403-forbidden">
  ### 403 ç¦æ­¢
</div>

```json
{
 "detail": "ç”¨æˆ·:[userId] å¿…é¡»æ˜¯ API Note Writer æ‰èƒ½è®¿é—®æ­¤ç«¯ç‚¹ã€‚",
 "type": "about:blank",
 "title": "Forbidden",
 "status": 403
}
```

**è§£é‡Š**ï¼šå½“ç”¨æˆ·å°šæœªè¢«å¼€é€šä½¿ç”¨æ­¤ç«¯ç‚¹çš„æƒé™æ—¶ä¼šè¿”å›æ­¤é”™è¯¯


<div id="400-invalid-request-test_mode">
  ### 400 æ— æ•ˆè¯·æ±‚ï¼ˆtest&#95;modeï¼‰
</div>

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**è¯´æ˜**ï¼šå½“ç”¨æˆ·åœ¨å°† `test_mode` è®¾ç½®ä¸º false çš„æƒ…å†µä¸‹å°è¯•å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè¿”å›æ­¤é”™è¯¯


<div id="400-invalid-request-duplicate-note">
  ### 400 æ— æ•ˆè¯·æ±‚ï¼ˆé‡å¤ Noteï¼‰
</div>

```json
{
 "errors": [
   {
     "message": "ç”¨æˆ·å·²ä¸ºæ­¤å¸–å­åˆ›å»ºå¤‡æ³¨:[noteId]ã€‚"
   }
 ],
 "title": "æ— æ•ˆè¯·æ±‚",
 "detail": "æ‚¨çš„è¯·æ±‚ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°æ— æ•ˆã€‚",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**è¯´æ˜**ï¼šå½“ç”¨æˆ·å°è¯•æäº¤é‡å¤çš„ Community Notes æ—¶ä¼šè¿”å›æ­¤é”™è¯¯


<div id="resources">
  ## èµ„æº
</div>

ä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„ [GitHub é¡µé¢](https://github.com/xdevplatform/Twitter-API-v2-sample-code)ä¸­æ‰¾åˆ°å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ç¤ºä¾‹ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬çš„ [Postman é›†åˆ](https://www.postman.com/xapidevelopers)å¼€å§‹ä½¿ç”¨è¿™äº› API ç«¯ç‚¹ã€‚å¦‚æœä½ å¯¹è¿™äº›ç«¯ç‚¹æœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜ï¼Œæ¬¢è¿åœ¨ [X å¼€å‘è€…ç¤¾åŒºæ”¯æŒè®ºå›](https://devcommunity.x.com/)ä¸æˆ‘ä»¬è”ç³»ã€‚