---
title: 使用 v2 全量归档搜索端点获取历史帖子
mode: wide
keywords: ["full archive search", "historical search", "historical tweets", "archive search", "search tutorial", "historical data", "full archive"]
---

<div id="introduction">
  ## 介绍
</div>

在 v2 中，[Search Posts 端点](/zh/x-api/posts/search/introduction)
使你能够根据自己构建的搜索查询，获取与你感兴趣主题相关的帖子。对于 v2 Search Posts，我们提供两个不同的端点：最近搜索（recent search），对所有已获批准账户的开发者开放，可搜索最多可追溯 7 天的帖子；以及全归档搜索（full-archive search），仅向已获批准加入
[Academic Research 产品路径](https://developer.x.com/en/products/x-api/early-access/guide#na_2)
的研究人员开放，可在整个帖子存档中进行搜索，最早可追溯到 2006 年 3 月。

你可以在我们的
[搜索概览页面](/zh/x-api/posts/search/introduction)
查看完整的搜索能力。

这些 Search Posts 端点覆盖了学术研究人员最常见的用例之一，他们可能会将其用于纵向研究，或分析历史主题或事件。

本教程为希望使用全归档搜索端点来检索 X 公共数据完整历史记录的研究人员提供逐步指南。它还将演示构建数据集的不同方式，例如检索带地理标签的帖子，以及如何在某个查询的可用帖子中进行分页浏览。

<div id="prerequisites">
  ### 先决条件
</div>

目前，此 endpoint 仅作为
[Academic Research 产品线](https://developer.x.com/en/solutions/academic-research/products-for-researchers) 的一部分提供。
要使用此 endpoint，你必须
[申请访问权限](https://developer.x.com/en/portal/petition/academic/is-it-right-for-you)。
进一步了解该产品线的
[申请流程和要求](https://developer.x.com/en/solutions/academic-research/application-info)。

<div id="connect-an-app-to-the-academic-project">
  ### 将应用连接到学术项目
</div>

在你获批使用 Academic Research 产品路径后，你会在
[开发者门户](https://developer.x.com/en/portal/dashboard) 中看到你的 Academic
[Project](/zh/resources/fundamentals/projects)。在“Projects and Apps”部分，点击“Add App”，将你的
[X App](/zh/resources/fundamentals/developer-apps) 连接到该项目。

[](https://res.cloudinary.com/practicaldev/image/fetch/s--gHFOyuDc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/gb7aevhqyfvfjznd0pnd.png)

![此图像展示了在开发者门户中的一个 Academic Project，目前尚未向其添加任何 App](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-1.png.twimg.1920.png)

接着，你可以选择一个现有的 App 并将其连接到你的项目（如下所示）。

![此图像展示了当你尝试向 Academic Project 添加 App 时弹出的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-2.png.twimg.1920.png)

或者，你可以创建一个新的 App，为其命名并点击完成，将一个新的 App 连接到你的 Academic Project。

![此图像展示了你为新 App 输入名称或选择现有 App 的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-3.png.twimg.1920.png)

这样，你就会获得 API 密钥和
[Bearer Token](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)，然后你就可以使用这些来连接到 full-archive search 端点。

![此图像展示了你创建新 App 后看到的页面，该页面显示了你的密钥和令牌](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-4.png.twimg.1920.png)

**请注意**

上方截图中的密钥已被隐藏，但在你自己的开发者门户中，
你将能够看到 API Key、API Secret Key 和
Bearer Token 的实际值。请保存这些密钥和 Bearer Token，因为在调用 full-archive search 端点时你将需要它们。

<div id="connecting-to-the-full-archive-search-endpoint">
  ### 连接到完整归档搜索端点
</div>

下面的 cURL 命令演示如何从 @XDevelopers 账号获取历史帖子。将 $BEARER&#95;TOKEN 替换为你自己的 Bearer Token，将完整请求粘贴到终端，然后按下回车键。

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers' --header 'Authorization: Bearer $BEARER_TOKEN'
```

你将看到响应的 JSON 数据。

默认情况下，只会返回最近的 10 条帖子。如果你希望每次请求获取超过 10 条帖子，可以使用 `max_results` 参数，并将其设置为每次请求最多返回 500 条帖子，如下所示：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

构建查询

如上面的示例调用所示，通过使用 `query` 参数，你可以
指定想要搜索的内容。举例来说，如果你想
获取所有包含单词 *covid* 或单词 *coronavirus* 的帖子，可以
在括号中使用 OR 运算符，将查询写成
`(covid OR coronavirus)`，这样你的 API 调用将如下所示：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=(covid%20OR%20coronavirus)&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

类似地，如果你想获取所有包含 *covid19* 且不是转帖的帖子，你可以使用 is:retweet 运算符并结合逻辑非（用 - 表示），因此你的查询可以是 covid19 -is:retweet，而你的 API 调用将是：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=covid19%20-is:retweet&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

请查阅
[本指南，了解完整的运算符列表](/zh/x-api/posts/search/integrate/build-a-query)
这些运算符都在完整归档搜索端点中受支持。

<div id="using-the-start_time-and-end_time-parameters-to-get-historical-posts">
  ### 使用 start&#95;time 和 end&#95;time 参数获取历史帖子
</div>

在使用完整归档搜索端点时，默认会返回过去 30 天的帖子。如果你想获取早于 30 天的帖子，可以在 API 调用中使用 start&#95;time 和 end&#95;time 参数。这些参数必须采用有效的 RFC3339 日期时间格式，例如 2020-12-21T13:00:00.00Z。因此，如果你想获取 XDevelopers 账号在 2020 年 12 月的所有帖子，你的 API 调用将是：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:XDevelopers&start_time=2020-12-01T00:00:00.00Z&end_time=2021-01-01T00:00:00.00Z' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

获取带地理位置标记的历史帖子

所谓带地理位置标记的帖子，是指关联了城市、省/州、国家等地理信息的帖子。

<div id="using-hasgeo-operator">
  #### 使用 has:geo 运算符
</div>

如果你想获取包含地理位置信息（geo 数据）的帖子，可以使用 has:geo 运算符。
例如，以下 cURL 请求将只获取来自
@XDevelopers 账号且包含地理位置信息的帖子：

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20has:geo' --header
'Authorization: Bearer $BEARER_TOKEN'
```

<div id="using-place_country-operator">
  #### 使用 place&#95;country 运算符
</div>

同样，你可以使用 place&#95;country 运算符，将带有地理位置信息的帖子限定为某个特定国家。下面的 cURL 命令将获取来自 @XDevelopers 账号、位于美国的所有帖子：

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20place_country:US'
--hbasheader 'Authorization: Bearer XXXXX'
```

上面的国家/地区是通过 ISO alpha-2 两位字母代码指定的。可用的 ISO 代码列表请参见[此处](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)。

<div id="getting-more-than-500-historical-posts-using-the-next_token">
  ### 使用 next&#95;token 获取超过 500 条历史帖子
</div>

如上所述，默认情况下，对完整归档搜索端点的查询，每个请求最多只能获取 500 条帖子。
如果你的查询结果中有超过 500 条可用帖子，你的 JSON 响应中会包含一个 next&#95;token，
你可以将其附加到 API 调用中，以获取该查询的下一批可用帖子。
这个 next&#95;token 位于 JSON 响应的 meta 对象中，其结构大致如下：

```
{ "newest_id": "12345678...", "oldest_id": "12345678...", "result_count": 500,
"nebashxt_token": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" }
```

因此，要获取下一批可用的帖子，请从该 meta 对象中取出 next&#95;token 的值，并在对完整归档搜索端点的 API 调用中将其作为 next&#95;token 的值使用，如下所示（你将使用自己的 Bearer Token，以及在上一次 API 调用中获得的 next&#95;token 值）。

```
curl --request GET
'https://api.x.com/2/tweets/search/all?max_results=500&query=covid&next_token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
--header 'Authorization: Bearer $BEARER_TOKEN'
```

通过这种方式，你可以不断检查是否有可用的 `next_token`，如果你尚未达到希望收集的帖子数量，就可以在每个请求中使用新的 `next_token` 继续调用 full-archive 搜索端点。请记住，full-archive 搜索端点会计入你的总体
[Post cap](/zh/x-api/fundamentals/post-cap)，也就是你每个月可以通过 X API 从每个
[项目](/zh/resources/fundamentals/projects) 获取的帖子数量上限，因此在对结果进行分页时，请谨慎设计你的代码逻辑，以确保不会在无意中耗尽你的 Post cap。

下面是一些在使用 full-archive 搜索端点时可供参考的资源。我们非常期待听到你的反馈。如对该端点有任何问题，请通过
[@XDevelopers](https://x.com/XDevelopers) 或我们的
[开发者社区论坛](https://devcommunity.x.com/) 与我们联系。

<div id="additional-resources">
  ### 其他资源
</div>

* [完整归档搜索端点 API 参考](/zh/x-api/posts/full-archive-search)
* [了解构建搜索查询的基础知识](/zh/x-api/posts/search/integrate/build-a-query)