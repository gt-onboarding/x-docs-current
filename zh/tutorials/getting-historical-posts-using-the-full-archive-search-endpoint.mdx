---
title: 通过 v2 全量存档搜索端点获取历史帖子
mode: wide
keywords: ["全量存档搜索", "历史搜索", "历史帖子", "存档搜索", "搜索教程", "历史数据", "全量存档"]
---

<div id="introduction">
  ## 简介
</div>

在 v2 中，[Search Posts 端点](/zh/x-api/posts/search/introduction)
可以根据你提供的搜索查询，为你返回与你感兴趣主题相关的帖子。v2 的 Search Posts
提供了两个不同的端点：recent search（最近搜索），对所有已获批准账号的开发者开放，
可以搜索最近最多七天内发布的帖子；以及 full-archive search（完整存档搜索），仅向已获批准加入
[Academic Research 产品路径](https://developer.x.com/en/products/x-api/early-access/guide#na_2)
的研究人员开放，可以在从 2006 年 3 月起的完整帖子存档中进行搜索。

你可以在我们的
[搜索概览页面](/zh/x-api/posts/search/introduction)
查看完整的搜索能力。

这些 Search Posts 端点满足了学术研究者最常见的使用场景之一，他们可能会用它来进行纵向研究，
或分析过去的某个主题或事件。

本教程为希望使用 full-archive search 端点来搜索公共 X
数据完整历史的研究人员提供循序渐进的指南。它还将演示构建数据集的不同方式，例如检索带地理标签的帖子，以及如何分页获取某个查询可用的帖子。

<div id="prerequisites">
  ### 先决条件
</div>

目前，此端点仅作为
[Academic Research product track](https://developer.x.com/en/solutions/academic-research/products-for-researchers)
的一部分提供。
若要使用此端点，您必须先
[申请访问权限](https://developer.x.com/en/portal/petition/academic/is-it-right-for-you)。
详细了解此产品通道的
[申请流程和要求](https://developer.x.com/en/solutions/academic-research/application-info)。

<div id="connect-an-app-to-the-academic-project">
  ### 将应用连接到学术项目
</div>

一旦你获批准使用 Academic Research 产品路径，你将在
[developer portal](https://developer.x.com/en/portal/dashboard) 中看到你的 Academic
[Project](/zh/resources/fundamentals/projects)。在 “Projects and Apps” 部分，点击 “Add App”，将你的
[X App](/zh/resources/fundamentals/developer-apps) 连接到该 Project。

[](https://res.cloudinary.com/practicaldev/image/fetch/s--gHFOyuDc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/gb7aevhqyfvfjznd0pnd.png)

![此图展示了在 developer portal 中尚未添加 App 的 Academic Project](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-1.png.twimg.1920.png)

接下来，你可以选择一个已有的 App，并将其连接到你的项目（如下所示）。

![此图展示了当你尝试向 Academic Project 添加 App 时弹出的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-2.png.twimg.1920.png)

或者，你也可以创建一个新的 App，为其命名并点击完成，将一个新的
App 连接到你的 Academic Project。

![此图展示了你为新 App 输入名称或选择已有 App 的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-3.png.twimg.1920.png)

这样你就会获得 API keys 和
[Bearer Token](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)，随后你就可以使用它们来连接到完整存档搜索端点。

![此图展示了你创建新 App 后显示密钥和令牌的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-4.png.twimg.1920.png)

**请注意**

上面截图中的密钥是隐藏的，但在你自己的 developer portal 中，
你将能够看到 API Key、API Secret Key 和
Bearer Token 的实际值。请保存这些密钥和 Bearer Token，因为在调用完整存档搜索端点时你会需要它们。

<div id="connecting-to-the-full-archive-search-endpoint">
  ### 连接到完整归档搜索端点
</div>

下面的 cURL 命令演示了如何从 @XDevelopers 账号获取历史帖子。将 $BEARER&#95;TOKEN 替换为你自己的 Bearer Token，把完整请求粘贴到终端中，然后按下“回车”键。

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers' --header 'Authorization: Bearer $BEARER_TOKEN'
```

你会看到一个 JSON 响应。

默认情况下，只会返回最近的 10 条帖子。如果你希望每次请求获取超过 10 条帖子，可以使用 `max_results` 参数，并将其设置为每次请求最多 500 条帖子，如下所示：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

构建查询

如上面的示例调用所示，你可以使用 `query` 参数来指定你想要搜索的内容。比如，如果你想获取所有包含单词 *covid* 或 *coronavirus* 的帖子，可以在括号中使用 OR 运算符，查询可以写成 `(covid OR coronavirus)`，相应的 API 调用如下所示：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=(covid%20OR%20coronavirus)&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

同样地，如果你想获取所有包含 *covid19* 且不是转发的帖子，可以将 is:retweet 运算符与逻辑非运算（用 - 表示）一起使用，这样查询语句可以是 covid19 -is:retweet，对应的 API 调用将是：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=covid19%20-is:retweet&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

请参阅
[本指南以获取完整的运算符列表](/zh/x-api/posts/search/integrate/build-a-query)
这些运算符都受全档案搜索端点支持。

<div id="using-the-start_time-and-end_time-parameters-to-get-historical-posts">
  ### 使用 start&#95;time 和 end&#95;time 参数获取历史帖子
</div>

在使用完整归档搜索端点时，默认会返回最近 30 天的帖子。如果你想获取早于这 30 天的帖子，可以在 API 调用中使用 start&#95;time 和 end&#95;time 参数。这些参数必须采用有效的 RFC3339 日期时间格式，例如 2020-12-21T13:00:00.00Z。因此，如果你想获取 XDevelopers 账户在 2020 年 12 月的所有帖子，你的 API 调用将是：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:XDevelopers&start_time=2020-12-01T00:00:00.00Z&end_time=2021-01-01T00:00:00.00Z' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

获取带地理标记的历史帖子

带地理标记的帖子是指包含城市、州/省、国家等地理信息的帖子。

<div id="using-hasgeo-operator">
  #### 使用 has:geo 运算符
</div>

如果你想获取包含地理位置信息的帖子，可以使用 has:geo 运算符。
例如，下面的 cURL 请求只会获取由 @XDevelopers 账号发布且包含地理位置信息的帖子：

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20has:geo' --header
'Authorization: Bearer $BEARER_TOKEN'
```

<div id="using-place_country-operator">
  #### 使用 place&#95;country 运算符
</div>

同样，你可以使用 place&#95;country 运算符，将带有地理位置信息的帖子限定为来自特定国家。下面的 cURL 命令将获取由 @XDevelopers 账号在美国发布的所有帖子：

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20place_country:US'
--hbasheader 'Authorization: Bearer XXXXX'
```

上文使用 ISO alpha-2 两位字母代码指定了国家/地区。有效的 ISO 代码可以在[此处](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)找到。

<div id="getting-more-than-500-historical-posts-using-the-next_token">
  ### 使用 next&#95;token 获取超过 500 条历史帖子
</div>

如上所述，默认情况下，在查询完整存档搜索端点时，每个请求最多只能获取 500 条帖子。如果你的查询结果中有超过 500 条帖子，你的 JSON 响应中会包含一个 next&#95;token，你可以将其附加到 API 调用中，以获取该查询的下一批可用帖子。这个 next&#95;token 位于 JSON 响应的 meta 对象中，其结构大致如下所示：

```
{ "newest_id": "12345678...", "oldest_id": "12345678...", "result_count": 500,
"nebashxt_token": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" }
```

因此，要获取下一批可用的帖子，请从该 meta 对象中取出 next&#95;token 的值，并在对完整归档搜索端点发起 API 调用时，将其作为 next&#95;token 的值，如下所示（你将使用你自己的 Bearer Token，以及你在上一次 API 调用中获得的 next&#95;token 的值）。

```
curl --request GET
'https://api.x.com/2/tweets/search/all?max_results=500&query=covid&next_token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
--header 'Authorization: Bearer $BEARER_TOKEN'
```

通过这种方式，你可以不断检查是否有可用的 `next_token`，如果你尚未达到想要收集的帖子数量，就可以在每次请求中使用新的 `next_token` 继续调用完整存档端点（full-archive endpoint）。请记住，完整存档搜索端点会计入你的总
[Post cap](/zh/x-api/fundamentals/post-cap)，也就是说，你每月可以通过 X API 在每个
[Project](/zh/resources/fundamentals/projects) 中获取的帖子数量上限。因此，在对结果进行分页时，请谨慎设计代码逻辑，确保不会在无意中耗尽你的 Post cap。

下面是一些在使用完整存档搜索端点时可以为你提供帮助的资源。我们非常期待收到你的反馈。若对该端点有任何问题，请通过
[@XDevelopers](https://x.com/XDevelopers) 或我们的
[社区论坛](https://devcommunity.x.com/) 与我们联系。

<div id="additional-resources">
  ### 其他资源
</div>

* [完整存档搜索端点 API 参考](/zh/x-api/posts/full-archive-search)
* [了解构建搜索查询的基础](/zh/x-api/posts/search/integrate/build-a-query)