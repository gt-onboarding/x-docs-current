---
title: "OAuth2PKCEAuth"
sidebarTitle: "OAuth2PKCEAuth"
---

此模块提供 OAuth2 PKCE（Proof Key for Code Exchange，代码交换证明密钥）身份验证功能，用于安全的授权流程。包括 code verifier 生成、令牌管理以及自动令牌刷新等功能。

<div id="class-xdkoauth2_authoauth2pkceauth">
  ### `class xdk.oauth2_auth.OAuth2PKCEAuth`
</div>

用于 X API 的 OAuth 2.0 PKCE 认证。

<div id="parameters">
  #### 参数
</div>

<ParamField path="path.base_url" type="str" default="'https://api.x.com'"></ParamField>

<ParamField path="path.authorization_base_url" type="str" default="'https://x.com/i'"></ParamField>

<ParamField path="path.client_id" type="str or None" default="None"></ParamField>

<ParamField path="path.client_secret" type="str or None" default="None"></ParamField>

<ParamField path="path.redirect_uri" type="str or None" default="None"></ParamField>

<ParamField path="path.token" type="Dict[str, Any] or None" default="None"></ParamField>

<ParamField path="path.scope" type="str or List[str] or None" default="None"></ParamField>

<div id="__init__">
  ### `__init__`
</div>

初始化 OAuth2 PKCE 身份验证。

<div id="parameters">
  #### 参数
</div>

<ParamField path="path.base_url" type="str" default="'https://api.x.com'">
X API 令牌端点的基础 URL（默认为 [https://api.x.com](https://api.x.com)）。
</ParamField>

<ParamField path="path.authorization_base_url" type="str" default="'https://x.com/i'">
OAuth2 授权的基础 URL（默认为 [https://x.com/i](https://x.com/i)）。
</ParamField>

<ParamField path="path.client_id" type="str or None" default="None">
X API 的 client ID。
</ParamField>

<ParamField path="path.client_secret" type="str or None" default="None">
X API 的 client secret。
</ParamField>

<ParamField path="path.redirect_uri" type="str or None" default="None">
用于 OAuth2 授权的重定向 URI。
</ParamField>

<ParamField path="path.token" type="Dict[str, Any] or None" default="None">
现有的 OAuth2 token 字典（如有）。
</ParamField>

<ParamField path="path.scope" type="str or List[str] or None" default="None">
用于 OAuth2 授权范围（scope）的、以空格分隔的字符串或字符串列表。
</ParamField>

<div id="exchange_code">
  ### `exchange_code`
</div>

将授权码换取令牌（与 TypeScript API 保持一致）。

<div id="parameters">
  #### 参数
</div>

<ParamField path="path.code" type="str">
回调中返回的授权码。
</ParamField>

<ParamField path="path.code_verifier" type="str or None" default="None">
可选的代码校验值（如未提供，则使用已存储的校验值）。
</ParamField>

<div id="returns">
  #### 返回值
</div>

`Dictstr, Any`

<div id="fetch_token">
  ### `fetch_token`
</div>

使用授权响应 URL 获取令牌（旧版方法，内部通过 `exchange_code` 实现）。

<div id="parameters">
  #### 参数
</div>

<ParamField path="path.authorization_response" type="str">
授权完成后收到的完整回调 URL
</ParamField>

<div id="returns">
  #### 返回值
</div>

`Dictstr, Any`

<div id="get_authorization_url">
  ### `get_authorization_url`
</div>

获取 OAuth2 PKCE 流程所需的授权 URL。

<div id="parameters">
  #### 参数
</div>

<ParamField path="path.state" type="str or None" default="None">
用于安全防护的可选 state 参数。
</ParamField>

<div id="returns">
  #### 返回值
</div>

`str`

<div id="get_code_challenge">
  ### `get_code_challenge`
</div>

获取当前的 code challenge（用于 PKCE）。
:returns: 当前的 code challenge，如果未设置则为 None。
:rtype: Optional[str]

<div id="returns">
  #### 返回值
</div>

`str | None`

<div id="get_code_verifier">
  ### `get_code_verifier`
</div>

获取当前的 code verifier（用于 PKCE）。
:returns: 当前的 code verifier，或在未设置时为 None。
:rtype: Optional[str]

<div id="returns">
  #### 返回值
</div>

`str | None`

<div id="is_token_expired">
  ### `is_token_expired`
</div>

检查令牌是否过期。
:returns: 如果令牌已过期则返回 True，否则返回 False。
:rtype: bool

<div id="returns">
  #### 返回值
</div>

`bool`

<div id="refresh_token">
  ### `refresh_token`
</div>

刷新访问令牌。
:returns: 刷新后的访问令牌字典
:rtype: Dict[str, Any]

<div id="returns">
  #### 返回值
</div>

`Dictstr, Any`

<div id="set_pkce_parameters">
  ### `set_pkce_parameters`
</div>

手动配置 PKCE 参数。

<div id="parameters">
  #### 参数
</div>

<ParamField path="path.code_verifier" type="str">
要使用的 code verifier。
</ParamField>

<ParamField path="path.code_challenge" type="str or None" default="None">
可选的 code challenge（如果未提供，将自动生成）。
</ParamField>