---
title: 分页
sidebarTitle: 分页
---

X API 在那些会返回多页结果的端点上（例如时间线、搜索等）使用分页机制。每个 API 调用的响应中都会包含一个带有 `result_count`、`previous_token` 和 `next_token` 的 `meta` 对象。XDK 会自动处理基于 `next_token` 的多次 API 调用，这样开发者只需要指定希望获取的数据量，而不必自己处理多次调用。
SDK 通过以下方式简化了这一过程：

- **内置迭代器**：使用生成器函数无缝获取多页数据。
- **显式 Token 处理**：在需要时通过传入 `pagination_token`，实现灵活的手动控制。
- **最大结果数限制**：每次调用遵守 `max_results`（受 API 限制，例如搜索最多 100 条）。

<div id="automatic-pagination-recommended">
  ## 自动分页（推荐）
</div>

对分页响应使用 `iterate()` 方法，以惰性方式获取全部结果。
**示例：分页搜索**

```python
from xdk import Client
client = Client(bearer_token="your_bearer_token")
# 使用自动分页进行搜索
all_posts = []
for page in client.posts.search_recent(
    query="python",
    max_results=100,  # 每页
    tweet_fields=["created_at", "author_id"]  # 可选扩展字段
):
    all_posts.extend(page.data)
    print(f"已获取 {len(page.data)} 条帖子（总计：{len(all_posts)}）")
print(f"帖子总数：{len(all_posts)}")
```

* 迭代器会自动处理 `next_token`。
* 当没有 `next_token` 时自动停止。
* 支持基于速率限制的退避机制，以避免出现 429 错误。


<div id="manual-pagination">
  ## 手动分页
</div>

如果你出于某些自定义逻辑的需要（例如逐页处理）而希望对结果有更精细的控制，可以像下面所示继续使用 `next_token` 手动进行分页：

```python
# 获取第一页 - search_recent 返回一个迭代器
first_page = next(client.posts.search_recent(
    query="xdk python sdk",
    max_results=100,
    pagination_token=None  # 第一页
))
print(f"第一页:{len(first_page.data) if first_page.data else 0} 个帖子")
# 从 meta 中提取 next_token
next_token = None
if hasattr(first_page, 'meta') and first_page.meta:
    if hasattr(first_page.meta, 'next_token'):
        next_token = first_page.meta.next_token
    elif isinstance(first_page.meta, dict):
        next_token = first_page.meta.get('next_token')
if next_token:
    second_page = next(client.posts.search_recent(
        query="xdk python sdk",
        max_results=100,
        pagination_token=next_token
    ))
    print(f"第二页:{len(second_page.data) if second_page.data else 0} 个帖子")
```

**提示**：

* 始终指定 `max_results` 以优化结果（默认值因端点而异）。
* 监控 `meta.result_count` 以便调试。
* 对于非常大的查询，考虑使用异步迭代以避免阻塞。
  如需查看使用 Python XDK 的详细代码示例，请访问我们的 [代码示例 GitHub 仓库](https://github.com/xdevplatform/samples/tree/main/python)。
