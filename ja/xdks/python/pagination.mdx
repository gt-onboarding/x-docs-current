---
title: ページネーション
sidebarTitle: ページネーション
---

X API では、複数ページにわたる結果を返すエンドポイント（タイムライン、検索など）にページネーションを使用します。各 API 呼び出しのレスポンスには、`result_count`、`previous_token`、`next_token` を含む `meta` オブジェクトが含まれます。XDK は `next_token` を使って複数回の API 呼び出しを自動で処理するため、開発者は複数回の呼び出しを行うことなく、必要なデータ量だけを指定するだけで済みます。
SDK はこれを次のように簡素化します:

- **組み込みイテレーター**: ジェネレーター関数を使用して、複数ページにまたがるフェッチをシームレスに実行できます。
- **明示的なトークン処理**: 必要に応じて `pagination_token` を渡すことで、柔軟な手動制御が可能です。
- **最大結果数の順守**: 各呼び出しごとに `max_results`（API 制限まで。例: 検索では最大 100）を守ります。

<div id="automatic-pagination-recommended">
  ## 自動ページネーション（推奨）
</div>

ページネーション対応のレスポンスに対して `iterate()` メソッドを使用し、すべての結果を遅延的に取得できます。
**例: ページネーション対応の検索**

```python
from xdk import Client
client = Client(bearer_token="your_bearer_token")
# 自動ページネーションで検索
all_posts = []
for page in client.posts.search_recent(
    query="python",
    max_results=100,  # ページごと
    tweet_fields=["created_at", "author_id"]  # オプションのexpansions
):
    all_posts.extend(page.data)
    print(f"{len(page.data)}件のポストを取得 (合計: {len(all_posts)})")
print(f"ポストの合計: {len(all_posts)}")
```

* イテレータは `next_token` を自動的に処理します。
* `next_token` が返されなくなった時点で停止します。
* 429 エラーを回避するためのレート制限バックオフ機能をサポートします。


<div id="manual-pagination">
  ## 手動でのページネーション
</div>

独自ロジック（例: ページごとの処理）が必要な場合は、以下のように `next_token` を使用してページネーションを手動で行うこともできます。

```python
# 最初のページを取得 - search_recentはIteratorを返します
first_page = next(client.posts.search_recent(
    query="xdk python sdk",
    max_results=100,
    pagination_token=None  # 最初のページ
))
print(f"最初のページ: {len(first_page.data) if first_page.data else 0} ポスト")
# metaからnext_tokenを抽出
next_token = None
if hasattr(first_page, 'meta') and first_page.meta:
    if hasattr(first_page.meta, 'next_token'):
        next_token = first_page.meta.next_token
    elif isinstance(first_page.meta, dict):
        next_token = first_page.meta.get('next_token')
if next_token:
    second_page = next(client.posts.search_recent(
        query="xdk python sdk",
        max_results=100,
        pagination_token=next_token
    ))
    print(f"2ページ目: {len(second_page.data) if second_page.data else 0} ポスト")
```

**ヒント**:

* `max_results` を必ず指定して最適化してください（デフォルト値はエンドポイントによって異なります）。
* デバッグのために `meta.result_count` を監視してください。
* 非常に大きなクエリの場合は、ブロッキングを避けるために非同期イテレーション処理の利用を検討してください。
  Python XDK を使った詳細なコード例については、[コードサンプルの GitHub リポジトリ](https://github.com/xdevplatform/samples/tree/main/python) を参照してください。
