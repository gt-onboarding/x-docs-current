---
title: クイックスタート
sidebarTitle: クイックスタート
keywords: ["filtered stream webhooks quickstart", "webhook stream quickstart", "stream webhooks tutorial", "webhook stream guide"]
---

<div id="getting-started-with-the-filtered-stream-webhooks-api">
  ## filtered stream webhooks API の利用を開始する
</div>

v2 filtered stream webhooks API は、フィルタリング対象のルール設定という点では [v2 filtered stream endpoint](/ja/x-api/posts/filtered-stream/introduction) と似ています。違いは、ルールに一致したポストの配信方法にあります。

* v2 filtered stream endpoint の場合は、永続的な接続を確立し、ルールに一致するポストを受信し続ける必要があります。
* この filtered stream webhook endpoint の場合は、webhook を登録すると、X がルールに一致するポストを webhook に配信します。

このガイドでは、filtered stream webhooks endpoint を使ってポストをフィルタリングし、受信する方法を説明します。ここでは、次の 3 つのステップを行います。

1. filtered stream ルールの設定
2. webhook の作成
3. Filtered Stream インスタンスと webhook のリンク

Filtered Stream インスタンスを webhook にリンクすると、X はルールに一致したポストを webhook に送信します。

<div id="setting-up-your-filtered-stream-rules">
  ### filtered stream ルールの設定
</div>

filtered stream のルールは 1 つ以上のオペレーターから構成され、ブール演算とかっこを組み合わせることで、どのポストを webhook に配信するかを定義します。filtered stream webhooks API は、ルールを作成および管理するために、[v2 filtered stream endpoint](/ja/x-api/posts/filtered-stream/introduction) と同じ一連のエンドポイントを使用します。フィルターの構築方法については、[この詳細なガイド](/ja/x-api/posts/filtered-stream/integrate/build-a-rule) を参照してください。

<div id="creating-your-webhook">
  ### Webhook の作成
</div>

X API に対して外部からアクセス可能な HTTPS URL を登録して、イベントを受信するための Webhook を作成します。Webhook は、CRC 検証用の GET リクエストと、イベントのペイロード用の POST リクエストの両方を処理できる必要があります。Webhook の作成および管理の詳細な手順については、[Webhooks Introduction documentation](/ja/x-api/webhooks/introduction) を参照してください。

**注:** すでに [Account Activity API (AAA)](/ja/x-api/account-activity/introduction) 向けに Webhook を使用している場合、その際に設定した Webhook はここでもまったく同じように利用できます。実際、十分な帯域があり、イベントを分離して処理できるのであれば、AAA で使用しているのと同じ Webhook エンドポイントをこの API に対しても利用できます。

<div id="linking-your-filtered-stream-instance-to-your-webhook">
  ### Filtered Stream インスタンスをウェブフックに関連付ける
</div>

ルールを設定し、ウェブフックを作成したら、そのウェブフックを Filtered Stream インスタンスに関連付けます。これにより、条件に一致したポストイベントがウェブフック URL にルーティングされます。

使用するエンドポイント: `POST /2/tweets/search/webhooks/:webhook_id `

ストリーミングエンドポイント `/2/tweets/search/stream` で使用するものと同一のクエリパラメータ（expansions、フィールド、メディアオプションなど）を指定できます。これにより、イベントのペイロードに含まれるデータをカスタマイズできます。

**例:**

```bash
curl --request POST \ 
  --url 
'https://api.x.com/2/tweets/search/webhooks/123456789012345678?ex
pansions=author_id&user.fields=username,name,id' \ 
  --header 'Authorization: Bearer $BEARER_TOKEN' 
```

成功したレスポンスの例：

```json
{ 
  "data": { 
    "provisioned": true 
  } 
}
```

**ヒント：** 冗長化や異なるフィールドセットを受信する目的で、同じ filtered stream に複数の webhook をリンクできます。各リンクごとに固有のパラメータを指定できます。

filtered stream インスタンスを webhook にリンクすると、以下のように、設定したルールに一致するポストの受信が開始されます。

```json
{
    "data": {
        "id": "1346889436626259968",
        "text": "X API v2でユーザー投稿タイムラインとユーザーメンションタイムラインのエンドポイントを使用して投稿を探索する方法を学びましょう… https://t.co/56a0vZUx7i",
        "created_at": "2021-01-06T18:40:40.000Z",
        "author_id": "2244994945"
    },
    "includes": {
        "users": [
            {
                "id": "2244994945",
                "name": "Developers",
                "username": "Xdevelopers",
                "created_at": "2013-12-14T04:35:55Z",
                "protected": false
            }
        ]
    },
    "matching_rules": [
        {
            "id": "120897978112909812",
            "tag": "api-posts"
        }
    ]
}
```

<div id="retrieving-webhooks-linked-to-filtered-stream">
  ### Filtered Stream にリンクされている Webhook の取得
</div>

現在 Filtered Stream にリンクされているすべての Webhook の一覧を取得します。

```bash
GET /2/tweets/search/stream/webhooks 
```

レスポンス例:

```json
{
    "data": {
        "links": [
            {
                "application_id": "29893711",
                "business_user_id": "1877374016438091776",
                "fields": [
                    "user.fields=username",
                    "name",
                    "id",
                    "expansions=author_id"
                ],
                "instance_id": "1877375130462289920",
                "webhook_id": "1952390923729424384"
            }
        ]
    }
}
```

<div id="unlinking-your-webhook-from-filtered-stream">
  ### filtered stream から webhook のリンクを解除する
</div>

特定の webhook でイベントの受信を停止するには、次のようにしてリンクを解除します。

```bash
DELETE /2/tweets/search/webhooks/:webhook_id
```

レスポンスは次のようになります。

```json
{
    "data": {
        "deleted": true
    }
}
```
