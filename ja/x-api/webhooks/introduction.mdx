---
title: V2 Webhooks API
sidebarTitle: 概要
keywords: ["Webhook", "Webhook API", "Webhook イベント", "リアルタイム Webhook", "Webhook 通知", "Webhook サブスクリプション", "Webhook 管理"]
---

<div id="overview">
  ## 概要
</div>

V2 Webhooks API を使用すると、開発者は webhook ベースの JSON メッセージを通じて、X アカウントからのイベント通知をリアルタイムに受信できます。これらの API を使用することで、webhook の登録および管理、イベントを処理するコンシューマーアプリケーションの開発、チャレンジレスポンスチェック（CRC）や署名ヘッダーによる安全な通信の確保が可能になります。

<div id="feature-summary">
  ## 機能概要
</div>

| プラン | 料金 | Webhook の数 |
| :---: | :---: | :---: |
| Self-Serve Pro | $5,000/月 | 1 |
| Enterprise | [営業担当者にお問い合わせ](/ja/resources/enterprise/forms/enterprise-api-interest#enterprise-access-form) | 5+ |

<div id="products-that-support-webhooks">
  ## Webhook をサポートしている製品
</div>

現在、イベントを webhook 経由で配信できる製品は次のとおりです。

* [Account Activity API (AAA)](/ja/x-api/account-activity/introduction)
* [Filtered Stream](/ja/x-api/webhooks/stream/introduction)

<div id="manage-webhooks">
  ## Webhook を管理する
</div>

Account Activity API は、あなたのサービスにサブスクライブしている X アカウントに関連するイベントが発生するたびに、webhook ベースの JSON メッセージを送信します。X は、それらのアクティビティを登録済みの webhook に配信します。以下の手順では、webhook とサブスクライブ中のユーザーを管理する方法を説明します。

webhook とサブスクライブ中のユーザーの両方について、登録、表示、削除の方法を学びます。ここでは、さまざまな API エンドポイントにリクエストを送信するために、シンプルな cURL コマンドを使用します。cURL は、URL 構文を使用してリクエストの取得や送信を行うコマンドラインツールです。

イベントコンシューマアプリケーションで webhook イベントの受信を開始する前に、注意すべき点がいくつかあります。以下に説明するように、X アプリを作成し、Account Activity API へのアクセス権を取得し、webhook イベントを処理する Web アプリを開発する必要があります。 

<div id="1-develop-a-webhook-consumer-app">
  ### 1. Webhook コンシューマーアプリを開発する
</div>

X アプリに関連付けられた新しい webhook を登録するには、X の webhook イベントを受信し、セキュリティリクエストに応答する Web アプリを開発・デプロイ・ホストする必要があります。

*始める前に、[サンプルアプリ](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)を確認することをおすすめします。*

* イベントを受信する webhook エンドポイントとして機能する、インターネットからアクセス可能な HTTPS URL を持つ Web アプリを作成します。
  * URI の*パス*は完全に任意です。次の例は有効です: [https://mydomain.com/service/listen](https://mydomain.com/service/listen)
  * さまざまなソースからの webhook を受信している場合、よく使われるパターンは次のとおりです: [https://mydomain.com/webhook/twitter](https://mydomain.com/webhook/twitter)
  * 指定する URL にはポート番号を含めることはできない点に注意してください（[https://mydomain.com:5000/NoWorkie](https://mydomain.com:5000/NoWorkie) のような URL は使用できません）。
* 最初のステップとして、X Challenge Response Check (CRC) の GET リクエストを受信し、正しい形式の JSON レスポンスで応答するコードを記述します。
* webhook URL を登録します。URL を含む JSON 本文で `/2/webhooks` エンドポイントに POST リクエストを送信します。このリクエストを行うと、X は CRC リクエストをあなたの Web アプリに送信します。
* webhook が正常に登録されると、レスポンスには webhook の `id` が含まれます。この webhook `id` は、後で webhook をサポートするプロダクトに対してリクエストを行う際に必要になります。
* X は、イベントを含む POST リクエストを、あなたが登録した URL に送信します。これらのイベントは JSON 形式でエンコードされています。webhook の JSON ペイロード例については[こちら](/ja/x-api/account-activity/introduction#account-activity-data-object-structure)を参照してください。

<div id="optional-use-xurl-for-testing">
  #### オプション: テストに xurl を使用する
</div>

テスト目的で、xurl ツールが一時的な Webhook をサポートするようになりました。GitHub から [`xurl` プロジェクト](https://github.com/xdevplatform/xurl) の最新バージョンをインストールし、認可設定を行ってから、以下を実行します。

```
xurl webhook start
```

これは一時的なパブリック Webhook URL を生成し、すべての CRC チェックを自動的に処理し、受信したサブスクリプションイベントをすべてログに記録します。デプロイ前にセットアップを検証するのに最適な方法です。出力例：

```
Starting webhook server with ngrok...
Enter your ngrok authtoken (leave empty to try NGROK_AUTHTOKEN env var):

Attempting to use NGROK_AUTHTOKEN environment variable for ngrok authentication.
Configuring ngrok to forward to local port: 8080
Ngrok tunnel established!
  Forwarding URL: https://<your-ngrok-subdomain>.ngrok-free.app -> localhost:8080

Use this URL for your X API webhook registration: https://<your-ngrok-subdomain>.ngrok-free.app/webhook

Starting local HTTP server to handle requests from ngrok tunnel (forwarded from https://<your-ngrok-subdomain>.ngrok-free.app)...
```

**重要な注意事項**

* Webhook URL を登録する際、Web アプリは CRC チェックの暗号化にアプリの consumer secret を使用する必要があります。

* すべての受信ダイレクトメッセージは webhook 経由で配信されます。 [POST /2/dm&#95;conversations/with/:participant&#95;id/messages](/ja/x-api/direct-messages/send-a-new-message-to-a-user) 経由で送信されたすべてのダイレクトメッセージも webhook 経由で配信されます。これは、別のクライアント経由で送信されたダイレクトメッセージを Web アプリが把握できるようにするためです。

* 同じ webhook URL を共有する Web アプリが複数あり、かつ同じユーザーがそれぞれのアプリにマッピングされている場合、同じイベントが webhook に複数回送信されます（Web アプリごとに 1 回ずつ）。

* 場合によっては、webhook が重複したイベントを受け取ることがあります。Webhook アプリはこの状況を許容し、イベント ID に基づいて重複排除を行う必要があります。

* 次のサンプルコードを参照してください:

  * [Account Activity API Setup](https://github.com/m-rosinsky/XWebhookTest) — Account Activity API の Enterprise ティアを使用して webhook イベントを表示する Node.js ベースの Web アプリ。

<div id="2-securing-webhooks">
  ### 2. Webhook のセキュリティ保護
</div>

X の webhook ベースの API では、webhook サーバーのセキュリティを検証するために、次の 2 つの方法を提供しています。

1. チャレンジレスポンスチェックにより、webhook イベントを受信する web アプリの所有権を X が確認できます。
2. 各 POST リクエストに含まれる署名ヘッダーにより、受信した webhook が X から送信されたものであることを確認できます。

実装要件については CRC Check セクションを参照してください。

<div id="3-the-webhooks-api">
  ### 3. Webhooks API
</div>

Webhook の管理は Webhook Management API を通じて行います。すべてのエンドポイントで OAuth 2.0 アプリ専用 Bearer Token 認証が必要です。

<div id="adding-a-webhook">
  #### [Adding a webhook](/ja/x-api/webhooks/create-webhook-config)
</div>

**POST /2/webhooks**

**説明:**

webhook 設定を作成します。外部からアクセス可能な公開 `https` コールバック URL を JSON ボディに指定する必要があります。
まず、対象のアプリケーションコンテキスト用に新しい webhook URL を登録します。

**認証:**

OAuth2 App Only Bearer Token

* **Bearer token** `<BEARER_TOKEN>` 例: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

**パラメータ（JSON ボディ）：**

```
{
    "url": "<your publicly accessible https callback url>"
}
```

* **URL** `<URL>` 例: `https://yourdomain.com/webhooks/twitter/`

**リクエスト:** 次の cURL リクエストの以下の部分を変更したうえで、コマンドラインにコピーして実行します。

````
  ```
  curl --request POST --url 'https://api.twitter.com/2/webhooks?url=<URL>' --header 'authorization: Bearer <BEARER_TOKEN>'
  --data '{
"url": "https://yourdomain.com/webhooks/twitter"
          }'
  ```
````

**レスポンス:**

**成功 (200 OK)**

成功レスポンスは、Webhook が作成され、最初の CRC チェックに合格したことを示します。

```
{
  "data": {
    "id": "<webhook_id>",
    "url": "<your callback url>",
    "valid": true,
    "created_at": "YYYY-mm-DDTHH:MM:ss.000Z"
  }
}
```

**失敗（400 Bad Request）**

このエラーが発生すると、標準的なエラーオブジェクトが返されます。

```
{
    "errors": [
      {
        "message": "<Reason>: <Details>"
      }
    ],
    "title": "Invalid Request",
    "detail": "One or more parameters to your request was invalid.",
    "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

一般的な失敗の原因には次のようなものがあります。

| Reason                 | Description                                                       |
| :--------------------- | :---------------------------------------------------------------- |
| `CrcValidationFailed`  | コールバック URL が CRC チェックに正しく応答しませんでした（たとえば、タイムアウトした、誤ったレスポンスを返したなど）。 |
| `UrlValidationFailed`  | 指定されたコールバック URL が要件を満たしていません（たとえば、`https` ではない、不正な形式であるなど）。       |
| `DuplicateUrlFailed`   | 指定されたコールバック URL については、このアプリケーションですでに Webhook が登録されています。           |
| `WebhookLimitExceeded` | このアプリケーションで許可されている Webhook 設定数の上限に達しています。                         |

<div id="viewing-a-webhook">
  #### [webhook の表示](/ja/x-api/webhooks/get-a-list-of-webhook-configs-associated-with-a-client-app)
</div>

**GET /2/webhooks**

**Description:** 自分のアプリケーション（開発者アカウント）に関連付けられているすべての webhook 設定を取得します。

**Authentication:**

OAuth2 App Only Bearer Token

* **Bearer token** `<BEARER_TOKEN>` （例）`AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

* **URL** `<URL>` （例）`https://yourdomain.com/webhooks/twitter/`

**Request:** 指定したアプリケーションに対して登録されているすべての webhook URL とそのステータスを取得するには、次のコマンドを実行します。

次の cURL リクエストをコピーし、必要な部分を変更してからコマンドラインに貼り付けてください。

````
  ```
  curl --request GET --url 'https://api.twitter.com/2/webhooks' --header 'authorization: Bearer <BEARER_TOKEN>'
  ```
````

**成功 (200 OK)**

Webhook 設定のリストを返します。Webhook が設定されていない場合、このリストは空になります。

*例 (Webhook が 1 件設定されている場合):*

```
{
  "data": [
    {
      "created_at": "YYYY-mm-DDTHH:MM:ss.000Z",
      "id": "<webhook_id>",
      "url": "<callback url>",
      "valid": true
    }
  ],
  "meta": {
    "result_count": 1
  }
}
```

*例（Webhook を構成していない場合）：*

```
{
  "data": [],
  "meta": {
    "result_count": 0
  }
}
```

<div id="removing-a-webhook">
  #### [webhook を削除する](/ja/x-api/webhooks/delete-webhook-config)
</div>

DELETE /2/webhooks/:webhook&#95;id

**説明:** 特定の `webhook_id` を使用して webhook 設定を削除します。この ID は、`POST /2/webhooks` による作成時のレスポンス、または `GET /2/webhooks` による一覧取得のレスポンスから取得できます。

**認証:**

OAuth2 アプリ専用 Bearer Token

* **Bearer Token** `<BEARER_TOKEN>` 例: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

**パスパラメータ:**

| パラメータ        | 説明                  |
| :----------- | :------------------ |
| `webhook_id` | 削除対象の webhook の ID。 |

**リクエスト:** 次のコマンドを実行して、指定されたアプリケーションの設定から webhook を削除します。

以下の cURL リクエストをコピーし、必要な箇所を変更してからコマンドラインで実行してください。

````
  ```
  curl --request DELETE --url 'https://api.twitter.com/2/webhooks/:WEBHOOK_ID' --header 'authorization: Bearer <BEARER_TOKEN>'
  ```

  **レスポンス:**
````

**成功 (200 OK)**

正常に削除された場合、&quot;deleted&quot; ステータスが true の JSON レスポンスを返します。

*例 (webhook の削除に成功した場合):*

```
{
  "data": {
    "deleted": true
  }
}
```

**失敗 (400 Bad Request)**

| 理由                 | 説明                                               |
| :----------------- | :----------------------------------------------- |
| `WebhookIdInvalid` | 指定された `webhook_id` が見つからないか、ご利用のアプリに関連付けられていません。 |

<div id="validate-and-reenable-webhook">
  #### [Webhook を検証して再有効化する](/ja/x-api/webhooks/webhook-crc-check)
</div>

**PUT /2/webhooks/:webhook&#95;id**

**説明:** 指定された webhook の URL に対して Challenge Response Check (CRC) を実行します。チェックが成功した場合は HTTP ステータスコード 200 を返し、ステータスを `valid` に設定して webhook を再有効化します。

**認証:**

OAuth2 App Only Bearer Token

* **Bearer token** `<BEARER_TOKEN>` (例) `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

**パスパラメータ:**

| Parameter    | Description        |
| :----------- | :----------------- |
| `webhook_id` | 検証する webhook の ID。 |

**リクエスト:** 対象アプリケーションの設定に基づいて webhook を検証するには、次のコマンドを実行します。

次の cURL リクエストをコピーし、必要な変更を加えたうえでコマンドラインに貼り付けて実行します。

````
  ```
  curl --request PUT --url 'https://api.twitter.com/2/webhooks/:WEBHOOK_ID' --header 'authorization: Bearer <BEARER_TOKEN>'
  ```

  **レスポンス:**
````

**成功 (200 OK)**

200 OK レスポンスは、CRC チェックリクエストが*開始された*ことを示します。これは CRC チェックが成功したことを保証するものでは**ありません**。レスポンス内の `valid` フィールドは、チェックの実行*後*のステータスを表します。CRC チェックが成功すると、webhook のステータスは `valid` に更新されます。現在のステータスは `GET /2/webhooks` を使用して確認できます。

```
{
  "data": {
    "valid": true // CRCチェック試行完了後のステータスを示す
  }
}
```

**失敗 (400 Bad Request)**

| Reason                | Description                                      |
| :-------------------- | :----------------------------------------------- |
| `WebhookIdInvalid`    | 指定された `webhook_id` が見つからないか、お使いのアプリに関連付けられていません。 |
| `CrcValidationFailed` | コールバック URL が CRC チェックリクエストに正しく応答しませんでした。         |

<div id="4-the-crc-check">
  ### 4. CRC チェック
</div>

Challenge Response Check（CRC）は、X が、指定したコールバック URL が有効であり、かつあなたがその URL を管理していることを検証するための仕組みです。

**CRC がトリガーされるタイミング:**

* 初回の webhook 登録時（`POST /2/webhooks`）
* 検証のために X によって 1 時間ごとに実行
* `PUT /2/webhooks/:id` による手動トリガー

例:

```
GET https://your-webhook-url.com/webhook?crc_token=challenge_string
```

JSON レスポンスボディの例：

```
{
  "response_token": "sha256=<base64エンコードされたHMACハッシュ>"
}
```

**レスポンスの構築方法:**

* `crc_token` をメッセージとして使用します
* アプリの **consumer secret** をキーとして使用します
* HMAC-SHA-256 のハッシュ値を作成します
* 結果を Base64 エンコードします

<div id="sample-apps">
  ## サンプルアプリ
</div>

* [Simple webhook server](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py)
  * CRC チェックへの応答方法と POST イベントの受信方法を示す、1 つの Python スクリプトです。
* [Account Activity API sample dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)
  * [bun.sh](https://bun.sh) で作成された Web アプリで、webhook やサブスクリプションの管理に加えて、アプリ内でリアルタイムにイベントを受信できます。