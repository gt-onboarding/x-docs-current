---
title: ポストとルールのマッチング
sidebarTitle: ポストとルールのマッチング
keywords: ["matching rules", "filter rules", "rule matching", "stream rules", "filtered stream rules", "rule tags"]
---

<div id="matching-returned-posts-to-their-associated-rule">
  ### 返されるポストを対応するルールに紐付ける
</div>

filtered stream エンドポイントを使うと、単一の接続で複数のルールを設定できます。ストリームでポストの受信を開始する前に、どの種類のポストに関心があるかを指定するルールを作成する必要があります。 

ユーザー属性、位置情報、言語など、さまざまな属性に基づいてポストをマッチさせるためのルールを指定する際には、そのルールをより高いレベルで識別するためにタグを付与できます。多数のルールを設定している場合、とくにタグはルールの文脈付けに役立ちます。フィルタリングルールによって、どのポストのアクティビティが接続を通じて送信されるかが決まります。

別の種類のポストを取得するために新しいフィルタリングルールを追加する必要がある場合や、既存のルールを削除する必要がある場合は、アプリから [POST tweets/search/stream/rules](/ja/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules) エンドポイントにリクエストを送信して行えます。このリクエストが送信されると、フィルタリングルールは自動的に変更され、再接続することなく、その変更がデータストリームに反映されます。多くの場合、ルールの追加は概ね 20 秒以内に有効になります。まれではありますが、外部要因（たとえばネットワーク接続状況）によっては、一致するポストの受信が始まるまで、さらに時間がかかることがあります。list rule エンドポイントでルールが見つからない場合は、ルール作成リクエストが成功しているかを必ず確認してください。これは、ログにエラーメッセージが出力されていないかを確認することで行えます。

<div id="matching-rules">
  #### 一致したルール
</div>

アクティビティが filtered stream 接続を通じて配信されるとき、`matching_rules` 配列には、その配信されたポストに対してどのフィルターが一致したかの一覧が含まれます。

ポストのペイロードには、特定のポストが配信されるトリガーとなったルールの id とタグを含む、追加の文字列メタデータがあります。1 つのポストに複数のルールが一致した場合でも、アクティビティは 1 回だけ配信され、そのメタデータ内に一致したすべてのルールが含まれます。`matching_rules` は、特定のポストを特定のルールと簡単に対応付けられるようにするもので、多くの異なるルールを持っている場合に特に有用です。このようにデータが 1 つのストリームで配信されるため、一意の id とタグを設定しておくことが、正しく対応付ける上で不可欠です。 

**以下は、ポストのペイロード内で `matching_rules` 配列がどのように含まれるかの例です。**

```"matching_rules": [
    {
      "id": "1166916266197536768",
      "tag": "test-rule-tag-00000"
    },
    {
      "id": "1166916266197536769",
      "tag": "test-rule-tag-12345"
    }
  ]
```

<div id="rule-tags">
  #### ルールタグ
</div>

各フィルタリングルールには、作成時にタグを付与できます。ルールタグ自体には特別な意味はなく、ルールに付随する単なる文字列として扱われます。これらは返されるアクティビティの `matching_rules` メタデータに含まれ、より上位のレベルでルールを区別しやすくするために利用されます。 

タグは、フィルタリングルールを論理的なグループにまとめる簡便な方法を提供します。たとえば、特定のルール用に一意の ID を生成し、それをそのルールのタグとして設定しておくことで、アプリが処理するアクティビティ内でその ID を参照し、結果を特定の顧客、キャンペーン、カテゴリ、その他の関連グループに関連付けることができます。

タグは既存のルールに対して更新することはできず、ルール作成時にのみ指定できる点に注意してください。タグを「更新」または「名前変更」するには、まずそのルールを削除し、その後に目的のタグを付けて再度追加する必要があります。最善の方法は、タグとして一意の識別子を使用し、システム側でそれをアプリ内のさまざまな他のデータポイントと関連付けられるようにすることです。これにより、ルールセット自体を変更することなく対応できます。

<div id="filtered-stream-recovery-and-redundancy-features">
  ### filtered stream - 復旧および冗長化機能
</div>

<Note>
  注: これらの復旧および冗長化機能は、Enterprise アクセス権をお持ちの方のみご利用いただけます。
</Note>