---
title: ポストをルールにマッチさせる
sidebarTitle: ポストをルールにマッチさせる
keywords: ["ルールのマッチング", "フィルタールール", "ルールマッチング", "ストリームルール", "filtered stream のルール", "ルールタグ"]
---

<div id="matching-returned-posts-to-their-associated-rule">
  ### 返されるポストを対応するルールにマッチさせる
</div>

filtered stream エンドポイントでは、単一の接続で複数のルールを設定できます。ストリームでポストを受信し始める前に、どのような種類のポストに関心があるかを指定するルールを作成する必要があります。

ユーザー属性、位置情報、言語など、さまざまな属性に基づいてポストをマッチさせるルールを指定する際には、そのルールをより高いレベルで区別できるようにタグを付けることができます。多数のルールを設定している場合、タグはルールの意味づけや用途を分かりやすくする有効な手段です。フィルタリングルールによって、どのポストのアクティビティが接続経由で送信されるかが決まります。

別のタイプのポストを取得するために新しいフィルタリングルールを追加する必要がある場合や、既存のルールを削除する必要がある場合、アプリから [POST tweets/search/stream/rules](/ja/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules) エンドポイントにリクエストを送信して行えます。このリクエストが送信されると、フィルタリングルールは自動的に更新され、再接続の必要なく、その変更がデータストリームにそのまま反映されます。ほとんどのルール追加は約 20 秒以内に有効になります。可能性は低いものの、外部要因（たとえばネットワーク接続）によっては、マッチするポストを受信し始めるまでにそれ以上の時間がかかる場合があります。ルール一覧用のエンドポイントでルールが見つからない場合は、ルール作成リクエストが成功しているか確認してください。これは、ログ内にエラーメッセージがないか確認することで行えます。

<div id="matching-rules">
  #### 一致したルール
</div>

filtered stream 接続を通じてアクティビティが配信されると、配信されたポストに対してどのフィルターがマッチしたかを示す情報が、`matching_rules` 配列として含まれます。

ポストのペイロードには、特定のポストが配信される原因となったルールの `id` とタグを含む、追加の文字列メタデータが含まれます。複数のルールが 1 つのポストにマッチした場合でも、アクティビティは 1 回だけ配信され、そのメタデータ内にマッチしたそれぞれのルールが含まれます。`matching_rules` を利用することで、特定のポストを特定のルールと簡単に関連付けることができ、多数の異なるルールを持つ場合に特に有用です。このようにデータが 1 本のストリームを通じて配信されるため、一意の `id` とタグを設定しておくことがマッチングにおいて不可欠です。 

**ポストのペイロード内で `matching_rules` 配列がどのように表現されるかの例を次に示します。**

```"matching_rules": [
    {
      "id": "1166916266197536768",
      "tag": "test-rule-tag-00000"
    },
    {
      "id": "1166916266197536769",
      "tag": "test-rule-tag-12345"
    }
  ]
```

<div id="rule-tags">
  #### ルールタグ
</div>

フィルタリングルールは作成時に、それぞれにタグを付与することができます。ルールタグ自体には特別な意味はなく、ルールと一緒に保持される不透明な文字列として扱われます。タグは返されるアクティビティ内の matching&#95;rules メタデータに含まれ、より上位のレベルでルールを区別しやすくすることを目的としています。 

タグは、フィルタリングルールを論理的にグループ化する簡単な方法を提供します。たとえば、特定のルールごとに一意の ID をタグとして生成し、アプリが処理するアクティビティ内でその ID を参照することで、結果を特定の顧客、キャンペーン、カテゴリ、その他の関連グループと関連付けることができます。

既存のルールに対してタグを更新することはできず、タグはルールを作成する際にのみ含めることができる点に注意してください。タグを「更新」または「名前変更」するには、まずそのルールを削除し、その後目的のタグを付けて再度追加する必要があります。最善の方法は、タグとして一意の識別子を使用し、ルールセット自体を変更することなく、システム側でその識別子を自分のアプリ内のさまざまな他のデータポイントと関連付けることです。

<div id="filtered-stream-recovery-and-redundancy-features">
  ### filtered stream - リカバリーおよび冗長化機能
</div>

<Note>
  Note: これらのリカバリーおよび冗長化機能は、Enterprise アクセスをお持ちの方のみご利用いただけます。
</Note>