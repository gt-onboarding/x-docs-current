---
title: クイックスタート
sidebarTitle: クイックスタート
keywords: ["filtered stream クイックスタート", "ストリーミング クイックスタート", "filtered stream チュートリアル", "ストリームガイド", "ストリーミングの例"]
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-filtered-stream-endpoints">
  ## filtered stream エンドポイントの利用を開始する
</div>

このクイックスタートガイドでは、cURL リクエストを使用して filtered stream エンドポイント群に最初のリクエストを送信する手順を説明します。cURL は、最小限の設定でリクエストを送信できるコマンドラインツールです。

他の言語でのサンプルコードを確認したい場合は、当社の [X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub リポジトリをご覧ください。 

<Note>
  **前提条件**

  このガイドを完了するには、リクエストの認証に使用する[キーとトークン](/ja/resources/fundamentals/authentication)のセットが必要です。これらのキーとトークンは、次の手順で生成できます。

  * [開発者アカウントにサインアップ](https://developer.x.com/en/apply-for-access)し、承認を受けてください。
  * 開発者ポータルで、[プロジェクト](/ja/resources/fundamentals/projects)と、それに関連付けられた[開発者アプリ](/ja/resources/fundamentals/developer-apps)を作成します。
  * App の「Keys and tokens」ページに移動し、必要な認証情報を生成します。すべての認証情報は安全な場所に保存してください。
</Note>

<div id="steps-to-build-a-filtered-stream-request-using-curl">
  ### cURL を使用して filtered stream リクエストを作成する手順
</div>

**ステップ 1: ルールを作成する**

ルールは、どのポストをストリームに配信するかを定義するために、ブールロジックと括弧を使って組み合わせられた 1 つ以上のさまざまな[オペレーター](/ja/x-api/posts/filtered-stream#building-rules-for-filtered-stream)で構成されます。このガイドでは、「cat」というキーワードと画像の両方を含むポストが取得されるように、ストリームをフィルタリングします。作成するルールは次のとおりです。

```cat has:images
```

**ステップ2：ルールにタグを追加する**

ストリームには、同時に複数のルールを追加できます。ストリーミング接続を開くと、これらのいずれかのルールにマッチしたポストは、同じストリーミング接続を通じて流れてきます。どのポストがどのルールにマッチしたかを把握できるようにするため、ルール作成リクエスト時にタグを渡すことができます。そのルールにマッチした各ポストのペイロードには、どのルールにマッチしたかを示す tag フィールドが含まれるようになります。このルールには、次のタグを設定します。

```cats with images
```

**ステップ3：ルールをストリームに追加する**

このエンドポイントでは、ルールとそのタグを含む `application/json` 形式のリクエストボディを渡す必要があります。ルールをストリームに追加しようとしているため、`add` オブジェクト内にルールの値とタグを含めていることにも気付くと思います。JSON ボディは次のようになります。

```json
{
  "add": [
    {
      "value": "cat has:images",
      "tag": "画像付きの猫"
    }
  ]
}
```

この JSON 本文の準備が整ったので、これを cURL リクエストに追加できます。リクエストは次のようになります。ただし、このリクエストはまだ完成していないため、後のステップに進むまで送信しないでください。

```json
curl -X POST 'https://api.x.com/2/tweets/search/stream/rules' \
-H "Content-type: application/json" \
-H "Authorization: Bearer $APP_ACCESS_TOKEN" -d \
'{
  "add": [
    {"value": "cat has:images", "tag": "cats with images"}
  ]
}'`
```

**ステップ4：リクエストを認証する**

filtered stream のルールエンドポイントは [OAuth 2.0 App-Only authentication](/ja/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token) を必要とするため、ステップ3の cURL コマンド内の $APP&#95;ACCESS&#95;TOKEN を、前提条件の手順で生成した [App Access Token](/ja/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token) に置き換える必要があります。 

**ステップ5：ルールをストリームに追加する**

次に、cURL リクエストを実行してルールをストリームに追加します。cURL コマンドをコマンドラインインターフェースにコピー＆ペーストし、「Enter」キーを押します。 

cURL リクエストが成功すると、value、tag、id（ルールの一意の識別子として機能します）に関するデータを含むレスポンスが返されます。レスポンスは次のような形式になります。

```json
{
  "data": [
    {
      "value": "cat has:images",
      "tag": "画像付きの猫",
      "id": "1273026480692322304"
    }
  ],
  "meta": {
    "sent": "2020-06-16T22:55:39.356Z",
    "summary": {
      "created": 1,
      "not_created": 0,
      "valid": 1,
      "invalid": 0
    }
  }
}
```

ルールが正常に追加されたことを確認するには、次の GET リクエストを rules エンドポイントに送信します。その際、再度 $APP&#95;ACCESS&#95;TOKEN をご自身のトークンに置き換えてください。このリクエストは、ストリームに追加されているすべてのルールの一覧を返します。

```bash
curl -X GET 'https://api.x.com/2/tweets/search/stream/rules' \
-H "Authorization: Bearer $APP_ACCESS_TOKEN"
```

cURL リクエストが成功すると、次のようなレスポンスが返されます。

```json
{
	"data": [{
		"id": "1273028376882589696",
		"value": "cat has:images",
		"tag": "cats with images"
	}],
	"meta": {
		"sent": "2020-06-16T23:14:06.498Z"
	}
}
```

**ステップ6：取得するフィールドを特定して指定する**

ステップ 5 の後にストリームへ接続すると、レスポンスにはデフォルトの [Post object](/ja/x-api/fundamentals/data-dictionary#tweet) のフィールドである id、text、edit&#95;history&#95;tweet&#95;ids が含まれます。これらに加えて追加のフィールドを受け取りたい場合は、リクエストで [field](/ja/x-api/fundamentals/fields) パラメータおよび／または [expansion](/ja/x-api/fundamentals/expansions) パラメータを使って、それらのフィールドを指定する必要があります。

この演習では、異なるオブジェクトから 3 つの異なるフィールドセットをリクエストします。

1. プライマリの Post オブジェクトに対する追加の tweet.created&#95;at フィールド
2. 返されるポストの投稿者に関連付けられた [user object](/ja/x-api/fundamentals/data-dictionary#user) のデフォルトフィールド: id、name、username
3. 関連するユーザーオブジェクトに対する追加の user.created&#95;at フィールド
    

これらのフィールドをリクエストするには、リクエストで次の値を渡す必要があります。

|              |                |                                                                 |
| :----------- | :------------- | :-------------------------------------------------------------- |
| Key          | Value          | Returned fields                                                 |
| tweet.fields | created&#95;at | tweets.created&#95;at                                           |
| expansions   | author&#95;id  | includes.users.id, includes.users.name, includes.users.username |
| user.fields  | created&#95;at | includes.users.created&#95;at                                   |

これでこの情報を踏まえて、ストリームに接続するためのリクエスト URL を組み立てることができます。URL は次のようになります。

```bash
https://api.x.com/2/tweets/search/stream?tweet.fields=created_at&expansions=author_id&user.fields=created_at
```

**ステップ 7: ストリームに接続してレスポンスを確認する**

ルールを設定し、返してほしいフィールドを指定したので、ストリームに接続する準備が整いました。ストリームに接続すると、送信したルールにマッチするポストオブジェクトが配信されます。以下は、ステップ 6 で取得した URL をリクエストに追加したあとの cURL コマンドの例です。

```bash
curl -X GET -H "Authorization: Bearer $APP_ACCESS_TOKEN" "https://api.x.com/2/tweets/search/stream?tweet.fields=created_at&expansions=author_id&user.fields=created_at"
```

繰り返しになりますが、このリクエストは OAuth 2.0 アプリ専用フローで認証されている必要があるため、コマンドラインツールにコピー＆ペーストする前に、必ず $APP&#95;ACCESS&#95;TOKEN をご自身の認証情報に置き換えてください。

filtered stream に接続すると、ルールに一致するポストが、次の JSON 形式で受信され始めます。

```json
{
  "data": [
    {
      "author_id": "2244994945",
      "created_at": "2022-09-14T19:00:55.000Z",
      "id": "1228393702244134912",
      "edit_history_tweet_ids": ["1228393702244134912"],
      "text": "開発者はバレンタインカードに何を書いたでしょうか？\n  \nwhile(true) {\n    I = Love(You);  \n}"
    },
    {
      "author_id": "2244994945",
      "created_at": "2022-09-12T17:09:56.000Z",
      "id": "1227640996038684673",
       "edit_history_tweet_ids": ["1227640996038684673"],
      "text": "Doctors: Googling stuff online does not make you a doctor\n\nDevelopers: https://t.co/mrju5ypPkb"
    },
    {
      "author_id": "2244994945",
      "created_at": "2022-09-27T20:26:41.000Z",
      "id": "1199786642791452673",
      "edit_history_tweet_ids": ["1199786642791452673"],
      "text": "C#"
    }
  ],
  "includes": {
    "users": [
      {
        "created_at": "2013-12-14T04:35:55.000Z",
        "id": "2244994945",
        "name": "Twitter Dev",
        "username": "TwitterDev"
      }
    ]
  }
}
```

接続を終了したい場合は、Mac または Windows のどちらのシステムでも、コマンドラインツール上で Control+C を押して接続を切るか、ウィンドウを閉じてください。
