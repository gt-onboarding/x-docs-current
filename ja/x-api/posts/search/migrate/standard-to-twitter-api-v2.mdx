---
title: v1 から v2 へ
sidebarTitle: v1 から v2 へ
keywords: ["v1.1 から v2 への移行", "検索の移行", "検索移行", "Standard 版から v2 の検索へ", "v1 から v2 の検索へ", "移行ガイド"]
---

<div id="standard-v11-compared-to-x-api-v2">
  ### Standard v1.1 と X API v2 の比較
</div>

v1.1 の [search/posts](/ja/x-api/posts/search/introduction) を利用している場合、このガイドの目的は、Standard v1.1 と X API v2 の search Posts エンドポイントの共通点と相違点を理解できるようにすることです。

* **共通点**
  * OAuth 1.0a User Context と OAuth 2.0 アプリ専用フロー
  * ポストの編集履歴とメタデータのサポート 
* **相違点**
  * エンドポイント URL

  * アプリおよびプロジェクトの要件

  * レスポンスデータ形式

  * リクエストパラメータ

  * 新しいクエリ演算子

  * AND / OR 演算子の優先順位 

<div id="similarities">
  #### 類似点
</div>

**OAuth 1.0a User Context と OAuth 2.0 アプリ専用フロー認証**

v1.1 の search/posts エンドポイントと X API v2 の recent search エンドポイントは、[OAuth 1.0a User Context](/ja/resources/fundamentals/authentication) と [OAuth 2.0 アプリ専用フロー](/ja/resources/fundamentals/authentication#oauth-2-0) の両方をサポートしています。 

そのため、以前に標準の v1.1 search エンドポイントを使用していた場合、X API v2 バージョンへ移行しても、同じ認証方法を引き続き利用できます。 

利用する認証ライブラリ／パッケージにもよりますが、アプリ専用フローによる認証は、おそらく最も簡単に使い始められる方法であり、シンプルなリクエストヘッダーで設定できます。App Access Token（アプリ用アクセストークン）の生成方法については、この [OAuth 2.0 アプリ専用フローのガイド](/ja/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)を参照してください。 

X API v2 エンドポイントで非公開または広告用メトリクスを取得する機能を活用したい場合は、OAuth 1.0a User Context を使用し、対象のポストを投稿したユーザーに関連付けられたユーザーのアクセストークンを渡す必要があります。 

**ポストの編集履歴とメタデータのサポート**

どちらのバージョンも、編集履歴を表すメタデータを提供します。詳細については、[search API リファレンス](/ja/x-api/posts/recent-search)および [ポスト編集の基本事項ページ](/ja/x-api/fundamentals/edit-posts)を参照してください。 

<div id="differences">
  #### 違い
</div>

**エンドポイント URL**

* Standard v1.1 エンドポイント:
  * https://api.x.com/1.1/search/tweets

* X API v2 エンドポイント:
  * https://api.x.com/2/tweets/search/recent
     

**アプリとプロジェクトの要件**

X API v2 エンドポイントでは、リクエストを認証する際に、そのリクエストにひも付いた [開発者アプリ](/ja/resources/fundamentals/developer-apps) と、それに関連付けられている [プロジェクト](/ja/resources/fundamentals/projects) の認証情報を使用する必要があります。すべての X API v1.1 エンドポイントでは、プロジェクトに関連付けられていない単独のアプリ、またはプロジェクトに関連付けられたアプリの認証情報を使用できます。 

**レスポンスデータ形式**

Standard v1.1 と X API v2 のエンドポイントバージョンの最大の違いの 1 つは、ペイロードにどのフィールドを含めて返すかを、どのように選択するかという点です。

Standard エンドポイントでは、多くのレスポンスフィールドがデフォルトで返され、さらにパラメータを使用して、どのフィールドまたはフィールドセットをペイロードに返すかを指定できます。

X API v2 では、デフォルトで返されるのはポストの `id` と `text` フィールドのみです。追加のフィールドやオブジェクトをリクエストするには、[fields](/ja/x-api/fundamentals/fields) と [expansions](/ja/x-api/fundamentals/expansions) パラメータを使用する必要があります。これらのエンドポイントからリクエストしたポストフィールドはすべて、メインのポストオブジェクト内に返されます。展開されたユーザー、メディア、投票、または場所オブジェクトとそのフィールドは、レスポンス内の `includes` オブジェクトに返されます。その後、ポストと展開されたオブジェクトの両方に含まれる ID を突き合わせることで、展開されたオブジェクトをポストオブジェクトに対応付けることができます。 

これらの新しいパラメータについての詳細は、それぞれのガイド、または [fields と expansions の使い方](/ja/x-api/fundamentals/data-dictionary#how-to-use-fields-and-expansions) に関するガイドを参照することをおすすめします。 

また、Standard v1.1 のフィールドを新しい v2 のフィールドにマッピングするのに役立つ [データ形式マイグレーションガイド](/ja/x-api/migrate/data-format-migration#migrating-from-standard-v1-1s-data-format-to-v2) も用意しています。このガイドでは、特定のフィールドを返すために v2 リクエストで指定する必要がある expansions パラメータおよびフィールド関連パラメータについても、具体的に説明しています。 
 

特定のフィールドのリクエスト方法の変更に加えて、X API v2 では API によって返されるオブジェクトの JSON デザインも新しく導入しています。これには [Post](/ja/x-api/fundamentals/data-dictionary#tweet) オブジェクトや [user](/ja/x-api/fundamentals/data-dictionary#user) オブジェクトが含まれます。

* JSON のルートレベルでは、Standard エンドポイントは `statuses` 配列内にポストオブジェクトを返しますが、X API v2 では `data` 配列を返します。 
* Retweeted および Quoted の「statuses」を参照する代わりに、X API v2 の JSON では Retweeted および Quoted のポストを参照します。`contributors` や `user.translator_type` のような、レガシーまたは非推奨の多くのフィールドが削除されます。 
* ポストオブジェクト内の `favorites` とユーザーオブジェクト内の `favourites` の両方を使用する代わりに、X API v2 では `like` という用語を使用します。 
* X では、値を持たない JSON 値（たとえば `null`）はペイロードに書き出さない、という方針を採用しています。ポストおよびユーザーの属性は、値が `null` でない場合にのみ含まれます。 
   

また、[Post オブジェクト](/ja/x-api/fundamentals/data-dictionary#tweet) には、次のような新しいフィールドセットも追加しました。

* [conversation&#95;id](/ja/x-api/fundamentals/conversation-id) フィールド
* `context` と `entities` を含む、2 つの新しい [annotations](/ja/x-api/fundamentals/post-annotations) フィールド
* 複数の新しい [metrics](/ja/x-api/fundamentals/metrics) フィールド 
* 特定のポストに誰が返信できるかを示す、新しい `reply_setting` フィールド

<div id="request-parameters">
  #### リクエストパラメータ
</div>

次の標準 v1.1 のリクエストパラメータには、X API v2 における対応パラメータがあります。

| Standard search v1.1 | Search Posts v2 |
| :--- | :--- |
| q   | query |
|     | start&#95;time (YYYY-MM-DDTHH:mm:ssZ) |
| until (YYYY-MM-DD) | end&#95;time (YYYY-MM-DDTHH:mm:ssZ) |
| since&#95;id | since&#95;id |
| max&#95;id | until&#95;id |
| count | max&#95;results |
| Response provides search&#95;metadata.next&#95;results | next&#95;token |

また、標準検索の Posts リクエストパラメータのうち、X API v2 ではサポートされて**いない**ものもあります。

| **Standard v1.1 parameter** | **詳細** |
| :--- | :--- |
| geocode | Basic Access レベルの Search Posts では、ジオ演算子はサポートされていません。 |
| locale | 標準検索では、クエリの言語を指定するために使用されていましたが、完全には実装されていませんでした。 |
| lang | Search Posts エンドポイントでは、関心のある言語にマッチさせるための lang クエリ演算子が提供されています。 |
| include&#95;entities | ポストのエンティティは常に含まれます。 |
| result&#95;type | Search Posts エンドポイントは、エンゲージメントレベルに関係なく、マッチしたすべてのポストを返します。 |
| extended | X API v2 は、最大 280 文字のポストをサポートすることを前提として一から設計されています。v2 では「extended」ポストという概念は存在しません。 |

以下は、Standard リクエストと Search Posts リクエストの違いを示すリクエスト例です。

|     |     |
| :--- | :--- |
| **Standard v1.1** | **X API v2** |
| https://api.x.com/1.1/search/tweets.json?q=snow&amp;count=50 | https://api.x.com/2/tweets/search/recent?query=snow&amp;max&#95;results=50 |

これらのリクエストはいずれも、キーワード snow を含む直近 50 件のポストを返します。v2 のリクエストでは、一致したポストのデフォルトの id および text フィールドが返されます。次に、JSON ペイロードに含める追加のポストおよびユーザーのフィールドを指定する例を示します。

|     |
| :--- |
| **X API v2** |
| https://api.x.com/2/tweets/search/recent?query=snow&amp;max&#95;results=50&amp;tweet.fields=id,created&#95;at,author&#95;id,text,source,entities,attachments&amp;user.fields=id,name,username,description |

**新しいクエリ演算子**

Search Posts では、X API v2 の次の 2 つの新機能をサポートする新しい演算子が導入されています。 

* **[Conversation IDs](/ja/x-api/fundamentals/conversation-id)** - X 上で会話が展開していくと、その会話に含まれるポストを識別するための Conversation ID が利用可能になります。会話内のすべてのポストでは、その会話を開始したポストの ID が conversation&#95;id に設定されます。 
  * `conversation_id:`
* **[X Annotations](/ja/x-api/fundamentals/post-annotations)** は、ポストに関するコンテキスト情報を提供し、エンティティおよびコンテキストアノテーションを含みます。エンティティは、人、場所、製品、組織で構成されます。コンテキストは、検出されたエンティティが属するドメインやトピックです。たとえば、ポストで言及されている人物には、アスリート、俳優、政治家などであることを示すコンテキストが付与される場合があります。  
  * context: 関心のあるコンテキストでアノテーションされたポストにマッチします。 
  * entity: 関心のあるエンティティでアノテーションされたポストにマッチします。 

     

<div id="and-or-operator-precedence">
  #### AND / OR 演算子の優先順位
</div>

検索クエリを構築する際の基本的な構成要素は、論理演算子 OR と AND の組み合わせです。standard search API では AND より先に OR が適用されますが、Search Posts エンドポイント（および Premium 版と Enterprise 版）では OR より先に AND が適用されます。2 つの間でクエリを変換する際には、この違いが非常に重要です。 

たとえば standard search では、キーワード「storm」を含み、さらに「colorado」という単語か #COwx ハッシュタグのいずれかを含むポストにマッチさせたい場合、次の検索クエリでそれを実現できます:

storm #COwx OR colorado

Search Posts の演算子の優先順位では、OR より先に AND が適用されます。そのため、上記のクエリは次のように解釈されます: 

(storm #COwx) OR colorado

しかし、上記のルールだと、「storm」や #COwx ハッシュタグの有無にかかわらず、「Colorado」に言及している任意のポストにマッチしてしまいます。加えて、キーワード「storm」と #COwx ハッシュタグの両方に言及しているポストにもマッチします。 

クエリを元々の意図どおりに動作させるには、OR 句をまとめてグループ化する必要があります。元の standard search のクエリを Search Posts 向けに変換すると、次のようになります:

storm (#COwx OR colorado)

この 2 つのルールは、マッチング動作が大きく異なります。2019年10月の場合、元のルールでは 1,175,000 件以上のポストにマッチしますが、正しく変換したルールでは約 5,600 件のポストにのみマッチします。AND と OR の扱いには注意し、必要に応じてかっこを使用してください。 

<div id="curl-requests">
  #### cURL リクエスト
</div>

**以下のセクションでは、v1.1 標準エンドポイントと、それに相当する v2 エンドポイントへの cURL リクエストを示します。**

これらのリクエストは [OAuth 2.0 アプリ専用フロー]([https://developer.x.com(/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token)](https://developer.x.com\(/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token\)) を使用して行われます。以下の cURL リクエストを実行するには、Authorization ヘッダー内の ACCESS&#95;TOKEN をアプリのアクセストークンに置き換える必要があります。v2 エンドポイントの場合、そのアクセストークンは、[Project](/ja/resources/fundamentals/projects/overview) 内の [developer App](/ja/resources/fundamentals/developer-apps/overview) に紐づいている必要があります。 

v1.1 エンドポイントから返されるレスポンスペイロードは、v2 エンドポイントから返されるレスポンスペイロードとは異なります。v2 では、レスポンスにはデフォルトのフィールドに加えて、[fields](/ja/x-api/fundamentals/fields) および [expansions](/ja/x-api/fundamentals/expansions) パラメータでリクエストされたその他のフィールドも含まれます。これらのパラメータを使用して、返されるフィールドのセットを変更できます。

**Standard v1.1 [GET search/tweets](https://developer.x.com/en/docs/twitter-api/v1/tweets/search/api-reference/get-search-tweets) と v2 [GET tweets/search/recent](/ja/x-api/posts/recent-search) エンドポイント**

```bash
      curl --request GET \
  --url 'https://api.x.com/1.1/search/tweets.json?q=from%3ATwitterDev%20-is%3Aretweet&count=100' \
  --header 'Authorization: Bearer $ACCESS_TOKEN'
```

```bash
      curl --request GET \
  --url 'https://api.x.com/2/tweets/search/recent?query=from%3ATwitterDev%20-is%3Aretweet&tweet.fields=created_at%2Cconversation_id%2Centities&max_results=100' \
  --header 'Authorization: Bearer $ACCESS_TOKEN'
```

**次のステップ**

[X API v2 の最近の検索用クイックスタートガイドを参照する](/ja/x-api/posts/search/quickstart/recent-search)

[最近の検索の API リファレンスを参照する](/ja/x-api/posts/recent-search)

[これらのエンドポイント用サンプルコードを参照する](https://github.com/xdevplatform/Twitter-API-v2-sample-code "これらのエンドポイント用サンプルコードを参照する")

[最近の検索に最初のリクエストを送信するためのステップバイステップのガイド](/ja/x-api/getting-started/make-your-first-request "最近の検索に最初のリクエストを送信するためのステップバイステップのガイド")
