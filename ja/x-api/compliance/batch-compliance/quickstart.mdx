---
title: クイックスタート
sidebarTitle: クイックスタート
keywords: ["batch compliance quickstart", "compliance batch quickstart", "compliance jobs quickstart", "batch compliance tutorial"]
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-batch-compliance-endpoints">
  ## バッチコンプライアンスエンドポイントの使用を開始する
</div>

バッチコンプライアンスエンドポイントを利用する際には、通常、次の5つの手順を実行します。

1. コンプライアンスジョブを作成する
2. ポストIDまたはユーザーIDのリストを準備する
3. ポストIDまたはユーザーIDのリストをアップロードする
4. コンプライアンスジョブのステータスを確認する
5. 結果をダウンロードする

このセクションでは、コマンドラインを使ってこれらそれぞれの手順を実行する方法を説明します。さまざまなプログラミング言語でのサンプルコードを確認したい場合は、[X API v2 sample code GitHub repository](https://github.com/xdevplatform/Twitter-API-v2-sample-code) を参照してください。

<div id="prerequisites">
  ### 前提条件
</div>

このガイドを完了するには、リクエストを認証するための [キーとトークン](/ja/resources/fundamentals/authentication) のセットが必要です。次の手順に従って、これらのキーとトークンを生成できます。

* [開発者アカウントにサインアップ](https://developer.x.com/en/apply-for-access) して、承認を受けてください。
* developer portal で [プロジェクト](/ja/resources/fundamentals/projects) と、それに関連付けられた [開発者アプリ](/ja/resources/fundamentals/developer-apps) を作成します。
* アプリの「Keys and tokens」ページにアクセスして、必要な認証情報を生成します。すべての認証情報は安全な場所に保存してください。

<div id="step-one-create-a-compliance-job">
  #### ステップ 1: コンプライアンスジョブを作成する
</div>

まず、コンプライアンスジョブを作成し、`type` パラメータを使用してポストIDをアップロードするのか、ユーザーIDをアップロードするのかを指定する必要があります。必要に応じて、`name` パラメータを使用してジョブに名前を付けることもできます。

このリクエストを認証するには、[App only](/ja/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token) を使用する必要があります。そのためには、以下の `$APP_ACCESS_TOKEN` を、開発者ポータル上の [X App](/ja/resources/fundamentals/developer-apps) で生成できる [App Access Token](/ja/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token) に置き換えてください。

`curl --request POST 'https://api.x.com/2/compliance/jobs' \ --header 'Authorization: Bearer $APP_ACCESS_TOKEN' \ --header 'Content-Type: application/json' \ --data-raw '{"type": "tweets"}'`

API 呼び出しが成功すると、次のようなレスポンスが返されます。

```
{
   "data": {
       "download_expires_at": "2021-08-18T19:42:55.000Z",
       "status": "created",
       "upload_url": "https://storage.googleapis.com/twttr-tweet-compliance/1425543269983784962/submission/1202726487847104512_1425543269983784962?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210811%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210811T194255Z&X-Goog-Expires=900&X-Goog-SignedHeaders=content-type%3Bhost&X-Goog-Signature=355e4c4739ae508304d3df15b4e13e64b6c7752d8d79d73676a4d8e60dc5241f83924ad2a1f8b7bddcc768062bb9c64d39b8e8f7cce7f66ffbea9f9ed33a4da975b3a2c127fb738c1c1ff3c3964bd4d9dc0706e6c8a70e67522160ea774e090d2793e06f890d1158ce86be3031c1c471b74f961b6f18743a28730611000336286ad0111b41fb5d14aa813ff00cf06b3572dc68d0b3c6fdc07f25c1b1196c1af4325a9ead68994944bbef0d2123585ea051deb9765aa7f5832446440bc9ba76af327b69df1fd7b1a99bd4419c128f1f697dbbacbc62bbc7c2c9aebc82a2128be0ed05d48a54d814162daad1232a0d13081e9543ab8557f567149af82281193f37",
       "created_at": "2021-08-11T19:42:55.000Z",
       "resumable": false,
       "id": "1425543269983784962",
       "type": "tweets",
       "download_url": "https://storage.googleapis.com/twttr-tweet-compliance/1425543269983784962/delivery/1202726487847104512_1425543269983784962?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210811%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210811T194255Z&X-Goog-Expires=604800&X-Goog-SignedHeaders=host&X-Goog-Signature=0a11dd5a3c5adb508f32ce904568abada863dc9499ba2adeafb3452ccee0dcb3dade17910dbc502dcbe54c130ac4d8638eb176c8b7344de068139b06c970794efa6312f0a5149f40da441eafcaf475f670c93ca73951999902a531d34dfab1e5490918929e5b06ae803b5604e0c0c26852255ccdbc79a2c1e2eefe924e5e6bf5b6603a7f287d1621333b9548ec6cc203716070528bebc2e67c12e92b1f4e54471db92c15a54799f2b855ae224250ca44c47993fd7d79a4940a0f68fe09f73fc8b291e88cfd10ade860b4b35c2b964d1777c1d93cd300c313138d9ca90aa8b3ecd3bf9dc73d3ebe32ba7634228fe07e1e4ecdda57cd94c802afc520162735d5a3",
       "upload_expires_at": "2021-08-11T19:57:55.000Z"
   }
}
```

upload&#95;url、download&#95;url、およびidフィールドの値をメモしておいてください。これらは次の手順で必要になります。

<div id="step-two-prepare-a-list-of-post-ids-or-user-ids">
  #### ステップ 2: ポストIDまたはユーザーIDのリストを準備する
</div>

各行に 1 つのポストIDまたはユーザーIDが含まれるように、ポストIDまたはユーザーIDを並べたテキストファイルを作成します。テキストファイルの内容は次のようになります。

1417856744319971329

1415457498803232770

1415348607813832708

1413515358766452738

. . .

. . .

<Note>
  **Note**: 上記のファイルには、ポストIDかユーザーIDのどちらか一方のみを含める必要があり、両方を混在させることはできません。

  このURLに対して **PUT** リクエストを送信することで、ファイルを直接アップロードできます。URL にはすでに認証トークンによる署名が行われているため、アプリのアクセストークンを再度渡して認証する必要はありません。テキストファイルをアップロードしていることを示すために Content-Type ヘッダーを必ず指定し、以下の $FILE&#95;LOCATION をファイルへのパスに置き換えてください。
</Note>

```
curl -X PUT  \
 -H "Content-Type: text/plain" \
 --data-binary @$FILE_LOCATION \
"https://storage.googleapis.com/twitter-compliance/customer_test_object_123456_d8ske9.json?X-Goog-Algorithm=\nGOOG4-RSA-SHA256&X-Goog-Credential=example%40example-project.iam.gserviceaccount\n.com%2F20181026%2Fus-central-1%2Fstorage%2Fgoog4_request&X-Goog-Date=20181026T18\n1309Z&X-Goog-Expires=900&X-Goog-SignedHeaders=host&X-Goog-Signature=247a2aa45f16\n9edf4d187d54e7cc46e4731b1e6273242c4f4c39a1d2507a0e58706e25e3a85a7dbb891d62afa849\n6def8e260c1db863d9ace85ff0a184b894b117fe46d1225c82f2aa19efd52cf21d3e2022b3b868dc\nc1aca2741951ed5bf3bb25a34f5e9316a2841e8ff4c530b22ceaa1c5ce09c7cbb5732631510c2058\n0e61723f5594de3aea497f195456a2ff2bdd0d13bad47289d8611b6f9cfeef0c46c91a455b94e90a\n66924f722292d21e24d31dcfb38ce0c0f353ffa5a9756fc2a9f2b40bc2113206a81e324fc4fd6823\na29163fa845c8ae7eca1fcf6e5bb48b3200983c56c5ca81fffb151cca7402beddfc4a76b13344703\n2ea7abedc098d2eb14a7"
```

ステータスコード 200 は、アップロードが正常に完了したことを示します。

<div id="step-three-optional-check-your-job-status">
  #### ステップ3（任意）: ジョブステータスを確認する
</div>

大きなアップロードは処理に時間がかかる場合があります。最初のステップで受け取ったジョブ ID を指定して、コンテンツコンプライアンスジョブ用エンドポイントからステータスの更新をリクエストできます。

同様に、以下の $APP&#95;ACCESS&#95;TOKEN は App のアクセストークンに、$ID は最初のステップのジョブ ID に置き換えてください。

`curl --request GET 'https://api.x.com/2/compliance/jobs/$ID' \ --header 'Authorization: Bearer $APP_ACCESS_TOKEN'`

レスポンスにはジョブに関する情報が含まれます。

```
{
   "data": {
       "upload_expires_at": "2021-08-05T01:50:11.000Z",
       "type": "tweets",
       "resumable": false,
       "download_url": "https://storage.googleapis.com/twttr-tweet-compliance/1423095206576984067/delivery/1202726487847104512_1423095206576984067?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210805%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210805T013511Z&X-Goog-Expires=604800&X-Goog-SignedHeaders=host&X-Goog-Signature=09de4feae68a6d4449eb7ce1f8f3551996552e7fba103005b3bd50ab318bb5215e4f5396ef29d17755deb6bf172b9d1dab61a04b249d39e87f6e2dbb31632b7e5f2d35f4f534e1f1522c9d7958b8745dd62471deb8d6992c80fd418628404f5f14eda3f557adf709403058910ea009e0c88ce81458ec9b915016a5c5901e2365b130db00b18fcb7da1b082e1a5c75f7bf7eeab8783675d1b6a56441ac6e9ffc972b1278a5853d2b94dda55e1a6e2068bc0ddd3cddc9213ec9cebb7cb5be931977bb28dda12c7c5e69d1f876b243f0f224076bf1b81149603319a2fc9cb82337bdbe05e7bbf184bcbdc17d43b3f5efbae72ea386d955ca10e702e00df31aabf32",
       "id": "1423095206576984067",
       "status": "expired",
       "created_at": "2021-08-05T01:35:11.000Z",
       "upload_url": "https://storage.googleapis.com/twttr-tweet-compliance/1423095206576984067/submission/1202726487847104512_1423095206576984067?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210805%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210805T013511Z&X-Goog-Expires=900&X-Goog-SignedHeaders=content-type%3Bhost&X-Goog-Signature=ba08f588bea3873aa0465cf22015e583c2851a5ff14891d22430b1127288728f1aa303673e6895694e7017739871ff5ae59bbcde7d4ac7a14aaaafba98ad22ca818e99fb3ec7eaaf74b3ecfecbfb33711869b2e85d7666609276666ef4a8b396ae9616743a0cbd773962e5850f2942cd76be7373d608a140e041ca8492017d43fac9220fa145d0b2ecaf9f752d71fc8c4b81b67c5c22aa59ac87666f7d83714fdace72894d2911a3e36dd42028d0222e71054d6b28c8ef63d0f0000f228c8680bab9c8011b87d1a6c9a60e8cc9e8b6a83abf7c47a57772746c83b19849f5b4c938ccd0922990da5f2a81ff806edcb4667bb402fb1f1f6f5162768e0661648b21",
       "download_expires_at": "2021-08-12T01:35:11.000Z"
   }
}
```

status が complete の場合、結果をダウンロードできる状態であることを意味します。注: status の値としては、created、complete、in&#95;progress、failed、expired が設定される可能性があります

<div id="step-four-download-the-results">
  #### ステップ4：結果をダウンロードする
</div>

ジョブ完了ステータスを受け取ったら、download&#95;url フィールド（最初のステップで生成されたもの）に示されている URL からコンプライアンス結果をダウンロードできます。この URL にはすでに認証トークンによる署名が付与されているため、アプリのアクセストークンを渡して再度認証する必要はありません。

```
curl --request GET \
'https://storage.googleapis.com/twttr-tweet-compliance/1423047488781488129/delivery/1202726487847104512_1423047488781488129?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210804%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210804T222534Z&X-Goog-Expires=604800&X-Goog-SignedHeaders=host&X-Goog-Signature=8ed0fe9e9748f6be5e7e052f6635c8b5cbe62fb2d3a165278b922b28a48fb79b02d74f0bd31b4fdb32532bc6746c6082aaff2154cdab4b59c4c6561ff2c840e5f32dd13c09ff5b52376dfac1b7f97807c72209d2844a6c078b71fddf22a5493f88118802e98a60e16ce5715fce0242baddd17d4598d31be59393e1dacd22fc1eeb532572cc4e784402c5fbeb84a22dd308922e937a26fa99cb717bb26fb61b657403010121a996691814b7aeb00bc05ed25f15d394fd46899dd9390be6d5da44960e81d8018318c325c70b39d0a4fc9d65fea2b8b3355d4c7dd7c386eac1d9c09233462bde40fa3f4023d1cd6470b0346f9f36d74665dde3f716940312019703'
```

結果には、複数の JSON オブジェクト（1 行につき 1 つのオブジェクト）が含まれます。各オブジェクトには、ポストまたはユーザーの ID、ポストまたはユーザーの作成日時（ポストを日付ごとに整理して特定するのに便利）、必要なアクション、コンプライアンス対応が必要な理由、およびコンプライアンス対応の日時が含まれます。

```
{"id":"1265324480517361664","action":"delete","created_at":"2019-10-29T17:02:47.000Z","redacted_at":"2020-07-29T17:02:47.000Z","reason":"deleted"}
{"id":"1263926741774581761","action":"delete","created_at":"2019-10-29T17:02:47.000Z","redacted_at":"2020-07-29T17:02:47.000Z","reason":"protected"}
{"id":"1265324480517361669","action":"delete","created_at":"2019-10-29T17:02:47.000Z","redacted_at":"2020-07-29T17:02:47.000Z","reason":"suspended"}
```

コードで各JSON行をパースし、ポストまたはユーザーのIDを特定して、そのIDに対応するポストおよびユーザーをデータセットから削除することで、コンプライアンスを維持できます。アップロードしたIDに対応するJSONオブジェクトが存在しない場合、そのIDはコンプライアンス上問題ないとみなせます。

**注記**: すべてのコンプライアンスイベントに redacted&#95;at フィールドが含まれるわけではありません。
