---
title: "Account Activity API: Enterprise"
keywords: ["enterprise Account Activity API", "enterprise AAA", "Account Activity enterprise", "enterprise webhooks", "enterprise activity"]
---

<Note>
  このエンドポイントは、ポスト編集メタデータを含むように更新されています。これらのメタデータの詳細については、[「ポストの編集」基本事項のページ](/ja/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets)をご覧ください。 

  このエンドポイントは、Direct Messages エンドポイントと併用されることがよくあります。新しい [v2 Direct Messages エンドポイント](/ja/x-api/direct-messages/manage/introduction)を公開しました。Enterprise および Premium Account Activity API は v2 の 1 対 1 のメッセージをサポートしていますが、グループ会話はまだサポートしていない点に注意してください。   
</Note>

Overview

`Enterprise`

Account Activity API は、webhook を介してユーザーアカウントに関連するアクティビティをリアルタイムで購読する機能を提供します。これは、1 つの接続を通じて、あなたが所有している、または購読している 1 つ以上のアカウントから、リアルタイムのポスト、Direct Messages、その他のアカウントイベントを受信できることを意味します。

Webhook 登録ごとの各ユーザーサブスクリプションについて、以下のすべての関連アクティビティを受信します。

| Activity types |     |
| :--- | :--- |
| * ポスト（ユーザーによる）  <br />    <br />* ポストの削除（ユーザーによる）<br />* @メンション（ユーザー宛て）<br />* 返信（ユーザーから、またはユーザー宛て）<br />* リポスト（ユーザーによる、またはユーザー宛て）<br />* 引用ポスト（ユーザーによる、またはユーザー宛て）<br />* 引用ポストのリポスト（ユーザーによる、またはユーザー宛て）<br />* いいね（ユーザーによる、またはユーザー宛て）<br />* フォロー（ユーザーによる、またはユーザー宛て）  <br />    <br />* フォロー解除（ユーザーによる） | * ブロック（ユーザーによる）<br />* ブロック解除（ユーザーによる）<br />* ミュート（ユーザーによる）<br />* ミュート解除（ユーザーによる）<br />* 送信された Direct Messages（ユーザーによる）<br />* 受信した Direct Messages（ユーザー宛て）<br />* 入力中インジケーター（ユーザー宛て）<br />* 既読通知（ユーザー宛て）<br />* サブスクリプションの解除（ユーザーによる） |

**注意** - Account Activity API 経由ではホームタイムラインのデータは配信されません。このデータを取得するには、[GET statuses/home&#95;timeline](https://developer.x.com/en/docs/x-api/v1/tweets/timelines/overview) を使用してください。
 

<div id="video-series">
  #### 動画シリーズ
</div>

Account Activity API の概要を手早く把握するには、[全4回の動画シリーズ](https://www.youtube.com/watch?v=otPxejFhyy8\&index=0\&list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg)をご覧ください。

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRyZWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=996790447048613888&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Foverview&sessionId=81f4a0339cbd7bd77b669faa00bd3a7224bc4418&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" height="400px" />

<div id="feature-summary">
  ### 機能の概要
</div>

| ティア | 価格 | 一意のサブスクリプション数 | webhook 数 | 信頼性とアクティビティのリカバリ |
| :--- | :--- | :--- | :--- | :--- |
| Enterprise | [営業担当へのお問い合わせ](/ja/x-api/enterprise-gnip-2.0/enterprise-gnip) | 最大 500 件以上 | 3 以上 | [再試行](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) および [リプレイ](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) |

* ご不明な点やエラーが発生していますか？
  * [FAQ（よくある質問）](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) または [エラーのトラブルシューティングガイド](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) をお読みください。

* サンプルコードをご覧ください:
  * [Enterprise Account Activity API ダッシュボード](https://github.com/xdevplatform/account-activity-dashboard-enterprise): Enterprise ティアの Account Activity API を使用して webhook イベントを表示し、[リプレイ](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) 機能を備えた、Node で構築された Web アプリケーションです。
  * [SnowBot チャットボット](https://github.com/xdevplatform/SnowBotDev): Enterprise の Account Activity API および Direct Message API を利用して構築された、Ruby 製の Web アプリケーションです。

<div id="manage-webhooks-and-subscribed-users">
  ## Webhook と購読ユーザーを管理する
</div>

**⏱ 読了目安: 10 分**

Enterprise Account Activity API は、お使いのサービスを購読している X アカウントに関連するイベントが発生するたびに、webhook ベースの JSON メッセージを送信します。X はこれらのアクティビティを、登録済みの webhook に配信します。以下の手順では、webhook と購読ユーザーの管理方法について説明します。

webhook と購読ユーザーの両方について、登録、確認、削除の方法を学びます。各種 API エンドポイントにリクエストするために、シンプルな cURL コマンドを使用します。cURL は、URL 構文を使ってリクエストを取得または送信するためのコマンドラインツールです。

必要なもの:

* 登録済みの X アプリ - *[こちらから登録](https://developer.x.com/content/developer-twitter/en/apps)*
* Bearer Token - *[詳細はこちら](/ja/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)*
* Challenge-Response Check (CRC) をパスする webhook - *[詳細はこちら](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)*
* Enterprise アカウント - *[こちらから申請](https://developer.x.com/en/products/x-api/enterprise)*

*作業を始める前に、X の Account Activity API を使い始めるためのサンプル web アプリとヘルパースクリプトを提供している [GitHub リポジトリ](https://github.com/xdevplatform/account-activity-dashboard) もご覧になることをおすすめします。*

<div id="managing-a-webhook">
  #### Webhook の管理:
</div>

Webhook を使用すると、1 つの接続でユーザーアカウントに関連するリアルタイムアクティビティを購読できるようになります。 

<Tabs>
  <Tab title="Webhook を追加する">
    対象のアプリケーションコンテキスト用に、新しい webhook URL を登録することから始めます。

    URL は保存前に CRC リクエストによって検証されます。Webhook を登録したら、後で必要になるため、必ず webhook ID を控えておいてください。

    次の項目を変更したうえで、以下の cURL リクエストをコマンドラインにコピーして実行します。

    * **URL** `<URL>` 例: `https://yourdomain.com/webhooks/twitter/`

    * **Consumer key** `<CONSUMER_KEY>` 例: `xvz1evFS4wEEPTGEFPHBog`

    * **Access token** `<ACCESS_TOKEN>` 例:  `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url 'https://api.x.com/1.1/account_activity/webhooks.json?url=<URL>' --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Webhook を表示する">
    対象のアプリケーションに対して、登録済みのすべての webhook URL とそのステータスを返す次のコマンドを実行します。

    次の項目を変更したうえで、以下の cURL リクエストをコマンドラインにコピーして実行します。

    * **Bearer token** `<BEARER_TOKEN>` 例: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```curl --request GET --url https://api.x.com/1.1/account_activity/webhooks.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Webhook を削除する">
    対象のアプリケーションの設定から webhook を削除するには、次の項目を変更したうえで、以下の cURL リクエストをコマンドラインにコピーして実行します。

    * **Webhook ID** `<:WEBHOOK_ID>` 例: `1234567890`

    * **Consumer key** `<CONSUMER_KEY>` 例: `xvz1evFS4wEEPTGEFPHBog`

    * **Access token** `<ACCESS_TOKEN>` 例:  `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

<div id="managing-subscribed-users">
  #### 購読ユーザーの管理:
</div>

Webhook を登録したら、そのユーザーのアカウントアクティビティを受信し始めるために、Account Activity API に購読ユーザーを追加できます。

<Tabs>
  <Tab title="購読の追加">
    まずはユーザーを購読して、すべてのイベントタイプを受信できるようにします。

    次の cURL リクエストを、以下の項目を変更したうえでコマンドラインにコピーして実行してください。

    * **Webhook ID** `<:WEBHOOK_ID>` 例: `1234567890`

    * **Consumer key 名** `<CONSUMER_KEY>` 例: `xvz1evFS4wEEPTGEFPHBog`

    * **購読対象ユーザーのアクセストークン** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` 例: `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<SUBSCRIBING_USER'S_ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="購読状況の確認">
    特定の Webhook に対するあらゆるアクティビティタイプの購読一覧を表示するには、以下の項目を変更したうえで、次の cURL リクエストをコマンドラインにコピーして実行してください。

    * **Webhook ID** `<:WEBHOOK_ID>` 例: `1234567890`

    * **Bearer Token** `<BEARER_TOKEN>` 例: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```
      curl --request GET --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all/list.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="購読の削除">
    無効化後、リクエスト元ユーザーに対するすべてのイベントは、Webhook URL へ送信されなくなります。

    指定されたユーザーコンテキストとアプリケーションから購読を無効化するには、以下の項目を変更したうえで、次の cURL リクエストをコマンドラインにコピーして実行してください。

    * **Webhook ID** `<:WEBHOOK_ID>` 例: `1234567890`

    * **Consumer key** `<CONSUMER_KEY>` 例: `xvz1evFS4wEEPTGEFPHBog`

    * **購読対象ユーザーのアクセストークン** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` 例: `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

これで Webhook と購読ユーザーを管理できるようになりました。

<div id="referenced-articles">
  #### 参照記事
</div>

* [チャレンジレスポンスチェック (CRC) の概要](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)
* [Account Activity のデータ型](/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure
* [Webhook とサブスクリプションの管理](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions)

<div id="a-video-walkthrough-of-the-account-activity-api">
  ## Account Activity API のビデオウォークスルー
</div>

このビデオウォークスルーでは、Account Activity API の Premium ティアと Enterprise ティアで利用できる機能について学びます。

ビデオを最後まで見ると、次の機能について理解できるようになります。

* webhook の登録
* ユーザーサブスクリプションの追加
* ユーザーサブスクリプションの解除
* アカウントアクティビティの受信
* アカウントアクティビティのリプレイ

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRyZWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=1204084171334832128&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Fquick-start%2Fa-visual-walkthrough-of-the-account-activity-api&sessionId=b5b8e259a4c6287be2413de9059093170036fb30&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" />

* 質問がありますか？ エラーに遭遇していますか？
  * [よくある質問](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) や [エラーのトラブルシューティングガイド](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) をお読みください。

* サンプルコードをご覧ください：
  * [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise) は、Account Activity API の Enterprise ティアを使用して webhook イベントを表示し、[Replay](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) 機能を備えた Node.js 製のウェブアプリです。
  * [SnowBot chatbot](https://github.com/xdevplatform/SnowBotDev) は、Enterprise Account Activity API と Direct Message API を利用して構築された Ruby 製のウェブアプリです。

**Enterprise**

<div id="getting-started-with-webhooks">
  ## Webhook の利用を開始する
</div>

Account Activity API は、あなたが開発・デプロイ・ホストする Web アプリにアカウントイベントを送信する、webhook ベースの API です。 

イベントを受信するアプリケーションで webhook イベントを受け取れるようにする前に、いくつか事前に対応しておくべき基盤的な設定があります。以下のとおり、X アプリを作成し、Account Activity API へのアクセス権を取得し、webhook イベントを受信して処理する Web アプリを開発する必要があります。 

<div id="1-create-a-x-app">
  ### 1. X アプリを作成する
</div>

* [developer portal](/ja/resources/fundamentals/developer-portal) の承認済み開発者アカウントで [X app](/ja/resources/fundamentals/developer-apps) を作成します。自社を代表してアプリを作成する場合は、会社の公式 X アカウントでアプリを作成することを推奨します。開発者アカウントを申請するには、[こちらをクリック](/ja/resources/fundamentals/developer-apps)してください。
* アプリページの [permissions](/ja/resources/fundamentals/developer-apps#oauth-1-0a-app-permissions) タブで「Read, Write and Access direct messages」を有効にします。
* &quot;Keys and Access Tokens&quot; タブで、アプリの Consumer Key (API Key) と Consumer Token (API Secret) を控えておきます。
* 同じタブで、アプリの [Access Token と Access Token Secret](/ja/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) を生成します。これらの Access Token は、X がアカウントイベントを送信する webhook URL を登録する際に必要になります。
* [X Sign-in](/ja/resources/fundamentals/authentication#log-in-with-x) や、X API におけるユーザーコンテキストの仕組みに不慣れな場合は、[Obtaining Access Tokens](https://dev.x.com/webhooks/access-tokens) を確認してください。イベントを受信するアカウントを追加するときは、そのアカウントの Access Token を使用してサブスクライブします。
* [developer portal](/ja/resources/fundamentals/developer-portal) の [&quot;Apps&quot;](/ja/resources/fundamentals/developer-apps) ページに表示されるアプリの数値 ID を控えておきます。Account Activity API アクセスを申請する際に、このアプリ ID が必要になります。
   

<div id="2-get-account-activity-api-access">
  ### 2. Account Activity API へのアクセスを取得する
</div>

X アプリを作成したら、次のステップは、Account Activity API へのアクセスを申請することです。 

Account Activity API は Enterprise でのみ利用可能なため、以下のリンクから申請を行う必要があります。

<Button href="https://developer.x.com/en/enterprise-application.html">
  Enterprise アクセスを申請
</Button>

<div id="3-develop-webhook-consumer-app">
  ### 3. Webhook コンシューマーアプリの開発
</div>

Account Activity API へのアクセス権を取得したら、X の webhook イベントを受信する Web アプリを開発し、デプロイしてホストする必要があります。 

* イベントを受信するための webhook として使用する URL を持つ Web アプリを作成します。これは、受信する X webhook イベントを待ち受けるためにサーバー上にデプロイされるエンドポイントです。 
  * URI の *path* は完全に任意です。次の例は有効です: https://mydomain.com&#95;/service/listen&#95;

  * さまざまなソースからの webhook を受信する場合、一般的なパターンは次のようになります: https://mydomain.com/webhook/twitter

  * 指定する URL にはポート番号を含めることはできない点に注意してください (https://mydomain.com:5000/NoWorkie は不可)。

* [Securing Webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) ガイドで説明しているように、最初のステップは、X Challenge Response Check (CRC) の GET リクエストを受信し、正しくフォーマットされた JSON レスポンスで応答するコードを書くことです。 

* Webhook の URL を登録します。/webhooks.json?url= エンドポイントに対して POST リクエストを送信します。このリクエストを行うと、X は Web アプリに CRC リクエストを送信します。Webhook が正常に登録されると、レスポンスには webhook の id が含まれます。この webhook id は、後で一部の Account Activity API リクエストを行う際に必要になります。 

* X は、登録した URL にアカウントの webhook イベントを送信します。Web アプリが、受信イベントに対する POST リクエストをサポートしていることを確認してください。これらのイベントは JSON でエンコードされます。Webhook の JSON ペイロード例については、[こちら](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure) を参照してください。

* Web アプリの準備ができたら、次のステップはアクティビティを受信するアカウントを追加することです。アカウントを追加 (または削除) する際には、そのアカウント id を参照する POST リクエストを送信します。詳しくは、[購読の追加に関するガイド](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions) を参照してください。

<div id="4-validate-setup">
  ### 4. セットアップを検証する
</div>

* アプリと webhook が正しく構成されていることを検証するには、アプリが購読している X アカウントのいずれかのポストに「いいね」を付けてください。購読しているアカウントに「いいね」が付くたびに、各「いいね」について webhook URL に対して POST リクエスト経由で `favorite_events` が届くはずです。
* 購読が追加されてからイベントの配信が開始されるまで、最大で 10 秒かかる場合があることに注意してください。

**重要な注意事項**

* webhook URL を登録する際、Web アプリはコンシューマートークンとシークレット *に加えて、アプリ所有者のユーザーアクセストークンとシークレット* で認証する必要があります。 

* すべての受信ダイレクトメッセージは webhook 経由で配信されます。 [POST direct&#95;messages/events/new (message&#95;create)](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) 経由で送信されたすべてのダイレクトメッセージも、webhook 経由で配信されます。これは、別のクライアント経由で送信されたダイレクトメッセージを Web アプリが把握できるようにするためです。

* すべての webhook イベントには、どの購読に対してイベントが配信されたかを示すユーザー ID である `for_user_id` が含まれていることに注意してください。

* 同じ会話内で 2 人のユーザーがダイレクトメッセージ用にあなたの Web アプリを使用している場合、webhook は重複した 2 つのイベント（ユーザーごとに 1 つ）を受信します。Web アプリ側でこれを考慮する必要があります。 

* 同じ webhook URL を共有し、同じユーザーが各アプリにマッピングされている Web アプリが複数ある場合、同じイベントが（Web アプリごとに 1 回ずつ）複数回 webhook に送信されます。

* 場合によっては、webhook が重複したイベントを受信することがあります。webhook アプリはこれを許容し、イベント ID によって重複排除を行う必要があります。

* クイックリプライのレスポンスがリクエストに直接続いて返ってくることは想定しないでください。ユーザーはクイックリプライのリクエストを無視し、従来のダイレクトメッセージで返信することもできます。また、ユーザーはメッセージスレッド内で以前に返信していないリクエストに対して、後からクイックリプライのレスポンスを送信することもあります。

* コード例を参照してください：
  * [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise) は、Account Activity API の Enterprise ティアを使用して webhook イベントを表示し、[Replay](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) 機能を備えた Node 製の Web アプリです。

  * [SnowBot chatbot](https://github.com/xdevplatform/SnowBotDev) は、Account Activity API と Direct Message API 上に構築された Ruby 製の Web アプリです。このコードベースには、Account Activity API の webhook セットアップを支援する [スクリプト](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) が含まれています。

<div id="securing-webhooks">
  ## Webhook のセキュリティ確保
</div>

X の webhook ベースの API では、webhook サーバーのセキュリティを確認するために、次の 2 つの方法を提供しています。

1. Challenge-Response チェックにより、webhook イベントを受信する Web アプリの所有権を X が確認できます。 
2. 各 POST リクエストの署名ヘッダーにより、受信した webhook の送信元が X であることを検証できます。
    

<div id="challenge-response-checks">
  ### チャレンジレスポンスチェック
</div>

アプリと webhook URL の両方の所有者があなたであることを検証するために、X は Challenge-Response Check (CRC) を実行します。これは循環冗長検査 (cyclic redundancy check) とは別物です。CRC が送信されると、X は `crc_token` パラメータを付けてあなたの Web アプリに対して GET リクエストを行います。このリクエストを受信した際、あなたの Web アプリは、`crc_token` パラメータとアプリの Consumer Secret（詳細は後述）に基づいて暗号化された `response_token` を生成する必要があります。`response_token` は JSON 形式でエンコードされていなければならず（下記の例を参照）、3 秒以内に返す必要があります。成功すると、webhook の `id` が返されます。 

CRC は webhook URL を登録する際に送信されるため、CRC レスポンスコードを実装することは最初の基本ステップとなります。webhook が確立された後は、直近で成功したレスポンスを受信してからおよそ 24 時間ごとに、X が CRC をトリガーします。あなたのアプリ側からも、webhook の `id` を指定して PUT リクエストを行うことで、必要に応じて CRC をトリガーできます。CRC をトリガーするのは、webhook アプリケーションの開発中や、新しいコードをデプロイしてサービスを再起動した後などに有用です。 

`crc_token` は、受信する各 CRC リクエストごとに異なる値になることを想定し、計算時にはこの値をメッセージとして使用し、Consumer Secret を鍵として使用する必要があります。

レスポンスが 3 秒以内に返されない場合や、無効になった場合、イベントは登録済みの webhook には送信されなくなります。

<div id="the-crc-request-will-occur">
  #### CRC リクエストが発生するタイミング:
</div>

* webhook URL を登録したとき。
* webhook URL を検証するために、およそ *1 時間ごと*。
* PUT リクエストを送信することで、CRC を手動でトリガーできます。webhook クライアントを開発する際は、CRC レスポンスの実装に合わせて、CRC を手動でトリガーすることも計画しておく必要があります。 
   

<div id="response-requirements">
  #### レスポンス要件:
</div>

* `crc_token` とアプリの Consumer Secret から生成された、base64 でエンコードされた HMAC-SHA256 ハッシュ
* 有効な response&#95;token を含む JSON フォーマットであること。
* レイテンシが 3 秒未満であること。
* HTTP レスポンスコード 200 であること。
   

<div id="language-specific-hmac-libraries">
  #### プログラミング言語ごとの HMAC ライブラリ:
</div>

* [Java/Scala](https://docs.oracle.com/javase/8/docs/api/index.html?javax/crypto/Mac.html)
* [Ruby](http://ruby-doc.org/stdlib-2.1.0/libdoc/openssl/rdoc/OpenSSL/HMAC.html)
* [Node.js](https://nodejs.org/api/crypto.html#crypto_class_hmac)
* [Python](https://docs.python.org/2/library/hmac.html)

<div id="example-response-token-generation-in-python">
  #### Python におけるレスポンストークン生成の例:
</div>

次のコードは、Python 2.7 の Flask Web アプリで、チャレンジレスポンスチェックに正しく応答するルートを定義しています。

```
import base64
import hashlib
import hmac
import json


\# Defines a route for the GET request
@app.route('/webhooks/twitter', methods=\['GET'\])
def webhook_challenge():

  # 受信トークンとコンシューマーシークレットからHMAC SHA-256ハッシュを作成します
  sha256\_hash\_digest = hmac.new(TWITTER\_CONSUMER\_SECRET, msg=request.args.get('crc_token'), digestmod=hashlib.sha256).digest()

  # base64エンコードされたハッシュを使用してレスポンスデータを構築します
  response = {
    'response\_token': 'sha256=' + base64.b64encode(sha256\_hash_digest)
  }

  # 適切にフォーマットされたJSONレスポンスを返します
  return json.dumps(response)
```

<div id="example-json-response">
  #### JSON レスポンス例:
</div>

上記のようにルートを定義している場合、Web ブラウザで [https://your-app-domain/webhooks/twitter?crc&#95;token=foo](https://your-app-domain/webhooks/twitter?crc_token=foo) にアクセスすると、Web アプリは次のようなレスポンスを返すはずです。

```
{
  "response_token": "sha256=x0mYd8hz2goCTfcNAaMqENy2BFgJJfJOb4PdvTffpwg="
}
```

<div id="other-examples">
  #### その他の例:
</div>

* [HERE](https://github.com/xdevplatform/account-activity-dashboard/blob/master/helpers/security.js) は、Node.js で実装された CRC レスポンスメソッドの例です。
* [HERE](https://github.com/xdevplatform/SnowBotDev/blob/master/app/controllers/snow_bot_dev_app.rb) は、Ruby で実装された CRC レスポンスメソッドの例です（*generate&#95;crc&#95;response* メソッドと、CRC イベントを受信する /GET ルートを参照してください）。

<div id="optional-signature-header-validation">
  ### 任意のシグネチャーヘッダーの検証
</div>

X からの POST リクエストを受信する場合、Webhook を作成するための GET リクエストを送信する場合、または手動 CRC を実行するための GET リクエストを送信する場合、ハッシュシグネチャーが `x-twitter-webhooks-signature` としてヘッダーに渡されます。このシグネチャーを使用して、データの送信元が X であることを検証できます。POST のハッシュシグネチャーは `sha256=` から始まり、これは HMAC SHA-256 を使用して X アプリの Consumer Secret とペイロードを暗号化していることを示します。GET のハッシュは、クエリパラメーター文字列 `crc_token=$token&nonce=$nonce` から計算されます。 

**リクエストを検証する手順**

1. Consumer Secret と受信したペイロード本体を使用してハッシュを生成します。
2. 生成したハッシュと、base64 エンコードされた `x-twitter-webhooks-signature` の値を比較します。[compare&#95;digest](https://docs.python.org/2/library/hmac.html) のようなメソッドを使用して、タイミング攻撃に対する脆弱性を低減します。

<div id="additional-security-guidelines">
  ### 追加のセキュリティガイドライン
</div>

以下は、Web アプリケーションで検討すべき追加のセキュリティガイドラインです。これらのガイドラインを実装していなくても webhook は機能しますが、X 情報セキュリティ チームにより強く推奨されています。以下の推奨事項についてよく分からない場合は、サーバー管理者に相談してください。

<div id="x-aggregate-network-blocks">
  #### X 集約ネットワークブロック
</div>

セキュリティをさらに強化するために、以下の集約ネットワークブロックを許可リストに追加することを検討してください。

* 199.59.148.0/22

* 199.16.156.0/22

* 192.133.77.0/26

* 64.63.15.0/24

* 64.63.31.0/24

* 64.63.47.0/24

* 202.160.128.0/24

* 202.160.129.0/24

* 202.160.130.0/24

<div id="recommended-server-configurations">
  #### 推奨サーバー構成
</div>

* [ssllabs.com](http://ssllabs.com/) のテストで &quot;A&quot; 評価を取得する
* **TLS 1.2 を有効にする**
* Forward Secrecy を有効にする
* SSLv2 を無効にする
* SSLv3 を無効にする（POODLE 対策）
* TLS 1.0 を無効にする
* TLS 1.1 を無効にする
* TLS 圧縮機能を無効にする
* セッションチケットキーをローテーションしない限り、Session Tickets を無効にする
* SSL 設定で “ssl&#95;prefer&#95;server&#95;ciphers” または “SSLHonorCipherOrder” オプションを “on” に設定する
* 暗号スイートのリストが、次のような最新のリストになっていることを確認する:
  `ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:DES-CBC3-SHA`

<div id="managing-webhooks-and-subscriptions">
  ## Webhook およびサブスクリプションの管理
</div>

<div id="creating-changing-webhooks">
  ### Webhook の作成と変更
</div>

Webhook URL を変更するには、既存の webhook を削除してから新しい webhook を作成する必要があります。この操作を行った場合は、新しい webhook に対してユーザーサブスクリプションを再度追加する必要があることに注意してください。

<div id="webhook-configuration-management-endpoints">
  #### Webhook 構成管理エンドポイント:
</div>

|     |     |
| :--- | :--- |
| **Method** | Enterprise |
| webhook URL を登録し、webhook&#95;id を生成します | [POST webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| すべての webhook URL とそのステータスを返します | [GET webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| アプリの現在の webhook 構成を削除します | [DELETE webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| CRC リクエストを手動でトリガーします | [PUT webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |

<div id="why-cant-i-just-update-the-webhook-url">
  #### webhook URL を更新するだけではいけないのはなぜですか？
</div>

なぜ webhook 構成は変更できないのでしょうか？X はセキュリティを非常に重視しています。webhook URL が変更された場合、アプリケーションの consumer key と consumer secret が漏えいしている可能性があります。新しい webhook 構成の作成を必須にすることで、ユーザーのイベントへの再サブスクライブも必須になります。これには、悪意のある第三者が保有している可能性が低いアクセストークンの使用が必要です。その結果、第三者がユーザーの非公開情報を受け取る可能性が低くなります。
 

<div id="adding-removing-user-subscriptions">
  ### ユーザーサブスクリプションの追加と削除
</div>

Enterprise プランでは、数千件規模のサブスクリプションに対応しています。すでにアカウントマネージャーがいる場合は、質問があればその担当者にお問い合わせください。Enterprise API へのアクセスを申請するには、[こちら](https://developer.x.com/en/products/x-api/enterprise)から行ってください。 

<div id="subscription-management-endpoints">
  #### サブスクリプション管理エンドポイント
</div>

|     |     |
| :--- | :--- |
| メソッド | Enterprise |
| 新しいユーザーサブスクリプションを追加 | [POST webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| ユーザーサブスクリプションを取得 | [GET webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| すべての有効なサブスクリプションのリストを返す | [GET webhooks/:webhook&#95;id/subscriptions/all/list](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| アプリケーション専用 OAuth を使用してユーザーサブスクリプションを無効化 | [DELETE webhooks/:webhook&#95;id/subscriptions/:user&#95;id/all.json](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |

Account Activity API: Enterprise

<Note>
  **ご注意ください**:

  API の使用を開始する前に、X が開発者アプリに対して Account Activity API へのアクセスを有効化する必要があります。そのため、認証に使用する予定のアプリ ID を、アカウントマネージャーまたはテクニカルサポートチームに必ず共有してください。
</Note>

[Account Activity API](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity) は、一連のエンドポイントで構成されており、単一の接続を通じて、購読中のすべてのアカウントのリアルタイムなアカウントアクティビティを受信するためのユーザーサブスクリプションを作成および管理できます。 

Account Activity API で利用できる認証方法は 2 種類です（[OAuth 1.0a](/ja/resources/fundamentals/authentication#oauth-1-0a-2) と [OAuth 2.0 Bearer Token](/ja/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)）。どの認証方法を使用するかは、利用するエンドポイントによって異なります。

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Description** | **Endpoint ** | OAuth 1.0a  <br />(ユーザーコンテキスト) | OAuth 2.0 Bearer Token (アプリケーション専用) |
| 指定されたアプリケーションコンテキスト用の新しい webhook URL を登録します | [POST account&#95;activity/webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| 指定されたアプリケーションに対するすべての URL とそのステータスを返します | [GET account&#95;activity/webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| 指定された webhook の URL に対して CRC（Challenge Response Check）をトリガーします | [PUT account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| アプリケーションをユーザーのアカウントイベントを購読するようにします | [POST account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| 現在アクティブなサブスクリプションの件数を返します | [GET account&#95;activity/subscriptions/count](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| webhook 設定がユーザーのイベントを購読しているかどうかを確認します | [GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| 現在アクティブなサブスクリプションの一覧を返します | [GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all/list](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| webhook を削除します | [DELETE account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| [DEPRECATED] 指定されたユーザーコンテキストおよびアプリケーションのサブスクリプションを無効化します | [DELETE account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ * |     |
| アプリケーション専用の OAuth を使用してサブスクリプションを無効化します | [DELETE /account&#95;activity/webhooks/:webhook&#95;id/subscriptions/:user&#95;id/all.json](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| アクティビティを webhook に再配信します | [POST /1.1/account&#95;activity/replay/webhooks/:webhook&#95;id/subscriptions/all.json](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

*&#95; 認証には、サブスクライブするユーザーのアクセストークンが必要です。 &#95;

OAuth 1.0a ユーザーコンテキスト認証を必要とするエンドポイントについては、リクエストを認証するために次の認証情報を指定する必要があります。 

* Consumer Keys (API Key and Secret)
* Access Tokens (Access Token and Secret)

次の 3 つのエンドポイントの場合、X ユーザーは関与せず、アプリケーションコンテキスト内で書き込み操作を実行します。したがって、指定する必要があるアクセストークンは、開発者アプリに属するものです。これらは、[developer portal](https://developer.x.com/en/portal/projects-and-apps) 内の App の “Keys and tokens”（キーとトークン）タブから直接生成できます。  

* [POST account&#95;activity/webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): 指定されたアプリケーションコンテキストに対して新しい webhook URL を登録します
* [PUT account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): 指定された webhook の URL に対して CRC (challenge response check) をトリガーします
* [DELETE account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): webhook を削除します

一方、次の 3 つのエンドポイントでは、X ユーザー（たとえばダイレクトメッセージ）の保護されたデータに、アプリケーションが代理でアクセスできるようにするリクエストを送信します。そのため、該当する購読ユーザーに属するアクセストークンを指定する必要があります。必要なアクセストークンは、3-legged OAuth フローを使用して取得できます（[OAuth 1.0a: how to obtain a user’s Access Tokens](/ja/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) を参照）。これらのエンドポイントには、上記の表でアスタリスク（*）が付いています。

* [POST account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): アプリケーションをユーザーのアカウントイベントに購読させます
* [GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): webhook 設定がユーザーのイベントを購読しているかどうかを確認します
* [DELETE account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): 指定されたユーザーコンテキストおよびアプリケーションのサブスクリプションを無効化します [非推奨]

<Note>
  **注意**: 

  開発者アプリが「Read, Write, and Direct Messages」に有効化されていることを確認してください。この設定は、開発者アカウントの [Projects &amp; Apps セクション](https://developer.x.com/en/portal/projects-and-apps) の、選択した開発者アプリの「App permissions」で変更できます。権限設定を変更した後は、アプリの認証情報を再生成する必要があります。
</Note>

Account Activity API で利用可能なすべてのエンドポイントの一覧と、それぞれの説明および認証の実装例を含むサンプル cURL リクエストは、[API リファレンスドキュメント](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)に記載されています。

Enterprise Account Activity API を使い始めるにあたり、XDev の [サンプル Web アプリとヘルパースクリプト](https://github.com/xdevplatform/account-activity-dashboard-enterprise) も参照してください。

<Note>
  **注意**: 

  Account Activity API を利用開始する前に、X が開発者アプリに対して当該 API へのアクセスを有効化する必要があります。そのために、認証に使用する予定の App ID をアカウントマネージャーまたはテクニカルサポートチームと共有するようにしてください。
</Note>

[Account Activity API](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity) は、一連のエンドポイントで構成されており、単一の接続を通じて、購読しているすべてのアカウントのリアルタイムなアカウントアクティビティを受信するためのユーザーサブスクリプションを作成および管理できます。 

Account Activity API では 2 種類の認証方法（[OAuth 1.0a](/ja/resources/fundamentals/authentication#oauth-1-0a-2) と [OAuth 2.0 Bearer Token](/ja/resources/fundamentals/authentication#oauth-2-0)）が利用可能です。どの認証方法を使用するかは、利用するエンドポイントによって異なります。

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **説明** | **エンドポイント** | OAuth 1.0a  <br />(User Context) | OAuth 2.0 Bearer Token (アプリケーション専用) |
| 指定されたアプリケーションコンテキスト用の新しい webhook URL を登録します | [POST account&#95;activity/webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| 指定されたアプリケーションのすべての URL とそのステータスを返します | [GET account&#95;activity/webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| 指定された webhook の URL に対して challenge response check (CRC) をトリガーします | [PUT account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| アプリケーションをユーザーのアカウントイベントにサブスクライブします | [POST account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| 現在アクティブなサブスクリプションの件数を返します | [GET account&#95;activity/subscriptions/count](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| webhook 設定がユーザーのイベントをサブスクライブしているかどうかを確認します | [GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| 現在アクティブなサブスクリプションのリストを返します | [GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all/list](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| webhook を削除します | [DELETE account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| [非推奨] 指定されたユーザーコンテキストおよびアプリケーションに対するサブスクリプションを無効化します | [DELETE account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ * |     |
| アプリケーション専用 OAuth を使用してサブスクリプションを無効化します | [DELETE /account&#95;activity/webhooks/:webhook&#95;id/subscriptions/:user&#95;id/all.json](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| アクティビティを webhook に再配信します | [POST /1.1/account&#95;activity/replay/webhooks/:webhook&#95;id/subscriptions/all.json](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

*&#95; 認証には、サブスクライブしているユーザーのアクセストークンが必要です。 &#95;

OAuth 1.0a User Context 認証が必要なエンドポイントについては、リクエストを認証するために次の認証情報を指定する必要があります。 

* コンシューマーキー（API Key と Secret）
* アクセストークン（Access Token と Secret）

次の 3 つのエンドポイントの場合、アプリケーションのコンテキスト内で書き込み操作を実行します（X ユーザーは関与しません）。そのため、指定する必要があるアクセストークンは、開発者アプリに紐づくものです。これらは、[developer portal](https://developer.x.com/en/portal/projects-and-apps) 内のアプリの「Keys and tokens」タブから直接生成できます。  

* [POST account&#95;activity/webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): 指定されたアプリケーションコンテキスト用に新しい webhook URL を登録します
* [PUT account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): 指定された webhook の URL に対して CRC（challenge-response チェック）をトリガーします
* [DELETE account&#95;activity/webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): webhook を削除します

一方、次の 3 つのエンドポイントでは、アプリケーションが X ユーザー（例: Direct Messages）に代わって保護されたデータにアクセスできるようにするリクエストを行います。そのため、該当する購読ユーザーに属するアクセストークンを必ず指定する必要があります。必要なアクセストークンは 3-legged OAuth フローを使用して取得できます（[OAuth 1.0a: how to obtain a user’s Access Tokens](/ja/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) を参照）。これらのエンドポイントは、上記の表内でアスタリスク（*）付きで示されています。

* [POST account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): アプリケーションをユーザーのアカウントイベントにサブスクライブします
* [GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): webhook 設定がユーザーのイベントをサブスクライブしているかどうかを確認します
* [DELETE account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): 指定されたユーザーコンテキストおよびアプリケーションのサブスクリプションを無効化します [非推奨]

<Note>
  **注意**: 

  開発者アプリで「Read, Write, and Direct Messages」が有効になっていることを確認してください。この設定は、開発者アカウントの [Projects &amp; Apps セクション](https://developer.x.com/en/portal/projects-and-apps)で、選択した開発者アプリの「App permissions」から変更できます。権限設定を変更した後は、アプリの認証情報を再生成する必要があります。
</Note>

Account Activity API で利用可能なすべてのエンドポイントの一覧（関連する説明および認証の実装例を含む cURL リクエストの例）は、[API リファレンスドキュメント](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)に記載されています。

さらに詳しい情報については、Enterprise Account Activity API を使い始める際に役立つ、XDev の [sample web app and helper scripts](https://github.com/xdevplatform/account-activity-dashboard-enterprise) も参照してください。

<div id="retries">
  ## 再試行
</div>

`Enterprise`

Account Activity API の Enterprise ティアの利点の 1 つとして、Webhook イベントに対する再試行メカニズムがあります。ステータスコード 200 の「成功」HTTP レスポンスが受信されなかった場合、X サーバーは再試行メカニズムを開始し、5 分間に最大 3 回まで Webhook イベントを再送信します。この Webhook イベント再試行サービスにより、ネットワークに問題が発生した場合や、クライアント側サービスの停止やデプロイ時における信頼性とイベントの復旧性が向上します。
 

<div id="what-are-retries">
  ### リトライとは何ですか？
</div>

Account Activity API には、クライアントの Web アプリがアカウントアクティビティの webhook イベントに対して「成功」を示す 200 レスポンスを返さない場合に、リトライを行う機能があります。クライアント側がイベントの正常な受信を確認しない場合、X はそのイベントが受信されなかったとみなします。非 200 レスポンスが返された場合、3 秒以内にレスポンスが返ってこない場合、またはまったくレスポンスが返ってこない場合には、リクエストを再送し、そのリクエストを 3 秒間開いたままにします。これは、X がお使いの webhook URL に送信しようとしているアクティビティについて応答し受信を完了させるための試行が 2 回あり、合計でおおよそ 5 秒の猶予があることを意味します。サーバーが応答しない、または一時的なエラーを返す場合には、5 分間にわたってリトライを行います。検証を確定するためのリトライ試行は合計 3 回です。これにより、すべての webhook イベントを確実に受信できるよう、冗長性と安全性が確保されます。リトライが行われるサブスクリプションでは、その webhook に登録されているすべてのユーザーに対するあらゆるアクティビティについて、リトライされたイベントが配信される点に注意してください。

これら 8 回の試行のいずれにおいても検証が完了しない場合、そのアクティビティは Account Activity API 経由ではこれ以上利用できなくなります。 

<div id="retry-timeline">
  ### リトライのタイムライン
</div>

Account Activity API は、200 レスポンスを受信するまでの最長 5 分間に最大 3 回までリトライを行います。詳細については以下の表を参照してください。およそ 5 分が経過すると、そのアクティビティは Account Activity API 経由で再送できなくなります。取り逃したデータを収集するには、他の X エンドポイントを使用する必要があります。たとえば、[search APIs](/ja/x-api/enterprise-gnip-2.0/fundamentals/search-api) を使用して、関連するポスト、リポスト、引用ポスト、メンション、リプライを取得できます。取り逃したダイレクトメッセージは、[このエンドポイント](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)で取得できます。

<div id="retries-timeline">
  #### リトライのタイムライン
</div>

|     |
| :--- |
| アクティビティが作成され、Account Activity API から webhook URL への POST リクエストが送信されますが、3 秒でタイムアウトします。 |
| 直前のタイムアウトが終了してから 3 秒待機し、その後、Account Activity API から webhook URL への POST リクエストが送信され、3 秒でタイムアウトします。 |
| 直前のタイムアウトが終了してから 27 秒待機し、その後、Account Activity API から webhook URL への POST リクエストが送信され、3 秒でタイムアウトします。 |
| 直前のタイムアウトが終了してから 242 秒待機し、その後、Account Activity API から webhook URL への POST リクエストが送信され、3 秒でタイムアウトします。 |
| これ以降、Account Activity API は POST の再試行を行いません。Client は他の X エンドポイントを使用してデータを復元する必要があります。 |

<div id="account-activity-data-object-structure">
  ## Account Activity データオブジェクト構造
</div>

| Object | Details |
| :--- | :--- |
| for&#95;user&#95;id | イベントに関連する対象ユーザーのサブスクリプションを識別します。 |
| is&#95;blocked&#95;by | （条件付き）別のユーザーがサブスクライブしているユーザーに言及した場合にのみ表示されます。ポストへのメンションイベントで、値が true の場合にのみ含まれます。 |
| source | アクティビティを実行しているユーザー。たとえば、フォロー、ブロック、ミュートを行っているユーザーが source ユーザーです。 |
| target | アクティビティの対象となるユーザー。たとえば、フォロー、ブロック、ミュートされているユーザーが target ユーザーです。 |

**利用可能なアクティビティ**

| Message Type | Details |
| :--- | :--- |
| [tweet&#95;create&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | 次のいずれかのアクションがサブスクリプションユーザーによって、またはサブスクリプションユーザーに対して行われたときのポストステータスのペイロード：ポスト、リツイート、リプライ、@メンション、引用ポスト、引用ポストのリツイート。 |
| [favorite&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | ユーザーおよび target を含む、いいね（Favorite）イベントステータス。 |
| [follow&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | ユーザーおよび target を含む、フォローイベント。 |
| [unfollow&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unfollow-events) | ユーザーおよび target を含む、フォロー解除イベント。 |
| [block&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | ユーザーおよび target を含む、ブロックイベント。 |
| [unblock&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unblock-events) | ユーザーおよび target を含む、ブロック解除イベント。 |
| [mute&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | ユーザーおよび target を含む、ミュートイベント。 |
| [unmute&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unmute-events) | ユーザーおよび target を含む、ミュート解除イベント。 |
| [user&#95;event](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#user-event) | ユーザーがアプリケーションの認可を削除し、それに伴いサブスクリプションが自動的に削除されたときに送信される取り消しイベント。 |
| [direct&#95;message&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | ダイレクトメッセージが送信または受信されたときの、ユーザーおよび target を含むダイレクトメッセージステータス。 |
| [direct&#95;message&#95;indicate&#95;typing&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | ユーザーおよび target を含む、ダイレクトメッセージの入力中イベント。 |
| [direct&#95;message&#95;mark&#95;read&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | ユーザーおよび target を含む、ダイレクトメッセージの既読イベント。 |
| [tweet&#95;delete&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-delete-events) | コンプライアンスの維持を容易にするための、削除されたポストに関する通知。 |

**ペイロード例**

上記の表で説明した各 Account Activity イベントについて、以下のペイロード例を参照してください。

<div id="tweet_create_events-posts-retweets-replies-quotetweets">
  #### tweet&#95;create&#95;events (ポスト、リポスト、返信、引用ポスト)
</div>

```
{
	"for_user_id": "2244994945",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

<div id="tweet_create_events-mentions">
  #### tweet&#95;create&#95;events (@メンション)
</div>

```
{
	"for_user_id": "2244994945",
	"user_has_blocked": "false",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

<div id="favorite_events">
  #### favorite&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"favorite_events": [{
		"id": "a7ba59eab0bfcba386f7acedac279542",
		"created_at": "Mon Mar 26 16:33:26 +0000 2018",
		"timestamp_ms": 1522082006140,
		"favorited_status": {
			<Tweet Object>
		},
		"user": {
			<User Object>
		}
	}]
}
```

<div id="follow_events">
  #### follow&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "follow",
			"created_timestamp": "1517588749178",
			"target": {
				<User Object >
			},
			"source": {
				< User Object >
			}
		]
	}
}
```

<div id="unfollow_events">
  #### unfollow&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "unfollow",
			"created_timestamp": "1517588749178",
			"target": {
				<User Object >
			},
			"source": {
				< User Object >
			}
		]
	}
}
```

<div id="block_events">
  #### block&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "block",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

<div id="unblock_events">
  #### unblock&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "unblock",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

<div id="mute_events">
  #### mute&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "mute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

<div id="unmute_events">
  #### unmute&#95;events
</div>

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "unmute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

<div id="user_event">
  #### user&#95;event
</div>

```
{
	"user_event": {
		"revoke": {
			"date_time": "2018-05-24T09:48:12+00:00",
			"target": {
				"app_id": "13090192"
			},
			"source": {
				"user_id": "63046977"
			}
		}
	}
}
```

<div id="direct_message_events">
  #### direct&#95;message&#95;events
</div>

```
{
  	"for_user_id": "4337869213",
	"direct_message_events": [{
		"type": "message_create",
		"id": "954491830116155396",
		"created_timestamp": "1516403560557",
		"message_create": {
			"target": {
				"recipient_id": "4337869213"
			},
			"sender_id": "3001969357",
			"source_app_id": "13090192",
			"message_data": {
				"text": "こんにちは世界！",
				"entities": {
					"hashtags": [],
					"symbols": [],
					"user_mentions": [],
					"urls": []
				}
			}
		}
	}],
	"apps": {
		"13090192": {
			"id": "13090192",
			"name": "FuriousCamperTestApp1",
			"url": "https://x.com/furiouscamper"
		},
		"users": {},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 22,
			"friends_count": 45,
			"statuses_count": 494,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"4337869213": {
			"id": "4337869213",
			"created_timestamp": "1448312972328",
			"name": "Harrison Test",
			"screen_name": "Harris_0ff",
			"location": "Burlington, MA",
			"protected": false,
			"verified": false,
			"followers_count": 8,
			"friends_count": 8,
			"profile_image_url": "null",
			"statuses_count": 240,
			"profile_image_url_https": "https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png"
		}
	}
}
```

<div id="direct_message_indicate_typing_events">
  #### direct&#95;message&#95;indicate&#95;typing&#95;events
</div>

```
{
	"for_user_id": "4337869213",
	"direct_message_indicate_typing_events": [{
		"created_timestamp": "1518127183443",
		"sender_id": "3284025577",
		"target": {
			"recipient_id": "3001969357"
		}
	}],
	"users": {
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 47,
			"statuses_count": 509,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"3284025577": {
			"id": "3284025577",
			"created_timestamp": "1437281176085",
			"name": "Bogus Bogart",
			"screen_name": "bogusbogart",
			"protected": true,
			"verified": false,
			"followers_count": 1,
			"friends_count": 4,
			"statuses_count": 35,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/763383202857779200/ndvZ96mE_normal.jpg"
		}
	}
}
```

<div id="direct_message_mark_read_events">
  #### direct&#95;message&#95;mark&#95;read&#95;events
</div>

```
{
	"for_user_id": "4337869213",
	"direct_message_mark_read_events": [{
		"created_timestamp": "1518452444662",
		"sender_id": "199566737",
		"target": {
			"recipient_id": "3001969357"
		},
		"last_read_event_id": "963085315333238788"
	}],
	"users": {
		"199566737": {
			"id": "199566737",
			"created_timestamp": "1286429788000",
			"name": "Le Braat",
			"screen_name": "LeBraat",
			"location": "Denver, CO",
			"description": "data by day @X, design by dusk",
			"protected": false,
			"verified": false,
			"followers_count": 299,
			"friends_count": 336,
			"statuses_count": 752,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/936652894371119105/YHEozVAg_normal.jpg"
		},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 48,
			"statuses_count": 510,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		}
	}
}
```

<div id="tweet_delete_events">
  #### tweet&#95;delete&#95;events
</div>

```
{
    "for_user_id": "930524282358325248",
    "tweet_delete_events": [
{
        "status": {
            "id": "1045405559317569537",
            "user_id": "930524282358325248"
        },
        "timestamp_ms": "1432228155593"
    }
   ]
}
```

<div id="account-activity-replay-api">
  ## Account Activity Replay API
</div>

`Enterprise`

Account Activity Replay API は、最長 5 日前までさかのぼってイベントを取得できるデータ復旧ツールです。この API は、[webhook](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) サーバーがイベントを取り逃がした場合にデータを復旧するために利用します。原因としては、[retry window](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) を超える長時間の切断が発生した場合や、システムを通常状態に戻すまで数日を要するようなディザスタリカバリのケースなどが含まれます。

Account Activity Replay API は、一定期間にわたって [activities](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity) の取り込みに失敗したあらゆるシナリオ向けに設計されています。アクティビティは、元のリアルタイム配信で使用していたものと同じ webhook に配信されます。本 API はリカバリツールであり、バックフィルツールではありません。つまり、過去に配信試行が行われたイベントのみがリプレイされます。Account Activity Replay API は、サブスクリプションが作成される前の期間に発生したイベントを配信することはできません。

<div id="using-account-activity-replay-api">
  ### Account Activity Replay API の使用
</div>

アカウントに Replay 機能が設定されている場合、Account Activity API へのリクエストとほぼ同様の方法でリクエストを行うことができます。重要な点として、どの webhook のアクティビティをリプレイするかを示すために、リクエストで webhook の id パラメータを指定する必要があります。言い換えると、Replay リクエストは、webhook の id と application id に基づいて、開始日時から終了日時までのイベントを取得するように Account Activity Replay API に要求するものです。

時刻は UTC で指定する必要があります。これらのアクティビティは、id に関連付けられた登録済み webhook を通じて、1 秒あたり最大 2,500 件のイベントとして配信されます。また、指定した日付/時刻範囲内でアクティブだったすべてのサブスクリプションがリプレイされる一方で、同時に実行できる Replay ジョブは webhook ごとに 1 つだけであることにも留意してください。

イベントは、指定した時間範囲の最初（最も古い）の 1 分から配信が開始され、最後の 1 分が配信されるまで、可能な限り時系列順に続きます。その時点で、Replay は webhook に [ジョブ完了イベント](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#job-completed-successfully-message) を配信します。アクティビティは時系列で配信されるため、開始時刻付近で一致する結果がほとんど、またはまったくない場合、最初の結果が配信されるまでに時間がかかる可能性があります。

<div id="limitations">
  ### 制限事項
</div>

Replay は、過去最大 5 日前までのアクティビティを簡単に再取得するためのツールですが、サブスクリプションが作成される前のイベントは配信されません。たとえば、3 日前に新しいサブスクリプションを追加し、本日から 5 日前までを取得対象期間として Replay ジョブを実行した場合、この新しいサブスクリプションが有効だった 3 日間のデータのみを受信します。

<div id="data-availability-and-types">
  ### データの利用可能期間と種類
</div>

Account Activity Replay API から取得できるアクティビティは、リクエストの開始時点から 5 日間利用可能で、各アクティビティが作成されてからおおよそ 10 分後に新しいデータが利用可能になります。この 5 日間の範囲内で、リクエスト内の from&#95;date パラメーターと to&#95;date パラメーターを使用して、取得したい時間枠を指定してリクエストを行うことができます。Replay へのアクセス権を得る前に本来配信されていたイベントは、リプレイすることはできません。たとえば、2019 年 6 月 1 日 3:30PM UTC にあなたのアカウントで Account Activity Replay API へのアクセスが有効化された場合、それ以前の日時のイベントを Replay を使って取得することはできません。

[Account Activity Replay API リファレンス](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated)に進む

<div id="migration-introduction">
  ## 移行の概要
</div>

**Site Streams、User Streams、および Account Activity API - DM Only の標準ベータ版の製品は 2018 年に廃止されました。これらの製品を利用していた場合は、必ず Account Activity API の Premium 版または Enterprise 版へ移行してください。**

**旧来の Direct Message エンドポイントも廃止しました。これらのエンドポイントを利用していた場合は、新しい DM エンドポイント、もしくは Account Activity API の Premium 版または Enterprise 版のいずれかに必ず移行してください。**

**詳細については、[このアナウンス](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746)をご確認ください。**

これらの変更によって影響を受けるエンドポイントは次のとおりです。

* User Streams
* Site Streams
* GET direct&#95;messages
* GET direct&#95;messages/sent
* GET direct&#95;messages/show
* POST direct&#95;messages/new
* POST direct&#95;messages/destroy
   

同等のアクセスを提供し、さらに Direct Message 向けには追加機能も備えた新しいエンドポイントとサービスを用意しています。

* Account Activity API の [enterprise](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) と [premium](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)
* [GET direct&#95;messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)
* [GET direct&#95;messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event)
* [POST direct&#95;messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event)
* [POST direct&#95;messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event)

これらの新しいエンドポイントやサービスへのスムーズな移行を支援するため、次の 2 つの移行ガイドを用意しています。

* User Streams と Site Streams から新しい Webhook ベースのサービスへ移行する方向けの [Account Activity API 移行ガイド](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api)
* Direct Message REST エンドポイント間を移行する方向けの [Direct Message 移行ガイド](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration)
   

さらに、Account Activity API とその利用開始方法について説明した[動画シリーズ](https://www.youtube.com/playlist?list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg)も用意しています。

最後に、理解を深め、すぐに利用を開始できるようにするためのコードサンプルもあります。

* [Account Activity Dashboard](https://github.com/xdevplatform/Account-Activity-dashboard) は、Account Activity API を使い始めるためのヘルパースクリプトを備えたサンプルの Node.js Web アプリです。
* [SnowBot](https://github.com/xdevplatform/SnowBotDev) は、Account Activity API と Direct Message REST エンドポイントを利用するサンプルのチャットボットです。Ruby で実装され、Sinatra Web アプリケーションフレームワークを使用し、Heroku 上にデプロイされています。

<div id="migration-guide-moving-from-user-streamssite-streams-to-account-activity-api">
  ## 移行ガイド：User Streams/Site Streams から Account Activity API への移行
</div>

**2018年8月23日をもって、Site Streams と User Streams は提供を終了しました。必ず Account Activity API への移行を行ってください。**

**詳細については、[このお知らせ](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746)をご確認ください。**

このガイドは、従来の User Streams および Site Streams API から、後継 API である Account Activity API へ移行する際の支援を目的としています。以下では、変更点の概要、新機能の一覧、そして移行時に役立つ主な違いや考慮事項を説明します。従来の基本的な DM エンドポイントからの移行については、[ダイレクトメッセージ移行ガイド](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration)を参照してください。

<div id="summary-of-changes">
  ### 変更点の概要
</div>

Account Activity API では、User Streams や Site Streams のようなストリーミング接続ではなく、認証済みで購読対象となっているアカウントのイベントを webhook 経由で配信します。

<div id="deprecated-apis">
  #### 非推奨 API
</div>

GET user

GET site（コントロールストリームを含む: GET site/c/:stream&#95;id, GET site/c/:stream&#95;id/info.json, GET site/c/:stream&#95;id/friends/ids.json, POST site/c/:stream&#95;id/add&#95;user.json, POST /site/c/:stream&#95;id/remove&#95;user.json）

<div id="replacement-apis">
  #### 代替API
</div>

[Enterprise Account Activity API - すべてのアクティビティ](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api)

### 違いと移行時の考慮事項

**API フォーマット:** 新しい Account Activity API は、User Streams や Site Streams とは動作が異なります。webhook でデータを受信できるように、Web アプリを変更する必要があります。webhook についての詳細は[こちら](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks)をご覧ください。

**利用可能なデータ:** もう 1 つの大きな違いは、配信されるデータに関する点です。X は、あなたが X 上でフォローしているユーザー（いわゆるホームタイムライン）からのイベントを、今後は送信しません。これは意図的な変更であり、今後も変更する予定はありません。

**信頼性:** ストリーミングとは異なり、webhook では配信の確認と、webhook URL に到達しなかった POST されたアクティビティを再試行するオプションが利用できます。これにより、短時間の切断やダウンタイムが発生した場合でも、アプリが該当するすべてのアクティビティを受信できていることを、より確実にできます。

<div id="new-features">
  ### 新機能
</div>

Account Activity API では多くの新機能が提供されており、特に重要なのは、データがストリーミングではなく webhook 経由で配信されるようになった点です。webhook にはストリーミングと比べて多くの利点がありますが、中でも際立っているのは速度と信頼性です。API は、データが利用可能になり次第 JSON イベント形式で送信するため、アクティブな接続を維持したり、エンドポイントをポーリングしたりする必要がなくなります。これにより冗長化機能の必要性が減り、全体の効率が向上します。webhook の詳細については、[技術ドキュメント](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks)を参照してください。

<div id="managing-user-subscriptions">
  ### ユーザーサブスクリプションの管理
</div>

Account Activity API では、1 つの登録済み webhook に対して複数のサブスクリプションを設定できます。これにより、Site Streams のアーキテクチャと同様に、複数のユーザーサブスクリプションに関するアクティビティを、webhook を使って同じ場所へ配信できます。つまり、サブスクリプション制限との関係においてサブスクリプションを、webhook 接続とは独立して管理・追跡できます。また、1 つまたは少数のサブスクリプションから、1 つの webhook に対して数千のサブスクリプションまで柔軟に拡張できます。

<div id="how-to-migrate">
  ### **移行手順**
</div>

<div id="follow-the-steps-below-to-easily-migrate-from-the-site-streams-api-to-the-account-activity-api">
  ### **以下の手順に従って、Site Streams API から Account Activity API へ簡単に移行してください**
</div>

**ステップ 1：パッケージを決定する**

現在 User Streams または Site Streams をどのように運用しているかに応じて、Account Activity API の Enterprise 版または Premium 版のいずれかへの移行を検討する必要があります。現在サポートしているアプリケーション数や認可ユーザー数を考慮し、必要なボリュームと信頼性に合わせて適切にスケールしてください。どのパッケージがニーズに最も適しているかを決定する際には、次のような点を考慮してください。

* 必要な webhook の数
* アプリケーションで現在管理している／今後管理を予定しているサブスクリプション／認可ユーザー数
* 現在の X クライアントアプリケーションの数
* X から受けたいサポートレベル（フォーラムサポートか、マネージドな Enterprise レベルの 1:1 サポートか）
* 各パッケージの価格

**ステップ 2：** **developer portal で X アプリの設定を確認する**

現在 User Streams または Site Streams に使用している [X app](/ja/resources/fundamentals/developer-apps) は、[developer portal](/ja/resources/fundamentals/developer-portal) 内で所有ユーザーに紐づけられて一覧表示されます。この X アプリは Account Activity API でも使用でき、そのアプリケーションに対する認可ユーザーを引き継ぐことができます。新しいアプリを作成し、必要に応じてユーザーにその新しいアプリを再度認可してもらうこともできます。ビジネスを代表して新しいアプリを作成する場合は、企業の X @handle アカウントでアプリを作成することを推奨します。

* X アプリページの [permissions](/ja/resources/fundamentals/developer-apps#app-permissions) タブで「Read, Write and Access direct messages」を有効にします。\
  *これらの設定変更は遡及的には適用されない点に注意してください。すでに認可されているユーザーについては、その時点の認可設定が維持されます。ユーザーがまだ Read, Write, Direct Message アクセスを許可していない場合、そのユーザーにアプリケーションを再認可してもらう必要があります。*
* [X Sign-in](/ja/resources/fundamentals/authentication#log-in-with-x) や、X API におけるユーザーコンテキストの動作に不慣れな場合は、[Obtaining Access Tokens](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks) を確認してください。
* 「Keys and Tokens」タブの一番下で、X アプリ所有者のアクセストークンを生成します。同じタブで Consumer Key、Consumer Secret、Access Token、Access Token Secret を控えておいてください。これらは API を使用する際に必要になります。
* [application-only](/ja/resources/fundamentals/authentication#bearer-token-also-known-as-app-only) API メソッド用に、Consumer Key と Consumer Secret を使って Bearer Token を生成します。

**ステップ 3：Webhook をセットアップして構成する**

* イベントを受信するための webhook として使用するエンドポイントを持つ Web アプリを作成します（例： https://your&#95;domain.com/webhook/twitter または https://webhooks.your&#95;domain.com）。

* webhook を作成する際には、Consumer Key、Consumer Secret、Access Token、Access Token Secret を使用します。エンドポイントは、crc&#95;token とアプリの Consumer Secret から作成された、base64 エンコードされた HMAC SHA-256 ハッシュである response&#95;token を含む JSON レスポンスを返す必要があることに注意してください。

* [Securing Webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) ドキュメントを確認し、とくに Challenge Response Check (CRC) の要件に注意してください。

* webhook が、受信イベント用の POST リクエストと CRC 用の GET リクエストをサポートしていることを確認してください。

* webhook が低レイテンシ（POST リクエストに 3 秒未満で応答）であることを確認してください。

**ステップ 4：Webhook 設定を検証する**

* Webhook API は次の 2 つの方法で webhook を保護します。

               - webhook の所有者が Web アプリの所有者であることを検証するために、Challenge Response Check を要求します。

               - Web アプリ側で送信元を検証できるよう、各 POST リクエストに署名ヘッダーを付与します。

* あなたが Web アプリと webhook URL の両方の所有者であることを検証するために、X は cyclic redundancy check とは異なる Challenge Response Check (CRC) を実行します。
* crc&#95;token という名前のパラメータを含む GET リクエストが、webhook URL に送信されます。エンドポイントは、crc&#95;token とアプリの Consumer Secret から作成された、base64 エンコードされた HMAC SHA-256 ハッシュである response&#95;token を含む JSON レスポンスを返さなければなりません。
* crc&#95;token は、受信する各 CRC リクエストごとに変化すると想定してください。crc&#95;token は計算におけるメッセージとして使用し、Consumer Secret をキーとして使用します。
* 応答が無効な場合、登録された webhook へのイベント送信は停止されます。

**ステップ 5：各 User Stream または Site Streams の認可ユーザーごとにサブスクリプションを作成する**

User Streams から Account Activity API へ移行する場合：

* User Streams 上で現在のユーザーサブスクリプションの一覧を取得します
* リクエスト  *POST account&#95;activity/all/:env&#95;name/subscriptions* を使用して、新しい Account Activity API サブスクリプションを設定します
* リクエスト  &#95;GET account&#95;activity/all/:env&#95;name/subscriptions/list
   &#95; を使用して、Account Activity API サブスクリプションを確認します

Site Streams から Account Activity API への移行: (コントロールストリームを使用する場合):

* リクエスト  *GET /1.1/site/c/:stream&#95;id/info.json* を使用して、Site Streams 上で現在のサブスクリプションの一覧を取得します
* リクエスト  *POST account&#95;activity/all/:env&#95;name/subscriptions* を使用して、新しい Account Activity API サブスクリプションを設定します
* リクエスト  &#95;GET account&#95;activity/all/:env&#95;name/subscriptions/list
   &#95; を使用して、Account Activity API サブスクリプションを確認します

Webhook の登録とサブスクリプションの作成 (Site Streams または User Streams から移行しない場合)

* [POST webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) を使用してアプリで webhook URL を登録し、webhook&#95;id を受け取ります。
* 返された webhook&#95;id を使用して、[POST webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) でユーザーサブスクリプションを追加します。

<div id="the-account-activity-dashboard-sample-account-activity-api-application">
  ### Account Activity ダッシュボード（Account Activity API 用サンプルアプリケーション）
</div>

Account Activity API のテストを少しでも早く始められるよう、サンプルアプリを用意しました。   

* Account Activity Dashboard サンプルアプリケーションを[こちら](https://github.com/xdevplatform/Account-Activity-dashboard)からダウンロードします（Node.js を使用しています）
* README の手順に従ってアプリをインストールし、起動します
* アプリケーションを起動したら、UI を使って webhook を簡単に設定し、新しいサブスクリプションを作成できます

<div id="available-activities">
  ### 利用可能なアクティビティ
</div>

| Message Type | 詳細 |
| :--- | :--- |
| [tweet&#95;create&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | サブスクリプションユーザーが行う、またはサブスクリプションユーザーに対して行われる、ポスト、リポスト、返信、@メンション、引用ポスト（QuoteTweet）などのアクションに対応するポストステータスのペイロード。 |
| [favorite&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | ユーザーと対象ユーザーを含む「お気に入り（いいね）」イベントのステータス。 |
| [follow&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | ユーザーと対象ユーザーを含むフォローイベント。 |
| [block&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | ユーザーと対象ユーザーを含むブロックイベント。 |
| [mute&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | ユーザーと対象ユーザーを含むミュートイベント。 |
| [direct&#95;message&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | ユーザーと対象ユーザーを含むダイレクトメッセージのステータス。 |
| [direct&#95;message&#95;indicate&#95;typing&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | ユーザーと対象ユーザーを含むダイレクトメッセージの入力中イベント。 |
| [direct&#95;message&#95;mark&#95;read&#95;events](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | ユーザーと対象ユーザーを含むダイレクトメッセージの既読イベント。 |

<div id="deprecated-streaming-message-types">
  ### 廃止されたストリーミングメッセージタイプ
</div>

|     |     |
| :--- | :--- |
| 空行 | 空行は User Streams と Site Streams ではキープアライブメッセージとして使用されていましたが、Account Activity API では今後配信されなくなります。 |
| 制限通知 | 制限通知は、特定の webhook には送信されなくなります。代わりに、API を呼び出して、利用可能なハンドルの現在の使用状況を取得できます。これは将来的に developer portal にも表示される予定です。 |
| 切断メッセージ | webhook はアクティブな接続に依存しないため、切断通知は不要になります。 |
| ストール警告 | webhook は大量の受信メッセージを処理できるアクティブな接続に依存しないため、ストール警告は不要になります。 |
| フレンドリスト | フレンドリストは今後、プロアクティブには送信されません。この情報を取得するための REST エンドポイントが新たに提供されます。 |

<div id="deprecated-event-types">
  ### 非推奨のイベントタイプ
</div>

|     |     |     |     |     |
| :--- | :--- | :--- | :--- | :--- |
| **説明** | **イベント名** | **ソース** | **ターゲット** | **ターゲットオブジェクト** |
| ユーザーがポストを削除する | delete | 現在のユーザー | 現在のユーザー | ポスト |
| フォローしているユーザーがポストを削除する | delete | フォローしているユーザー | フォローしているユーザー | ポスト |
| ユーザーがポストへのいいねを取り消す | unfavorite | 現在のユーザー | ポストの作成者 | ポスト |
| ユーザーのポストへのいいねが取り消される | unfavorite | いいねを取り消したユーザー | 現在のユーザー | ポスト |
| ユーザーが誰かのフォローを解除する | unfollow | 現在のユーザー | フォローされていたユーザー | Null |
| ユーザーがリストを作成する | list&#95;created | 現在のユーザー | 現在のユーザー | リスト |
| ユーザーがリストを削除する | list&#95;destroyed | 現在のユーザー | 現在のユーザー | リスト |
| ユーザーがリストを編集する | list&#95;updated | 現在のユーザー | 現在のユーザー | リスト |
| ユーザーが誰かをリストに追加する | list&#95;member&#95;added | 現在のユーザー | 追加されたユーザー | リスト |
| ユーザーがリストに追加される | list&#95;member&#95;added | 追加したユーザー | 現在のユーザー | リスト |
| ユーザーが誰かをリストから削除する | list&#95;member&#95;removed | 現在のユーザー | 削除されたユーザー | リスト |
| ユーザーがリストから削除される | list&#95;member&#95;removed | 削除したユーザー | 現在のユーザー | リスト |
| ユーザーがリストを購読する | list&#95;user&#95;subscribed | 現在のユーザー | リストの所有者 | リスト |
| ユーザーのリストが購読される | list&#95;user&#95;subscribed | 購読したユーザー | 現在のユーザー | リスト |
| ユーザーがリストの購読を解除する | list&#95;user&#95;unsubscribed | 現在のユーザー | リストの所有者 | リスト |
| ユーザーのリストが購読解除される | list&#95;user&#95;unsubscribed | 購読を解除したユーザー | 現在のユーザー | リスト |
| ユーザーがプロフィールを更新する | user&#95;update | 現在のユーザー | 現在のユーザー | Null |
| ユーザーが非公開設定を更新する | user&#95;update | 現在のユーザー | 現在のユーザー | Null |

<div id="direct-message-migration-guide">
  ## ダイレクトメッセージ移行ガイド
</div>

**2018年9月17日、従来のダイレクトメッセージエンドポイントは廃止されました。
それらのエンドポイントを利用していた場合は、新しいダイレクトメッセージエンドポイント、もしくは Account Activity API への移行を必ず行ってください。**

**詳細については、[このお知らせ](https://devcommunity.x.com//t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) をご確認ください。**

このガイドは、従来のダイレクトメッセージ REST API から、ベータ版を終了した強化版の後継 API へ移行する際に役立つよう作成されたものです。以下では、変更点の概要、新機能の一覧、移行を支援するための主な違いと考慮事項を説明します。新しいダイレクトメッセージエンドポイントは、すべての開発者が既に利用できます。User Streams または Site Streams からの移行については、[Account Activity API への移行ガイド](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api) を参照してください。

* [変更点の概要](#summary)
* [新機能](#features)
* [ダイレクトメッセージの送信](#sending)
* [ダイレクトメッセージの受信](#receiving)
* [ダイレクトメッセージの削除](#deleting)

<div id="summary-of-changes">
  ### 変更点の概要
</div>

以下のDMエンドポイントをまだ使用している場合は、新しいエンドポイントに移行する必要があります。

| 非推奨エンドポイント | 移行先の新エンドポイント |
| :--- | :--- |
| [POST direct&#95;messages/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) | [POST direct&#95;messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) |
| [GET direct&#95;messages/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct&#95;messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) |
| [GET direct&#95;messages](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) | [GET direct&#95;messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [GET direct&#95;messages/sent](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct&#95;messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [POST direct&#95;messages/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) | [DELETE direct&#95;messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event "GET direct_messages/events/list") |

<div id="new-features">
  ### 新機能
</div>

新しい Direct Message API エンドポイントでは、複数の新機能が追加され、従来のダイレクトメッセージへのアクセスも改善されています。主な新機能は次のとおりです。

* メディア（画像、GIF、動画）の添付に対応。
* あらかじめ定義された選択肢リストを使って、ユーザーに構造化された返信を促せる機能。
* 過去 30 日分のダイレクトメッセージへのアクセス。

新しいダイレクトメッセージ機能および追加された新規 API エンドポイントの一覧については、[技術ドキュメント](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/overview)を参照してください。
 

<div id="differences-migration-considerations">
  ### 相違点と移行時の考慮事項
</div>

新しい API エンドポイントは、以前の対応するエンドポイントとは挙動が大きく異なります。エンドポイントの URL を更新するだけでは、アプリケーションでエラーが発生します。移行にあたってアプリケーションを更新する際は、次の点を考慮してください。

<div id="new-direct-message-object">
  #### 新しいダイレクトメッセージオブジェクト
</div>

まず目につくのは、ダイレクトメッセージの新しいオブジェクト構造でしょう。この新しい Message Create オブジェクト構造は、[Quick Replies](https://developer.x.com/en/docs/x-api/v1/direct-messages/quick-replies/overview) や [Attachments](https://developer.x.com/en/docs/x-api/v1/direct-messages/message-attachments/overview) といった新機能をサポートするために導入されました。この新しいオブジェクトには、よりコンパクトにまとめられたユーザーオブジェクトも含まれています。アプリケーションでは、この新しいオブジェクト構造に対応するため、パース処理や、場合によってはデータモデルやストレージの更新が必要になる場合があります。各プロパティの説明については、[Message Create オブジェクトに関する詳細なドキュメント](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/message-create-object)を参照してください。

**Message Create オブジェクトの例**

```json
{
      "type": "message_create",
      "id": "1234858592",
      "created_timestamp": "1392078023603",
      "initiated_via": {
        "tweet_id": "123456",
        "welcome_message_id": "456789"
      },
      "message_create": {
        "target": {
          "recipient_id": "1234858592"
        },
        "sender_id": "3805104374",
        "source_app_id": "268278",
        "message_data": {
          "text": "Blue Bird",
          "entities": {
            "hashtags": [],
            "symbols": [],
            "urls": [],
            "user_mentions": [],
          },
          "quick_reply_response": {
            "type": "options",
            "metadata": "external_id_2"
          },
          "attachment": {
            "type": "media",
            "media": {
             ...
            }
          }
        }
      }
```

<div id="summary">
  #### 概要
</div>

* ダイレクトメッセージオブジェクトの構造が一新されました。
* ユーザーオブジェクトがコンパクトになりました。
* 新しい情報が提供されます（クイックリプライのレスポンス、添付ファイルなど）。

<div id="sending-direct-messages">
  ### ダイレクトメッセージの送信
</div>

[POST direct&#95;messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) は、従来のダイレクトメッセージ送信方法をそのまま置き換えるエンドポイントです。このエンドポイントでの最も大きな違いは、すべての情報が個々の POST パラメーターではなく、POST リクエストボディ内の JSON として送信されるようになった点です。

**Twurl リクエストの例**

```bash
twurl -A 'Content-type: application/json' -X POST /1.1/direct\_messages/events/new.json -d '{"event": {"type": "message\_create", "message\_create": {"target": {"recipient\_id": "4534871"}, "message_data": {"text": "Hello World!"}}}}'
```

上記のリクエストでは、`content-type` が `application/x-www-form-urlencoded` ではなく `application/json` に設定されている点に注意してください。さらに、OAuth 1.0a の署名を自分で構築する場合は、署名の生成処理には JSON 本文が含まれない点にも注意してください。ほとんどの OAuth ライブラリでは、この挙動はすでに考慮されています。[twurl](https://github.com/twitter/twurl) を使用している場合は、少なくともバージョン 0.9.3 以降を使用していることを確認してください。

<div id="summary">
  #### 概要
</div>

* メッセージは JSON の POST リクエストボディで定義します
* `Content-Type` ヘッダーは `application/json` に設定する必要があります
* JSON ボディは OAuth シグネチャの生成には含まれません
   

<div id="retrieving-direct-messages">
  ### ダイレクトメッセージの取得
</div>

過去のダイレクトメッセージの取得は、現在は 1 つの API エンドポイントで行えるようになりました: [GET direct&#95;messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)。この新しいエンドポイントの大きな違いは、送信済みメッセージと受信メッセージの両方を、新しいものから順に返す点です。これにより、会話を再構築しやすくなります。ただし、送信済みメッセージのみ、あるいは受信メッセージのみを取得したい場合は、`sender_id` プロパティを参照してレスポンスを後処理する必要があります。

ページネーションは、ダイレクトメッセージの ID ではなくカーソル値に基づくようになりました。各レスポンスには `cursor` プロパティが返されます。[GET direct&#95;messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) は、過去 30 日間に存在するメッセージ数に関わらず、最大で過去 30 日分のメッセージを返します。カーソルが返されない場合は、それ以上返すメッセージが存在しないことを意味します。[GET direct&#95;messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) による個々のダイレクトメッセージへのアクセス方法は変わりませんが、返されるダイレクトメッセージオブジェクトの構造は、前述のとおり異なります。

最後に、ダイレクトメッセージへのリアルタイムアクセスは、[Account Activity API](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity) を用いた webhook 経由で行われます。User Streams または Site Streams からの移行については、Account Activity API への移行ガイドを参照してください。

<div id="summary">
  #### 概要
</div>

* 送信済みメッセージと受信メッセージを同じエンドポイントから取得可能。
* 最大30日分のメッセージを取得可能。
* カーソルベースのページネーション。
* Webhook を使用した Direct Message へのリアルタイムアクセス。

<div id="deleting-direct-messages">
  ### ダイレクトメッセージの削除
</div>

ダイレクトメッセージは、`DELETE direct_messages/events/destroy` で削除できるようになりました。使用方法はほぼ同じで、削除するメッセージの `id` が必要です。主な違いは、このエンドポイントが `POST` リクエストではなく、`DELETE` リクエストを受け付けるようになった点です。

削除されたダイレクトメッセージが公式 X クライアントにどのように反映されるかは、これまでと変わりません。ダイレクトメッセージは、指定されたユーザーコンテキストのインターフェースからのみ削除されます。会話の他のメンバーは、引き続きそのダイレクトメッセージにアクセスできます。

#### 要約

* ダイレクトメッセージを削除するには ID が必要です。
* 新しいエンドポイントでは DELETE リクエストを送信する必要があります。
* 削除されたダイレクトメッセージが公式の X クライアントにどのように表示されるかは変更されていません。

**新しいダイレクトメッセージエンドポイントへの移行についてご質問がありますか？
**ご質問は開発者コミュニティフォーラム [devcommunity.com](https://devcommunity.x.com/) に投稿してください。

<div id="frequently-asked-questions">
  ## よくある質問
</div>

<div id="general">
  ### General
</div>

**Account Activity API を使用する利点は何ですか？**

Account Activity API は webhook を使用します。そのため、ストリーミング API のように情報を送信するためのオープンな接続を維持しておく必要がありません。Webhook は REST API とも異なり、関心のあるデータを取得するために 15 分ごとに何百回もポーリングする必要がありません。イベント発生時にデータが配信されるため、ユーザーとあなたのアプリ間の効率が向上します。

Account Activity API には、次のような利点があります。

1. **速度**: X のスピードでデータを配信します。
2. **シンプルさ**: アカウントのすべてのイベントを、1 つの webhook 接続だけで配信します。API で配信されるアクティビティには、ポスト、@メンション、返信、Retweet、Quote Tweet、Quote Tweet の Retweet、いいね、送信されたダイレクトメッセージ、受信したダイレクトメッセージ、フォロー、ブロック、ミュートが含まれます。 
3. **スケール**: あなたが管理するアカウントのすべてのアクティビティを、イベント数の上限を設けるようなレート制限に縛られることなく受け取ることができます。

Account Activity API は、Premium サンドボックス版、Premium 有料版、および Enterprise 版として提供されており、監視機能や追加機能のためにより多くのアカウントが必要になった場合にも、要件に応じてスケールできます。

始めるには、[GitHub](https://github.com/xdevplatform/account-activity-dashboard) からサンプルコードスニペットをダウンロードしてください。
 

**どのプロダクトティアが自分に最適かを判断するにはどうすればよいですか？**

Premium オプションと Enterprise オプションの違いについて詳しく知るには、[Account Activity API Overview](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity) ページをお読みください。 
 

**Premium environment と Enterprise webhook の違いは何ですか？**

違いはありません。各 Premium environment には、それぞれ専用の webhook&#95;id があります。
 

**Account Activity API 用に開発 (development)、ステージング、プロダクション環境が必要です。これは可能ですか？**

はい。Account Activity API の有料ティア (Paid Premium および Enterprise) では、複数の webhook URL を登録し、API メソッドを通じて環境ごとに購読を個別に管理できます。さらに、複数のクライアントアプリを許可リスト (allowlist) に追加して、現在の認可済みユーザーに対する認可状態を維持することもできます。
 

**Account Activity API のセットアップについて、ステップバイステップのガイドはありますか？**

はい、用意しています。

* これから始める場合は、[Getting started with webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks) ガイドを参照することをおすすめします。

* 次の X Dev 提供スクリプトに沿って進めてください: 
  * [Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard) — webhook イベントを表示する Node.js 製 Web アプリです。
  * [SnowBot chatbot](https://github.com/xdevplatform/SnowBotDev) — Account Activity API と Direct Message API を利用して構築された Ruby 製 Web アプリです。このコードベースには、Account Activity API の webhook セットアップを支援する[スクリプト](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script)が含まれています。
     

**システムが一定期間ダウンした場合に、データを復旧する方法はありますか？**

Account Activity API の有料ティア (Paid Premium および Enterprise) では、当社のシステムは 4 時間の間に複数回、アクティビティの送信を[再試行](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries)します。その 4 時間の間にあなたのシステムが応答しない場合、そのアクティビティは失われ、7 日以内のデータを復旧するためには、他の REST エンドポイントを使用する必要があります。

[Account Activity Replay API](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) のように、異なる webhook や environment を冗長化のための仕組みとして利用し、いずれかのシステムがダウンしてもアクティビティを取り逃さないようにすることをおすすめします。
 

**Account Activity API では、どの認証方式を使用する必要がありますか？**

Account Activity API に必要な認証方式は、[API reference pages](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index) でメソッドごとに説明されています。X の認証をこれから使い始める場合は、[このセクション](/ja/resources/fundamentals/authentication)を読むことをおすすめします。

**challenge-response check (CRC) とは何ですか？**

Account Activity API のチャレンジレスポンスチェックは、Account Activity API のアクティビティが正しい開発者に送信されていることを保証するために設けられたセキュリティ機能です。また、開発者が、自分たちが受信しているデータが X から送信されていることを確認する用途にも使用できます。X は、Webhook URL が最後に検証されてから 24 時間ごとに、CRC を自動的にあなたの Webhook URL に送信します。システムは検証状態を維持するために、3 秒以内に有効なレスポンスで応答しなければなりません。 

詳しくは、[Securing webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) のページをご覧ください。
 

**Webhook URL が即座に無効化されるケースはありますか？**

以下のいずれかが発生した場合、Webhook は直ちに無効としてマークされます。

* サーバーが CRC に対して誤ったトークンで応答した場合。この場合、当社のシステムはアクティビティの送信を[再試行](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries)しません。
* Webhook URL に誤った証明書が設定されている場合。この場合も、当社のシステムはアクティビティの送信を[再試行](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries)しません。
* サーバーが 2XX、4XXX、5XXX 以外のレスポンスコードを返した場合。
* gzip を使用すると指定しているにもかかわらず、実際には gzip で送信していない場合。
* gzip を使用すると指定していないにもかかわらず、実際にはレスポンスを gzip で送信している場合。
   

**相互にやり取りしているユーザーにサブスクライブした場合、重複したアクティビティを受け取りますか？**

はい。Web アプリでユーザー A とユーザー B に対して有効なサブスクリプションがあり、ユーザー A がポスト内でユーザー B に言及した場合、登録済みの Webhook には 2 つの POST アクティビティが送信されます。それぞれのアクティビティには、そのアクティビティがどのサブスクリプションに属するかを示す &quot;for&#95;user&#95;id&quot; フィールドが含まれます。
 

**Webhook に対してサブスクリプションを作成するときに、次のエンドポイントの `/all/` 部分を他のアカウントアクティビティデータオブジェクトに置き換えて、この API が配信するアクティビティを絞り込むことはできますか？ **`POST https://api.x.com/1.1/account_activity/all/:env_name/subscriptions.json`

いいえ、これはできません。現時点では、利用可能なプロダクトは `/all/` のみです。
 

**ユーザーから Direct Messages の権限をリクエストせずに Account Activity API を利用する方法はありますか？ **

現時点では、この API で Direct Messages のアクティビティだけを「フィルタリングして除外する」手段がないため、Direct Messages の権限が必須です。 
 

**Account Activity API に無料版はありますか？**

はい、無料ティアとして sandbox バージョンを提供しています。sandbox オプションは Webhook を 1 つに制限し、サブスクリプション数は最大 15 件までとなります。sandbox オプションの詳細については、[ドキュメント](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity)をご覧ください。 

**Account Activity API を使用して、サブスクライブしているユーザーに言及しているポストの Retweet を取得することはできますか？ **

残念ながら、これはこの API で配信されるアクティビティには含まれていません。この用途には、代わりに Streaming API の利用をお勧めします。 
 

**tweet&#95;create&#95;event で表現される可能性のあるアクティビティタイプにはどのようなものがありますか？**

tweet&#95;create&#95;event のペイロードは、次の場合に送信されます。

サブスクリプション対象のユーザーが次のいずれかのアクションを行った場合:

* ポストを作成したとき
* Retweet したとき
* ポストに返信したとき

別のユーザーが次の場合:

* サブスクリプション対象ユーザーを @メンション* したとき
* サブスクリプション対象ユーザーが作成した Tweet を引用したとき 

*注: Account Activity API は、サブスクリプション対象ユーザーが X から通知を受け取り、かつそのイベントを公開範囲で確認できる場合にのみイベントを配信します。つまり、メンションされたアカウント (@userA) が非公開アカウント (@userB) をフォローしている場合、UserA は UserB からメンションされたという通知を受け取ります。UserA が UserB をフォローしていない（かつ UserB に承認されていない）場合、UserA は通知を受け取らず、そのため @userA にサブスクリプションがあっても、tweet&#95;create&#95;event は AAA 経由で送信されません。

**ブロックしているユーザーが、私がサブスクライブしているユーザーをメンションした場合、どのようにそれを判別できますか？**

json レスポンスのトップレベルに、&quot;true&quot; もしくは &quot;false&quot; が設定された boolean フィールド `user&#95;has&#95;blocked` が表示されます。このフィールドは、ポストのメンションに対してのみ公開されます。 

Enterprise

**アプリを allowlist に追加するには、またはアプリがすでに allowlist に含まれているか確認するにはどうすればよいですか？**

Enterprise APIs 経由でのアクセスを許可するために allowlist に追加した [X apps](/ja/resources/fundamentals/developer-apps) を管理するには、アカウントマネージャーにアプリ ID を添えてご連絡ください。アプリ ID は、[developer portal](/ja/resources/fundamentals/developer-portal) 内の「[Apps](/ja/resources/fundamentals/developer-apps)」ページに移動すると確認できます。
 

**Enterprise 利用向けに登録した各アプリごとに 3 つの webhook へのアクセス権がある場合、それぞれのアプリで 3 つずつ webhook を利用できますか？**

webhook の上限はアカウント単位で設定されており、アプリ単位ではありません。3 つの webhook へのアクセス権があり、Enterprise 利用向けに登録されたアプリが 2 つある場合、1 つのアプリで 2 つ、もう一方のアプリで 1 つの webhook を利用できますが、それぞれのアプリで 3 つずつ利用することはできません。 

**Account Activity Replay API を利用してリプレイされるイベントの種類を指定できますか？**

リプレイするイベントの種類を指定することはできません。指定した日時の範囲で配信されたすべてのイベントがリプレイされます。 

**アプリケーションが Account Activity Replay API のイベントの取り込みに失敗した場合、再試行は行われますか？**

いいえ、再試行は行われません。アプリケーションが Account Activity Replay API によって送信されたイベントの取り込みに失敗した場合、同じ期間に対して別の Replay ジョブを送信し、取りこぼした Replay イベントの再配信を試みることができます。 

**partial success completion event を受信した場合はどうすればよいですか？**

受信したイベントのタイムスタンプを控え、取りこぼしたイベントに対して別の Replay ジョブをリクエストすることをお勧めします。 

**同時に実行できる Account Activity Replay API ジョブの数に上限はありますか？**

1 つの webhook につき、同時に実行できる Account Activity Replay API ジョブは 1 件のみです。 

**Account Activity Replay API から配信されるイベントと、本番環境のリアルタイムイベントを、webhook に配信された際にどのように区別できますか？**

Account Activity Replay API は必ず過去のイベントのみを配信するため、イベントのタイムスタンプに基づいて本番環境のリアルタイムイベントと区別できます。 

**アプリケーションがドロップまたは見逃したアクティビティを再配信するために、Account Activity Replay API をどのくらい早くから利用できますか？**

アクティビティは、作成から約 10 分後に再配信可能になります。 

<div id="error-troubleshooting-guide">
  ### エラーに関するトラブルシューティングガイド
</div>

<div id="code-32">
  #### Code 32
</div>

このエラーは一般的に、リクエスト、ヘッダー、認可、または指定している URL のいずれかの形式が不正であることを意味します。これは Account Activity API 固有のエラーではなく、認可エラーであり、X が適切な OAuth 設定または URL を受け取れていません。

* **Enterprise** - 使用しているコンシューマーキーとアクセストークンが、Enterprise 製品の利用が登録されている [X app](/ja/resources/fundamentals/developer-apps) に属していることを確認してください。コンシューマーキーやアクセストークンを保持していない場合、または X app を allowlist に追加する必要がある場合は、アカウントマネージャーにお問い合わせください。 

* ユーザーコンテキストで認証する場合は、`oauth nonce`、`oauth_signature`、`oauth_timestamp` を正しく指定して[リクエストを認可](/ja/resources/fundamentals/authentication#authorizing-a-request)していることを確認してください。

* アクセストークンに適切な権限レベルが付与されていることを確認してください。
  * [app dashboard](/ja/resources/fundamentals/developer-apps) の「Keys and tokens」タブで、アクセストークンに「Read, write, and direct messages」の[権限レベル](/ja/resources/fundamentals/developer-apps#app-permissions)が設定されていることを確認してください。 
  * トークンの権限レベルがこれより低く設定されている場合は、「Permissions」タブに移動し、アクセス権限を「Read, write, and direct messages」に変更してから、「Keys and tokens」タブでアクセストークンとシークレットを再生成してください。

* URL が正しい形式になっていることを確認してください。
  * `:env_name` は大文字と小文字が区別されることに注意してください。
     

<div id="code-200-forbidden">
  #### コード 200 - Forbidden（アクセス禁止）
</div>

* **Premium** - API にリクエストを送信する前に、[開発者アカウント](/ja/resources/fundamentals/developer-portal)が承認されていることを確認してください。リクエスト内で適切な :env&#95;name を使用する必要があり、これは [dev environments](/ja/resources/fundamentals/developer-portal) ページで設定できます。

* **Enterprise** - アカウント担当者によって、Account Activity API へのアクセス権が付与されていることを確認してください。

* URI を正しく設定していることを確認してください。リクエストで誤った URI を入力している場合、このエラーが発生する可能性があります。
   

<div id="code-214-webhook-url-does-not-meet-the-requirements">
  #### Code 214 - Webhook URL が要件を満たしていません。
</div>

* HTTPS を使用していることを確認してください。
* Webhook URL の形式が正しくない可能性があります。
* Webhook URL の設定方法については、[Getting started with webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks) ページの [Develop webhook consumer app](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#3-develop-webhook-consumer-app) セクションを参照してください。
   

<div id="code-214-high-latency-on-crc-get-request-your-webhook-should-respond-in-less-than-3-seconds">
  #### Code 214 - CRC GET リクエストのレイテンシが高すぎます。webhook は 3 秒未満で応答する必要があります。
</div>

* これはサーバーの応答が遅いことを示しています。CRC リクエストには 3 秒以内に応答していることを確認してください。
   

<div id="code-214-non-200-response-code-during-crc-get-request-ie-404-500-etc">
  #### Code 214 - CRC GET リクエスト時の 200 以外のレスポンスコード（例: 404、500 など）。
</div>

* サーバーがダウンしています。サーバーが正常に稼働していることを確認してください。
   

<div id="code-214-too-many-resources-already-created">
  #### コード 214 - すでに作成されているリソースが多すぎます。
</div>

* **Enterprise** - 利用可能な webhook をすでにすべて使い切っています。登録済みの各アプリごとに [GET webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) エンドポイントを使用し、webhook がどこに割り当てられているかを特定してください。 

<div id="code-261-application-cannot-perform-write-actions">
  #### コード 261 - アプリケーションは書き込みアクションを実行できません。
</div>

* 使用している API 用アプリに紐づくアクセストークンとアクセストークンシークレットに、適切な[権限レベル](/ja/resources/fundamentals/developer-apps#app-permissions)が設定されていません。[X apps](/ja/resources/fundamentals/developer-apps) ダッシュボードの「Keys and tokens」タブに移動し、アクセストークンおよびアクセストークンシークレットに割り当てられている権限レベルを確認してください。「Read, write and Direct Messages」以外に設定されている場合は、「Permission」タブで設定を変更し、新しい設定を反映させるためにアクセストークンとアクセストークンシークレットを再生成する必要があります。
* または、サポートされていないアプリのみ認証 (app-only authentication) を使用して webhook を登録しようとしている可能性があります。[Enterprise Account Activity API](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) の webhook 登録に関する API リファレンスセクションで説明されているとおり、代わりにユーザーコンテキストで認証してください。

<div id="account-activity-api-reference-index">
  ## Account Activity API リファレンスインデックス
</div>

|     |     |
| :--- | :--- |
| **目的** | Enterprise |
| webhook URL を登録 / webhook&#95;id を生成 | [POST  <br />webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| すべての webhook URL とそのステータスを返す | [GET  <br />webhooks](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| チャレンジレスポンスチェックを手動でトリガーする | [PUT  <br />webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |
| アカウントのイベントにアプリケーションを購読させる | [POST  <br />webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| 現在アクティブなサブスクリプションの件数を返す | [GET  <br />subscriptions/count](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| webhook がアカウントのイベントを購読しているか確認する | [GET  <br />webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| 現在アクティブなサブスクリプションの一覧を返す | [GET  <br />webhooks/:webhook&#95;id/subscriptions/all/list](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| webhook を削除する | [DELETE  <br />webhooks/:webhook&#95;id](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| 3-legged OAuth を使用してサブスクリプションを無効化する（非推奨） | [DELETE  <br />webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |
| アプリケーション専用 OAuth を使用してサブスクリプションを無効化する | [DELETE  <br />webhooks/:webhook&#95;id/subscriptions/:user&#95;id/all.json](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |
| webhook にアクティビティを再配信する | [POST  <br />replay/webhooks/:webhook&#95;id/subscriptions/all](/ja/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |

<div id="enterprise-account-activity-api">
  ### Enterprise アカウントアクティビティ API
</div>

<div id="post-account_activitywebhooks">
  #### POST account&#95;activity/webhooks[](#post-account-activity-webhooks "Permalink to this headline")
</div>

指定されたアプリケーションコンテキストに対して、新しい webhook の URL を登録します。URL は保存される前に CRC リクエストによって検証されます。検証に失敗した場合は、リクエスト元に対して詳細なエラーメッセージを返します。

許可される webhook の数は、利用中の課金プランによって決まります。

### リソース URL[](#resource-url "この見出しへのパーマリンク")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（ユーザーコンテキスト - すべてのコンシューマーキーおよびアクセストークン） |
| レート制限 | あり |
| リクエスト数 / 15分間あたり（ユーザー認証） | 15  |
| ポスト編集のサポート | すべてのポストオブジェクトには、そのポストの編集履歴を示すポスト編集メタデータが含まれています。詳細については、[「ポスト編集」の基本](/ja/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets)ページを参照してください。 |

### パラメータ[](#parameters "Permalink to this headline")

|     |     |
| :--- | :--- |
| url (required) | コールバックエンドポイントの URL（URL エンコード済み）。 |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

$ curl --request POST
--url &#39;https://api.x.com/1.1/account&#95;activity/webhooks.json?url=https%3A%2F%2Fyour&#95;domain.com%2Fwebhooks%2Ftwitter%2F0&#39;
--header &#39;authorization: OAuth oauth&#95;consumer&#95;key=&quot;CONSUMER&#95;KEY&quot;, oauth&#95;nonce=&quot;GENERATED&quot;, oauth&#95;signature=&quot;GENERATED&quot;, oauth&#95;signature&#95;method=&quot;HMAC-SHA1&quot;, oauth&#95;timestamp=&quot;GENERATED&quot;, oauth&#95;token=&quot;ACCESS&#95;TOKEN&quot;, oauth&#95;version=&quot;1.0&quot;&#39;

<div id="http-responses">
  ### HTTP Responses[](#http-responses "この見出しへのパーマリンク")
</div>

| HTTP Code | Message |
| :--- | :--- |
| 200 | Webhook URL が指定されたアプリケーションに登録されています |
| 403 | リクエストにエラーがあります。以下のエラーメッセージ セクションを参照してください。 |

### 成功時のレスポンス例[](#example-response-success "Permalink to this headline")

```json
_HTTP 200_

    {
      "id": "1234567890",
      "url": "https://your_domain.com/webhook/twitter/0",
      "valid": true,
      "created_at": "2016-06-02T23:54:02Z"
    }
```

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | Message                                                  |
| :--- | :------------------------------------------------------- |
| 214  | Webhook URL が要件を満たしていません。                                |
| 214  | すでに作成済みのリソースが多すぎます。                                      |
| 214  | Webhook URL が要件を満たしていません。CRC トークンまたは JSON レスポンス形式が無効です。  |
| 214  | CRC GET リクエストのレイテンシーが高すぎます。Webhook は 3 秒以内に応答する必要があります。  |
| 214  | CRC GET リクエスト中に 200 以外のレスポンスコード (例: 404、500 など) が返されました。 |

*HTTP 403*

```json
    {
      "errors": [
        {
          "code": 214,
          "message": "リソースが既に作成されすぎています。"
        }
      ]
    }
```

<div id="get-account_activitywebhooks">
  #### GET account&#95;activity/webhooks[](#get-account-activity-webhooks "Permalink to this headline")
</div>

指定したアプリケーションに対して登録されているすべてのURLとそのステータスを返します。

URL が日次の検証に失敗した場合、そのURLは無効としてマークされます。URLを再度有効化するには、update エンドポイントを呼び出してください。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証 | 必要（アプリのみ - Bearer Token） |
| レート制限 | あり |
| 15分あたりのリクエスト数（アプリ認証） | 15  |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/webhooks.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-response">
  ### レスポンス例[](#example-response "Permalink to this headline")
</div>

*HTTP 200 OK*

```json
    [
      {
        "id": "1234567890",
        "url": "https://your_domain.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-02T23:54:02Z"
      }
      {
        "id": "2468013579",
        "url": "https://your_domain2.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-04T22:31:29Z"
      }
    ]
```

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | メッセージ |
| :--- | :--- |
| 99  | このリソースにアクセスする権限がありません。 |

<div id="put-account_activitywebhookswebhook_id">
  #### PUT account&#95;activity/webhooks/:webhook&#95;id[](#put-account-activity-webhooks-webhook-id "Permalink to this headline")
</div>

指定された webhook の URL に対してチャレンジレスポンスチェック (CRC) をトリガーします。チェックが成功すると、ステータスを `valid` に設定して webhook を再有効化し、204 を返します。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（ユーザーコンテキスト - すべてのコンシューマートークンおよびアクセストークン） |
| レート制限あり | はい |
| リクエスト数 / 15分間のウィンドウ（ユーザー認証） | 15  |

<div id="parameters">
  ### パラメーター[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook&#95;id (required) | Webhook のID。リソースパスで定義されます。 |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

```json
    $ curl --request PUT
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="response">
  ### レスポンス[](#response "この見出しへのパーマリンク")
</div>

*HTTP 204 OK*

```
    { }
```

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 34  | Webhook が存在しないか、別の X アプリに関連付けられています。 |
| 214 | Webhook の URL が要件を満たしていません。 |
| 214 | Webhook の URL が要件を満たしていません。CRC トークンが無効か、JSON レスポンス形式が不正です。 |
| 214 | CRC GET リクエストのレイテンシーが高すぎます。Webhook は 3 秒未満で応答する必要があります。 |
| 214 | CRC GET リクエスト中に 200 以外のレスポンスコードが返されました (例: 404、500 など)。 |

<div id="post-account_activitywebhookswebhook_idsubscriptionsall">
  #### POST account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all[](#post-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")
</div>

指定されたアプリケーションを、指定されたユーザーコンテキストにおけるすべてのメッセージタイプのすべてのイベントにサブスクライブします。有効化後、リクエスト元ユーザーに関するすべてのイベントは、POST リクエストを介してアプリケーションの webhook に送信されます。

サブスクリプションは、現在お使いのアカウント設定に基づき制限されています。さらにサブスクリプションを追加する必要がある場合は、アカウントマネージャーまでご連絡ください。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（3-legged OAuth ― ホワイトリスト登録済みコンシューマーキーと購読ユーザーのアクセストークン） |
| レート制限 | あり |
| リクエスト数 / 15分間ウィンドウ（ユーザー認証） | 500 |

### パラメータ[](#parameters "Permalink to this headline")

|     |     |
| :--- | :--- |
| webhook&#95;id (required) | WebhookのID。リソースパスで定義されます。 |

### リクエスト例[](#example-request "この見出しへの固定リンク")

```bash
    $ curl --request POST
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBING_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-response-success">
  ### レスポンス例 - 成功時[](#example-response-success "Permalink to this headline")
</div>

*HTTP 204 NO CONTENT*

```
    {}
```

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 34  | webhook は存在しないか、別の X アプリに関連付けられています。 |
| 348 | クライアントアプリには、このユーザーの webhook サブスクリプションにアクセスする権限がありません。 |

<div id="get-account_activitysubscriptionscount">
  #### GET account&#95;activity/subscriptions/count[](#get-account-activity-subscriptions-count "Permalink to this headline")
</div>

現在のアカウントで有効になっているサブスクリプションの件数を返します。`/count` エンドポイントを利用するにはアプリケーション専用（application-only）OAuth が必要なため、ユーザーコンテキストではなく Bearer Token を使用してリクエストを行ってください。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/subscriptions/count.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | HTTP response code |
| 認証が必要 | はい（アプリケーションのみ - Bearer Token） |
| レート制限 | あり |
| リクエスト数 / 15 分ウィンドウ（アプリケーション認証） | 15  |

<div id="http-response-codes">
  ### HTTP レスポンスコード[](#http-response-codes "この見出しへのパーマリンク")
</div>

|     |     |
| :--- | :--- |
| Code | Message |
| 200 | 成功。リクエストされた webhook のサブスクリプションの件数が返されます。 |
| 401 | ご利用のアプリケーションには、指定された webhook のサブスクリプションを閲覧する権限がありません。 |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/subscriptions/count.json
     --header 'authorization: Bearer TOKEN'
```

### 成功時のレスポンス例[](#example-response-success "Permalink to this headline")

*HTTP 200*

```bash
    {
      "account_name":"my-account",
      "subscriptions_count_all":"1",
      "subscriptions_count_direct_messages":"0",
      "provisioned_count":"50"
    }
```

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | Message    |
| :--- | :--------- |
| 32   | 認証に失敗しました。 |

*HTTP 401*

```abash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

<div id="get-account_activitywebhookswebhook_idsubscriptionsall">
  #### GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all[](#get-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")
</div>

指定されたユーザーのイベントに対して、特定の webhook 設定が購読されているかどうかを確認するためのものです。指定されたユーザーコンテキストに、指定されたアプリケーションで有効なサブスクリプションがある場合は 204 OK を返します。レスポンスコードが 204 でない場合、そのユーザーには有効なサブスクリプションがありません。詳細については、以下の HTTP レスポンスコードおよびエラーメッセージを参照してください。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（3-legged OAuth - ホワイトリスト登録済みコンシューマーキーと購読ユーザーのアクセストークン） |
| レート制限 | はい |
| リクエスト数 / 15 分間（ユーザー認証） | 500 |

### パラメータ[](#parameters "Permalink to this headline")

|     |     |
| :--- | :--- |
| webhook&#95;id (required) | Webhook ID。リソースパスで定義されます。 |

### リクエスト例[](#example-request "この見出しへのパーマリンク")

$ curl --request GET
--url https://api.x.com/1.1/account&#95;activity/webhooks/:WEBHOOK&#95;ID/subscriptions/all.json
--header &#39;authorization: OAuth oauth&#95;consumer&#95;key=&quot;WHITELISTED&#95;CONSUMER&#95;KEY&quot;, oauth&#95;nonce=&quot;GENERATED&quot;, oauth&#95;signature=&quot;GENERATED&quot;, oauth&#95;signature&#95;method=&quot;HMAC-SHA1&quot;, oauth&#95;timestamp=&quot;GENERATED&quot;, oauth&#95;token=&quot;SUBSCRIBING&#95;USER&#39;S&#95;ACCESS&#95;TOKEN&quot;, oauth&#95;version=&quot;1.0&quot;&#39;

<div id="example-response-success">
  ### レスポンス例 - 成功時[](#example-response-success "Permalink to this headline")
</div>

*HTTP 204 NO CONTENT*

```
    { }
```

<div id="get-account_activitywebhookswebhook_idsubscriptionsalllist">
  #### GET account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all/list[](#get-account-activity-webhooks-webhook-id-subscriptions-all-list "Permalink to this headline")
</div>

指定した webhook に対する現在の All Activity タイプのサブスクリプション一覧を返します。/list エンドポイントではアプリケーション専用の OAuth 認証が必要となるため、リクエストはユーザーコンテキストではなく Bearer Token を使用して行う必要があります。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all/list.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | HTTP response code |
| 認証 | 要（アプリケーション認証のみ、Bearer Token） |
| レート制限 | あり |
| リクエスト数 / 15分間ウィンドウ（アプリケーション認証） | 50  |

### パラメータ[](#parameters "Permalink to this headline")

|     |     |
| :--- | :--- |
| webhook&#95;id（必須） | Webhook ID。リソースパス内で定義されます。 |

### HTTP レスポンスコード[](#http-response-codes "Permalink to this headline")

| Code | Message |
| :--- | :--- |
| 200 | 成功。要求された webhook に対するサブスクリプションの一覧が返されます。 |
| 401 | アプリケーションには、指定された webhook のサブスクリプションを閲覧する権限がありません。 |

### リクエスト例[](#example-request "この見出しへのパーマリンク")

$ curl --request GET
--url https://api.x.com/1.1/account&#95;activity/webhooks/:WEBHOOK&#95;ID/subscriptions/all/list.json
--header &#39;authorization: Bearer TOKEN&#39;

### 成功時のレスポンス例[](#example-response-success "Permalink to this headline")

*HTTP 200*

```bash
    {
      "webhook_id": "1234567890",
      "webhook_url": "https://your_domain.com/webhook/twitter/0",
      "application_id": "11231812",
      "subscriptions": [{
        "user_id": "20212306"
      }]
    }
```

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | Message    |
| :--- | :--------- |
| 32   | 認証に失敗しました。 |

*HTTP 401*

```bash
    {
      "errors": [
        {
           "code": 32,
          "message": "認証できませんでした。"
        }
      ]
    }
```

<div id="delete-account_activitywebhookswebhook_id">
  #### DELETE account&#95;activity/webhooks/:webhook&#95;id[](#delete-account-activity-webhooks-webhook-id "Permalink to this headline")
</div>

指定されたアプリケーションの設定から webhook を削除します。webhook ID は、GET /1.1/account&#95;activity/webhooks を呼び出すことで取得できます。

<div id="resource-url">
  ### リソースURL[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（ユーザーコンテキスト - すべてのコンシューマー／アクセストークン） |
| レート制限 | あり |
| リクエスト数 / 15 分（ユーザー認証） | 15  |

### パラメータ[](#parameters "Permalink to this headline")

|     |     |
| :--- | :--- |
| webhook&#95;id (required) | Webhook のID。リソースパスで定義されます。 |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

### レスポンス[](#response "Permalink to this headline")

*HTTP 204 OK*

```
    { }
```

<div id="delete-account_activitywebhookswebhook_idsubscriptionsall-deprecated">
  #### DELETE account&#95;activity/webhooks/:webhook&#95;id/subscriptions/all (非推奨)[](#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated- "Permalink to this headline")
</div>

指定されたユーザーコンテキストおよびアプリケーションのサブスクリプションを無効化します。無効化後は、リクエスト元ユーザーに関するすべてのイベントは Webhook URL に送信されなくなります。

<div id="resource-url">
  ### リソースURL[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（3-legged OAuth - ホワイトリスト登録済みのコンシューマキーとサブスクライブしているユーザーのアクセストークン） |
| レート制限あり | はい |
| リクエスト数 / 15分間（ユーザー認証） | 500 |

<div id="parameters">
  ### パラメーター[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook&#95;id (required) | Webhook の ID。リソースパスで指定されます。 |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

リクエスト例

```
    { }
```

<div id="delete-account_activitywebhookswebhook_idsubscriptionsuser_idalljson">
  #### DELETE /account&#95;activity/webhooks/:webhook&#95;id/subscriptions/:user&#95;id/all.json[](#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json "Permalink to this headline")
</div>

指定された webhook とユーザー id に対するサブスクリプションを無効化します。無効化後は、リクエストを行ったユーザーに関するすべてのイベントは、webhook URL には送信されなくなります。なお、このエンドポイントは application-only OAuth を必要とするため、リクエストはユーザーコンテキストではなく Bearer Token を使用して行う必要があります。

### リソース URL[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json`

<div id="resource-information">
  ### リソース情報[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| レスポンス形式 | JSON |
| 認証が必要 | はい（アプリのみ - Bearer Token） |
| レート制限あり | はい |
| リクエスト数 / 15 分間ウィンドウ | 500 |

<div id="example-request">
  ### リクエスト例[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json
     --header 'authorization: Bearer TOKEN'
```

### レスポンス[](#response "Permalink to this headline")

*HTTP 204 NO CONTENT*

<div id="error-messages">
  ### エラーメッセージ[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 404 | 申し訳ありませんが、そのページは存在しません。- 指定されたユーザー id が実際にはサブスクライブされていない場合によく発生します。 |

<div id="replay-api">
  ### Replay API
</div>

**POST /1.1/account&#95;activity/replay/webhooks/:webhook&#95;id/subscriptions/all.json [¶](#post-1-1-account-activity-replay-webhooks-webhook-id-subscriptions-all-json- "Permalink to this headline")**

リクエストで指定した日時ウィンドウ内に存在していたすべてのサブスクリプションについて、過去最大5日分のアクティビティ取得を要求します。Webhook にアクティブなユーザーサブスクリプションがある場合、それらのイベントも同時に受信します。注: リプレイイベントを配信する前に CRC チェックを実行します。

|     |     |
| :--- | :--- |
| **Request Method** | HTTP POST |
| **URL** | /1.1/account&#95;activity/replay/webhooks/:webhook&#95;id/subscriptions/all.json?from&#95;date=yyyymmddhhmm&amp;to&#95;date=yyyymmddhhmm |
| **Response Format** | JSON |
| **Requires Authentication** | はい（アプリケーション専用 - Bearer Token） |
| **Rate Limit** | 15分あたり5リクエスト。リクエスト可能なリプレイジョブの数に、現在上限はありません。 |
| **from&#95;date** | イベントが提供される最も古い（開始）UTC タイムスタンプ。&#39;yyyymmddhhmm&#39; 形式で指定する必要があります。タイムスタンプの粒度は分単位で、包含的です（例: 12:00 は 00 分を含みます）。有効な時間は直近5日以内の UTC 時刻であり、現在時刻の31分前より新しくてはなりません。`from_date` と `to_date` はおおよそ2時間以内の範囲に収めることを推奨します。 |
| **to&#95;date** | イベントが提供される最も新しい（終了）UTC タイムスタンプ。&#39;yyyymmddhhmm&#39; 形式で指定する必要があります。タイムスタンプの粒度は分単位で、排他的です（例: 12:30 はその時間の30分ちょうどを含みません）。有効な時間は直近5日以内の UTC 時刻であり、現在時刻の10分前より新しくてはなりません。 |

<div id="responses">
  #### レスポンス
</div>

以下のレスポンスが API から返される可能性があります。ほとんどのエラーコードは、ボディ内に追加の詳細を含む文字列とともに返されます。200 以外のレスポンスの場合は、エラーを解消してから再試行してください。

| Status | Text | Error Code | Description | Message |
| :--- | :--- | :--- | :--- | :--- |
| 202 | Accepted | N/A | リクエストは正常に処理され、アクティビティが送信されます。 | N/A |
| 400 | Bad Request | 214 | Webhook が無効としてマークされています。 | Webhook is marked invalid and requires a CRC check. |
| 400 | Bad Request | 357 | クエリパラメータがありません。 | : queryParam is required. |
| 400 | Bad Request | 358 | ルートまたはクエリパラメータの形式が正しくありません。 | Unable to parse parameter. |
| 400 | Bad Request | 360 | ルートパラメータが負の値です。 | webhook&#95;id: [] is not greater than or equal to 0. |
| 400 | Bad Request | 368 | from&#95;date または to&#95;date が過去の日付ではありません。 | : [&lt;field&#95;value&gt;] is not in the past. |
| 400 | Bad Request | 356 | from&#95;date は to&#95;date より前である必要があります。 | from&#95;date must be before to&#95;date. |
| 400 | Bad Request | 356 | from&#95;date は過去 5 日以内である必要があります。 | from&#95;date must be within the past 5 days. |
| 401 | Unauthorized | 32  | 3-legged 認証が指定されているため、HTTP 認証に失敗しました。 | Invalid authentication method. Please use application-only authentication. |
| 401 | Unauthorized | 61  | Client はこのメソッドを要求することが許可されていません。 | Client is not permitted to request this method. |
| 403 | Forbidden | 200 | Client は Replay が有効な Enterprise アカウントを持っていません。 | Replay が有効な Account Activity API の Enterprise アカウントが必要です。Enterprise アカウントを保有し、Replay が有効になっていることを確認してください。 |
| 404 | Not Found | 34  | 存在しない webhook&#95;id か、webhook&#95;id と application&#95;id が一致していません。 | Webhook が存在しないか、別の X アプリケーションに関連付けられています。 |
| 409 | Conflict | 355 | 進行中のリクエストがあるため、処理が完了するまで次のリクエストを行うことはできません。 | この webhook にはすでに Replay ジョブが進行中です。 |
| 429 | Too Many Requests | 88  | レート制限（一定時間あたりのリクエスト数の上限に達しました）。 | リクエストが多すぎます。API リクエストの頻度を下げてください。 |
| 500 | Internal Server Error | 0   | 内部サーバーエラー。 | Internal server error. |
| 503 | Service Unavailable | 67  | X が依存している 1 つ以上のサービスを利用できません。 | X のサーバーエラーです。指数バックオフパターンで再試行してください。 |

<div id="job-completed-successfully-message">
  #### &quot;ジョブが正常に完了しました” メッセージ
</div>

ジョブが正常に完了すると、Account Activity Replay API は次のジョブ完了イベントを送信します。このイベントを受信した時点で、そのジョブの実行は完了しており、別のジョブを送信できる状態になっています。

```json
{
  "replay\_job\_status": {
    "webhook_id": "1234577122340233217",
    "job_state": "Complete",
    "job\_state\_description": "Job completed successfully"
    "job_id": "1095098195724558337"
  }
}
```

<div id="job-failed-to-complete-message">
  #### &quot;Job failed to complete&quot; メッセージ
</div>

ジョブが正常に完了しなかった場合、Replay ジョブの再試行を促す次のメッセージが返されます。このイベントを受信した時点で、そのジョブの実行は終了しており、別のジョブを送信できます。

```json
{
  "replay\_job\_status": {
    "webhook_id": "123451374207332352",
    "job_state": "Incomplete",
    "job\_state\_description": "Job failed to deliver all events, please retry your replay job",
    "job_id": "1093226942650736640"
  }
}
```

<div id="example-curl-request">
  #### cURL リクエスト例
</div>

```bash
    curl --request POST  --url 'https://api.x.com/1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json?from_date=yyyymmddhhmm&to_date=yyyymmddhhmm'
    --header 'authorization: Bearer TOKEN'
```

#### レスポンスの例

HTTP 202

```bash
{
  "job_id": "1234567890",
  "created_at": "2016-06-02T23:54:02Z"
}
```
