---
title: クイックスタート
sidebarTitle: クイックスタート
keywords: ["ダイレクトメッセージ管理のクイックスタート", "DM 管理のクイックスタート", "DM 送信のクイックスタート", "DM 管理のクイックスタート"]
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## ダイレクトメッセージ管理エンドポイントの利用を開始する
</div>

このクイックスタートガイドでは、HTTP リクエストの管理と送信に使用できるツールである Postman を使って、ダイレクトメッセージエンドポイントへの最初のリクエストを送信する方法を説明します。Postman コレクションの詳細については、[Using Postman](/ja/tutorials/postman-getting-started) ガイドを参照してください。

Python ベースのサンプルを確認したい場合は、[X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) の GitHub リポジトリをご覧ください。さらに、公式の [X Developer Platform software development kits (SDKs)](/ja/x-api/tools-and-libraries/sdks) も、これらのダイレクトメッセージエンドポイントをサポートするように更新される予定です。  

<Note>
  **前提条件**

  このガイドを完了するには、リクエストを認証するための [キーとトークン](/ja/resources/fundamentals/authentication) 一式が必要です。これらのキーとトークンは、次の手順に従って生成できます。

  * [開発者アカウントにサインアップ](https://developer.x.com/en/apply-for-access) し、承認を受けます。
  * 開発者ポータルで [プロジェクト](/ja/resources/fundamentals/projects) と、それに関連付けられた [開発者アプリ](/ja/resources/fundamentals/developer-apps) を作成します。
  * アプリの「Keys and tokens」ページに移動し、必要な認証情報を生成します。すべての認証情報は安全な場所に保存してください。
</Note>

<div id="steps-to-building-manage-direct-message-requests">
  ### manage Direct Message リクエストを構築する手順
</div>

この例では、1 回のリクエストで新しいグループ会話を作成し、その会話に最初のメッセージを追加します。続いて、作成した会話に2つ目のメッセージを追加します。

<div id="step-one-start-with-a-tool-or-library">
  #### ステップ1：ツールまたはライブラリから始める
</div>

Direct Message 管理エンドポイントの利用を始めるにあたり、ここでは Postman ツールを使って手順を簡略化します。XDev が作成した X API v2 リクエストのサンプルコレクションを利用して、新しいダイレクトメッセージを作成する 6 つのエンドポイントと、ダイレクトメッセージ会話イベントを一覧取得するエンドポイントを確認していきます。

コレクションの大部分はあらかじめ入力されていますが、これらの API リクエストをホストするために作成した X アプリに基づいて、いくつか設定していただく必要がある項目があります。まずは、コレクションを読み込む／更新する作業から始めましょう。

X API v2 Postman コレクションを自分の環境に読み込むには、次のボタンをクリックしてください。

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  X API v2 を Postman に追加
</Button>

Postman に X API v2 コレクションを読み込んだら、「Manage Direct Messages」フォルダーに移動します。このフォルダーの Authorization タブは可能な限りあらかじめ入力されており、いくつかの設定を更新して X アプリの認証情報を反映できます。このフォルダーには、新しいダイレクトメッセージを作成するための 3 つのエンドポイントも含まれています。なお、送受信メッセージや会話参加者の参加・退出など、ダイレクトメッセージ会話イベントを取得するための 3 つのエンドポイントが含まれた「Direct Message lookup」フォルダーもあります。 

グループ会話の作成は X API v2 の新しく魅力的な機能であるため、この例ではそこにフォーカスします。ここでは &quot;New group DM and conversation&quot; のサンプルを使用します。このリクエストを使って、ダイレクトメッセージのグループ会話を作成します。

次のステップでは、エンドポイントへの認証を行います。

**ステップ2：リクエストを認証する**

X API に正しくリクエストを送信するには、その操作を行う権限があることを検証する必要があります。このエンドポイントへのリクエストを成功させるために、ここでは [OAuth 2.0 Authorization Code Flow with PKCE](resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2) を使用します。アクセストークンは Postman 内で生成できます。 

Postman では、フォルダーレベルまたはリクエストレベルで認証方式を設定できます。ここではフォルダーレベルで認証情報を設定します。

「Manage Direct Messages」フォルダーに移動し、「Authorization」タブを選択して、Type が「OAuth 2.0」に設定されていること、および &quot;Add auth data to&quot; が &quot;Request Headers&quot; に設定されていることを確認します。&quot;Current Token&quot; セクションで、&quot;header Prefix&quot; が Bearer に設定されていることを確認してください。  

新しいトークンを設定および生成するには、次の手順を実行します。

1. &quot;Manage DMs&quot; などのトークン名を作成します。

2. **Grant Type** が Authorization Code (with PKCE) に設定されていることを確認します。

3. **Callback URL** を設定します。Callback URL は、[v2 Dev Portal](https://developer.x.com/en/portal/dashboard) 上のアプリケーションに紐づいている Callback URL と完全に一致するように更新する必要があります。この例で使用している X アプリでは、Callback URL は [*https://www.example.com*.](https://www.example.com/) に設定されています。（完全一致する必要があるため、[*https://example.com*](https://example.com) では動作しない点に注意してください。） 

4. **Auth URL** が [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize) に設定されていることを確認します。

5. **Access Token URL** が [https://api.x.com/2/oauth2/token](https://api.x.com/2/oauth2/token) に設定されていることを確認します。\
   **Client ID** - Developer Portal から OAuth 2.0 client ID をコピー＆ペーストします。\
   **Client Secret** - 機密クライアントの App タイプを使用している場合にのみ必要です。その場合は、Developer Portal から OAuth 2.0 Client Secret をコピー＆ペーストします。 

6. **Scope** が dm.read、dm.write、tweet.read、users.read に設定されていることを確認します。

7. **State** が “state” に設定されていることを確認します。

8. **Client Authentication** が Send as Basic Auth header に設定されていることを確認します。

9. **Get New Access Token** をクリックし、「Sign-in with X」プロセスの一部として &quot;Authorize app&quot; をクリックします。

10. &quot;Proceed&quot; ボタンをクリックし、その後 &quot;Use Token&quot; をクリックしてトークンを生成します。 

11. 「Save」ボタンをクリックして、これらの設定内容を保存します。

X にログインしていないというメッセージが表示される場合があります。このエラーが発生した場合は、Postman 内で、代理で投稿しようとしている X アカウントにログインする必要があります。

これらの OAuth 2.0 の詳細をフォルダーレベルで設定したら、各サンプルに移動し、「Authorization」タブを開いて、Type が「Inherit auth from parent」に設定されていることを確認します。

このトークンはまもなく有効期限が切れるため、「Get New Access Token」ボタンをクリックして再生成する必要があります。クリックすると「Sign-in with X」のプロセスが開始され、新しいトークンが発行されてリクエストに使用できるようになります。

<div id="step-three-specify-the-direct-message-conversation-participants-and-message-contents">
  #### 手順3: ダイレクトメッセージ会話の参加者とメッセージ内容を指定する
</div>

「Body」タブに移動し、サンプルの JSON オブジェクトを更新します。`participant_ids` 属性に、ダイレクトメッセージを送信したいアカウントを設定します。

`{
   "message": {"text": "Hello to just you two, this is a new group conversation."},
   "participant_ids": ["944480690","906948460078698496"],
   "conversation_type": "Group"
}`

<div id="step-four-make-your-request-and-review-the-response">
  #### ステップ4：リクエストを送信してレスポンスを確認する
</div>

すべての設定が完了したら、「Send」ボタンをクリックすると、下のサンプルレスポンスと同様のレスポンスが返ってきます。上で作成したトークンの有効期限が切れている場合は、フォルダーの「Authorization」タブに戻り、「Get New Access Token」をクリックして新しいトークンを取得してください。

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582103724607971332"
   }
}
```

返されたレスポンスの &quot;data&quot; オブジェクトに dm&#95;conversation&#95;id と dm&#95;event&#95;id が含まれている場合、新しいダイレクトメッセージ会話が正常に作成できています。この会話に関連付けられたイベントの検索を開始するには、Direct Message ルックアップのクイックスタートガイドに進んでください。

<div id="step-five-add-another-message-to-that-group-conversation">
  #### ステップ5：そのグループ会話に別のメッセージを追加する
</div>

次に「Add DM to conversation」の例を選択し、「Params」タブを開きます。「Path Variables」で `dm_conversation_id` を、先ほど作成した会話の ID に更新します。

|                            |                     |
| :------------------------- | :------------------ |
| **Key**                    | **Value**           |
| dm&#95;conversation&#95;id | 1582103724607971328 |

この会話 ID を使用すると、リクエストパスは次のようになります: [https://api.x.com/2/dm&#95;conversations/1582103724607971328/messages](https://api.x.com/2/dm_conversations/1582103724607971328/messages)

また、送信したいメッセージテキストを含むリクエスト JSON を「Body」タブに設定します。

```
{
   "text": "Adding a new message to our group conversation..."
}
```

すべての準備が整ったら「Send」ボタンをクリックします。すると、次のサンプルレスポンスと同様のレスポンスが返ってきます。

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582106224379559940"
   }
}
```
