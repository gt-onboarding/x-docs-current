---
title: 連携ガイド
sidebarTitle: 連携ガイド
keywords: ["ダイレクトメッセージ管理連携", "DM管理連携", "DM送信連携", "DM連携ガイド", "ダイレクトメッセージ連携設定"]
---

import { Button } from '/snippets/ja/button.mdx';

Direct Messages v2 エンドポイントでは、会話と会話イベントがコアの X API オブジェクトとして導入され、1対1の会話とグループ会話が区別されます。1対1の会話では参加者は常に 2 人のみですが、グループ会話では 2 人以上が参加でき、参加メンバーは変動する可能性があります。   

このページでは、Manage Direct Messages エンドポイントをシステムに統合する際に把握しておくべき、いくつかのツールと重要な概念について説明します。ページの内容は次の 2 つのセクションに分かれています。

* 重要な概念
  * [ダイレクトメッセージの会話](#direct-message-conversations)

  * [v1.1 と v2 間で共有される会話 ID とイベント ID](#shared-conversation-and-event-ids)

  * [メディア添付とポストの参照](#including-media-attachments-and-referencing-tweets)

  * [認証](#authentication)

  * [Developer portal、プロジェクト、開発者アプリ](#developer-portal-projects-and-developer-apps)

  * [レート制限](#rate-limits)

* [役立つツール](#helpful-tools)

**重要な概念**

<div id="direct-message-conversations">
  ### ダイレクトメッセージの会話
</div>

すべてのダイレクトメッセージは、ダイレクトメッセージの会話の一部です。これらの会話は 1対1 の会話、またはグループ会話になります。今回のリリースでは、ダイレクトメッセージを作成し、ダイレクトメッセージの会話に関連付けられたイベントを取得するために必要な基盤となるエンドポイントを提供します。すべての会話には一意の dm&#95;conversation&#95;id があり、その会話を構成する各イベントには、それぞれ一意の dm&#95;event&#95;id が存在します。  

「Manage Direct Message」エンドポイントは、新しいメッセージを作成して会話に追加するための 3 つの POST メソッドを提供します。

* **POST /2/dm&#95;conversations/with/:participant&#95;id/messages** - 1対1 のダイレクトメッセージを作成します。このメソッドは、既存の 1対1 の会話にメッセージを追加するか、新しい会話を作成します。:participant&#95;id パスパラメータは、メッセージを受信するアカウントのユーザー ID です。 
  以下は、1対1 のダイレクトメッセージを送信する際の JSON リクエストボディの例です。

```
{
   "text": "Hello just you. This will appear as a new conversation if we have never messaged, or will be added to our existing thread. "
}
```

* **POST /2/dm&#95;conversations** - 新しいグループ会話を作成し、その会話にダイレクトメッセージを追加します。これらのリクエストでは、会話参加者のリストが必要です。同じ参加者リストを使って複数の会話を作成できる点に注意してください。これらのリクエストは常に新しい会話IDを返します。以下は、新しいグループ会話を作成し、ダイレクトメッセージを追加するためのJSONリクエストボディの例です。これには &quot;conversation&#95;type&quot; フィールドが必要であり、その値は &quot;Group&quot;（大文字・小文字は区別されます）に設定する必要がある点に注意してください。

```
{
   "message": {"text": "Hello to just you two, this is a new group conversation."},
   "participant_ids": ["944480690","906948460078698496"],
   "conversation_type": "Group"
}
```

* **POST /2/dm&#95;conversations/:dm&#95;conversation&#95;id/messages** - ダイレクトメッセージを作成し、既存の会話に追加します。:dm&#95;conversation&#95;id パスパラメータは、そのメッセージが追加される会話の ID です。このメソッドは、1 対 1 およびグループ会話の両方にメッセージを追加するために使用できます。
  1 対 1 およびグループ会話の両方にダイレクトメッセージを送信するための JSON リクエストボディの例を次に示します。

```
{
   "text": "Here is a new message."
}
```

これらの POST メソッドでは、1 つのメディアを添付できます。POST リクエストボディには、`text` フィールドと `attachments` フィールドのいずれか一方、または両方を含める必要があります。`attachments` フィールドが含まれていない場合は `text` 属性が必須であり、`text` フィールドが含まれていない場合は `attachments` フィールドが必須です。詳細については次のセクションを参照してください。

さらに詳しくは、[Manage Direct Messages API References](/ja/x-api/direct-messages/create-a-new-dm-conversation) を参照してください。

<div id="shared-conversation-and-event-ids-across-v11-and-v2">
  ### v1.1 と v2 間で共有される会話 ID とイベント ID
</div>

重要なポイントは、会話 ID とイベント ID が X Platform の v1.1 と v2 で共通になっているということです。これは、両バージョンを組み合わせて使用できることを意味します。

たとえば、Direct Messages v1.1 エンドポイントには、単一のイベントを返すメソッドと、イベントを削除するメソッドがあります。これらのメソッドは、まだ v2 では利用できません。ID は v1.1 と v2 で共通であるため、v2 から返された ID に基づいて v1.1 リクエストを行ったり、X アプリ上の会話 URL に表示される会話 ID を参照したりできます。  

<div id="including-media-attachments-and-referencing-posts">
  ### メディア添付の追加とポストの参照
</div>

Manage Direct Message の各エンドポイントはすべて、1 つのメディア（写真、動画、または GIF）を添付することをサポートしています。メディアを添付するには、v1.1 の [Upload media](https://developer.x.com/en/docs/x-api/v1/media/upload-media/overview) エンドポイントによって生成されるメディア ID が必要です。Direct Message を送信する認証済みユーザーは、そのメディアを事前にアップロードしている必要があります。アップロードが完了すると、メッセージに含める目的でメディアは 24 時間利用可能になります。

メディアを含める方法を示すため、以下に JSON リクエストボディの例を示します。

```
{
 "text": "Here's a photo...",
 "attachments": [{"media_id": "1583157113245011970}]
}
```

生成される MessageCreate イベントには次のメタデータが含まれます。

```
{
    "attachments": {
        "media_keys": [
            "5_1583157113245011970"
        ]
    }
}
```

メッセージ本文にポストのURLを記載すると、そのメッセージにポストを含めることもできます。メッセージにポストを含める方法を示すために、以下にJSONリクエストボディの例を示します。

```
{
 "text": "私が話していたツイートはこちらです: https://x.com/SnowBotDev/status/1580559079470145536"
}
```

生成される MessageCreate イベントには、以下のメタデータが含まれます。

```
{
    "referenced_tweets": [
        {
            "id": "1580559079470145536"
        }
    ]
}
```

<div id="authentication">
  ### 認証
</div>

すべての X API v2 エンドポイントでは、キーとトークンとも呼ばれる一連の認証情報を使ってリクエストを認証する必要があります。すべてのダイレクトメッセージは非公開であり、それらにアクセスするにはユーザーによる認可が必要です。 

これらのダイレクトメッセージエンドポイントでは、[OAuth 2.0 Authorization Flow with PKCE](/ja/x-api/posts/manage-tweets) または [1.0a User Context](/ja/resources/fundamentals/authentication) の利用が必要です。これは、リクエストを正常に行うために、一連の API キーとユーザーのアクセストークンを使用しなければならないことを意味します。アクセストークンは、あなたが代理してリクエストを送るユーザーに関連付けられている必要があります。別のユーザー用のアクセストークンを生成したい場合は、そのユーザーが [3-legged OAuth フロー](/ja/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) を使ってあなたのアプリを認可または認証する必要があります。

OAuth のユーザーコンテキストは扱いが難しいことがあります。この認証方法に慣れていない場合は、[ライブラリ](/ja/x-api/tools-and-libraries/overview) や Postman のようなツールを使って、リクエストの認証を正しく行うことをおすすめします。 

[OAuth 2.0 Authorization Code with PKCE](resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2) は、アプリケーションのスコープや複数デバイスにまたがる認可フローをより高度に制御できるようにします。OAuth 2.0 では、ユーザーに代わって特定の権限を付与する、きめ細かいスコープを選択できます。ダイレクトメッセージのルックアップエンドポイントでは、次のスコープが必要です:  `dm.write`, `dm.read`, `tweet.read`, `user.read`。

アプリで OAuth 2.0 を有効化するには、Developer Portal の App 設定セクションにあるアプリの認証設定で有効にする必要があります。

<div id="developer-portal-projects-and-developer-apps">
  ### Developer portal、プロジェクト、および開発者アプリ
</div>

X API v2 のエンドポイントで使用できる認証情報一式を取得するには、承認済みの開発者アカウントを取得し、そのアカウント内でプロジェクトを作成し、そのプロジェクト内に開発者アプリを作成する必要があります。その後、開発者アプリ内でキーとトークンを確認できます。 

<div id="rate-limits">
  ### レート制限
</div>

毎日何万人もの開発者が X API へリクエストを送信しています。これら膨大なリクエストを管理するため、各エンドポイントにはレート制限が設定されており、アプリや認証済みユーザーに代わって送信できるリクエスト数には上限があります。 

Manage Direct Message エンドポイントには、ユーザー単位と X アプリ単位の両方でレート制限が適用されます。これは、あなたがリクエストを送信する対象の認証済みユーザーが、あなたの X アプリを使って送信できるメッセージ数に上限があることを意味します。さらに、あなたの X アプリから 1 日に送信できるダイレクトメッセージの総数にも上限があります。 

POST メソッドには、ユーザー単位で 15 分あたり 200 リクエスト／メッセージというレート制限があります。ユーザーは 24 時間あたり 1000 件のダイレクトメッセージにも制限されています。さらに、X アプリには 24 時間あたり 15000 件のメッセージという上限があります。これらのレート制限は POST エンドポイント間で共有されます。 

**便利なツール**

Direct Messages lookup エンドポイントを利用する際に、ぜひ活用してほしい便利なツールをいくつか紹介します。 

****Postman****

Postman はエンドポイントのテストに使用できる優れたツールです。各 Postman リクエストには、利用可能な内容をすばやく理解できるよう、すべてのパスパラメータとボディパラメータが含まれています。Postman コレクションの詳細については、[Using Postman](/ja/tutorials/postman-getting-started) ページをご覧ください。 

****サンプルコード****

v2 Direct Messages エンドポイント向けの Python サンプルコードは、[X API v2 sample code GitHub](https://github.com/xdevplatform/Twitter-API-v2-sample-code)[](https://github.com/xdevplatform/Twitter-API-v2-sample-code) リポジトリで提供しています。&quot;Manage-Direct-Messages&quot; フォルダには POST メソッドの例が、&quot;Direct-Messages-lookup&quot; フォルダには GET メソッドの例が含まれています。

**XDev Software Development Kits (SDKs)**

これらの[ライブラリ](/ja/x-api/tools-and-libraries/overview)は v2 Direct Messages エンドポイントに対応するよう更新中で、近日中に利用可能になる予定です。

* [X API Java SDK](https://github.com/xdevplatform/twitter-api-java-sdk) - X API v2 用の公式 Java SDK
* [X API TypeScript/JavaScript SDK](https://github.com/xdevplatform/twitter-api-typescript-sdk) - X API v2 用の公式 TS/JS SDK

**サードパーティライブラリ**

コミュニティによって開発された[サードパーティライブラリ](/ja/x-api/tools-and-libraries/overview#community-tools-and-libraries-for-v2)が増えています。これらのライブラリは、スムーズに使い始められるように設計されており、そのうちいくつかは v2 Direct Messages エンドポイントのサポートが見込まれています。対応するバージョンタグを確認することで、v2 エンドポイントと連携できるライブラリを見つけることができます。