---
title: クイックスタート
sidebarTitle: クイックスタート
keywords: ["ダイレクトメッセージクイックスタート", "DMクイックスタート", "DMルックアップクイックスタート", "ダイレクトメッセージチュートリアル", "DMチュートリアル"]
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## ダイレクトメッセージ管理エンドポイントの利用を開始する
</div>

このクイックスタートガイドでは、HTTP リクエストの作成および送信ツールである Postman を使って、ダイレクトメッセージエンドポイントへの最初のリクエストを行う方法を説明します。Postman コレクションの詳細については、[Postman の利用](/ja/tutorials/postman-getting-started) ガイドを参照してください。

Python ベースの例を確認したい場合は、[X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub リポジトリをご覧ください。加えて、公式の [X Developer Platform software development kits (SDKs)](/ja/x-api/tools-and-libraries/sdks) は、これらのダイレクトメッセージエンドポイントをサポートするように順次更新されます。  

<Note>
  **前提条件**

  このガイドを完了するには、リクエストを認証するための一連の [キーとトークン](/ja/resources/fundamentals/authentication) が必要です。これらのキーとトークンは、次の手順に従うことで生成できます。

  * [開発者アカウントに登録](https://developer.x.com/en/apply-for-access) し、承認を受けてください。
  * developer.x.com で [プロジェクト](/ja/resources/fundamentals/projects) を作成し、関連付けられた [開発者アプリ](/ja/resources/fundamentals/developer-apps) を作成します。
  * 開発者ポータルでアプリの「Keys and tokens」ページに移動し、必要な認証情報を生成します。すべての認証情報は安全な場所に保存してください。
</Note>

<div id="steps-to-building-direct-message-lookup-requests">
  ### ダイレクトメッセージルックアップリクエストを作成する手順
</div>

この例では、1回のリクエストで新しいグループ会話を作成し、最初のメッセージを追加します。その後、作成した会話に2つ目のメッセージを追加します。

<div id="step-one-start-with-a-tool-or-library">
  #### ステップ 1: ツールまたはライブラリを用意する
</div>

Manage Direct Message エンドポイントの利用を始めるにあたり、手順を簡略化するために Postman ツールを使用します。XDevelopers が作成した X API v2 リクエストのサンプルコレクションを使って、新しい Direct Message を作成し、Direct Message 会話イベントを一覧表示するために使用される 6 つのエンドポイントを確認していきます。

コレクションの大部分はあらかじめ入力されていますが、これらの API リクエストをホストするために作成した X アプリに基づいて、設定する必要がある項目がいくつかあります。まずはコレクションを読み込み／更新しましょう。

X API v2 Postman コレクションを環境に読み込むには、次のボタンをクリックしてください。

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  X API v2 を Postman に追加
</Button>

Postman で X API v2 コレクションの読み込みが完了したら、「Manage Direct Messages」フォルダーに移動します。このフォルダーの Authorization タブは、可能な範囲で事前入力されています。X アプリの認証情報を利用できるようにするため、いくつかの設定を更新する必要があります。

このフォルダーには、新しい Direct Message を作成するための 3 つのエンドポイントも含まれています。さらに、Direct Message 会話イベント（メッセージの送受信や会話参加者の参加・退出など）を取得するために利用できる 3 つのエンドポイントを含む「Direct Message lookup」フォルダーもある点に注意してください。

グループ会話の作成は X API v2 の新機能であるため、この例ではそこに焦点を当てます。「New group DM and conversation」のサンプルを使用します。このリクエストを使用して、Direct Message のグループ会話を作成します。

次のステップでは、このエンドポイントで認証を行います。

<div id="step-two-authenticate-your-request">
  #### ステップ2: リクエストを認証する
</div>

X API に正しくリクエストを送るには、その操作を行う権限があることを検証する必要があります。このエンドポイントへのリクエストを正常に行うために、ここでは [OAuth 2.0 Authorization Code Flow with PKCE](resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2) を使用します。Postman 内でアクセストークンを生成できます。 

Postman では、フォルダー単位またはリクエスト単位で認証方法を設定できます。ここではフォルダー単位で認証情報を設定します。「Mange Direct Messages」フォルダーに移動し、「Authorization」タブを選択して、Type が「OAuth 2.0」、「Add auth data to」が「Request Headers」に設定されていることを確認します。「Current Token」セクションでは、「header Prefix」が Bearer に設定されていることを確認してください。  

新しいトークンを設定・生成するには:

1. 「DM lookup」などのトークン名を作成します。

2. **Grant Type** が Authorization Code (with PKCE) に設定されていることを確認します。

3. **Callback URL** を設定します。[v2 Dev Portal](https://developer.x.com/en/portal/dashboard) であなたのアプリケーションに関連付けられている Callback URL とまったく同じ値になるように Callback URL を更新する必要があります。この例で使用している X アプリでは、Callback URL は [https://www.example.com.](https://www.example.com/) に設定されています（完全一致している必要があるため、[https://example.com](https://example.com) では動作しない点に注意してください）。 

4. **Auth URL** が [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize) に設定されていることを確認します。

5. **Access Token URL** が [https://api.x.com/2/oauth2/token.](https://api.x.com/2/oauth2/token) に設定されていることを確認します。\
   **Client ID** - Developer Portal から OAuth 2.0 client ID をコピー＆ペーストします。\
   **Client Secret** - 機密クライアントの App タイプを使用している場合にのみ必要です。その場合は、Developer Portal から OAuth 2.0 Client Secret をコピー＆ペーストします。 

6. **Scope** が dm.read dm.write tweet.read users.read に設定されていることを確認します。

7. **State** が “state” に設定されていることを確認します。

8. **Client Authentication** が Send as Basic Auth header に設定されていることを確認します。

9. 「Get New Access Token」と表示されている箇所をクリックし、「Sign-in with X」プロセスの一部として「Authorize app」をクリックします。

10. 「Proceed」ボタンをクリックし、その後「Use Token」をクリックしてトークンを生成します。 

11. 「Save」ボタンをクリックして、これらの設定内容を保存します。

X にログインしていないというメッセージが表示される場合があります。このエラーが表示された場合は、Postman 内で、代理でポストを送信しようとしている X アカウントにログインする必要があります。

これで OAuth 2.0 の詳細がフォルダー単位で設定されたので、各サンプルの「Authorization」タブに移動し、Type が「Inherit auth from parent.」に設定されていることを確認してください。 

このトークンはまもなく有効期限が切れるため、「Get New Access Token」ボタンをクリックして再生成する必要がある点に注意してください。これをクリックすると「Sign-in with X」プロセスがトリガーされ、新しいトークンが生成されてリクエストを送れるようになります。

<div id="step-three-retrieve-direct-messages-conversation-events">
  #### 手順3: ダイレクトメッセージ会話イベントを取得する
</div>

このエンドポイントでダイレクトメッセージの会話イベントを取得するには、会話 ID を指定する必要があります。会話 ID はエンドポイントパスの一部です: [https://api.x.com/2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events](https://api.x.com/2/dm\\_conversations/:dm\\_conversation\\_id/dm\\_events)

Postman では、「Params」タブに移動し、取得したい会話の ID を「Path Variables」セクションに入力します。

設定は次のようになります:

|                      |                       |
| :------------------- | :-------------------- |
| **Key**              | **Value**             |
| `dm_conversation_id` | `1228393702244134912` |

この会話を指定すると、最終的なパスは [https://api.x.com/2/dm&#95;conversations/1582103724607971328/dm&#95;events](https://api.x.com/2/dm\\_conversations/1582103724607971328/dm\\_events) になります。

「Send」ボタンをクリックすると、レスポンスには Direct Message オブジェクトのデフォルトフィールドである id、text、event&#95;type が含まれます。また、結果数と、利用可能な場合にさらにイベントを取得するために使用されるページネーショントークンを持つ `meta` オブジェクトも含まれます。

```
{
   "data": [
       {
           "event_type": "MessageCreate",
           "id": "1580705921830768647",
           "text": "hello to you two, this is a new group conversation."
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```

追加のフィールドを取得したい場合は、リクエスト内でそれらのフィールドを [field](/ja/x-api/fundamentals/fields) パラメータおよび/または [expansion](/ja/x-api/fundamentals/expansions) パラメータとして指定する必要があります。

この演習では、dm&#95;event オブジェクトの追加のフィールドセットをリクエストします。

1. デフォルトの Direct Message オブジェクトのフィールドである id、text、event&#95;type。

2. 追加で取得する Direct Message オブジェクトのフィールド: dm&#95;conversation&#95;id、created&#95;at、sender&#95;id、attachments、participant&#95;ids、referenced&#95;tweets

Postman で「Params」タブに移動し、「Query Params」テーブルに次の key:value ペアを追加します。

|                     |                                                                                                               |
| :------------------ | :------------------------------------------------------------------------------------------------------------ |
| Key                 | Value                                                                                                         |
| dm&#95;event.fields | dm&#95;conversation&#95;id,created&#95;at,sender&#95;id,attachments,participant&#95;ids,referenced&#95;tweets |

これで、「Send」ボタンの横に次の URL が表示されているはずです。

[https://api.x.com/2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events?dm&#95;event.fields=id,text,event&#95;type,dm&#95;conversation&#95;id,created&#95;at,sender&#95;id,attachments,participant&#95;ids,referenced&#95;tweets](https://api.x.com/2/dm\\_conversations/:dm\\_conversation\\_id/dm\\_events?dm\\_event.fields=id,text,event\\_type,dm\\_conversation\\_id,created\\_at,sender\\_id,attachments,participant\\_ids,referenced\\_tweets)

<div id="step-four-make-your-request-and-review-your-response">
  #### ステップ4: リクエストを送信してレスポンスを確認する
</div>

すべての設定が完了したら、再度「Send」ボタンをクリックすると、以下の例と同様のレスポンスが返ってきます。このレスポンスには、利用可能なすべての `dm_event` フィールドが含まれている点に注意してください。

```
{
   "data": [
       {
           "text": "hello to you two, this is a new group conversation.",
           "id": "1580705921830768647",
           "dm_conversation_id": "1580705921830768643",
           "event_type": "MessageCreate",
           "sender_id": "17200003",
           "created_at": "2022-10-13T23:43:54.000Z"
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```
