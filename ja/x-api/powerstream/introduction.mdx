---
title: はじめに
sidebarTitle: はじめに
keywords: ["powerstream", "powerstream API", "real-time streaming", "streaming rules", "filtered stream", "enterprise streaming", "GNIP powerstream"]
---

Powerstream は、公開されている X のデータにアクセスするための、最速のリアルタイム・ストリーミング API です。従来の GNIP Powetrack API と同様に、キーワード、オペレーター、メタデータに基づいてポストをフィルタリングするためのルールを使用します。Powerstream エンドポイントへの永続的な HTTP 接続が確立されると、条件に一致したポストをほぼリアルタイムで受信し始めることができます。

現在、Powerstream では最大 1,000 個のルールがサポートされており、各ルールは 2048 文字まで指定できます。

<div id="key-features">
  ## 主な機能:
</div>

* **リアルタイムなデータ配信**: ルールにマッチするデータをほぼリアルタイムで取得できます。
* **高精度なフィルタリング**: 演算子を用いたブールクエリで、必要なデータだけを正確にフィルタリングできます。
* **配信方式**: HTTP/1.1 のチャンク転送エンコーディングによる JSON レスポンス。
* **ローカルデータセンター対応**: レプリケーションの遅延を回避してレイテンシーを低減するため、ローカルデータセンターのみからポストを取得します。

<Note>
  Powerstream API は、一部の Enterprise プランで利用可能なプレミアムなサービスです。

  Powerstream へのアクセスや Enterprise 向けサービスの詳細にご関心がある場合は、[Enterprise Request Form](/ja/forms/enterprise-api-interest) を送信して営業チームまでお問い合わせください。
  Powerstream がどのようにお客様のニーズを支援できるか、ご相談させていただきます。
</Note>

<div id="authentication">
  ## 認証
</div>

Powerstream API のエンドポイントでは OAuth 2.0 Bearer Token を使用します。`Authorization: Bearer &lt;token&gt;` ヘッダーに含めると、これらのエンドポイントをすぐに利用できます。

<div id="quick-start">
  ## クイックスタート
</div>

このセクションでは、Python と `requests` ライブラリを使用して PowerStream エンドポイントを手早く使い始める方法を紹介します。`pip install requests` でインストールしてください。すべての例は OAuth 2.0 Bearer Token 認証を使用します。`YOUR_BEARER_TOKEN` を実際のトークンに置き換えてください（`os.getenv('BEARER_TOKEN')` などを使って安全に保存してください）。

各エンドポイントについてコードスニペット付きで説明します。ファイルの先頭では、次の import 文が記述されているものとします。

```python
import requests
import json
import time
import sys
import os  # 環境変数用
```

<div id="setup">
  ### セットアップ
</div>

```python
bearer_token = os.getenv('BEARER_TOKEN') or "YOUR_BEARER_TOKEN"  # セキュリティのため環境変数を使用
base_url = "https://api.x.com/2/powerstream"
rules_url = f"{base_url}/rules"  # ルール管理用
headers = {
   "Authorization": f"Bearer {bearer_token}",
   "Content-Type": "application/json"
}
```

<div id="1-create-rules-post-rules">
  ### 1. ルールの作成 (POST /rules)
</div>

ストリームをフィルタリングするルールを追加します。

```python
data = {
   "rules": [
       {
           "value": "(cat OR dog) lang:en -is:retweet",
           "tag": "pet-monitor"
       },
       # 必要に応じてルールを追加してください(最大100件)
   ]
}

response = requests.post(rules_url, headers=headers, json=data)
if response.status_code == 201:
   rules_added = response.json().get("data", {}).get("rules", [])
   print("ルールが追加されました:")
   for rule in rules_added:
       print(f"ID: {rule['id']}, Value: {rule['value']}, Tag: {rule.get('tag', 'N/A')}")
else:
   print(f"エラー {response.status_code}: {response.text}")
```

<div id="2-delete-rules-post-rules">
  ### 2. ルールを削除する (POST /rules)
</div>

id（推奨）または value を指定してルールを削除します。

```python
data = {
   "rules": [
       {
           "value": "(cat OR dog) lang:en -is:retweet",
           "tag": "pet-monitor"
       },
       # 必要に応じてルールを追加（最大100件まで）
   ]
}

response = requests.delete(rules_url, headers=headers, json=data)
if response.status_code == 200:
   deleted = response.json().get("data", {})
   print(f"Deleted count: {deleted.get('deleted', 'N/A')}")
   if 'not_deleted' in deleted:
       print("Not deleted:", deleted['not_deleted'])
else:
   print(f"Error {response.status_code}: {response.text}")
```

**ヒント**: すべてのルールを削除するには、まず GET リクエストで取得し、`id` を抽出してから一括削除します。

<div id="3-get-rules-get-rules">
  ### 3. ルールの取得 (GET /rules)
</div>

すべてのアクティブなルールを取得します。

```python
response = requests.get(rules_url, headers=headers)
if response.status_code == 200:
   rules = response.json().get("data", {}).get("rules", [])
   if rules:
       print("Active rules:")
       for rule in rules:
           print(f"ID: {rule['id']}, Value: {rule['value']}, Tag: {rule.get('tag', 'N/A')}")
   else:
       print("No active rules.")
else:
   print(f"Error {response.status_code}: {response.text}")
```

<div id="4-powerstream-get-stream">
  ### 4. PowerStream (GET /stream)
</div>

リアルタイムにポストを取得するためにストリームに接続します。行単位で読み取るには `stream=True` を使用します。堅牢性のために再接続処理を実装してください。

```python
stream_url = base_url

def main():
   while True:
       response = requests.request("GET", stream_url, headers=headers, stream=True)
       print(response.status_code)
       for response_line in response.iter_lines():
           if response_line:
               json_response = json.loads(response_line)
               print(json.dumps(json_response, indent=4, sort_keys=True))
               if response.status_code != 200:
                   print(response.headers)
                   raise Exception(
                       "Request returned an error: {} {}".format(
                           response.status_code, response.text
                       )
                   )
```

<div id="local-datacenter-support">
  #### ローカルデータセンターサポート
</div>

レイテンシーを最適化するために、Powerstream では、接続が確立されているローカルデータセンターで生成または作成されたポストのみを取得するオプションを提供しています。これにより、レプリケーション遅延を回避でき、他のデータセンターからのポストと比べて、より高速な配信が可能になります。これを有効にするには、クエリパラメータ `?localDcOnly=true` をストリームのエンドポイント（例: `/2/powerstream?localDcOnly=true`）に追加します。接続しているデータセンターは、ストリームの初期データペイロード内とレスポンスの HTTP ヘッダーの両方で確認できます。

コードで使用するには:

```python
# ローカルデータセンターのみの場合:
stream_url = "https://api.x.com/2/powerstream?localDcOnly=true"
```

`localDcOnly` パラメータが有効な場合、ストリームが最初に接続されるときに、どのローカルデータセンターが使用されているかを示す次のレスポンスヘッダーが返されます。

```bash
'x-powerstream-datacenter': 'atla',
'x-powerstream-localdconly': 'true'
```

さらに、データセンターを指定した初期ペイロードも送信されます。

```bash
{
    "type": "connection_metadata",
    "datacenter": "atla",
    "timestamp": 1762557264155
}
```

<Note>
  **ヒント:** レイテンシを最適化するには、複数の地理的ロケーション（例: 米国東海岸のアトランタ付近と米国西海岸のポートランド付近）からそれぞれ接続を確立し、各接続で `localDcOnly=true` を有効にします。これにより、それぞれのデータセンターからのポストに高速にアクセスできます。取得したストリームはクライアント側で集約し、データセンター間のデータを統合してください。
</Note>

<div id="operators">
  ## 演算子
</div>

フィルタリングのルールを設定するには、キーワードと演算子を使用できます。利用可能な演算子の一覧を以下でご覧ください。

<div id="field-based-operators">
  ### フィールドベースの演算子
</div>

<div id="user-operators">
  #### ユーザー演算子
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `from:` | 特定ユーザーからのポストに一致する | `from:xdevelopers` or `from:123456` |
| `to:` | 特定ユーザー宛てのポストに一致する | `to:jvaleski` |
| `retweets_of:` | 特定ユーザーのポストのリポストに一致する | `retweets_of:xdevelopers` |

<div id="content-operators">
  #### コンテンツ演算子
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `contains:` | 特定のテキスト／キーワードを含むポストに一致 | `contains:hello` または `contains:-2345.432` |
| `url_contains:` | URL 内に特定のテキストを含むポストに一致 | `url_contains:"com/willplayforfood"` |
| `lang:` | 特定の言語のポストに一致 | `lang:en` |

<div id="entity-operators">
  #### エンティティ演算子
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `has:` | 特定のエンティティを含むポストに一致します（オプション: mentions（メンション）, geo, links（リンク）, media（メディア）, lang（言語）, symbols, images, videos） | `has:images`, `has:geo`, `has:mentions` |
| `is:` | 特定の種類または特定のプロパティを持つポストに一致します（オプション: retweet, reply） | `is:retweet`, `is:reply` |

<div id="location-operators">
  #### ロケーション演算子
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `place:` | 特定の場所からのポストにマッチします | `place:"Belmont Central"`, `place:02763fa2a7611cf3` |
| `bounding_box:` | 地理的なバウンディングボックス内のポストにマッチします | `bounding_box:[-112.424083 42.355283 -112.409111 42.792311]` |
| `point_radius:` | 特定の地点を中心とした半径内のポストにマッチします | `point_radius:[-111.464973 46.371179 25mi]`, `point_radius:[-111.464973 46.371179 15km]` |

<div id="advancedcontent-operators">
  #### 高度な／コンテンツ演算子
</div>

| Operator | Summary | Example |
|----------|---------|---------|
| `bio:` | 特定の自己紹介文を含むユーザーのポストにマッチします（フレーズ一致を使用） | N/A |
| `bio_name:` | 自己紹介文内に特定の名前を含むユーザーのポストにマッチします（フレーズ一致を使用） | N/A |

<div id="additional-operators">
  #### 追加の演算子
</div>

| Operator | 概要 | 例 |
|----------|---------|---------|
| `retweets_of_status_id:` | 特定のポストのリポストと一致します | `retweets_of_status_id:1234567890123456789` |
| `in_reply_to_status_id:` | 特定のポストへの返信と一致します | `in_reply_to_status_id:1234567890123456789` |

<div id="non-field-operators">
  ### フィールドに依存しないオペレーター
</div>

<div id="special-syntax-operators">
  #### 特殊構文演算子
</div>

| 演算子 | 概要 | 例 |
|----------|---------|---------|
| `@` | メンション演算子 | `@username` |
| フレーズ一致 | フレーズの完全一致を指定 | `"exact phrase"` |

<div id="logical-operators">
  #### 論理演算子
</div>

| 演算子 | 概要 | 例 |
|----------|---------|---------|
| `OR` | 複数の式の間の論理 OR | `x OR facebook` |
| スペース/AND | 複数の式の間の論理 AND | `x facebook`（両方の語が含まれていること） |
| `()` | 複雑な式のグルーピング | `(x OR facebook) iphone` |
| `-` | 否定/除外 | `x -facebook`（facebook を含まない x） |

<div id="responses">
  ## レスポンス
</div>

Powestream API のペイロードは、レガシー GNIP Powertrack API と同じ形式です。JSON レスポンスのサンプルは次のとおりです。

```json
[
   {
       "created_at": "Tue Mar 21 20:50:14 +0000 2006",
       "id": 20,
       "id_str": "20",
       "text": "twttrを設定中",
       "truncated": false,
       "entities": {
           "hashtags": [],
           "symbols": [],
           "user_mentions": [],
           "urls": []
       },
       "source": "<a href=\"http://x.com\" rel=\"nofollow\">X Web Client</a>",
       "in_reply_to_status_id": null,
       "in_reply_to_status_id_str": null,
       "in_reply_to_user_id": null,
       "in_reply_to_user_id_str": null,
       "in_reply_to_screen_name": null,
       "user": {
           "id": 12,
           "id_str": "12",
           "name": "jack",
           "screen_name": "jack",
           "location": "",
           "description": "no state is the best state",
           "url": "https://t.co/ZEpOg6rn5L",
           "entities": {
               "url": {
                   "urls": [
                       {
                           "url": "https://t.co/ZEpOg6rn5L",
                           "expanded_url": "http://primal.net/jack",
                           "display_url": "primal.net/jack",
                           "indices": [
                               0,
                               23
                           ]
                       }
                   ]
               },
               "description": {
                   "urls": []
               }
           },
           "protected": false,
           "followers_count": 6427829,
           "friends_count": 3,
           "listed_count": 32968,
           "created_at": "Tue Mar 21 20:50:14 +0000 2006",
           "favourites_count": 36306,
           "utc_offset": null,
           "time_zone": null,
           "geo_enabled": true,
           "verified": false,
           "statuses_count": 30134,
           "lang": null,
           "contributors_enabled": false,
           "is_translator": false,
           "is_translation_enabled": false,
           "profile_background_color": "EBEBEB",
           "profile_background_image_url": "http://abs.twimg.com/images/themes/theme7/bg.gif",
           "profile_background_image_url_https": "https://abs.twimg.com/images/themes/theme7/bg.gif",
           "profile_background_tile": false,
           "profile_image_url": "http://pbs.twimg.com/profile_images/1661201415899951105/azNjKOSH_normal.jpg",
           "profile_image_url_https": "https://pbs.twimg.com/profile_images/1661201415899951105/azNjKOSH_normal.jpg",
           "profile_banner_url": "https://pbs.twimg.com/profile_banners/12/1742427520",
           "profile_link_color": "990000",
           "profile_sidebar_border_color": "DFDFDF",
           "profile_sidebar_fill_color": "F3F3F3",
           "profile_text_color": "333333",
           "profile_use_background_image": true,
           "has_extended_profile": true,
           "default_profile": false,
           "default_profile_image": false,
           "following": null,
           "follow_request_sent": null,
           "notifications": null,
           "translator_type": "regular",
           "withheld_in_countries": []
       },
       "geo": null,
       "coordinates": null,
       "place": null,
       "contributors": null,
       "is_quote_status": false,
       "retweet_count": 122086,
       "favorite_count": 263321,
       "favorited": false,
       "retweeted": false,
       "lang": "en"
   }
]
```

<div id="limits-best-practices">
  ## 制限とベストプラクティス
</div>

* レート制限: ルール管理は 50 リクエスト/24時間、ストリームには制限なし（ただし接続数の制限あり）。
* 再接続: 切断された場合は指数バックオフを用いて再接続します。
* 監視: `Connection: keep-alive` ヘッダーを使用します。