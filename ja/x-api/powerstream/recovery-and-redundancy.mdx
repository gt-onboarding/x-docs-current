---
title: リカバリと冗長性
sidebarTitle: リカバリと冗長性
keywords: ["powerstream recovery", "powerstream redundancy", "recovery features", "redundancy features", "fault tolerance", "error recovery"]
---

ストリーミングデータを利用する際には、接続時間を最大化し、マッチしたすべてのデータを受信することが基本的な目標です。つまり、冗長接続を活用し、切断を自動的に検知してすばやく再接続し、失われたデータを復旧するための計画を用意しておくことが重要です。

このインテグレーションガイドでは、冗長接続、バックフィル、リカバリといった、さまざまな復旧および冗長性のための機能について説明します。
 

<div id="redundant-connections">
  ## 冗長接続
</div>

冗長接続を利用すると、ストリームに対して同時に複数の接続を確立できます。これにより、2 つの別個のコンシューマーから同じストリームに接続し、両方の接続を通じて同じデータを受信することで冗長性が確保されます。その結果、1 つのストリームが切断された場合やアプリケーションのプライマリサーバーが障害を起こした場合など、さまざまな状況に対してアプリでホット フェイルオーバーを行えるようになります。

冗長接続を使用するには、プライマリ接続で使用しているものと同じ URL に接続するだけです。ストリームのデータは両方の接続を通じて送信されます。

<div id="backfill">
  ## バックフィル
</div>

切断を検知したら、システムはストリームに自動的に再接続できるようにしておく必要があります。可能であれば、適切なリカバリ機能を使ってデータをバックフィルできるよう、切断がどのくらいの時間続いたかを記録しておく必要があります。 

切断時間が 5 分以下であると判断できた場合は、バックフィル用パラメータ `backfillMinutes` を使用できます。このパラメータを `GET /powerstream` リクエストに指定すると、直近 1〜5 分以内にあなたが設定しているルールにマッチしたポストを受信します。通常、これらの古いポストは新たにマッチしたポストよりも先に配信され、またポストの重複排除は行いません。つまり、もし 90 秒間切断されていたにもかかわらず、2 分分のバックフィルデータをリクエストした場合、30 秒分の重複したポストを受け取ることになり、システム側でそれを許容できるようにしておく必要があります。以下は、バックフィルパラメータを指定したリクエストの例です。

`curl 'https://api.x.com/2/powerstream?backfillMinutes=5' -H "Authorization: Bearer $ACCESS_TOKEN"`

切断時間が 5 分を超えていたと判断できた場合は、[recent search エンドポイント](/ja/x-api/posts/search/introduction) またはリカバリ機能を利用して、欠落したデータをリクエストできます。 

<div id="recovery">
  ## Recovery
</div>

5 分間のバックフィル猶予時間内に再接続できなかった場合、Recovery 機能を使用して直近 24 時間以内に取り逃したデータを復旧できます。

ストリーミングの Recovery 機能を使用すると、バックフィルの猶予時間を 24 時間まで拡張できます。Recovery によって、取り逃したデータが発生した期間を「リプレイ」できます。`startTime` と `endTime` リクエストパラメータを使用して接続リクエストを行うと、Recovery ストリームが開始されます。接続されると、Recovery は指定された時間範囲を再ストリーミングし、その後切断されます。  

|     |     |     |
| :--- | :--- | :--- |
| **Name** | **Type** | **Description** |
| `startTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339)。<br /><br />復旧を開始する時刻を示す UTC の日時。 |
| `endTime` | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ (ISO 8601/RFC 3339)。<br /><br />復旧を終了する時刻を示す UTC の日時。 |

リクエスト URL の例: `https://api.x.com/2/powerstream?startTime=2022-07-12T15:10:00Z&endTime=2022-07-12T15:20:00Z`