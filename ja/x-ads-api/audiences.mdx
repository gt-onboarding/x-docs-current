---
title: オーディエンス
keywords: ["カスタムオーディエンス", "テイラードオーディエンス", "オーディエンスターゲティング", "オーディエンス管理", "広告ターゲティング", "Audience API"]
---

import { Button } from '/snippets/ja/button.mdx';

## カスタムオーディエンス

### 概要

パートナーが[カスタムオーディエンス](https://business.x.com/en/targeting/tailored-audiences.html)を作成する方法はいくつかあります。

* [Audience API (CRM)](#crm)
* [Web](#web)
* [Mobile](#mobile)
* [Flexible](#flexible)

なお、ターゲティングから類似カスタムオーディエンスを除外することはできません。加えて、同じ広告ラインアイテム（広告グループ）で、カスタムオーディエンスとその類似オーディエンスを同時にターゲティングすることもできません。

**オーディエンス管理**

オーディエンスは、オーディエンスパートナーおよび Ads API パートナー経由で管理できます。カスタムオーディエンスにアクセスして管理するためのエンドポイント群を API で提供しています。

カスタムオーディエンス情報向けには、次の 2 つのエンドポイントを提供しています。

* [GET accounts/:account&#95;id/custom&#95;audiences](/ja/x-ads-api/audiences)
* [GET accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id](/ja/x-ads-api/audiences)

オーディエンスのアップロードおよび管理方法の詳細は、[Audience API ガイド](/ja/x-ads-api/audiences)を参照してください。

**処理時間**

一般的に、オーディエンスの変更は 6～8 時間ごとに実行されるバッチで処理されます。オーディエンスの変更を処理している間も、更新対象となる既存のオーディエンス自体には影響はありません。この時間枠内で、1 つのオーディエンスに対する追加更新は 1 回、削除更新も 1 回を超えて行わないことを推奨します。

**ターゲティング**

オーディエンスは、過去 90 日以内に X が所有・運営するクライアント上でアクティブだったユーザーが少なくとも 100 人に一致する場合にのみターゲティング可能です。[GET accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id](/ja/x-ads-api/audiences) は、一致するユーザーが少なすぎるためにオーディエンスをターゲティングできない場合、その旨を示します。

**Audience API (CRM)**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/crm_0.png" alt="画像2" />
</Frame>

オーディエンスパートナーまたは API パートナーがハッシュ化された識別子のリストを提供し、X が照合を行って、X 上でのメディア出稿に利用可能なセグメントを作成します。パートナーは [Audience API](/ja/x-ads-api/audiences) を使用してこれらのオーディエンスを作成できます。

**仕組み**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/crm_1.png" alt="画像3" />
</Frame>

**Web**

X 上でのメディア出稿向けにターゲティングするセグメントを特定するため、MPP オーディエンスパートナーと連携する際には標準的な cookie マッチングプロセスを提供しています。加えて、広告主は [X Web Event Tag](/ja/x-ads-api/measurement/web-conversions#web-event-tags) を設定してウェブサイトユーザーデータを収集し、それに対応するカスタムオーディエンスを作成できます。

**設定手順**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/screen_shot_2013-11-26-cookie-usage.png" alt="画像0" />
</Frame>

![]()

**仕組み**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/tailored_audience_web.png" alt="画像1" />
</Frame>

**Mobile**

詳細については、[Custom Audiences from Mobile Apps を紹介するブログ記事](https://blog.x.com/2014/introducing-tailored-audiences-from-mobile-apps)を参照してください。

**Flexible**

[Flexible audiences](/ja/x-ads-api/audiences) により、広告主は既存のカスタムオーディエンス、または既存のカスタムオーディエンスのサブセットに基づいてオーディエンスの組み合わせを構築・保存できます。カスタムオーディエンスのメンバーのサブセットは、インタラクションの直近性および頻度に基づいてターゲティングできます。

**Custom Audiences の使用制限**

[制限事項の詳細はこちらを参照してください](https://developer.x.com/en/developer-terms/more-on-restricted-use-cases "Read more about restrictions")

<div id="audiences-faq">
  ### Audiences FAQ[](#real-time-tailored-audiences "Permalink to this headline")
</div>

**Q: 大量のデータを送信したのに、オーディエンスサイズが TOO&#95;SMALL と表示されるのはなぜですか？**

A: 現在、データはリアルタイムでオーディエンスに追加されていますが、オーディエンスサイズを算出するジョブは一定時間ごとにしか実行されません。数時間ほど経過すると、正しいオーディエンスサイズが UI に表示されるはずです。

**Q: オーディエンスデータの送信を完了し、24 時間以上待ちましたが、それでもオーディエンスをターゲティングできません。次のステップとして何をすればよいですか？**

A: 以下の点を確認してください。

* 渡しているユーザー ID が正しく、不正な形式になっていないこと。
* 渡しているオーディエンス名が正しく、以前のメンバーシップ更新時のものと一致していること。
* POST コマンドからのレスポンスが想定どおりであること。
* ID Sync ピクセルが正しく実装されていること、および ID Sync プロセスで説明されているとおり、ユーザーをマッピングするのに十分な数のユーザーが該当サイトを訪問していることを確認してください。メンバーシップ更新内でマッピングされていないユーザーは、ターゲティング対象ユーザーには変換されません。

上記すべてが正しく動作していると確認できる場合は、できるだけ詳細な情報を添えて X のプロダクト担当者に連絡してください（望ましい情報の例については、[Guide to Partner Inbounds](/ja/x-ads-api/introduction) を参照してください）。

**Q: エンドポイントは何回呼び出すことができ、どのようなアルゴリズムを使うべきですか？**

A: 増分データ（差分）でシステムを呼び出し、完全なオーディエンスメンバーシップを再送しないことを強く推奨します。このシステムは、世界最大級のウェブサイトの増分データ更新を処理できるだけのスループットを備えるようテストされています。オーディエンスの初回アップロードは慎重にスロットリングする必要があり、完了までに相当な時間がかかることが想定されます。

**Q: ターゲティングに使用できるオーディエンスの最小サイズはどれくらいですか？**

* オーディエンスの最小サイズは 100 人のユーザーです（マッチ後）。500 人未満のユーザーしかマッチしなかったオーディエンスは、X Ads UI 上でターゲティングには利用できません。

**Q: オーディエンスファイルの処理にはどれくらい時間がかかりますか？また、X のユーザーインターフェース上でオーディエンスファイルが利用可能になるまでにはどれくらいかかりますか？**

* 通常、オーディエンスファイルの処理には 4〜6 時間かかりますが、ファイルサイズによって変動します。ファイルの処理が完了すると、そのオーディエンスは X Ads UI 上で利用できるようになります。

**Q: マッチ率はどのように計算されますか？**

* マッチ率 = 過去 90 日間のアクティブな X ユーザー数 / 提供されたユーザー数

**Q: オーディエンスファイルが正しく機能しているかどうかはどのようにテストできますか？**

* テスト用のオーディエンスファイルを用意し、「keltonlynn」を広告主ハンドル名として使用してください。その後、ファイルが正しく取り込まれ、X の UI にロードできているかを確認できます。

**Q: パートナーユーザー識別子（`p_user_id`）とは何ですか？**

* これは、御社が各顧客を一意に識別するために使用する識別子です。

**Q: 標準 ID とは何ですか？**

* これはメールアドレス、デバイス ID、X の @handle または ID を指します。

**Q: HMAC キーはどのように取得できますか？**

* HMAC キーは暗号化されたメールで提供されます。[mpp-inquiry@x.com](mailto:mpp-inquiry%x.com) 宛に公開 PGP 鍵をお送りください。すべてが正しく動作していることを確認するためのテストメールをお送りします。検証が完了したら、HMAC キーを送付します。

**Q: 提供された HMAC キーを使って、ハッシュ処理が正しく行われたことをどのように検証できますか？**

* X からテストファイル（サンプルのメールアドレス、デバイス ID などを含む）と、検証用のハッシュ結果ファイルを提供しますので、ご自身の結果と照合することができます。

**Q: フルデータマッチファイルにファイルサイズの制限はありますか？**

* いいえ、フルデータマッチファイルにサイズ制限はありません。

**Q: フルデータマッチファイルの処理にはどれくらい時間がかかりますか？**

* X がファイルを受信してから、処理が完了するまでおおよそ 1 日かかります。

<div id="crm">
  ### CRM
</div>

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/crm_0.png" alt="image0" />
</Frame>

このドキュメントでは、ファイル形式およびデータ交換プロセスを含む Custom Audiences CRM パートナー向けの連携の詳細について説明します。

**概要**

Company は、顧客に代わって、ハッシュ化された共通のユーザー識別子（例：メールアドレス）またはパートナーのユーザー ID のリストを X に提供し、ブラインドマッチを実行してターゲティング用の X ユーザー ID のリストを生成します。ターゲティング用セグメントは、ads.x.com のキャンペーン設定においてファイル名で指定された、広告主固有の @handle に対して利用可能になります。

Company から X へ送信されるすべてのファイルは、X が Company に付与した特定のアカウントを通じて、IronBox（www.golockbox.com）上のセキュアパッケージ経由で提供されます。X は IronBox へのアクセス権を付与します。IronBox API に関するドキュメントは [https://secure.goironcloud.com/Docs/Help/](https://secure.goironcloud.com/Docs/Help/) で参照できます。

<div id="partner-id-matching-requirements">
  #### パートナー ID マッチング要件
</div>

Company がユーザーを追跡するために独自の標準 ID システム（メールアドレス、デバイス id、X ユーザー ID などの一般的なユーザー識別子ではないもの）を使用している場合は、次のプロセスを推奨します。

**1. フルデータマッチ**

まず、Company は、X と共通の一意のユーザー識別子を含むすべてのユーザーレコードの包括的なリストを 1 つのファイルで提供し、フルデータマッチを実行して、パートナー ID（`p_user_id`）と X ID（`tw_id`）のマッピングを X 側で保存します。これは適切に最新状態を保つため、2～3 か月ごとに定期的に実施されます。マッチングが完了すると、X はこのファイルから得られたベースラインのマッチ率を電子メールで Company と共有します。

このファイルの形式は次のとおりです。

命名規則: FullDataMatch.[CompanyName].txt

ハッシュアルゴリズム: HMAC&#95;SHA-256

フォーマット:

Column 1: 共通識別子の HMAC ハッシュ値

Column 2: パートナーユーザー ID（ユーザーごとに一意、ファイル内では重複する可能性あり）

カラム区切り文字 (CSV): ハッシュ化された共通ユーザー識別子とパートナー ID を区切るためにカンマを使用します

行区切りの値

* 例: ユーザーレコード A のパートナーユーザー ID が 1 で、共通識別子が 1、2、3 の場合:

|     |     |
| :--- | :--- |
| common user identifier 1 | p&#95;user&#95;1 |
| common user identifier 2 | p&#95;user&#95;1 |
| common user identifier 3 | p&#95;user&#95;1 |

*共通ユーザー識別子については、以下の「ハッシュ化の手順」セクションを参照してください

**2. カスタムセグメントリスト**

Company は、`p_user_id` の形式でユーザーのリストを提供し、X 上でのターゲティング用に顧客向けカスタムオーディエンスを作成します。

* 行区切りの値
* `p_user_id`
* * （上記 1. フルデータマッチのセクションで提供されたものと同一です。フルデータマッチで提供された値がハッシュ化されている場合、Company はオーディエンスファイルでも同じハッシュ化された値を提供します。提供された値がハッシュ化されていない場合、Company はハッシュ化されていない値を提供します。）

<div id="standard-matching-requirements">
  #### 標準マッチング要件
</div>

企業が、すべての顧客ユーザー識別子のマッピングに標準の ID を使用していない場合は、以下のプロセスを推奨します。

**カスタムセグメントリスト**

企業は、顧客に代わって、ハッシュ済みの共通ユーザー識別子のリストを X に直接提供し、カスタムオーディエンスを作成します。

このファイルの形式は以下のとおりです。

* 1 行につき 1 つの値
* ハッシュ済みの共通ユーザー識別子（例: メールアドレス）
* 以下に示すファイル命名規則に従うこと
* 下記（Hashing Directions 内）のメールアドレスのハッシュ化手順に従うこと

<div id="custom-segment-list-file-naming-operations">
  #### カスタムセグメントリストのファイル命名規則とオペレーション
</div>

ファイルに対して実行される処理はファイル名によって決まり、利用可能なオペレーションおよび一般的なファイル命名規則は次のとおりです: audiencename&#95;partnername.handle.operation.filetype

* audiencename: Custom Audience の名前。このフィールドは、ads.x.com のキャンペーン設定 UI でオーディエンスを選択する際に表示される名前です（例: brand&#95;loyalty&#95;card&#95;holders）。
* partnername: 広告主に代わってデータを提供する企業の名前（例: company&#95;name）。
* handle: Custom Audiences にアクセスできる X アカウント (@handle)（例: @pepsi, @dietpepsi）
* operation: new, add, remove, removeall, replace（詳細は以下）
* : アップロードされる各オーディエンスファイルが一意になるようにするために使用される、秒単位の標準 Unix エポックタイム
* filetype: ファイルは *.txt 形式である必要があります

<div id="creating-and-updating-audiences">
  #### オーディエンスの作成と更新
</div>

単一ファイルで新しいオーディエンスを作成します（例: loyalty&#95;card&#95;holders&#95;partnername.pepsi.new.txt）。

Add - リスト内でマッチしたユーザーを既存のオーディエンスに追加します（例: loyalty&#95;card&#95;holders&#95;partnername.pepsi.add..txt）。

Remove - リスト内でマッチしたユーザーを既存のオーディエンスから削除します（例: loyalty&#95;card&#95;holders&#95;partnername.pepsi.remove..txt）。

Remove All - 定期的に更新される累積リストから生成されたマッチを、その Client に紐づくすべてのオーディエンスから削除します（つまり、Client のオプトアウトリスト）。例: partnername.pepsi.removeall.txt

* これは、Advertiser からオプトアウトしたユーザーの包括的なリストとして使用できます。
* X は、このファイルで提供された最新のリストのみを参照し、そのリストにマッチした既存および今後のすべてのオーディエンスに対して適用します。

このファイルが提供され処理された時点での X ユーザーが対象となります。

Replace - 既存のオーディエンスを削除し、新しいオーディエンスリストに置き換えます。例: loyalty&#95;card&#95;holders&#95;partnername.pepsi.replace..txt

Overall Company Opt-Out - Company は、自社のオプトアウトポリシーに従ってオプトアウトしたユーザーを削除するための累積オプトアウトファイルを提供します。

X は、この Company オプトアウトファイルで提供された最新のリストのみを参照し、そのリストにマッチした既存および今後のすべてのオーディエンスに対して適用します。Company オプトアウトファイルの形式は次のとおりです: 例: partnername.removeall.txt

Delete - 既存のオーディエンスを現在のオーディエンス一覧から削除します（例: loyalty&#95;card&#95;holders&#95;partnername.pepsi.delete.txt）。

<div id="hashing-directions">
  #### ハッシュ化手順
</div>

X は、共通のユーザー識別子（例: メールアドレス）をハッシュ化するために使用する、Base64 エンコードされた本番用キーを PGP を用いて安全に共有します。Company は、このキーを Base64 デコードして、ハッシュ化に使用する 32 バイトのキーを生成します。

Base64 エンコードされたキーの例:

BrQvOg+dACBUmKjRiNxZgJLh6zydjS0ZOv80FelTNzM=

Base64 デコードされたキーの例:

/:� TшY

正規化: Company は、ハッシュ化を行う前に、共通のユーザー識別子に対して基本的な正規化処理を実施します（ただし Device ID については対象外です。詳細は「Device ID Normalization」セクションを参照してください）。

<div id="e-mail-normalization">
  #### E-mail 正規化
</div>

具体的には、先頭と末尾の空白文字を取り除き、メールアドレスをすべて小文字にします。

例: Raw e-mail address（元のメールアドレス）: testemail&#95;Organisational&#95;baseball+884`@`It92I6Ev2B`.`Com

正規化後: testemail&#95;organisational&#95;baseball+884`@`it92i6ev2b`.`com

ハッシュ値: 74d9584eded0ad1e5572a1c1849f3716751d371d6117a6155dad5363f4b4fbec

注意: エンコードされた HMAC とキーのいずれについても、文字数は入力値やエンコード方式によって変化する可能性があるため、固定ではありません。

<div id="device-id-normalization">
  #### デバイスIDの正規化
</div>

デバイスIDについても、SHA-256 ハッシュアルゴリズムと、当社がデータパートナーに提供する共通ソルトを用いたハッシュ化に関して同一の要件を適用します。メールアドレスの場合と同様に空白文字は削除しますが、IDFA/Android ID に対して小文字への正規化は行わず、IDFA/Android ID は元の形式どおりの値を使用する必要があります。

以下は、ハッシュ化前の iOS および Android 向けデバイスIDの生の形式の例です。

iOS IDFA: DD99CFF7-6186-4602-9DF2-ED3FD0B2D431

Android ID: b5bf2122961b3595

ハッシュ化済み iOS IDFA: 134fb8cd95c7fd42e2793f469a447198ca5f990968db2dbadad70e723ed9750b

ハッシュ化済み Android ID: 130dddff1939f229476f50bc8adab8fcb7e3525b0e9604fe8effc15e68cee4a4

<div id="x-user-id-normalization">
  #### X User ID の正規化
</div>

X の ID は、データのグルーピング（例: @handle のカスタマーリスト）が PII ではないものの、広告主にとっては非公開であるため、引き続きハッシュ化されます。X の ID をハッシュ化する際には、SHA-256 ハッシュアルゴリズムと、当社がデータパートナーに提供する共通のソルトを使用するという、同じ要件が適用されます。X ID/`@`username の両方からはスペースを削除する必要がありますが、User ID については正規化は不要です。@username は正規化のために小文字に変換する必要があります。また、@ 記号は username の一部として含めないでください。

生の ID の形式は次のとおりです:

* User ID: 27674040
* @username: testusername

ハッシュ化された User ID: bf6b57d4e861e83bea8bbed2b800b251a64c95468ee6e8cb07c3368c9ed45e85

ハッシュ化された @username: 12201ae78ad1afa907c7112d17f498154ffb0bf9ea523f5390e072a06d7d9812

<div id="id-sync-integration">
  ### ID Sync Integration
</div>

`p_id` を使ってデータを送信するパートナーは、広告主またはパートナーのユーザー id と X ユーザー id のマッピングを生成するために、ID Sync プロセスを実行する必要があります。これにより、広告主は自社のユーザーセグメントを X 上で直接ターゲティングできるようになります。パートナーはメンバーシップ更新を送信する際、パラメータ `user_identifier_type` の値を `TALIST_PARTNER_USER_ID` または `TAWEB_PARTNER_USER_ID` のいずれかに設定しなければなりません。

* **Web Only**: 以下のとおり、広告主のサイトにピクセルを設置することで行えます。
* **リスト**: [CRM](/ja/x-ads-api/audiences#crm) ページで説明しているいずれかの方法を使用して行えます。

<div id="pixel-url">
  #### ピクセルURL
</div>

|     |
| :--- |
| **ベースURL** |
| [https://analytics.x.com/i/adsct](https://analytics.x.com/i/adsct) |

<div id="pixel-parameters">
  #### ピクセルパラメータ
</div>

|     |     |
| :--- | :--- |
| **Parameter** | **説明** |
| `p_id` | X によって割り当てられたパートナー ID |
| `p_user_id` | パートナーシステム内でのユーザー ID |

<div id="id-sync-pixel">
  #### ID Sync Pixel:
</div>

パートナー id を 111、`p_user_id` を abc とすると、生成されるピクセルは次のようになります。

```json
    <pre class="brush: xml">
    <img height="1" width="1" src="https://analytics.x.com/i/adsct?p_id=111&p_user_id=abc" style="display:none" />
    </pre>
```

**オプトアウトファイルの構成と送信**

パートナーは、パートナーが把握している範囲でターゲット広告配信のオプトアウトを選択したと認識しているユーザーのリストを X に提供する必要があります。ファイルは次の形式で送信してください。

|                   |                                     |                 |                                                                                                                                                                                                                                                                               |
| :---------------- | :---------------------------------- | :-------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Column Number** | **Column Name**                     | **Column Type** | **Description**                                                                                                                                                                                                                                                               |
| 1                 | Partner ID                          | string          | 「partner id」は、各パートナーを一意に識別するために X がパートナーに付与する ID です。                                                                                                                                                                                                                          |
| 2                 | The user’s id in the partner system | string          | `p_user_id` は、パートナーがユーザーを識別するために使用する一意の ID です。これらのオプトアウトユーザーを含むファイルは、[TON upload](/ja/x-ads-api/audiences) エンドポイントを使用してアップロードし、アップロードされたデータのパスをグローバルオプトアウトエンドポイント [PUT accounts/:account&#95;id/custom&#95;audiences/global&#95;opt&#95;out](/ja/x-ads-api/audiences) に送信する必要があります。 |

**メンバーシップ更新の送信**

エンドポイントドキュメントで指定しているとおり、[POST custom&#95;audience&#95;memberships](/ja/x-ads-api/audiences) エンドポイント経由でユーザーを送信する場合は、Cookie ベースのマッチングを可能にするために customer ID を渡す必要があります。`p_id` を含むデータを送信するパートナーは、`user_identifier_type` を `TALIST_PARTNER_USER_ID` または `TAWEB_PARTNER_USER_ID` に **必ず** 設定する必要があります。

その他の手順は、[Real-Time Audience API Integration Guide](/ja/x-ads-api/audiences) に記載されている内容と同じです。

<div id="custom-audiences-user-data">
  ### カスタムオーディエンスのユーザーデータ
</div>

このドキュメントでは、[Custom Audience]/x-ads-api/audiences 用のユーザーデータ形式について説明します。

**データ正規化**

**デバイス ID**:

* IDFA - 小文字かつダッシュ付きにすること。例: `4b61639e-47cc-4056-a16a-c8217e029462`
* AdID - デバイス上の元の形式が必要。大文字化せず、ダッシュ付きにすること。例: `2f5f5391-3e45-4d02-b645-4575a08f86e`
* Android ID - デバイス上の元の形式が必要。大文字化せず、ダッシュやスペースは入れないこと。例: `af3802a465767e36`

**メールアドレス**:

* 小文字にし、前後のスペースを削除すること。例: `support@x.com`

**X ユーザー名**:

* 先頭の @ を付けず、小文字にし、前後のスペースを削除すること。例: `jack`

**X ユーザー ID**:

* 標準的な整数。例: `143567`

**データのハッシュ化**

各行のデータは、ソルトなしで `SHA256` を使用してハッシュ化する必要があります。さらに、最終的なハッシュ出力は小文字でなければなりません。例: 49e0be2aeccfb51a8dee4c945c8a70a9ac500cf6f5cb08112575f74db9b1470d であり、**49E0BE2AECCFB51A8DEE4C945C8A70A9AC500CF6F5CB08112575F74DB9B1470D** ではありません。

```
# pythonを使用してユーザー@AdsAPIをハッシュ化
import hashlib
hashlib.sha256("adsapi".encode()).hexdigest()

#output
49e0be2aeccfb51a8dee4c945c8a70a9ac500cf6f5cb08112575f74db9b1470d
```

ハッシュ化用の追加コードサンプルは [github.com/xdevplatform/ads-platform-tools](https://github.com/xdevplatform/ads-platform-tools) で参照できます。

<div id="custom-audiences-web">
  ### カスタムオーディエンス: Web
</div>

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/info.png" alt="info.png" />
</Frame>

**情報**

パートナーは、広告主に代わってターゲティングに用いる ID（`p_user_ids`）のリストを送信します。これは、`p_user_ids` と X ユーザー ID の間にマッピングを構築する ID Sync プロセスによって実現されます。このマッピングは、その後ターゲティングに使用できる X ユーザー ID のリストを生成するために使用されます。これらのカスタムオーディエンスは、ads.x.com の Custom Audiences Web キャンペーン設定においてラベルで指定された、広告主固有の @handle 上で利用可能になります。

X は、パートナータグおよびサイト上に設置することで、ID（`p_user_ids`）を X ユーザー ID と照合できるセキュアピクセルを提供します。ID Sync プロセスが完了すると、ターゲティングファイルはパートナーによって作成され、HTTPS エンドポイントを通じて X が利用できるようにされます。これらのターゲティングファイルは X によって定期的に取り込まれ、その後 X の UI で利用可能になります。

**X セキュアピクセル**

X セキュアピクセルは次のようになります:

[https://analytics.x.com/i/adsct?p&#95;user&#95;id=xyz&amp;p&#95;id=123](https://analytics.x.com/i/adsct?p\\_user\\_id=xyz\&p_id=123)

**`p_user_id`** - xyz は、パートナーによって提供されるパートナーのユーザー ID を表します

**`p_id`** - 123 は、パートナー固有の ID（X によって付与される）を表します

**パートナー HTTPS エンドポイント &amp; ターゲティングユーザーファイル**

パートナーは、ターゲティングファイルを定期的に取り込むために使用できる HTTPS エンドポイントと認証情報（ユーザー名/パスワード）を X に提供する必要があります。HTTPS エンドポイントの例は次のようになります:

```
https://<partnerdomain>/twitter/partner_targeting_%Y-%M-%D.tsv.gz
```

%Y - 年を表すフォーマットコード (YYYY)

%M - 月を表すフォーマットコード (MM)

%D - 日を表すフォーマットコード (DD)

送信されるデータは、以下のファイルで構成されます。

1. Partner Targeting User File
2. Targeting Conversion File

すべてのファイルは TSV 形式であり、各行の個々のフィールドはタブ文字で区切られます。フィールドの有効な値自体にタブ文字が含まれることはありません。

**許可される X の IP レンジ:**

Partner エンドポイントへのアクセスで許可できる IP レンジは次のとおりです。

* 199.16.156.0/22
* 199.59.148.0/22

**Partner Targeting User File:**

| **Column Number** | **Column Name**   | **Column Type** | **Description**                                                                                                                                                            |
| :---------------- | :---------------- | :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1                 | partner id        | string          | 「partner id」は、各 Partner を一意に識別するために X から Partner に付与される ID です。                                                                                                             |
| 2                 | advertiser id     | string          | 「advertiser id」は、広告主の @handle です。                                                                                                                                          |
| 3                 | p&#95;user&#95;id | string          | 「p&#95;user&#95;id」は、Partner によってユーザーを識別するために使用される一意の ID です。                                                                                                               |
| 3                 | confidence score  | integer         | 「confidence score」は任意項目です。confidence score には 0〜100 の使用を推奨します。ユースケースがリターゲティングの場合、confidence score が「100」のユーザーは、直接リターゲティングされたユーザーを表します。0〜99 の任意のスコアは、類似オーディエンスに対する信頼度を示します。 |
| 4                 | segment label     | string          | 「segment label」は任意項目です。Partner は「segment label」を使用して、たとえば商品カテゴリなどを指定できます。この「segment label」は、ads.x.com の UI における Custom Audiences の人間が判読可能な名前であるため、使用することを推奨します。            |

**注記:**

新しい Partner Targeting File を受信するたびに、特段の合意がない限り、それは Partner がターゲティング対象として推奨するユーザーの完全なリストであり、増分データではないものとみなします。Partner Targeting File の配信頻度については、各 Partner と合意します。想定どおりに Partner Targeting File を受信できなかった場合は、事前に定義された有効期限付きで前回のバージョンを使用します。

<div id="audience-api-integration">
  ## Audience API 連携
</div>

<div id="overview">
  ### Overview
</div>

Audience API は Ads API の [v4](/ja/x-ads-api/introduction) の一部としてリリースされ、これにより従来の Audiences エンドポイントに対して複数の改善がもたらされています。この新しいエンドポイントは新しい Audience 処理バックエンドによって支えられており、安定性、堅牢性、および信頼性の面で大きく向上しています。本ガイドの目的は、Audience API と、従来の Audience のアップロードおよび管理プロセスとの違いを説明することです。 

リファレンスドキュメントは [Audience API](/ja/x-ads-api/audiences) リファレンスドキュメントページで確認できます。 

**注記**: すべての Audience ユーザーデータは、アップロード前に SHA-256 でハッシュ化されている必要があります。詳細および、許可されているユーザー識別子の種類やデータ正規化については、[user data](/ja/x-ads-api/audiences) ページを参照してください。

**Audience 機能の変更点**

v4 時点で Custom Audience に対して次の変更が導入されており、Ads API v3 のサンセット後は、非推奨となったエンドポイントは利用できなくなります。

* **非推奨** TON Upload:
  * GET accounts/:account&#95;id/custom&#95;audience&#95;changes
  * GET accounts/:account&#95;id/custom&#95;audience&#95;changes/:custom&#95;audience&#95;change&#95;id
  * POST accounts/:account&#95;id/custom&#95;audience&#95;changes
  * PUT accounts/:account&#95;id/custom&#95;audiences/global&#95;opt&#95;out
* **非推奨** Real Time Audiences:
  * POST custom&#95;audience&#95;memberships
* Custom Audience:
  * すべての [Custom Audience](/ja/x-ads-api/audiences) エンドポイントのリクエストおよびレスポンスから `list_type` パラメータが削除されます。このパラメータは、以前は Audience のユーザー識別子の種類（例: メールアドレス、X User ID など）を識別するために使用されていましたが、現在の Audience では同じ Audience に対して複数のユーザー識別子を受け付けることができるようになったため、この値は不要になりました。
* 全般:
  * Audience のルックバック期間は、過去 30 日間から、過去 90 日間にアクティブだったユーザーに対して照合するように更新されました
  * ターゲティング可能な Audience に必要な一致ユーザーの最小数は、500 ユーザーから 100 ユーザーに引き下げられました

<Note>
  **前提条件**

  * Ads API へのアクセス
  * Audience エンドポイントへのアクセスには、allowlist への追加が必要です。このフォームに記入のうえ、2018-08-01 より前に初回同意している場合は、新しい [X Ads Products and Services Agreement](/ja/x-ads-api/introduction) に同意してください
</Note>

**Audience アップロードプロセス**

次の表は、旧来の Audience 作成フローと新しい Audience 作成フローとの主な違いを示したもので、詳細は後述します。

| プロセスのステップ | Audience API | （非推奨）TON Upload |
| :--- | :--- | :--- |
| シェル Audience の作成 | [POST custom&#95;audience endpoint]/x-ads-api/audiences を使用して作成可能 | [POST custom&#95;audience endpoint]/x-ads-api/audiences を使用して作成可能 |
| 新規ユーザーの追加 | [Audience endpoint](/ja/x-ads-api/audiences) で `operation_type` `Update` を使用 | [POST custom&#95;audience&#95;changes](/ja/x-ads-api/audiences) エンドポイントで `operation` `ADD` を使用 |
| ユーザーの削除 | [Audience endpoint](/ja/x-ads-api/audiences) で `operation_type` `Delete` を使用 | [POST custom&#95;audience&#95;changes](/ja/x-ads-api/audiences) エンドポイントで `operation` `REMOVE` を使用 |
| ユーザーのオプトアウト | [Audience endpoint](/ja/x-ads-api/audiences) で `operation_type` `Delete` と、そのユーザーが属する対応する `custom_audience_id` を使用 | [Global opt-out endpoint](/ja/x-ads-api/audiences) を使用 |

**注記** TON Upload パス経由で更新またはオプトアウトされる Audience はすべて、[TON Upload](/ja/x-ads-api/audiences) エンドポイントを介して対応するリストがアップロードされ、[custom&#95;audience&#95;changes](/ja/x-ads-api/audiences) エンドポイントを使って Audience に関連付けられている必要があります。

**Rate Limiting**

Audience API エンドポイントのレート制限は、アカウントごとに 1 分あたり 1,500 回です。1 回のペイロードで送信できるユーザー数に制限はありません。ペイロードに対する制約は次のとおりです。

1. 操作の合計数: 2,500 operations

2. 最大ペイロードサイズ: 5,000,000 bytes

**Audience ユーザー管理**

新しい Audience を作成するには、以下のステップが必要です。

<div id="create-a-new-custom-audience">
  ### 新しいカスタムオーディエンスを作成する
</div>

[POST custom&#95;audience]/x-ads-api/audiences エンドポイントを使用して新しいカスタムオーディエンスの「シェル」を作成し、対応するカスタムオーディエンスの `id` を取得します。このステップはオーディエンスを一から作成する場合に必須です。既存のオーディエンスを更新する場合は、次のセクションに進んでください。

<div id="add-users-to-an-audience">
  ### オーディエンスにユーザーを追加する
</div>

カスタムオーディエンスの `id` と次のようなサンプルペイロードを指定して、[POST accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id/users](/ja/x-ads-api/audiences) エンドポイントを呼び出します。

POST [https://ads-api.x.com/11/accounts/18ce54d4x5t/custom&#95;audiences/1nmth/users](https://ads-api.x.com/11/accounts/18ce54d4x5t/custom_audiences/1nmth/users)

```
    # すべての値はハッシュ化する必要があります。ハッシュ化されていない値は説明目的でこの例に使用されています
    [
      {
        "operation_type": "Update",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "email": [
                "abc@x.com"
              ],
              "handle": [
                "x",
                "adsapi"
              ]
            },
            {
              "email": [
                "edf@x.com"
              ],
              "twitter_id": [
                "121291606",
                "17874544"
              ]
            }
          ]
        }
      }
    ]
```

ユーザーを Audience に追加するには、`operation_type` に `Update` を指定します。新しい Audience インターフェースでは、1人のユーザーに対して複数のユーザーキーを指定できます。JSON オブジェクトの配列内の各オブジェクトは、それぞれ1人のユーザーに対応します。上記のペイロード例では、このリクエストにより 2 人のユーザーが Audience に追加されます。1人は `email` と `handle` を持ち、もう1人は `email` と `twitter_id` を持ちます。

<div id="remove-users-from-an-audience">
  #### オーディエンスからユーザーを削除する
</div>

ユーザーを追加する場合と同様の手順で、以下のようにオーディエンスからユーザーを削除できます。

POST [https://ads-api.x.com/11/accounts/18ce54d4x5t/custom&#95;audiences/1nmth/users](https://ads-api.x.com/11/accounts/18ce54d4x5t/custom_audiences/1nmth/users)

```
    # すべての値はハッシュ化する必要があります。ハッシュ化されていない値は説明目的でこの例に使用されています
    [
      {
        "operation_type": "Delete",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "email": [
                "abc@x.com"
              ],
              "twitter_id": [
                "783214",
                "1225933934"
              ]
            },
            {
              "email": [
                "edf@x.com"
              ],
              "twitter_id": [
                "121291606",
                "17874544"
              ]
            }
          ]
        }
      }
    ]
```

`operation_type` は `Delete` に設定する必要があり、ユーザーはオーディエンスにユーザーを追加した際に使用された任意のキーで照合されます。たとえば、あるユーザーが `email` と `twitter_id` を使ってオーディエンスに追加されていた場合、同じユーザーはこれらのいずれかのキー、つまり `email` または `twitter_id`、もしくはその両方を使って削除できます。

さらに、同一のリクエスト内でオーディエンスからユーザーを追加および削除することも可能です。このエンドポイントは、1 リクエストあたり複数の種類の `operation_type` をサポートします。

<div id="opt-out-users">
  #### オプトアウトユーザー
</div>

グローバルオプトアウトエンドポイントの非推奨化に伴い、パートナーは、いずれかのオーディエンスからオプトアウトしたユーザーを `Delete` する必要があります。これを実現する方法はいくつかあります。

1. 各ユーザーがどのオーディエンスに属しているかを追跡し、各オーディエンスから個別にユーザーを削除する。
2. 広告アカウントに関連付けられている **すべての** オーディエンスから、そのユーザーを削除する。

**一般的なベストプラクティス**

* キューの急増によって処理に時間がかかったり、システムに不要な負荷をかけたりすることを避けるため、このエンドポイントはほぼリアルタイムのバッチで呼び出すことを強く推奨します。これにより、ユーザーがキャンペーンターゲティングに利用可能になるタイミングも早まります。
* 成功した API 呼び出しは、リクエストで受信した `user` オブジェクトの数に対応する `success_count` と `total_count` を返します。
* このエンドポイントはアトミックな性質を持っており、リクエスト全体が成功するか、エラーが発生した場合はリクエスト全体が失敗します。エラー応答が返された場合、API 利用者はエラーを修正し、ペイロード全体を含むリクエストを再試行することを推奨します。 
* 失敗時には、再試行には[指数バックオフ](https://en.wikipedia.org/wiki/Exponential_backoff)方式を使用することをパートナーに推奨します。たとえば、1 回目の失敗時には直ちに再試行し、2 回目の失敗後は 1 分後に、3 回連続で失敗した場合は 5 分後に再試行する、といった形です。

<div id="api-reference">
  ## APIリファレンス
</div>

<div id="keyword-insights">
  ### キーワードインサイト
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  Postman で実行
</Button>

<div id="get-insightskeywordssearch">
  #### GET insights/keywords/search[](#get-insights-keywords-search "この見出しへのパーマリンク")
</div>

キーワードのグループを指定して、それらに関連付けられたポスト数と、関連する 30 個のキーワードのセットを取得します。ポスト数は入力したキーワードのみに対応し、関連キーワードは含みません。

許可される最大の時間範囲（`end_time` - `start_time`）は 7 日間です。

結果は 1 つのジオ（国）ごとにスコープされる点に注意してください。

**Resource URL[](#resource-url "この見出しへのパーマリンク")**

`https://ads-api.x.com/12/insights/keywords/search`

**Parameters[](#parameters "この見出しへのパーマリンク")**

| Name                                    | Description                                                                                                                                                                                                                                                     |
| :-------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| granularity  <br />*required*           | `start_time` と `end_time` で示される時間範囲に対して返されるデータの粒度を指定します。たとえば `HOUR` に設定した場合、`start_time` と `end_time` の間の各時間ごとに 1 つのデータポイントが返されます。<br /><br />Type: enum<br /><br />Possible values: `DAY`, `HOUR`                                                              |
| keywords  <br />*required*              | 検索を絞り込むための、カンマ区切りのキーワード文字列です。すべてのキーワードは互いに OR 条件で評価されます。<br /><br />**Note**: 使用できるキーワード（`keywords` と `negative_keywords` の合計）は最大 10 個です。<br /><br />Type: string<br /><br />Example: `developers`                                                              |
| start&#95;time  <br />*required*        | 取得されるデータを、`start_time` と `end_time` 間の時間ウィンドウで収集されたデータにスコープします。[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 形式で指定します。<br /><br />Type: string<br /><br />Example: `2017-07-10T00:00:00Z`                                                                  |
| end&#95;time  <br />*optional*          | 取得されるデータを、`start_time` と `end_time` 間の時間ウィンドウで収集されたデータにスコープします。[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 形式で指定します。<br /><br />**Note**: 省略した場合は現在時刻がデフォルトとして使用されます。<br /><br />Type: string<br /><br />Example: `2017-07-11T00:00:00Z`                 |
| location  <br />*optional*              | アカウントのユーザーの所在地に基づいて結果を絞り込むために、[GET targeting&#95;criteria/locations](/ja/x-ads-api/campaign-management#get-targeting-criteria-locations) エンドポイントから取得したターゲティング値を指定します。現時点では国レベルのロケーションのみがサポートされています。<br /><br />Type: string<br /><br />Example: `0ce8b9a7b2742f7e` |
| negative&#95;keywords  <br />*optional* | 除外するキーワードを指定する、カンマ区切りの文字列です。すべてのネガティブキーワードは互いに OR 条件で評価されます。<br /><br />**Note**: 使用できるキーワード（`keywords` と `negative_keywords` の合計）は最大 10 個です。<br /><br />Type: string<br /><br />Example: `rain`                                                                |

**Example Request[](#example-request "この見出しへのパーマリンク")**

```json
GET https://ads-api.x.com/12/insights/keywords/search?end_time=2018-02-02&granularity=DAY&keywords=developers&start_time=2018-02-01
```

**レスポンス例[](#example-response "この見出しへのパーマリンク")***

```
    {
      "request": {
        "params": {
          "start_time": "2018-02-01T00:00:00Z",
          "end_time": "2018-02-02T00:00:00Z",
          "granularity": "DAY",
          "keywords": [
            "developers"
          ]
        }
      },
      "data": {
        "related_keywords": [
          "dev",
          "developer",
          "coders",
          "mysql",
          "devs",
          "#technology",
          "#developers",
          "security",
          "programmers",
          "#tech",
          "javascript",
          "#iot",
          "#bigdata",
          "cloud",
          "devops",
          "php",
          "developer",
          "programmer",
          "engineer",
          "big data",
          "agile",
          "app",
          "programming",
          "ios",
          "maker",
          "startups",
          "developer's",
          "java",
          "#devops",
          "startup"
        ],
        "tweet_volume": [
          15707
        ]
      }
    }
```

<div id="tailored-audience-permissions">
  ### テイラードオーディエンスの権限
</div>

<Button href="https://app.getpostman.com/run-collection/369a02c0adc626ff6a06#?env%5BTwitter%20Ads%20API%5D=W3sia2V5IjoiYWNjb3VudF9pZCIsInZhbHVlIjoieW91cl9hZHNfYWNjb3VudF9pZCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidmVyc2lvbiIsInZhbHVlIjoiNSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfa2V5IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX2tleSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfc2VjcmV0IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX3NlY3JldCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiYWNjZXNzX3Rva2VuIiwidmFsdWUiOiJ5b3VyX2FjY2Vzc190b2tlbiIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidG9rZW5fc2VjcmV0IiwidmFsdWUiOiJ5b3VyX3Rva2VuX3NlY3JldCIsImVuYWJsZWQiOnRydWV9XQ==">
  Postman で実行
</Button>

<div id="get-accountsaccount_idtailored_audiencestailored_audience_idpermissions">
  #### GET accounts/:account&#95;id/tailored&#95;audiences/:tailored&#95;audience&#95;id/permissions[](#get-accounts-account-id-tailored-audiences-tailored-audience-id-permissions "Permalink to this headline")
</div>

指定したテイラードオーディエンスに関連付けられている、一部またはすべての権限の詳細を取得します。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/5/accounts/:account_id/tailored_audiences/:tailored_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                                           | Description                                                                                                                                                                                                                                                     |
| :------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*                               | 対象アカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常必須のパラメータです。指定するアカウントは、認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t`                                    |
| tailored&#95;audience&#95;id  <br />*required*                 | リクエストで操作対象とするテイラードオーディエンスを指定します。<br /><br />Type: string<br /><br />Example: `1nmth`                                                                                                                                                                            |
| count  <br />*optional*                                        | 1 回のリクエストで取得を試みるレコード数を指定します。<br /><br />Type: int<br /><br />Default: `200`  <br />Min, Max: `1`, `1000`                                                                                                                                                        |
| cursor  <br />*optional*                                       | 結果の次ページを取得するためのカーソルを指定します。詳細は [Pagination](/ja/x-ads-api/introduction) を参照してください。<br /><br />Type: string<br /><br />Example: `8x7v00oow`                                                                                                                          |
| granted&#95;account&#95;ids  <br />*optional*                  | カンマ区切りの識別子リストを指定することで、レスポンスを指定したアカウントのみに絞り込みます。最大 200 個の ID を指定できます。<br /><br />Type: string<br /><br />Example: `18ce54aymz3`                                                                                                                                  |
| sort&#95;by  <br />*optional*                                  | サポートされている属性を基準に、昇順または降順でソートします。詳細は [Sorting](/ja/x-ads-api/introduction) を参照してください。<br /><br />Type: string<br /><br />Example: `created_at-asc`                                                                                                                   |
| tailored&#95;audience&#95;permission&#95;ids  <br />*optional* | カンマ区切りの識別子リストを指定することで、レスポンスを指定したテイラードオーディエンス権限のみに絞り込みます。最大 200 個の ID を指定できます。<br /><br />Type: string<br /><br />Example: `ri`                                                                                                                                  |
| with&#95;total&#95;count  <br />*optional*                     | `total_count` レスポンス属性を含めます。<br /><br />**Note**: このパラメータと `cursor` は排他的です。<br /><br />**Note**: `total_count` を含むリクエストには、現在 15 分あたり 200 に設定されている、より低いレート制限が適用されます。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/5/accounts/18ce54d4x5t/tailored_audiences/1nmth/permissions`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "tailored_audience_id": "1nmth"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "tailored_audience_id": "1nmth",
          "permission_level": "READ_ONLY",
          "id": "ri",
          "created_at": "2017-06-08T23:17:59Z",
          "granted_account_id": "18ce54aymz3",
          "updated_at": "2017-06-08T23:17:59Z",
          "deleted": false
        }
      ]
    }

```

<div id="post-accountsaccount_idtailored_audiencestailored_audience_idpermissions">
  #### POST accounts/:account&#95;id/tailored&#95;audiences/:tailored&#95;audience&#95;id/permissions[](#post-accounts-account-id-tailored-audiences-tailored-audience-id-permissions "Permalink to this headline")
</div>

指定したオーディエンスを特定のアカウントと共有できるようにする、新しい権限オブジェクトを作成します。

**注**: テイラードオーディエンスの権限を作成または変更するには、そのオーディエンスが、権限の変更を行おうとしているアカウントに所有されている必要があります。該当オーディエンスに対するレスポンスの `is_owner` 属性を確認することで、テイラードオーディエンスの所有権を確認できます。

**注**: オーディエンスは、同一ビジネス内の広告アカウント間、またはオーディエンスを所有している広告アカウントが `SHARE_AUDIENCE_OUTSIDE_BUSINESS` アカウント機能を持っている場合にのみ共有できます。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/5/accounts/:account_id/tailored_audiences/:tailored_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                           | Description                                                                                                                                                                                                                       |
| :--------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*               | 利用対象となるアカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで一般的に必須パラメータです。指定したアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| granted&#95;account&#95;id  <br />*required*   | テイラードオーディエンスへの権限を付与したい相手のアカウントです。<br /><br />Type: string<br /><br />Example: `18ce54aymz3`                                                                                                                                       |
| permission&#95;level  <br />*required*         | `granted_account_id` がテイラードオーディエンスに対して持つべきアクセスの種類です。<br /><br />Type: enum<br /><br />Possible values: `READ_ONLY`, `READ_WRITE`                                                                                                  |
| tailored&#95;audience&#95;id  <br />*required* | リクエストで操作対象としているテイラードオーディエンスへの参照です。<br /><br />Type: string<br /><br />Example: `2906h`                                                                                                                                            |

**Example Request[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/5/accounts/18ce54d4x5t/tailored_audiences/2906h/permissions?granted_account_id=18ce54aymz3&permission_level=READ_ONLY`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "granted_account_id": "18ce54aymz3",
          "permission_level": "READ_ONLY",
          "tailored_audience_id": "2906h"
        }
      },
      "data": {
        "tailored_audience_id": "2906h",
        "permission_level": "READ_ONLY",
        "id": "14m",
        "created_at": "2017-09-12T23:49:34Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-09-12T23:49:34Z",
        "deleted": false
      }
    }
```

<div id="delete-accountsaccount_idtailored_audiencestailored_audience_idpermissionstailored_audience_permission_id">
  #### DELETE accounts/:account&#95;id/tailored&#95;audiences/:tailored&#95;audience&#95;id/permissions/:tailored&#95;audience&#95;permission&#95;id[](#delete-accounts-account-id-tailored-audiences-tailored-audience-id-permissions-tailored-audience-permission-id "Permalink to this headline")
</div>

指定した Tailored Audience の共有権限を取り消します。

**Note**: Tailored Audience の権限を作成または変更するには、そのオーディエンスが、権限を変更しようとしているアカウントによって所有されている必要があります。特定のオーディエンスのレスポンス内に含まれる `is_owner` レスポンス属性を確認することで、その Tailored Audience の所有者かどうかを確認できます。

権限が取り消されると、付与先アカウント（`granted_account_id`）は今後のキャンペーンでそのオーディエンスをターゲティングできないことが保証されます。既存のキャンペーンは共有オーディエンスを使用して引き続き配信されます。キャンペーンは停止されず、オーディエンスもキャンペーンから削除されません。オーディエンス共有権限が取り消された後は、そのキャンペーンをコピーすることはできません。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/5/accounts/:account_id/tailored_audiences/:tailored_audience_id/permissions/:tailored_audience_permission_id`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                                          | Description                                                                                                                                                                                                                      |
| :------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*                              | 対象アカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで、一般的に必須パラメーターです。指定されたアカウントは、認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| tailored&#95;audience&#95;id  <br />*required*                | リクエストで操作対象となる Tailored Audience を示す ID です。<br /><br />Type: string<br /><br />Example: `1nmth`                                                                                                                                   |
| tailored&#95;audience&#95;permission&#95;id  <br />*required* | リクエストで操作対象となる Tailored Audience 権限を示す ID です。<br /><br />Type: string<br /><br />Example: `ri`                                                                                                                                    |

**Example Request[](#example-request "Permalink to this headline")**

`DELETE https://ads-api.x.com/5/accounts/18ce54d4x5t/tailored_audiences/1nmth/permissions/ri`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "tailored_audience_permission_id": "ri",
          "tailored_audience_id": "1nmth"
        }
      },
      "data": {
        "tailored_audience_id": "1nmth",
        "permission_level": "READ_ONLY",
        "id": "ri",
        "created_at": "2017-06-08T23:17:59Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-08-30T18:29:35Z",
        "deleted": true
      }
    }
```

<div id="targeted-audiences">
  ### ターゲットオーディエンス
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  Postman で実行
</Button>

<div id="get-accountsaccount_idcustom_audiencescustom_audience_idtargeted">
  #### GET accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id/targeted[](#get-accounts-account-id-custom-audiences-custom-audience-id-targeted "この見出しへのパーマリンク")
</div>

指定された `custom_audience_id` をターゲットにしているラインアイテムおよびキャンペーン（有効なもののみ、またはすべて）のリストを取得します

| Name                                         | Description                                                                                                                                                                                                                     |
| :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| account&#95;id  <br />*required*             | 利用するアカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで一般的に必須パラメータです。指定されたアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom&#95;audience&#95;id  <br />*required* | リクエストで操作の対象となるカスタムオーディエンスを参照します。<br /><br />Type: string<br /><br />Example: `2906h`                                                                                                                                            |
| with&#95;active  <br />*optional*            | `false` の場合、`servable=false` ステータスのラインアイテムも含めます。<br /><br />Type: boolean<br /><br />Default: `true`  <br />Possible values: `true`, `false`                                                                                    |
| cursor  <br />*optional*                     | 次のページの結果を取得するためのカーソルを指定します。詳細は [Pagination](/ja/x-ads-api/introduction) を参照してください。  <br />  <br />Type: string  <br />  <br />Example: `8x7v00oow`                                                                                 |

**Example Request[](#example-request "この見出しへのパーマリンク")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h/targeted`

**Example Response[](#example-response "この見出しへのパーマリンク")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_id": "2906h",
        }
      },
      "next_cursor": null,
      "data": [
        {
          "campaign_id": "59hod",
          "campaign_name": "test-campaign",
          "line_items": [
            {
              "id": "5gzog",
              "name": "test-line-item",
              "servable": true
            }
          ]
        },
        {
          "campaign_id": "arja7",
          "campaign_name": "Untitled campaign",
          "line_items": [
            {
              "id": "bjw1q",
              "name": null,
              "servable": true
            }
          ]
        }
      ]
    }
```

<div id="custom-audiences-users">
  ### カスタムオーディエンスのユーザー
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  Postman で実行
</Button>

<div id="post-accountsaccount_idcustom_audiencescustom_audience_idusers">
  #### POST accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id/users[](#post-accounts-account-id-custom-audiences-custom-audience-id-users "Permalink to this headline")
</div>

このエンドポイントを使用すると、パートナーは指定された `custom_audience_id` に属するユーザーを追加、更新、および削除できます。また、このエンドポイントは、1ユーザーにつき複数種類のユーザー識別子も受け付けます。

リクエストの `users` フィールドで提供されるデータのうち、`partner_user_id` **以外** はすべて `SHA256` を使用してハッシュ化し、[正規化](/ja/x-ads-api/audiences#twitter-user-id-normalization) する必要があります。

**バッチリクエスト**

* 現在の最大バッチサイズは **このエンドポイントに対して** `2500` です。バッチサイズは、リクエストごとの操作数（`Update`/`Delete`）によって決まります。たとえば、1つの配列内に 2500 を超える操作オブジェクト（`{"operation_type": "Update/Delete", [..] }`）があるとエラーになります。
* このエンドポイントが受け付ける POST リクエストボディサイズの最大値は `5,000,000` バイトです。
* このエンドポイントのレート制限は、1 分間の時間枠あたり 1500 回です。
* すべてのパラメータはリクエストボディで送信され、`Content-Type` として `application/json` が必要です。
* バッチリクエストはグループとして一括で失敗または成功し、エラーと成功の両方の API レスポンスで、最初のリクエストのアイテム順序が維持されます。

**バッチレスポンス**

Ads API が返すレスポンスには、`success_count` と `total_count` の 2 つのフィールドが含まれます。これらの値は常に等しくなければならず、バックエンドによって処理されたリクエスト内のレコード件数を表します。リクエストボディで送信されたレコード数が `success_count` および `total_count` と一致**しない**場合はエラー状態として扱う必要があり、リトライが必要です。

**バッチエラー**

* リクエストレベルのエラー（例: 最大バッチサイズ超過）は、レスポンス内の `errors` オブジェクトに含まれます。
* アイテムレベルのエラー（例: 必須パラメータの欠如）は、レスポンス内の `operation_errors` オブジェクトに含まれます。
* `operation_errors` 内のエラーのインデックスは、入力アイテム内のインデックスを指し、その位置のアイテムに対応するエラーメッセージが含まれます。

<div id="resource-url">
  #### リソースURL[](#resource-url "Permalink to this headline")
</div>

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/users`

<div id="parameters">
  #### Parameters[](#parameters "Permalink to this headline")
</div>

| Name | Description |
| :--- | :--- |
| operation&#95;type  <br />*required* | 各 `users` グループに対して実行する操作タイプ。<br /><br />Type: enum<br /><br />Possible values: `Update`, `Delete` |
| params  <br />*required* | `users` 配列、`effective_at` タイムスタンプ、`expires_at` タイムスタンプを含む JSON オブジェクト。<br /><br />Type: JSON |
| users  <br />*required* | 各ユーザーに対するすべてのパラメータを含む JSON オブジェクトの配列。<br /><br />Type: JSON |
| effective&#95;at  <br />*optional* | カスタムオーディエンスの関連付けが有効になる UTC 時刻。[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) で表現します。デフォルトは現在の日時です。<br /><br />Type: string<br /><br />Example: `2017-07-05T07:00:00Z` |
| expires&#95;at  <br />*optional* | カスタムオーディエンスの関連付けが期限切れになる UTC 時刻。指定する時刻は `effective_at` の値より後である必要があります。[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) で表現します。デフォルトはリクエストのタイムスタンプから 13 か月後です。<br /><br />Type: string<br /><br />Example: `2017-07-05T07:00:00Z` |

`users` オブジェクトに対する複数キー方式に基づき、このオブジェクトの各要素は以下のとおり定義されています。

| Name | Description |
| :--- | :--- |
| email  <br />*optional* | ユーザーのメールアドレス（複数可）。<br /><br />Type: Array[String] |
| device&#95;id  <br />*optional* | IDFA / AdID / Android ID<br /><br />Type: Array[String] |
| handle  <br />*optional* | ユーザーに紐づく @handle（複数可）。<br /><br />Type: Array[String] |
| twitter&#95;id  <br />*optional* | ユーザーに紐づく X ID（複数可）。<br /><br />Type: Array[String] |
| phone&#95;number  <br />*optional* | ユーザーの電話番号（複数可）。<br /><br />Type: Array[String] |
| partner&#95;user&#95;id  <br />*optional* | パートナーのシステムにおけるユーザーの ID（複数可）。<br /><br />Type: Array[String] |

<div id="example-request">
  #### リクエスト例[](#example-request "Permalink to this headline")
</div>

`POST https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/1nmth/users`

```
    [
      {
        "operation_type": "Update",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "email": [
                "4798b8bbdcf6f2a52e527f46a3d7a7c9aefb541afda03af79c74809ecc6376f3"
              ],
              "handle": [
                "7352f353c460e74c7ae226952d04f8aa307b12329c5512ec8cb6f1a0f8f9b2cb",
                "49e0be2aeccfb51a8dee4c945c8a70a9ac500cf6f5cb08112575f74db9b1470d"
              ]
            },
            {
              "email": [
                "5bf13d5ad4200407c5bc8b9bb578e425d05ef936fd488e3799a9d0806669223c"
              ],
              "twitter_id": [
                "34d56c7159a7eea941f359653029410f813f65a1d2d13ecc5ccbdd5a8cb755cf",
                "00e7b76c9739dec57f4c4a20ec021a20ffcf26bd00f519b17ea00f0ed6048f85"
              ]
            }
          ]
        }
      },
      {
        "operation_type": "Delete",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "device_id": [
                "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92"
              ],
              "email": [
                "4798b8bbdcf6f2a52e527f46a3d7a7c9aefb541afda03af79c74809ecc6376f3"
              ],
              "handle": [
                "461222f5dd690a20651c3d19848015cb0369db3f8e937571ffb775de70750847"
              ],
              "twitter_id": [
                "c623c7e163984493b46c547088542e95d0aaa529bc52bbecce3ff91eb6b7843b"
              ]
            },
            {
              "email": [
                "5bf13d5ad4200407c5bc8b9bb578e425d05ef936fd488e3799a9d0806669223c"
              ],
              "twitter_id": [
                "858cdc7f313f84a3f3c48e9a6323307c1ef1bb7439b8e3623e140454b0fd8fa5",
                "bb074e154657b91d99bd1bb3757409149670e8ae7a0fe9136fae29a26a7881c8"
              ]
            }
          ]
        }
      }
    ]
```

<div id="example-response">
  #### レスポンス例[](#example-response "この見出しへのパーマリンク")
</div>

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_id": "1nmth"
        }
      },
      "data": {
        "success_count": 4,
        "total_count": 4
      }
    }
```

<div id="custom-audience-permissions">
  ### カスタムオーディエンスの権限
</div>

<Button href="https://app.getpostman.com/run-collection/369a02c0adc626ff6a06#?env%5BTwitter%20Ads%20API%5D=W3sia2V5IjoiYWNjb3VudF9pZCIsInZhbHVlIjoieW91cl9hZHNfYWNjb3VudF9pZCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidmVyc2lvbiIsInZhbHVlIjoiNSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfa2V5IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX2tleSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfc2VjcmV0IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX3NlY3JldCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiYWNjZXNzX3Rva2VuIiwidmFsdWUiOiJ5b3VyX2FjY2Vzc190b2tlbiIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidG9rZW5fc2VjcmV0IiwidmFsdWUiOiJ5b3VyX3Rva2VuX3NlY3JldCIsImVuYWJsZWQiOnRydWV9XQ==">
  Postman で実行
</Button>

<div id="get-accountsaccount_idcustom_audiencescustom_audience_idpermissions">
  #### GET accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id/permissions[](#get-accounts-account-id-custom-audiences-custom-audience-id-permissions "Permalink to this headline")
</div>

指定されたカスタムオーディエンスに関連付けられている、一部またはすべての権限の詳細を取得します。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                                         | Description                                                                                                                                                                                                                                                 |
| :----------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*                             | 対象アカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常必須のパラメータです。指定されたアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t`                                |
| custom&#95;audience&#95;id  <br />*required*                 | リクエストで操作対象となるカスタムオーディエンスへの参照です。<br /><br />Type: string<br /><br />Example: `1nmth`                                                                                                                                                                         |
| count  <br />*optional*                                      | 1 回のリクエストで取得を試みるレコード数を指定します。<br /><br />Type: int<br /><br />Default: `200`  <br />Min, Max: `1`, `1000`                                                                                                                                                    |
| cursor  <br />*optional*                                     | 次のページの結果を取得するためのカーソルを指定します。詳細は [Pagination](/ja/x-ads-api/introduction) を参照してください。<br /><br />Type: string<br /><br />Example: `8x7v00oow`                                                                                                                     |
| granted&#95;account&#95;ids  <br />*optional*                | カンマ区切りの識別子リストを指定することで、レスポンスを必要なアカウントのみに絞り込みます。最大 200 個の ID を指定できます。<br /><br />Type: string<br /><br />Example: `18ce54aymz3`                                                                                                                               |
| sort&#95;by  <br />*optional*                                | サポートされている属性を、昇順または降順でソートします。詳細は [Sorting](/ja/x-ads-api/fundamentals/sorting) を参照してください。<br /><br />Type: string<br /><br />Example: `created_at-asc`                                                                                                          |
| custom&#95;audience&#95;permission&#95;ids  <br />*optional* | カンマ区切りの識別子リストを指定することで、レスポンスを必要なカスタムオーディエンス権限のみに絞り込みます。最大 200 個の ID を指定できます。<br /><br />Type: string<br /><br />Example: `ri`                                                                                                                                |
| with&#95;total&#95;count  <br />*optional*                   | `total_count` レスポンス属性を含めます。<br /><br />**注意**: このパラメータと `cursor` は排他的です。<br /><br />**注意**: `total_count` を含むリクエストには、現在 15 分あたり 200 に設定されている、より低いレート制限が適用されます。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/1nmth/permissions`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_id": "1nmth"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "custom_audience_id": "1nmth",
          "permission_level": "READ_ONLY",
          "id": "ri",
          "created_at": "2017-06-08T23:17:59Z",
          "granted_account_id": "18ce54aymz3",
          "updated_at": "2017-06-08T23:17:59Z",
          "deleted": false
        }
      ]
    }
```

<div id="post-accountsaccount_idcustom_audiencescustom_audience_idpermissions">
  #### POST accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id/permissions[](#post-accounts-account-id-custom-audiences-custom-audience-id-permissions "この見出しへのパーマリンク")
</div>

指定したオーディエンスを特定のアカウントと共有できるようにする新しい権限オブジェクトを作成します。

**注**: カスタムオーディエンスの権限を作成または変更するには、権限の作成または変更を行おうとしているアカウントが、そのオーディエンスを所有している必要があります。特定のオーディエンスに対するレスポンス内の `is_owner` 属性を確認することで、カスタムオーディエンスの所有者を確認できます。

**注**: オーディエンスは、同一ビジネス配下の広告アカウント間、またはオーディエンスを所有している広告アカウントが `SHARE_AUDIENCE_OUTSIDE_BUSINESS` アカウント機能を持っている場合にのみ共有できます。

**Resource URL[](#resource-url "この見出しへのパーマリンク")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/permissions`

**Parameters[](#parameters "この見出しへのパーマリンク")**

| Name                                         | Description                                                                                                                                                                                                                    |
| :------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*             | 対象となるアカウントの識別子です。リソースパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常は必須パラメータです。指定されたアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| granted&#95;account&#95;id  <br />*required* | カスタムオーディエンスの権限を付与したいアカウントです。<br /><br />Type: string<br /><br />Example: `18ce54aymz3`                                                                                                                                         |
| permission&#95;level  <br />*required*       | `granted_account_id` がカスタムオーディエンスに対して持つアクセスレベルです。<br /><br />Type: enum<br /><br />Possible values: `READ_ONLY`, `READ_WRITE`                                                                                                  |
| custom&#95;audience&#95;id  <br />*required* | リクエストで操作対象となるカスタムオーディエンスへの参照です。<br /><br />Type: string<br /><br />Example: `2906h`                                                                                                                                            |

**Example Request[](#example-request "この見出しへのパーマリンク")**

```
POST https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h/permissions?granted_account_id=18ce54aymz3&permission_level=READ_ONLY
```

**レスポンス例[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "granted_account_id": "18ce54aymz3",
          "permission_level": "READ_ONLY",
          "custom_audience_id": "2906h"
        }
      },
      "data": {
        "custom_audience_id": "2906h",
        "permission_level": "READ_ONLY",
        "id": "14m",
        "created_at": "2017-09-12T23:49:34Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-09-12T23:49:34Z",
        "deleted": false
      }
    }
```

<div id="delete-accountsaccount_idcustom_audiencescustom_audience_idpermissionscustom_audience_permission_id">
  #### DELETE accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id/permissions/:custom&#95;audience&#95;permission&#95;id[](#delete-accounts-account-id-custom-audiences-custom-audience-id-permissions-custom-audience-permission-id "この見出しへのパーマリンク")
</div>

指定された Custom Audience の共有権限を取り消します。

**注記**: Custom Audience の権限を作成または変更するには、その Custom Audience を所有しているアカウントである必要があります。特定の Custom Audience の所有者は、その Audience に対するレスポンス内の `is_owner` 属性を確認することで判別できます。

権限が取り消されると、付与されていたアカウント（`granted_account_id`）は今後のキャンペーンでその Audience をターゲットにできなくなることが保証されます。既存のキャンペーンは共有 Audience を使って引き続き配信されます。キャンペーンは停止されず、キャンペーンから Audience が削除されることもありません。Audience の共有権限が取り消された後は、そのキャンペーンをコピーすることはできません。

**Resource URL[](#resource-url "この見出しへのパーマリンク")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/permissions/:custom_audience_permission_id`

**Parameters[](#parameters "この見出しへのパーマリンク")**

| Name                                                        | Description                                                                                                                                                                                                                      |
| :---------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*                            | 利用するアカウントの識別子です。リソースのパス内に現れ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで、一般的に必須パラメータです。指定されたアカウントは、認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom&#95;audience&#95;id  <br />*required*                | リクエストで操作対象となる Custom Audience への参照です。<br /><br />Type: string<br /><br />Example: `1nmth`                                                                                                                                        |
| custom&#95;audience&#95;permission&#95;id  <br />*required* | リクエストで操作対象となる Custom Audience 権限への参照です。<br /><br />Type: string<br /><br />Example: `ri`                                                                                                                                         |

**Example Request[](#example-request "この見出しへのパーマリンク")**

`DELETE https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/1nmth/permissions/ri`

**Example Response[](#example-response "この見出しへのパーマリンク")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_permission_id": "ri",
          "custom_audience_id": "1nmth"
        }
      },
      "data": {
        "custom_audience_id": "1nmth",
        "permission_level": "READ_ONLY",
        "id": "ri",
        "created_at": "2017-06-08T23:17:59Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-08-30T18:29:35Z",
        "deleted": true
      }
    }
```

<div id="custom-audiences">
  ### カスタムオーディエンス
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  Postman で実行
</Button>

<div id="get-accountsaccount_idcustom_audiences">
  #### GET accounts/:account&#95;id/custom&#95;audiences[](#get-accounts-account-id-custom-audiences "Permalink to this headline")
</div>

現在のアカウントに関連付けられている一部またはすべてのカスタムオーディエンスの詳細を取得します。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                          | Description                                                                                                                                                                                                                                                        |
| :-------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*              | 利用対象となるアカウントの識別子です。リソースパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常必須となるパラメータです。指定したアカウントは認証されたユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t`                                 |
| count  <br />*optional*                       | 1 回のリクエストで取得を試みるレコードの件数を指定します。<br /><br />Type: int<br /><br />Default: `200`  <br />Min, Max: `1`, `1000`                                                                                                                                                         |
| cursor  <br />*optional*                      | 次のページの結果を取得するためのカーソルを指定します。詳細は [Pagination](/ja/x-ads-api/introduction) を参照してください。<br /><br />Type: string<br /><br />Example: `8x7v00oow`                                                                                                                            |
| permission&#95;scope  <br />*optional*        | 応答を、自分が所有するリスト、または自分と共有されているリストのみにフィルタリングできます。既定では、このパラメータを指定しない場合、自分が所有するオーディエンスのみが表示されます。<br /><br />Type: enum<br /><br />Default: `OWNER`  <br />Possible values: `OWNER`, `SHARED`                                                                            |
| q  <br />*optional*                           | リソースを `name` で絞り込むための任意のクエリです。<br /><br />**Note**: 大文字と小文字を区別しないプレフィックスマッチングを行います。<br /><br />Type: string<br /><br />Min, Max length: `1`, `255`                                                                                                                 |
| sort&#95;by  <br />*optional*                 | サポートされている属性を基準に、昇順または降順にソートします。詳細は [Sorting](/ja/x-ads-api/fundamentals/sorting) を参照してください。<br /><br />Type: string<br /><br />Example: `created_at-asc`                                                                                                              |
| custom&#95;audience&#95;ids  <br />*optional* | カンマ区切りの識別子リストを指定することで、応答を対象のカスタムオーディエンスのみに絞り込みます。最大 200 個の ID を指定できます。<br /><br />Type: string<br /><br />Example: `1nmth`                                                                                                                                         |
| with&#95;deleted  <br />*optional*            | 削除済みの結果をレスポンスに含めます。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false`                                                                                                                                                   |
| with&#95;total&#95;count  <br />*optional*    | `total_count` レスポンス属性を含めます。<br /><br />**Note**: このパラメータと `cursor` は同時には使用できません。<br /><br />**Note**: `total_count` を含むリクエストはレート制限がより厳しくなり、現在は 15 分あたり 200 に設定されています。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences?custom_audience_ids=1nmth`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "custom_audience_ids": [
            "1nmth"
          ],
          "account_id": "18ce54d4x5t"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "targetable": true,
          "name": "twurl-using-subshell-for-file",
          "targetable_types": [
            "CRM",
            "EXCLUDED_CRM"
          ],
          "audience_type": "CRM",
          "description": null,
          "permission_level": "READ_WRITE",
          "owner_account_id": "18ce54d4x5t",
          "id": "1nmth",
          "reasons_not_targetable": [],
          "created_at": "2017-01-08T08:19:58Z",
          "updated_at": "2017-01-08T16:21:13Z",
          "partner_source": "OTHER",
          "deleted": false,
          "audience_size": 1470
        }
      ]
    }
```

<div id="get-accountsaccount_idcustom_audiencescustom_audience_id">
  #### GET accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id[](#get-accounts-account-id-custom-audiences-custom-audience-id "この見出しへのパーマリンク")
</div>

現在のアカウントに関連付けられている特定の Custom Audience を取得します。

**Resource URL[](#resource-url "この見出しへのパーマリンク")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id`

**Parameters[](#parameters "この見出しへのパーマリンク")**

| Name                                         | Description                                                                                                                                                                                                                       |
| :------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*             | 利用するアカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで一般的に必須となるパラメータです。指定したアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom&#95;audience&#95;id  <br />*required* | リクエスト内で操作対象となる Custom Audience への参照です。<br /><br />Type: string<br /><br />Example: `2906h`                                                                                                                                        |
| with&#95;deleted  <br />*optional*           | リクエストで削除済みの結果を含めるかどうかを指定します。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false`                                                                                                         |

**Example Request[](#example-request "この見出しへのパーマリンク")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h`

**Example Response[](#example-response "この見出しへのパーマリンク")**

```
    {
      "request": {
        "params": {
          "custom_audience_id": "2906h",
          "account_id": "18ce54d4x5t"
        }
      },
      "data": {
        "targetable": false,
        "name": "developers",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "owner_account_id": "18ce54d4x5t",
        "id": "2906h",
        "reasons_not_targetable": [],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-22T23:34:26Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": 140321
      }
    }
```

<div id="post-accountsaccount_idcustom_audiences">
  #### POST accounts/:account&#95;id/custom&#95;audiences[](#post-accounts-account-id-custom-audiences "Permalink to this headline")
</div>

現在のアカウントに関連付けられた新しいプレースホルダー Custom Audience を作成します。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences`

**Parameters[](#parameters "Permalink to this headline")**

| Name                             | Description                                                                                                                                                                                                                        |
| :------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required* | 利用対象のアカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常必須となるパラメータです。指定されたアカウントは、認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| name  <br />*required*           | このオーディエンスの表示名です。一意の name 値（名前）を指定する必要があります。そうしない場合はエラーになります。<br /><br />Type: string<br /><br />Example: `ads api users`                                                                                                           |
| description  <br />*optional*    | このオーディエンスの説明です。<br /><br />Type: string<br /><br />Example: `Ads API の全ユーザーの集合`                                                                                                                                                    |

**Example Request[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences?name=developers`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "developers",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "owner_account_id": "18ce54d4x5t",
        "id": "2906h",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-22T23:34:26Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": null
      },
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "name": "developers"
        }
      }
    }
```

<div id="put-accountsaccount_idcustom_audiencescustom_audience_id">
  #### PUT accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id[](#put-accounts-account-id-custom-audiences-custom-audience-id "Permalink to this headline")
</div>

現在のアカウントに関連付けられている特定の Custom Audience を更新します。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                         | Description                                                                                                                                                                                                                       |
| :------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*             | 利用対象となるアカウントの識別子です。リソースパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常必須のパラメータです。指定されたアカウントは、認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom&#95;audience&#95;id  <br />*required* | リクエスト内で操作対象となる Custom Audience への参照です。<br /><br />Type: string<br /><br />Example: `2906h`                                                                                                                                        |
| name  <br />*optional*                       | このオーディエンスの表示名です。name の値は一意である必要があります。そうでない場合はエラーになります。<br /><br />Type: string<br /><br />Example: `ads api users`                                                                                                                |
| description  <br />*optional*                | このオーディエンスの説明です。<br /><br />Type: string<br /><br />Example: `Collection of all users of the Ads API`                                                                                                                              |

**Example Request[](#example-request "Permalink to this headline")**

`PUT https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h?name=developers_changed`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "developers_changed",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "is_owner": true,
        "id": "2906h",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-22T23:34:26Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": null
      },
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "name": "developers_changed"
        }
      }
    }
```

<div id="post-batchaccountsaccount_idcustom_audiences">
  #### POST batch/accounts/:account&#95;id/custom&#95;audiences[](#post-batch-accounts-account-id-custom-audiences "Permalink to this headline")
</div>

Custom Audience をバッチで作成できます。オーディエンスに関する情報は [Custom Audiences Overview](/ja/x-ads-api/audiences) ページを参照してください。

**注:** このバッチエンドポイントは現在 **クローズドベータ** で、一部の広告主のみが利用できます。このベータ期間中は、モバイルカスタムオーディエンスをベースにした Flexible Audience のみ作成できます。

**バッチリクエスト**

* 現在の最大バッチサイズは 10 です。
* すべてのパラメータはリクエストボディで送信され、`Content-Type` として `application/json` が必須です。
* バッチリクエストはグループとして一括して成功または失敗し、エラー・成功いずれの場合でも、すべての API レスポンスで最初のリクエストのアイテム順序が保持されます。

**バッチレスポンス**

バッチ API レスポンスは順序付きコレクションとしてアイテムを返します。それ以外は、対応する単一アイテムエンドポイントと構造的に同一です。

**バッチエラー**

* リクエストレベルのエラー（例: 最大バッチサイズ超過）は、レスポンス内の `errors` オブジェクトに表示されます。
* アイテムレベルのエラー（例: 必須パラメータの欠落）は、レスポンス内の `operation_errors` オブジェクトに表示されます。

**Flexible Audiences**

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  Postman で実行
</Button>

* Flexible Audience は一度作成すると変更できません。
* Custom Audience は、Flexible Audience を作成するために、ブール論理の組み合わせを持つツリー構造で指定します。
* Flexible Audience の作成に使用できる Custom Audience のリーフノードは最大 10 個です。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/batch/accounts/:account_id/custom_audiences`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                                   | Description                                                                                                                                                                                                                           |
| :----------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| account&#95;id  <br />*required*                       | 利用するアカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常は必須パラメータです。指定されたアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t`        |
| audience&#95;type  <br />*required*                    | 作成するオーディエンスの種類です。<br /><br />Type: enum<br /><br />Possible values: `FLEXIBLE`, `MOBILE_AUDIENCE`                                                                                                                                     |
| child&#95;segments  <br />*required*                   | ターゲットにしたい Custom Audience メンバーのサブセットを定義するオブジェクトを含む配列です。各オブジェクトには `custom_audience_id`、`frequency`、`frequency_comparator`、`lookback_window`、`negate`、および場合によっては追加の `child_segments` を含める必要があります。<br /><br />Type: array                |
| name  <br />*required*                                 | オーディエンスの表示名です。name には一意の値を使用する必要があります。満たさない場合はエラーになります。<br /><br />Type: string<br /><br />Example: `my_flexible_audience_name`                                                                                                       |
| operation&#95;type  <br />*required*                   | 各アイテムに対して実行される操作タイプです。<br /><br />Type: enum<br /><br />Possible values: `Create`, `Update`, `Delete`                                                                                                                                 |
| boolean&#95;operator  <br />*sometimes required*       | 親（包含する）オブジェクト内における子セグメント同士の論理関係です。親オブジェクトに対して child&#95;segments が空でない場合に必須です。<br /><br />Type: enum<br /><br />Possible values: `AND`, `OR`                                                                                          |
| lookback&#95;window  <br />*sometimes required*        | ユーザーが特定のアクションを実行し、指定された custom audience の条件を満たした日数の範囲（期間）を指定する整数値です。<br /><br />Type: int<br /><br />Possible values: `1`, `7`, `14`, `30`                                                                                            |
| segments  <br />*sometimes required*                   | ターゲットにしたい Custom Audience メンバーのサブセットを定義する `boolean_operator` と `child_segments` を含むオブジェクトです。<br /><br />Type: object                                                                                                                  |
| custom&#95;audience&#95;id  <br />*sometimes required* | 子セグメントとして使用する custom audience の id です。<br /><br />Type: string<br /><br />Example: `tyfo`                                                                                                                                             |
| frequency  <br />*optional*                            | ユーザーが特定のアクションを実行し、指定された custom audience の条件を満たした頻度を、lookback window 内で指定する整数値です。<br /><br />Type: int<br /><br />Default value: `1`                                                                                                   |
| frequency&#95;comparator  <br />*optional*             | リクエストで渡された `frequency` に対する比較演算子です。<br /><br />**Note**: 以下の値において、`GTE` は「以上」、`LT` は「未満」を表し、その他も同様です。<br /><br />Type: string<br /><br />Possible values: `NUM_GTE`, `NUM_GT`, `NUM_EQ`, `NUM_LTE`, `NUM_LT` Default value: `NUM_GTE` |
| negate  <br />*optional*                               | セグメントを否定し、そのセグメントを組み合わせから除外します。<br /><br />Type: boolean<br /><br />Default value: `true`  <br />Possible values: `true`, `false`                                                                                                     |

**Example Request[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/12/batch/accounts/18ce54d4x5t/custom_audiences`

```
    [
      {
        "operation_type":"Create",
        "params":{
          "name":"my_flexible_audience_name",
          "audience_type":"FLEXIBLE",
          "segments":{
            "boolean_operator":"AND",
            "child_segments":[
              {
                "custom_audience_id":"TYIF",
                "frequency":1,
                "frequency_comparator":"NUM_GT",
                "lookback_window":30,
                "negate":true,
                "child_segments":[

                ]
              },
              {
                "boolean_operator":"OR",
                "child_segments":[
                  {
                    "custom_audience_id":"TXR1",
                    "lookback_window":30,
                    "child_segments":[

                    ]
                  },
                  {
                    "custom_audience_id":"TYFO",
                    "frequency":1,
                    "frequency_comparator":"NUM_GT",
                    "lookback_window":30,
                    "negate":true,
                    "child_segments":[

                    ]
                  }
                ]
              }
            ]
          }
        }
      }
    ]
```

**レスポンス例[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "my_flexible_audience_name",
        "targetable_types": [
          "FLEXIBLE",
          "EXCLUDED_FLEXIBLE"
        ],
        "audience_type": "FLEXIBLE",
        "id": "13ld7",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "metadata": [
          {
            "custom_audience_id": "13ld7",
            "account_id": "qsx3w2",
            "name": "my_flexible_audience_name",
            "audience_source": "FLEXIBLE_AUDIENCE",
            "upload_status": "UPLOADED",
            "segments": {
              "boolean_operator": "AND",
              "frequency": 1,
              "frequency_comparator": "NUM_GTE",
              "negate": false,
              "child_segments": [
                {
                  "custom_audience_id": "tyif",
                  "lookback_window": 30,
                  "frequency": 1,
                  "frequency_comparator": "NUM_GT",
                  "negate": true,
                  "child_segments": [

                  ]
                },
                {
                  "boolean_operator": "OR",
                  "frequency": 1,
                  "frequency_comparator": "NUM_GTE",
                  "negate": false,
                  "child_segments": [
                    {
                      "custom_audience_id": "txr1",
                      "lookback_window": 30,
                      "frequency": 1,
                      "frequency_comparator": "NUM_GTE",
                      "negate": false,
                      "child_segments": [

                      ]
                    },
                    {
                      "custom_audience_id": "tyfo",
                      "lookback_window": 30,
                      "frequency": 1,
                      "frequency_comparator": "NUM_GT",
                      "negate": true,
                      "child_segments": [

                      ]
                    }
                  ]
                }
              ]
            }
          }
        ],
        "created_at": "2015-11-10T21:26:43Z",
        "updated_at": "2015-11-11T01:11:47Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": null
      },
      "request": [
        {
          "params": {
            "name": "my_flexible_audience_name",
            "audience_type": "FLEXIBLE",
            "segments": {
              "boolean_operator": "AND",
              "child_segments": [
                {
                  "custom_audience_id": "TYIF",
                  "lookback_window": 30,
                  "frequency": 1,
                  "frequency_comparator": "NUM_GT",
                  "negate": true,
                  "child_segments": [

                  ]
                },
                {
                  "boolean_operator": "OR",
                  "child_segments": [
                    {
                      "custom_audience_id": "TXR1",
                      "lookback_window": 30,
                      "child_segments": [

                      ]
                    },
                    {
                      "custom_audience_id": "TYFO",
                      "lookback_window": 30,
                      "frequency": 1,
                      "frequency_comparator": "NUM_GT",
                      "negate": true,
                      "child_segments": [

                      ]
                    }
                  ]
                }
              ]
            },
            "account_id": "qsx3w2"
          },
          "operation_type": "Create"
        }
      ]
    }
```

<div id="delete-accountsaccount_idcustom_audiencescustom_audience_id">
  #### DELETE accounts/:account&#95;id/custom&#95;audiences/:custom&#95;audience&#95;id[](#delete-accounts-account-id-custom-audiences-custom-audience-id "Permalink to this headline")
</div>

現在のアカウントに属する、指定された Custom Audience を削除します。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id`

**Parameters[](#parameters "Permalink to this headline")**

| Name                                         | Description                                                                                                                                                                                                                      |
| :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*             | 対象となるアカウントの識別子です。リソースのパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで通常必須のパラメータです。指定されたアカウントは、認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom&#95;audience&#95;id  <br />*required* | リクエストで操作対象となる Custom Audience への参照です。<br /><br />Type: string<br /><br />Example: `2906h`                                                                                                                                        |

**Example Request[](#example-request "Permalink to this headline")**

`DELETE https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "developers",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "owner_account_id": "18ce54d4x5t",
        "id": "2906h",
        "reasons_not_targetable": [
          "TOO_SMALL"
        ],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-30T18:09:00Z",
        "partner_source": "OTHER",
        "deleted": true,
        "audience_size": null
      },
      "request": {
        "params": {
          "custom_audience_id": "2906h",
          "account_id": "18ce54d4x5t"
        }
      }
    }
```

<div id="do-not-reach-lists">
  ### 配信除外リスト
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  Postman で実行
</Button>

<div id="get-accountsaccount_iddo_not_reach_lists">
  #### GET accounts/:account&#95;id/do&#95;not&#95;reach&#95;lists[](#get-accounts-account-id-do-not-reach-lists "Permalink to this headline")
</div>

現在のアカウントに関連付けられている一部またはすべての Do Not Reach List の詳細を取得します。

**Note**: `account_id` には Do Not Reach List を最大 1 つしか関連付けることはできません。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/do_not_reach_lists`

**Parameters[](#parameters "Permalink to this headline")**

| Name                               | Description                                                                                                                                                                                                                  |
| :--------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required*   | 利用対象アカウントの識別子。リソースのパス内に現れ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで一般的に必須パラメータです。指定されたアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| with&#95;deleted  <br />*optional* | 削除済みの結果をレスポンスに含めるかどうかを指定します。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false`                                                                                                    |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54bgxky/do_not_reach_lists`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54bgxky"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "targetable": false,
          "name": "Do Not Reach List",
          "description": "test DNRL",
          "id": "4kzrq",
          "reasons_not_targetable": [
            "TOO_SMALL"
          ],
          "created_at": "2021-10-28T22:09:29Z",
          "list_size": null,
          "updated_at": "2021-11-04T03:33:06Z",
          "deleted": false
        }
      ]
    }
```

<div id="post-accountsaccount_iddo_not_reach_lists">
  #### POST accounts/:account&#95;id/do&#95;not&#95;reach&#95;lists[](#post-accounts-account-id-do-not-reach-lists "Permalink to this headline")
</div>

現在のアカウントに紐づく新しい Do Not Reach List を作成します。

**注**: `account_id` ごとに作成できる Do Not Reach List は最大 1 つまでです。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/do_not_reach_lists`

**Parameters[](#parameters "Permalink to this headline")**

| Name                             | Description                                                                                                                                                                                                                 |
| :------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| account&#95;id  <br />*required* | 利用するアカウントの識別子です。リソースパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くほとんどの Advertiser API リクエストで必須のパラメータです。指定されたアカウントは、認証されたユーザーに紐づいている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| description  <br />*optional*    | このオーディエンスの説明を指定します。<br /><br />Type: string<br /><br />Example: `A list of users to exclude`                                                                                                                                |

**Example Request[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/12/accounts/18ce54bgxky/do_not_reach_lists?description=A list of users to exclude`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "description": "A list of users to exclude",
          "account_id": "18ce54bgxky"
        }
      },
      "data": {
        "targetable": false,
        "name": "Do Not Reach List",
        "description": "A list of users to exclude",
        "id": "4ofrq",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2022-02-08T23:02:48Z",
        "list_size": null,
        "updated_at": "2022-02-08T23:02:48Z",
        "deleted": false
      }
    }
```

<div id="post-batchaccountsaccount_iddo_not_reach_listsdo_not_reach_list_idusers">
  #### POST batch/accounts/:account&#95;id/do&#95;not&#95;reach&#95;lists/:do&#95;not&#95;reach&#95;list&#95;id/users[](#post-batch-accounts-account-id-do-not-reach-lists-do-not-reach-list-id-users "Permalink to this headline")
</div>

このエンドポイントでは、指定された `do_not_reach_list_id` に対してユーザーを追加、更新、および削除することができます。このエンドポイントは、有効なユーザー識別子の種類としてメールアドレスのみを受け付けます。

リクエストの `emails` フィールドで提供されるすべてのデータは、`SHA256` を使用してハッシュ化し、[正規化](/ja/x-ads-api/audiences#e-mail-normalization)しておく必要があります。

**注意事項**

* `account_id` ごとに保持できる Do Not Reach List は最大で 1 つのみです
* このリストに追加されるユーザーには、現在のタイムスタンプから 13 か月未満となる `expires_at` タイムスタンプが **必ず** 設定されている必要があります
* Do Not Reach List API は `effective_at` タイムスタンプを受け付けず、デフォルトで現在のタイムスタンプが使用されます
* Do Not Reach List は、アカウント内の任意またはすべてのカスタムオーディエンスからユーザーを削除するものではなく、そのアカウントのすべてのキャンペーンに対する除外ターゲティングとして機能します

**バッチリクエスト**

* このエンドポイントにおける現在の最大バッチサイズは `2500` です。バッチサイズは、リクエストごとの操作数（`Update` / `Delete`）によって決まります。例えば、1 つの配列内に 2500 を超える操作オブジェクト（`{"operation_type": "Update/Delete", [..] }`）があるとエラーになります。
* このエンドポイントが受け付け可能な POST リクエストボディのサイズの最大値は `5,000,000` バイトです。
* このエンドポイントのレート制限は、1 分あたり 1500 件です。
* すべてのパラメータはリクエストボディで送信され、`Content-Type` として `application/json` が必須です。
* バッチリクエストは、グループとしてまとめて失敗または成功し、エラーと成功の両方の API レスポンスにおいて、最初のリクエストの項目順序が保持されます。

**バッチレスポンス**

Ads API によって返されるレスポンスには、`success_count` と `total_count` の 2 つのフィールドが含まれます。これらの値は常に等しくなければならず、バックエンドで処理されたリクエスト内のレコード数を示します。リクエストボディで送信されたレコード数が `success_count` および `total_count` と **一致しない** 状況はエラー状態として扱い、再試行が必要です。

**バッチエラー**

* リクエストレベルのエラー（例: 最大バッチサイズ超過）はレスポンスの `errors` オブジェクト内に表示されます。
* アイテムレベルのエラー（例: 必須パラメータの不足）はレスポンスの `operation_errors` オブジェクト内に表示されます。
* `operation_errors` 内のエラーのインデックスは、入力アイテム内でのインデックスを指し、対応するエラーメッセージが含まれます。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/batch/accounts/:account_id/do_not_reach_lists/:do_not_reach_list_id/users`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account&#95;id  <br />*required* | 対象のアカウントの識別子です。リソースパス内に含まれ、[GET accounts](/ja/x-ads-api/campaign-management#accounts) を除くすべての Advertiser API リクエストで一般的に必須パラメータです。指定されたアカウントは認証済みユーザーに関連付けられている必要があります。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| do&#95;not&#95;reach&#95;list&#95;id  <br />*required* | リクエストで操作対象となる Do Not Reach List への参照です<br /><br />Type: string<br /><br />Example: `2906h` |
| operation&#95;type  <br />*required* | 実行される、`users` グループごとの操作タイプです。<br /><br />Type: enum<br /><br />Possible values: `Update`, `Delete` |
| params  <br />*required* | `emails` 配列と `expires_at` タイムスタンプを含む JSON オブジェクトです。<br /><br />Type: JSON |
| users  <br />*required* | 個々のユーザーに関するすべての params を含む JSON オブジェクトの配列です。<br /><br />Type: JSON |
| expires&#95;at  <br />*optional* | ユーザーの関連付けが失効する UTC 時刻です。指定された時刻は現在のタイムスタンプより後である必要があります。[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) で表現されます。デフォルトは現在のタイムスタンプから 13 か月後です。<br /><br />Type: string<br /><br />Example: `2017-07-05T07:00:00Z` |

`users` オブジェクトに対するマルチキーアプローチに基づき、このオブジェクトの各要素は以下のとおり文書化されています。

| Name                               | 説明                                       |
| :--------------------------------- | :--------------------------------------- |
| email  <br />*optional*            | ユーザーのメールアドレス<br /><br />型: Array[String] |
| phone&#95;number  <br />*optional* | ユーザーの電話番号<br /><br />型: Array[String]    |

**リクエスト例[](#example-request "この見出しへのパーマリンク")**

```
`POST https://ads-api.x.com/12/batch/accounts/18ce54bgxky/do_not_reach_lists/4kzro/users`

    [
      {
        "operation_type": "Update",
        "params": {
          "expires_at": "2023-01-22T00:00:00Z",
          "users": [
            {
              "email": [
                "FEAD76F6ADF99FFFB997AA4E3C8AD38FF531BC4C956DBD03CD0163F744D8AABC"
              ],
              "phone_number": [
                "CCABF1B62A202E0FE28BC6C014983C89A65451DD4482BD66A0ADB65366F38A9A"
              ]
            },
            {
              "email": [
                "FEAD76F6ADF99FFFB997AA4E3C8AD38FF531BC4C956DBD03CD0163F744D8AABA"
              ],
              "phone_number": [
                "CCABF1B62A202E0FE28BC6C014983C89A65451DD4482BD66A0ADB65366F38A9E"
              ]
            }
          ]
        }
      }
    ]
```

**レスポンス例[](#example-response "Permalink to this headline")**

```
    {
      "data": [
        {
          "success_count": 2,
          "total_count": 2
        }
      ],
      "request": [
        {
          "params": {
            "do_not_reach_list_id": "4ofrq",
            "expires_at": "2023-01-22T00:00:00Z",
            "account_id": "18ce54bgxky"
          },
          "operation_type": "Update"
        }
      ]
    }
```

<div id="delete-accountsaccount_iddo_not_reach_listsdo_not_reach_list_id">
  #### DELETE accounts/:account&#95;id/do&#95;not&#95;reach&#95;lists/:do&#95;not&#95;reach&#95;list&#95;id[](#delete-accounts-account-id-do-not-reach-lists-do-not-reach-list-id "この見出しへのパーマリンク")
</div>

現在のアカウントに属する指定された Do Not Reach リストを削除します。

**Resource URL[](#resource-url "この見出しへのパーマリンク")**

`https://ads-api.x.com/12/accounts/:account_id/do_not_reach_lists/:do_not_reach_list_id`

**Parameters[](#parameters "この見出しへのパーマリンク")**

なし

**Example Request[](#example-request "この見出しへのパーマリンク")**

`DELETE https://ads-api.x.com/12/accounts/18ce54bgxky/do_not_reach_lists/4ofrp`

**Example Response[](#example-response "この見出しへのパーマリンク")**

```
    {
      "request": {
        "params": {
          "do_not_reach_list_id": "4ofrp",
          "account_id": "18ce54bgxky"
        }
      },
      "data": {
        "targetable": false,
        "name": "Do Not Reach List",
        "description": null,
        "id": "4ofrp",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2022-02-08T23:02:07Z",
        "list_size": null,
        "updated_at": "2022-02-08T23:02:21Z",
        "deleted": true
      }
    }
```
