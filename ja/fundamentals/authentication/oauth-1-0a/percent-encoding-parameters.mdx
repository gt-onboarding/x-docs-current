---
title: パーセントエンコードされたパラメータ
sidebarTitle: パーセントエンコードされたパラメータ
keywords: ["パーセントエンコーディング", "URL エンコーディング", "OAuth エンコーディング", "パラメータエンコーディング", "URL エンコード", "OAuth 1.0a エンコーディング"]
---

import { Button } from "/snippets/ja/button.mdx";


<div id="percent-encoding-parameters">
  ### パーセントエンコードのパラメータ
</div>

X API の一部の機能、特に OAuth シグネチャを扱う部分では、文字列を [RFC 3986, Section 2.1](http://tools.ietf.org/html/rfc3986#section-2.1) に従ってエンコードする必要があります。URL エンコードアルゴリズムの多くの実装は RFC 3986 と完全には互換性がないため、不適切なエンコードが多くの OAuth シグネチャエラーの原因となっています。そのため、このページでは使用すべき正確な署名アルゴリズムについて説明します。

このページでは、[RFC 3986, Section 2.1](http://tools.ietf.org/html/rfc3986#section-2.1) で説明されている URL エンコード処理について解説します。あいまいな点や本ドキュメントと矛盾する点がある場合には、その仕様書を参照することを推奨します。
 

<div id="encoding-a-string">
  #### 文字列のエンコード
</div>

次のアルゴリズムでは、文字列 SRC を、内容を 1 バイトずつコピーして文字列 DST にエンコードすることを前提としています。

**ステップ 1: SRC に未読バイトが含まれている間、SRC から次のバイト（8 ビット）を読み取ります。** 通常これは 1 文字と見なされますが、UTF-8 のように 1 文字が複数バイトになり得るエンコーディングの場合でも、最初の 1 バイトだけを読み取ります。

**ステップ 2: 読み取ったバイトが、次の ASCII 文字のいずれかに一致するかを確認します。** 次の表は可読性のために行ごとに分割されていますが、判定としては、そのバイトが表全体のどこかに含まれているかどうかだけを確認すればよく、特定の行を識別する必要はありません。

| Name | ASCII characters | Equivalent byte values |
| :--- | :--- | :--- |
| Digits | ‘0’, ‘1’, ‘2’, ‘3’, ‘4’, ‘5’, ‘6’, ‘7’, ‘8’, ‘9’ | 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39 |
| Uppercase letters | ‘A’, ‘B’, ‘C’, ‘D’, ‘E’, ‘F’, ‘G’, ‘H’, ‘I’, ‘J’, ‘K’, ‘L’, ‘M’, ‘N’, ‘O’, ‘P’, ‘Q’, ‘R’, ‘S’, ‘T’, ‘U’, ‘V’, ‘W’, ‘X’, ‘Y’, ‘Z’ | 0x41, 0x42, 0x43, 0x44, 0x45,0x46, 0x47, 0x48, 0x49, 0x4A, 0x4B,0x4C, 0x4D, 0x4E, 0x4F, 0x50, 0x51,0x52, 0x53, 0x54, 0x55, 0x56, 0x57,0x58, 0x59, 0x5A |
| Lowercase letters | ‘a’, ‘b’, ‘c’, ‘d’, ‘e’, ‘f’, ‘g’, ‘h’, ‘i’, ‘j’, ‘k’, ‘l’, ‘m’, ‘n’, ‘o’, ‘p’, ‘q’, ‘r’, ‘s’, ‘t’, ‘u’, ‘v’, ‘w’, ‘x’, ‘y’, ‘z’ | 0x61, 0x62, 0x63, 0x64, 0x65,0x66, 0x67, 0x68, 0x69, 0x6A, 0x6B,0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71,0x72, 0x73, 0x74, 0x75, 0x76, 0x77,0x78, 0x79, 0x7A |
| Reserved characters | ‘-‘, ‘.’, ‘_’, ‘~’ | 0x2D, 0x2E, 0x5F, 0x7E |

**ステップ 2b: バイトが上の表に含まれていない場合は、続行します。** それ以外の値はすべてエンコードする必要があります。 **ステップ 2a: バイトが上の表に含まれている場合は、そのバイトを DST にコピーし、ステップ 1 に戻ります。** 上の表に含まれている文字はエスケープする必要がないため、そのバイトをそのままコピーします。

**ステップ 3: 文字 ‘%’ を DST に書き込みます。** パーセント文字 ‘%’（16 進数で 0x25、2 進数で 00100101）は、この次の 2 文字がエンコードされた 1 バイトを表すことを示します。

**ステップ 4: 現在のバイトの 16 進数値（大文字の ASCII 文字による表現）を表す 2 文字を DST に書き込みます。** これは少し分かりにくいので、例を示します。現在のバイトが 0xE6（2 進数で 11100110）であるとします。これは UTF-8 でエンコードされた ‘æ’ に対応します。この値をエンコードするには、文字 ‘E’（上の表の 0x45）を書き、その後に文字 ‘6’（0x36）を DST に書き込みます。直近で書き込まれた 3 文字は “%E6” になっているはずです。A、B、C、D、E、F のような文字を書く場合は、大文字を使用する必要があることに注意してください。

**ステップ 5: ステップ 1 に戻ります。** SRC 全体が DST にコピーされるまで繰り返します。
 

<div id="examples">
  #### 例
</div>

以下の例は、ご自身のコードの出力と比較する際に役立ちます。出力が異なる場合は、エラーと見なすべきです。スペースを「+」文字としてエンコードするのは、誤ったエンコードの一例です。

| 元の文字列 | エンコード後の文字列 |
| :--- | :--- |
| Ladies + Gentlemen | Ladies%20%2B%20Gentlemen |
| An encoded string! | An%20encoded%20string%21 |
| Dogs, Cats & Mice | Dogs%2C%20Cats%20%26%20Mice |
| ☃   | %E2%98%83 |