---
title: Xでログイン
keywords: ["Xでログイン", "Xでサインイン", "Xログイン", "OAuthログイン", "ソーシャルログイン", "X認証", "ログイン連携"]
---

import { Button } from "/snippets/ja/button.mdx";

Log in with X（Sign in with X とも呼ばれます）を利用すると、サイトやアプリケーションにボタンを設置でき、X ユーザーはクリック 1 回で登録ユーザーアカウントと同等の利点を利用できるようになります。これは Web サイト、iOS、モバイル、およびデスクトップアプリケーションで動作します。

<div id="features">
  ## 機能
</div>

* 使いやすさ - サイトへの新規訪問者は、初めてログインする際にボタンを2回クリックするだけでログインできます。
* X との統合 - Log in with X フローにより、ユーザーに代わって X API を利用するための権限を付与できます。
* OAuth ベース - 豊富なクライアントライブラリとサンプルコードが Log in with X API に対応しています。

<div id="available-for">
  ## 利用可能な環境
</div>

* ブラウザ - ユーザーがブラウザにアクセスできる場合は、Log in with X を組み込むことができます。詳しくは、ブラウザでのサインインフローをご覧ください。
* モバイルデバイス - インターネットに接続可能なあらゆるモバイルデバイスで Log in with X を利用できます。詳しくは、モバイルでのサインインフローをご覧ください。

<div id="implementing-log-in-with-x">
  ## Log in with X の実装
</div>

ブラウザーおよびモバイル Web における Log in with X の実装は、OAuth に基づいています。このページでは、サインインフロー用のアクセストークンを取得するために必要なリクエストについて説明します。

「Log in with X」フローを使用するには、[X アプリ設定](/ja/resources/fundamentals/developer-apps) に移動し、*Allow this app to be used to Sign in with X?* オプションが有効になっていることを確認してください。

このページでは、読者が OAuth 1.0a プロトコルを使ってリクエストに署名する方法を理解していることを前提としています。リクエストへの署名方法を知りたい場合は、[Authorizing a request](/ja/resources/fundamentals/authentication/oauth-1-0a/authorizing-a-request) ページを参照してください。

このページ内のリクエスト署名を検証したい場合は、使用している consumer secret は次のとおりです。L8qq9PZyRg6ieKGEKhZolGC0vJWLw8iEJ88DRdyOg。この値はテスト目的のものであり、実際のリクエストでは使用できません。

Log in with X の実装は、リクエストトークンの取得、ユーザーのリダイレクト、およびリクエストトークンをアクセストークンに変換するという 3 つのステップから成ります。

<Tabs>
  <Tab title="手順 1">
    ### ステップ 1: リクエストトークンの取得

    サインインフローを開始するには、[X アプリ](/ja/resources/fundamentals/developer-apps) から署名付きメッセージを [POST oauth/request&#95;token](/ja/resources/fundamentals/authentication/api-reference#post-oauth-request-token) に送信し、リクエストトークンを取得する必要があります。このリクエストで一意のパラメータは oauth&#95;callback のみであり、ステップ 2 の完了時にユーザーをリダイレクトしたい先の URL を URL エンコードした値である必要があります。残りのパラメータは、OAuth の署名プロセスによって追加されます。

    <Note>
      **Note:** [POST oauth/request&#95;token](/ja/resources/fundamentals/authentication/api-reference#post-oauth-request-token) エンドポイントで使用する任意の [callback URL](/ja/resources/fundamentals/developer-apps#callback-urls) は、[developer portal](/ja/resources/fundamentals/developer-portal) 内の [X アプリ設定](/ja/resources/fundamentals/developer-apps) に登録しておく必要があります。
    </Note>

    <Frame>
      <img src="/images/auth-4.png.twimg.1920.png" alt="" />
    </Frame>

    **リクエスト例（Authorization ヘッダーは折り返して表示しています）:**

    ```
    POST /oauth/request_token HTTP/1.1
    User-Agent: themattharris' HTTP Client
    Host: api.x.com
    Accept: */*
    Authorization:
            OAuth oauth_callback="http%3A%2F%2Flocalhost%2Fsign-in-with-twitter%2F",
                  oauth_consumer_key="cChZNFj6T5R0TigYB9yd1w",
                  oauth_nonce="ea9ec8429b68d6b77cd5600adbbb0456",
                  oauth_signature="F1Li3tvehgcraF8DMJ7OyxO4w9Y%3D",
                  oauth_signature_method="HMAC-SHA1",
                  oauth_timestamp="1318467427",
                  oauth_version="1.0"
    ```

    アプリではレスポンスの HTTP ステータスを確認してください。200 以外の値は失敗を示します。レスポンスボディには、`oauth&#95;token`、`oauth&#95;token&#95;secret`、`oauth&#95;callback&#95;confirmed` パラメータが含まれます。アプリは `oauth&#95;callback&#95;confirmed` が `true` であることを検証し、残り 2 つの値を次の手順で使用するために保存しておいてください。

    **レスポンス例（レスポンスボディは折り返して表示しています）:**

    ```
    HTTP/1.1 200 OK
    Date: Thu, 13 Oct 2011 00:57:06 GMT
    Status: 200 OK
    Content-Type: text/html; charset=utf-8
    Content-Length: 146
    Pragma: no-cache
    Expires: Tue, 31 Mar 1981 05:00:00 GMT
    Cache-Control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0
    Vary: Accept-Encoding
    Server: tfe

    oauth_token=NPcudxy0yU5T3tBzho7iCotZ3cnetKwcTIRlX0iwRl0&
    oauth_token_secret=veNRnAWe6inFuo8o2u8SLLZLjolYDmDP7SzL0YfYI&
    oauth_callback_confirmed=true

    ```
  </Tab>

  <Tab title="ステップ 2">
    ### ステップ 2: ユーザーのリダイレクト

    次のステップでは、ユーザーを X に誘導し、後述の「ブラウザでのサインインフロー」で説明される適切なフローを完了してもらいます。ユーザーを [GET oauth/authenticate](/ja/resources/fundamentals/authentication/api-reference#get-oauth-authenticate) に誘導し、ステップ 1 で取得したリクエストトークンを `oauth_token` パラメータとして渡します。

    ウェブサイトでこれを最もシームレスに実装する方法は、元の「サインイン」リクエストに対するレスポンスとして HTTP 302 リダイレクトを発行することです。モバイルおよびデスクトップアプリは、新しいブラウザウィンドウを開くか、埋め込み Web ビュー経由でその URL に遷移させてください。

    **リダイレクト先 URL の例:**

    [https://api.x.com/oauth/authenticate?oauth&#95;token=NPcudxy0yU5T3tBzho7iCotZ3cnetKwcTIRlX0iwRl0](https://api.x.com/oauth/authenticate?oauth_token=NPcudxy0yU5T3tBzho7iCotZ3cnetKwcTIRlX0iwRl0)

    サインインエンドポイントの挙動は、ユーザーの状態に応じて次の 3 通りのいずれかになります。

    1. **サインイン済みかつ承認済み**: ユーザーが x.com にサインインしており、すでに呼び出し元アプリケーションを承認している場合、ユーザーは即座に認証され、有効な OAuth リクエストトークンとともにコールバック URL に戻されます。x.com へのリダイレクトはユーザーにはほとんど気付かれません。
    2. **サインイン済みだが未承認**: ユーザーが x.com にサインインしているものの、呼び出し元アプリケーションを承認していない場合、呼び出し元アプリケーションとアクセスを共有するよう求める画面が表示されます。認可リクエストを承諾すると、ユーザーは有効な OAuth リクエストトークンとともにコールバック URL にリダイレクトされます。
    3. **サインインしていない**: ユーザーが x.com にサインインしていない場合、同じ画面上で認証情報の入力と、アプリケーションがユーザーの情報へアクセスすることへの許可を求められます。サインインが完了すると、ユーザーは有効な OAuth リクエストトークンとともにコールバック URL に戻されます。

    認証が成功すると、`callback_url` に対し、`oauth_token` と `oauth_verifier` パラメータを含むリクエストが送信されます。アプリケーション側では、このトークンがステップ 1 で受け取ったリクエストトークンと一致することを確認する必要があります。

    **クライアントからのリダイレクトによるリクエスト（クエリ文字列パラメータを括弧で囲んで表記）:**

    ```
    GET /sign-in-with-twitter/?
            oauth_token=NPcudxy0yU5T3tBzho7iCotZ3cnetKwcTIRlX0iwRl0&
            oauth_verifier=uw7NjWHT6OJ1MpJOXsHfNxoAhPKpgI8BlYDhxEjIBY HTTP/1.1
    Host: localhost
    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/535.5 (KHTML, like Gecko) Chrome/16.0.891.1 Safari/535.5
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    Referer: http://localhost/sign-in-with-twitter/
    Accept-Encoding: gzip,deflate,sdch
    Accept-Language: en-US,en;q=0.8
    Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
    ```
  </Tab>

  <Tab title="手順 3">
    ### ステップ 3: リクエストトークンをアクセストークンに変換する

    リクエストトークンを有効なアクセストークンに変換するには、アプリケーションから [POST oauth/access&#95;token](/ja/resources/fundamentals/authentication/api-reference#post-oauth-access-token) エンドポイントに、ステップ 2 で取得した oauth&#95;verifier の値を含めてリクエストを送信する必要があります。リクエストトークンはヘッダー内の oauth&#95;token 部分にも渡されますが、これは署名プロセスによって自動的に追加されます。

    **リクエスト例（Authorization ヘッダーは折り返して表示）：**

    ```
    POST /oauth/access_token HTTP/1.1
    User-Agent: themattharris' HTTP Client
    Host: api.x.com
    Accept: */*
    Authorization: OAuth oauth_consumer_key="cChZNFj6T5R0TigYB9yd1w",
                          oauth_nonce="a9900fe68e2573b27a37f10fbad6a755",
                          oauth_signature="39cipBtIOHEEnybAR4sATQTpl2I%3D",
                          oauth_signature_method="HMAC-SHA1",
                          oauth_timestamp="1318467427",
                          oauth_token="NPcudxy0yU5T3tBzho7iCotZ3cnetKwcTIRlX0iwRl0",
                          oauth_version="1.0"
    Content-Length: 57
    Content-Type: application/x-www-form-urlencoded

    oauth_verifier=uw7NjWHT6OJ1MpJOXsHfNxoAhPKpgI8BlYDhxEjIBY
    ```

    成功したレスポンスには、oauth&#95;token、oauth&#95;token&#95;secret パラメーターが含まれます。トークンとトークンシークレットは保存しておき、今後の X API への認証リクエストに使用する必要があります。ユーザーを特定するには、[GET account/verify&#95;credentials](https://dev.x.com/rest/reference/get/account/verify_credentials) を使用します。

    **レスポンス例（レスポンスボディは見やすくするために折り返しています）：**

    ```
    HTTP/1.1 200 OK
    Date: Thu, 13 Oct 2011 00:57:08 GMT
    Status: 200 OK
    Content-Type: text/html; charset=utf-8
    Content-Length: 157
    Pragma: no-cache
    Expires: Tue, 31 Mar 1981 05:00:00 GMT
    Cache-Control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0
    Vary: Accept-Encoding
    Server: tfe

    oauth_token=7588892-kagSNqWge8gB1WwE3plnFsJHAZVfxWD7Vb57p0b4&
    oauth_token_secret=PbKfYqSryyeKDWz4ebtY3o5ogNLG11WJuZBc9fQrQo
    ```
  </Tab>
</Tabs>

<Tabs>
  <Tab title="その他のリソース">
    ### Log in with X のリソース

    #### クライアントライブラリ

    [X libraries](/ja/resources/tools-and-libraries) に掲載されているクライアントライブラリは、Log in with X の実装に役立ちます。前の手順で説明したとおり、`/oauth/authenticate` エンドポイントを使用します。

    #### Brand Toolkit

    X では、一貫したブランディングのために、公式の [X Brand Toolkit](https://about.x.com/en/who-we-are/brand-toolkit) をアプリケーションで使用していただくことを推奨しています。これらのアセットを保存し、「Login with X」ボタンを作成する際に使用してください。
  </Tab>

  <Tab title="ブラウザーでのサインインフロー">
    ブラウザーでのログインフローは、ウェブブラウザーを開く／埋め込むことができるウェブサイトやアプリケーションに適しています。大まかな流れは次のとおりです。

    * アプリケーションが「Sign in with X」リンクまたはボタンを表示する。
    * ユーザーがサインインボタンをクリックする。
    * 現在のウェブブラウザーが X へリダイレクトされる（または新しいブラウザーが開かれ、X に遷移する）。
    * 必要に応じて、ユーザーは X 上でログインと認可のステップを完了する。
    * X は、ユーザーの認可情報を渡しつつ、アプリケーションが管理する URL にリダイレクトする。

    X は認可状態を管理しているため、すでに X.com にサインイン済みでアプリケーションを認可しているユーザーには UI は表示されず、自動的にアプリケーションへリダイレクトされます。

    ### デスクトップフロー

    <Frame>
      <img src="/images/browser_111.png" alt="" />
    </Frame>

    フローを説明するために、上のスクリーンショットにあるウェブサイト（「The greatest website ever created」）がこの API を実装していると仮定します。ランディングページに Sign in with X ボタンが表示されていることからそれが分かります。

    ユーザーが Sign in ボタンをクリックしたときに表示されるページは、ユーザーがサインインしているかどうか、およびすでにアプリケーションへのアクセスを許可しているかどうかによって異なります。

    ユーザーが x.com にサインインしているがアクセスを許可していない場合は、要求されている権限の一覧と、Sign In ボタンおよび Cancel ボタンが表示されます。

    ユーザーが x.com にサインインしていない場合は、ユーザー名とパスワードの入力フィールドが表示されます。なお、ユーザーがすでにアプリケーションへのアクセスを許可している場合でも、権限の一覧は引き続き表示されます。

    <Frame>
      <img src="/images/browser_2.png" alt="" />
    </Frame>

    <Frame>
      <img src="/images/browser_3.png" alt="" />
    </Frame>

    <Frame>
      <img src="/images/browser_4.png" alt="" />
    </Frame>

    ユーザーが有効な資格情報を入力（必要な場合）して “Sign In” をクリックすると、X はサインインフローを開始したウェブサイトへユーザーをリダイレクトします。

    ユーザーがすでに x.com にサインインしていて、かつそのウェブサイトへのアクセスを許可している場合は、このリダイレクトは即座に行われます。
  </Tab>

  <Tab title="モバイルでのサインインフロー">
    モバイルウェブブラウザーでの UI フローは、ブラウザーでのサインインフローとまったく同じですが、モバイルブラウザー向けに最適化されています。

    以下は、サインイン済みの画面、未サインイン状態の画面、およびリダイレクト画面のスクリーンショットです。

    <Frame>
      <img src="/images/authorize-login-screenshot.png" alt="" />
    </Frame>

    <Frame>
      <img src="/images/authorize-logged-in" alt="" />
    </Frame>

    <Frame>
      <img src="/images/redirect-application.png" alt="" />
    </Frame>
  </Tab>
</Tabs>